(function(){var zebkitEnvironment=function(){var pkg={},hostRe=/([a-zA-Z]+)\:\/\/([^/:]+)/,isFF=typeof navigator!=="undefined"&&navigator.userAgent.toLowerCase().indexOf("firefox")>=0;function $sleep(){var r=new XMLHttpRequest,t=(new Date).getTime().toString(),i=window.location.toString().lastIndexOf("?");r.open("GET",window.location+(i>0?"&":"?")+t,false);r.send(null)}function $Request(){this.responseText=this.statusText="";this.onreadystatechange=this.responseXml=null;this.readyState=this.status=0}$Request.prototype.open=function(method,url,async,user,password){var m=url.match(hostRe);if(location.scheme.toLowerCase()==="file:"||m!==null&&typeof m[2]!=="undefined"&&m[2].toLowerCase()===location.host.toLowerCase()){this._request=new XMLHttpRequest;this._xdomain=false;var $this=this;this._request.onreadystatechange=function(){$this.readyState=$this._request.readyState;if($this._request.readyState===4){$this.responseText=$this._request.responseText;$this.responseXml=$this._request.responseXml;$this.status=$this._request.status;$this.statusText=$this._request.statusText}if($this.onreadystatechange){$this.onreadystatechange()}};return this._request.open(method,url,async!==false,user,password)}else{this._xdomain=true;this._async=async===true;this._request=new XDomainRequest;return this._request.open(method,url)}};$Request.prototype.send=function(data){if(this._xdomain){var originalReq=this._request,$this=this;originalReq.ontimeout=originalReq.onprogress=function(){};originalReq.onerror=function(){$this.readyState=4;$this.status=404;if($this._async&&$this.onreadystatechange){$this.onreadystatechange()}};originalReq.onload=function(){$this.readyState=4;$this.status=200;if($this._async&&$this.onreadystatechange){$this.onreadystatechange(originalReq.responseText,originalReq)}};originalReq.timeout=0;if(this._async===false){originalReq.send(data);while(this.status===0){pkg.$sleep()}this.readyState=4;this.responseText=originalReq.responseText}else{setTimeout(function(){originalReq.send(data)},10)}}else{return this._request.send(data)}};$Request.prototype.abort=function(data){return this._request.abort()};$Request.prototype.setRequestHeader=function(name,value){if(this._xdomain){if(name==="Content-Type"){return}else{throw new Error("Method 'setRequestHeader' is not supported for "+name)}}else{this._request.setRequestHeader(name,value)}};$Request.prototype.getResponseHeader=function(name){if(this._xdomain){throw new Error("Method is not supported")}return this._request.getResponseHeader(name)};$Request.prototype.getAllResponseHeaders=function(){if(this._xdomain){throw new Error("Method is not supported")}return this._request.getAllResponseHeaders()};pkg.getHttpRequest=function(){if(typeof XMLHttpRequest!=="undefined"){var r=new XMLHttpRequest;if(isFF){r.__send=r.send;r.send=function(data){try{return this.__send(data)}catch(e){if(!e.message||e.message.toUpperCase().indexOf("NS_ERROR_FAILURE")<0){throw new Error(e.toString())}}}}return"withCredentials"in r?r:new $Request}throw new Error("Archaic browser detected")};pkg.parseXML=function(s){function rmws(node){if(node.childNodes!==null){for(var i=node.childNodes.length;i-- >0;){var child=node.childNodes[i];if(child.nodeType===3&&child.data.match(/^\s*$/)!==null){node.removeChild(child)}if(child.nodeType===1){rmws(child)}}}return node}if(typeof DOMParser!=="undefined"){return rmws((new DOMParser).parseFromString(s,"text/xml"))}else{for(var n in{"Microsoft.XMLDOM":0,"MSXML2.DOMDocument":1,"MSXML.DOMDocument":2}){var p=null;try{p=new ActiveXObject(n);p.async=false}catch(e){continue}if(p===null){throw new Error("XML parser is not available")}p.loadXML(s);return p}}throw new Error("No XML parser is available")};pkg.loadImage=function(ph,success,error){var img=null;if(ph instanceof Image){img=ph}else{img=new Image;img.crossOrigin="";img.crossOrigin="anonymous";img.src=ph}if(img.complete===true&&img.naturalWidth!==0){success.call(this,img)}else{var pErr=img.onerror,pLoad=img.onload,$this=this;img.onerror=function(e){img.onerror=null;try{if(typeof error!=="undefined"){error.call($this,img,new Error("Image '"+ph+"' cannot be loaded "+e))}}finally{if(typeof pErr==="function"){img.onerror=pErr;pErr.call(this,e)}}};img.onload=function(e){img.onload=null;try{success.call($this,img)}finally{if(typeof pLoad==="function"){img.onload=pLoad;pLoad.call(this,e)}}}}return img};pkg.parseJSON=JSON.parse;pkg.stringifyJSON=JSON.stringify;pkg.setInterval=function(cb,time){return window.setInterval(cb,time)};pkg.clearInterval=function(id){return window.clearInterval(id)};if(typeof window!=="undefined"){var $taskMethod=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){return setTimeout(callback,35)};pkg.decodeURIComponent=window.decodeURIComponent;pkg.encodeURIComponent=window.encodeURIComponent}else{pkg.decodeURIComponent=function(s){return s};pkg.encodeURIComponent=function(s){return s}}pkg.animate=function(f){return $taskMethod.call(window,f)};function buildFontHelpers(){var e=document.getElementById("zebkit.fm");if(e===null){e=document.createElement("div");e.setAttribute("id","zebkit.fm");e.setAttribute("style","visibility:hidden;line-height:0;height:1px;vertical-align:baseline;position:fixed;");e.innerHTML="<span id='zebkit.fm.text' style='display:inline;vertical-align:baseline;'>&nbsp;</span>"+"<img id='zebkit.fm.image' style='width:1px;height:1px;display:inline;vertical-align:baseline;' width='1' height='1'/>";document.body.appendChild(e)}var $fmCanvas=document.createElement("canvas").getContext("2d"),$fmText=document.getElementById("zebkit.fm.text"),$fmImage=document.getElementById("zebkit.fm.image");$fmImage.onload=function(){};$fmImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII%3D";pkg.fontMeasure=$fmCanvas;pkg.fontStringWidth=function(font,str){if(str.length===0){return 0}else{if($fmCanvas.font!==font){$fmCanvas.font=font}return $fmCanvas.measureText(str).width+.5|0}};pkg.fontMetrics=function(font){if($fmText.style.font!==font){$fmText.style.font=font}var height=$fmText.offsetHeight;if(height===0){height=$fmText.offsetHeight}return{height:height,ascent:$fmImage.offsetTop-$fmText.offsetTop+1}}}if(typeof document!=="undefined"){document.addEventListener("DOMContentLoaded",buildFontHelpers)}return pkg};if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports.zebkitEnvironment=zebkitEnvironment;if(typeof global!=="undefined"){global.zebkitEnvironment=zebkitEnvironment}}else{window.zebkitEnvironment=zebkitEnvironment}})();(function(){var zenv={},isInBrowser=typeof navigator!=="undefined",$global=typeof window!=="undefined"&&window!==null?window:typeof global!=="undefined"?global:this;if(typeof zebkitEnvironment==="function"){zenv=zebkitEnvironment()}else{if(typeof window!=="undefined"){zenv=window}}var $uriRE=/^(([a-zA-Z]+)\:\/\/([^\/:]+)?(\:[0-9]+)?(\/)?)?([^?]+)?(\?.+)?/;function URI(uri){if(arguments.length>1){if(arguments[0]!==null){this.scheme=arguments[0].toLowerCase()}if(arguments[1]!==null){this.host=arguments[1]}var ps=false;if(arguments.length>2){if(isNumber(arguments[2])){this.port=arguments[2]}else if(arguments[2]!==null){this.path=arguments[2];ps=true}}if(arguments.length>3){if(ps===true){this.qs=arguments[3]}else{this.path=arguments[3]}}if(arguments.length>4){this.qs=arguments[4]}}else if(uri instanceof URI){this.host=uri.host;this.path=uri.path;this.qs=uri.qs;this.port=uri.port;this.scheme=uri.scheme}else{var m=uri.match($uriRE);if(m===null){throw new Error("Invalid URI '"+uri+"'")}if(typeof m[1]!=="undefined"){this.scheme=m[2].toLowerCase();if(typeof m[3]==="undefined"){if(this.scheme!=="file"){throw new Error("Invalid host name : '"+url+"'")}}else{this.host=m[3]}if(typeof m[4]!=="undefined"){this.port=parseInt(m[4].substring(1),10)}}if(typeof m[6]!=="undefined"){this.path=m[6]}else if(typeof m[1]!=="undefined"){throw new Error("Invalid URL '"+url+"'")}if(typeof m[7]!=="undefined"&&m[7].length>1){this.qs=m[7].substring(1).trim()}}if(this.path!==null){this.path=this.path.replace(/\/\/*/g,"/");var l=this.path.length;if(l>1&&this.path[l-1]==="/"){this.path=this.path.substring(0,l-1)}if((this.host!==null||this.scheme!==null)&&this.path[0]!=="/"){this.path="/"+this.path}}}URI.prototype={scheme:null,host:null,port:-1,path:null,qs:null,toString:function(){return(this.scheme!==null?this.scheme+"://":"")+(this.host!==null?this.host:"")+(this.port!==-1?":"+this.port:"")+(this.path!==null?this.path:"")+(this.qs!==null?"?"+this.qs:"")},getParent:function(){if(this.path===null){return null}else{var i=this.path.lastIndexOf("/");return i<0||this.path==="/"?null:new zebkit.URI(this.scheme,this.host,this.port,this.path.substring(0,i),this.qs)}},appendQS:function(obj){if(obj!==null){if(this.qs===null){this.qs=""}if(this.qs.length>0){this.qs=this.qs+"&"+URI.toQS(obj)}else{this.qs=URI.toQS(obj)}}}};URI.isAbsolute=function(u){return u[0]==="/"||/^[a-zA-Z]+\:\/\//i.test(u)};URI.isURL=function(u){return/^[a-zA-Z]+\:\/\//i.test(u)};URI.parseQS=function(qs,decode){var mqs=qs.match(/[a-zA-Z0-9_.]+=[^?&=]+/g),parsedQS={};if(mqs!==null){for(var i=0;i<mqs.length;i++){var q=mqs[i].split("=");this.parsedQS[q[0].substring(1)]=decode===true?zebkit.environment.decodeURIComponent(q[1]):q[1]}}return parsedQS};URI.toQS=function(obj,encode){if(zebkit.isString(obj)||zebkit.isBoolean(obj)||zebkit.isNumber(obj)){return""+obj}var p=[];for(var k in obj){if(obj.hasOwnProperty(k)){p.push(k+"="+(encode===true?zebkit.environment.encodeURIComponent(obj[k].toString()):obj[k].toString()))}}return p.join("&")};URI.join=function(){var pu=new URI(arguments[0]);for(var i=1;i<arguments.length;i++){var p=arguments[i].toString().trim();if(p.length===0||URI.isAbsolute(p)){throw new Error("Absolute path '"+p+"' cannot be joined")}p=p.replace(/\/\/*/g,"/");if(p[p.length-1]==="/"){p=p.substring(0,p.length-1)}if(pu.path===null){pu.path=p;if((pu.host!==null||pu.scheme!==null)&&pu.path[0]!=="/"){pu.path="/"+pu.path}}else{pu.path=pu.path+"/"+p}}return pu.toString()};function DoIt(body,ignore){this.recover();if(arguments.length===1){if(zebkit.isBoolean(body)){this.$ignoreError=body;body=null}else{this.then(body)}}else if(arguments.length===2){this.$ignoreError=ignore;this.then(body)}}DoIt.prototype={recover:function(body){if(this.$error!==null){var err=this.$error;this.$error=null;this.$tasks=[];this.$results=[];this.$taskCounter=this.$level=this.$busy=0;if(arguments.length===1){body.call(this,err)}}},restart:function(){if(this.$error!==null){this.$error=null}this.$schedule();return this},then:function(body,completed){var level=this.$level;if(body instanceof DoIt){if(body.$error!==null){this.error(body.$error)}else{var $this=this;this.then(function(){var jn=$this.join();body.then(function(res){if(arguments.length>0){this.join.apply(this,arguments)}},function(){if($this.$error===null){jn.apply($this,arguments)}}).catch(function(e){$this.error(e)})})}return this}else{var task=function(){this.$busy=0;var pc=this.$taskCounter,args=null,r;if(this.$error===null){if(typeof this.$results[level]!=="undefined"){args=this.$results[level]}this.$taskCounter=0;this.$level=level+1;this.$results[level]=[];if(level>0){r=body.apply(this,args)}else{try{r=body.apply(this,args)}catch(e){this.error(e)}}if(this.$busy===0&&this.$error===null&&typeof r!=="undefined"){this.$results[level]=[r]}}if(level===0){try{this.$schedule()}catch(e){this.error(e)}}else{this.$schedule()}this.$level=level;this.$taskCounter=pc;if(typeof completed==="function"){if(level===0){try{if(args===null)completed.call(this);else completed.apply(this,args)}catch(e){this.error(e)}}else{if(args===null)completed.call(this);else completed.apply(this,args)}}if(args!==null)args.length=0};if(this.$error===null){if(level===0&&this.$busy===0){if(this.$results[level]!=null&&this.$results[level].length>0){task.apply(this,this.$results[level])}else{task.call(this)}}else{if(this.$level>0){this.$tasks.splice(this.$taskCounter++,0,task)}else{this.$tasks.push(task)}}}}if(this.$level===0){this.$schedule()}return this},$ignored:function(e){zebkit.dumpError(e)},error:function(e,pr){if(arguments.length===0){if(this.$error!==null){zebkit.dumpError(e)}}else{if(this.$error===null){if(this.$ignoreError){this.$ignored(e)}else{this.$taskCounter=this.$level=this.$busy=0;this.$error=e;this.$results=[]}this.$schedule()}else{if(arguments.length<2||pr===true){zebkit.dumpError(e)}}}return this},till:function(r){this.then(function(){var $this=this,jn=this.join(),res=arguments.length>0?Array.prototype.slice.call(arguments):[];r.then(function(){if($this.$error===null){if(res.length>0)jn.apply($this,res);else jn.call($this);if(arguments.length>0){this.join.apply(this,arguments)}}}).catch(function(e){$this.error(e)})});return this},join:function(){var level=this.$level===0?0:this.$level-1;if(arguments.length>0){this.$results[level]=[];for(var i=0;i<arguments.length;i++){this.$results[level][i]=arguments[i]}}else{var $this=this,index=this.$busy++;return function(){if($this.$results[level]==null){$this.$results[level]=[]}if($this.$busy>0){var i=0;if(arguments.length>0){$this.$results[level][index]=[];for(i=0;i<arguments.length;i++){$this.$results[level][index][i]=arguments[i]}}if(--$this.$busy===0){if($this.$results[level].length>0){var args=$this.$results[level],res=[];for(i=0;i<args.length;i++){Array.prototype.push.apply(res,args[i])}$this.$results[level]=res}$this.$schedule()}}}}},catch:function(body){var level=this.$level;var task=function(){this.$busy=0;var pc=this.$taskCounter;if(this.$error!==null){this.$taskCounter=0;this.$level=level+1;try{if(typeof body==="function"){body.call(this,this.$error)}else if(body===null){}else{zebkit.dumpError(this.$error)}}catch(e){this.$level=level;this.$taskCounter=pc;throw e}}if(level===0){try{this.$schedule()}catch(e){this.error(e)}}else{this.$schedule()}this.$level=level;this.$taskCounter=pc};if(this.$level>0){this.$tasks.splice(this.$taskCounter++,0,task)}else{this.$tasks.push(task)}if(this.$level===0){this.$schedule()}return this},throw:function(){return this.catch(function(e){throw e})},$schedule:function(){if(this.$tasks.length>0&&this.$busy===0){this.$tasks.shift().call(this)}},end:function(){this.recover()}};function isString(o){return typeof o!=="undefined"&&o!==null&&(typeof o==="string"||o.constructor===String)}function isNumber(o){return typeof o!=="undefined"&&o!==null&&(typeof o==="number"||o.constructor===Number)}function isBoolean(o){return typeof o!=="undefined"&&o!==null&&(typeof o==="boolean"||o.constructor===Boolean)}function lookupObjValue(obj,name){if(arguments.length===1){name=obj;obj=$global}if(typeof name==="undefined"||name.trim().length===0){throw new Error("Invalid field name: '"+name+"'")}var names=name.trim().split(".");for(var i=0;i<names.length;i++){obj=obj[names[i]];if(typeof obj==="undefined"||i+1===names.length&&obj===null){throw new Error("'"+name+"' value cannot be detected")}}return obj}function $ls(callback,all){for(var k in this){var v=this[k];if(this.hasOwnProperty(k)&&v instanceof Package===false){if(k[0]!=="$"&&k[0]!=="_"||all===true){if(callback.call(this,k,this[k])===true){return true}}}}return false}function $lsall(fn){return $ls.call(this,function(k,v){if(v!==null&&v.clazz===zebkit.Class){if(typeof v.$name==="undefined"){v.$name=fn+k;v.$pkg=lookupObjValue($global,fn.substring(0,fn.length-1))}return $lsall.call(v,v.$name+".")}})}function Package(name,parent){this.$url=null;this.$name=name;this.config={};this.$ready=new DoIt;this.$parent=arguments.length<2?null:parent;if(typeof __dirname!=="undefined"){this.$url=__dirname}else if(typeof document!=="undefined"){var s=document.getElementsByTagName("script"),ss=s[s.length-1].getAttribute("src"),i=ss===null?-1:ss.lastIndexOf("/"),a=document.createElement("a");a.href=i>0?ss.substring(0,i+1):document.location.toString();this.$url=a.href.toString()}}Package.prototype.fullname=function(){var n=[this.$name],p=this;while(p.$parent!==null){p=p.$parent;n.unshift(p.$name)}return n.join(".")};Package.prototype.cd=function(path){if(path[0]==="/"){path=path.substring(1)}var paths=path.split("/"),pk=this;for(var i=0;i<paths.length;i++){var pn=paths[i];if(pn===".."){pk=pk.$parent}else{pk=pk[pn]}if(typeof pk==="undefined"||pk===null){throw new Error("Package path '"+path+"' cannot be resolved")}}return pk};Package.prototype.packages=function(callback,recursively){for(var k in this){var v=this[k];if(k!=="$parent"&&this.hasOwnProperty(k)&&v instanceof Package){if(callback.call(this,k,v)===true||recursively===true&&v.packages(callback,recursively)===true){return true}}}return false};Package.prototype.ls=function(cb,all){return $ls.call(this,cb,all)};Package.prototype.import=function(){var code=[];if(arguments.length>0){for(var i=0;i<arguments.length;i++){var v=lookupObjValue(this,arguments[i]);if(v instanceof Package===false){throw new Error("Package '"+arguments[i]+" ' cannot be found")}code.push(v.import())}return code.length>0?code.join(";"):null}else{var fn=this.fullname();this.ls(function(k,v){code.push(k+"="+fn+"."+k)});return code.length>0?"var "+code.join(",")+";":null}};Package.prototype.require=function(){var pkgs=[],$this=this,fn=arguments[arguments.length-1];if(typeof fn!=="function"){throw new Error("Invalid callback function")}for(var i=0;isString(arguments[i])&&i<arguments.length;i++){var pkg=lookupObjValue(this,arguments[i]);if(pkg instanceof Package===false){throw new Error("Package '"+arguments[i]+"' cannot be found")}pkgs.push(pkg)}return this.then(function(){fn.apply($this,pkgs)})};var $textualFileExtensions=["txt","json","htm","html","md","properties","conf","xml"];Package.prototype.resources=function(){var args=Array.prototype.slice.call(arguments),$this=this,fn=args.pop();if(typeof fn!=="function"){throw new Error("Invalid callback function")}this.then(function(){for(var i=0;i<args.length;i++){(function(path,jn){var m=path.match(/^(\<[a-z]+\>\s*)?(.*)$/),type="img",p=m[2].trim();if(typeof m[1]!=="undefined"){type=m[1].trim().substring(1,m[1].length-1).trim()}else{var li=p.lastIndexOf(".");if(li>0){var ext=p.substring(li+1).toLowerCase();if($textualFileExtensions.indexOf(ext)>=0){type="txt"}}}if(type==="img"){zebkit.environment.loadImage(p,function(img){jn(img)},function(img,e){jn(img)})}else if(type==="txt"){var req=zebkit.environment.getHttpRequest();req.open("GET",p,true);req.onreadystatechange=function(){if(req.readyState===4){if(req.status>=400||req.status<100){console.log("HTTP error '"+req.statusText+"', code = "+req.status+" '"+path+"'");jn(null)}else{jn(req.responseText)}}};try{req.send(null)}catch(e){jn(null)}}else{console.log("Invalid path '"+path+"'");jn(null)}})(args[i],this.join())}}).then(function(){fn.apply($this,arguments)})};Package.prototype.then=function(f){this.$ready.then(f).catch(function(e){zebkit.dumpError(e);this.restart()});return this};Package.prototype.join=function(){return this.$ready.join.apply(this.$ready,arguments)};Package.prototype.package=function(name,callback){if(arguments.length===0){return this}var target=this;if(typeof arguments[0]!=="function"){if(typeof name==="undefined"||name===null){throw new Error("Null package name")}name=name.trim();if(name.match(/^[a-zA-Z_][a-zA-Z0-9_]+(\.[a-zA-Z_][a-zA-Z0-9_]+)*$/)===null){throw new Error("Invalid package name '"+name+"'")}var names=name.split(".");for(var i=0,k=names[0];i<names.length;i++,k=k+"."+names[i]){var n=names[i],p=target[n];if(typeof p==="undefined"){p=new Package(n,target);target[n]=p}else if(p instanceof Package===false){throw new Error("Requested package '"+name+"' conflicts with variable '"+n+"'")}target=p}}if(typeof arguments[arguments.length-1]==="function"){var f=arguments[arguments.length-1];this.then(function(){f.call(target,target,typeof zebkit!=="undefined"?zebkit.Class:null);$lsall.call(target,target.fullname()+".")})}return target};var zebkit=new Package("zebkit");zebkit.environment=zenv;if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=zebkit;if(typeof global!=="undefined"){global.zebkit=zebkit}}else{window.zebkit=zebkit}zebkit.package(function(pkg){var $$$=11,$caller=null;function ProxyMethod(name,f,clazz){if(typeof f.methodBody!=="undefined"){throw new Error("Proxy method '"+name+"' cannot be wrapped")}var a=function(){var cm=$caller;$caller=a;try{var r=f.apply(this,arguments);$caller=cm;return r}catch(e){$caller=cm;console.log(name+"("+arguments.length+") "+(e.stack?e.stack:e));throw e}};a.methodBody=f;a.methodName=name;a.boundTo=clazz;return a}function cpMethods(src,dest,clazz){var overriddenAbstractMethods=0;for(var name in src){if(name!==pkg.CNAME&&name!=="clazz"&&src.hasOwnProperty(name)){var method=src[name];if(typeof method==="function"&&method!==$toString){if(name==="$prototype"){method.call(dest,clazz)}else{if(typeof dest[name]!=="undefined"){if(method.$isAbstract===true){overriddenAbstractMethods++;continue}if(dest[name].boundTo===clazz){throw new Error("Method '"+name+"(...)'' bound to this class already exists")}}if(typeof method.methodBody!=="undefined"){dest[name]=ProxyMethod(name,method.methodBody,clazz)}else{dest[name]=ProxyMethod(name,method,clazz)}if(method.$isAbstract===true){dest[name].$isAbstract=true}}}}}return overriddenAbstractMethods}function $toString(){return this.$hash$}function make_template(instanceOf,templateConstructor,inheritanceList){templateConstructor.$hash$="$zEk$"+$$$++;templateConstructor.toString=$toString;templateConstructor.prototype.clazz=templateConstructor;templateConstructor.clazz=templateConstructor.constructor=instanceOf;templateConstructor.$parents={};templateConstructor.prototype.constructor=templateConstructor;if(arguments.length>2&&inheritanceList.length>0){for(var i=0;i<inheritanceList.length;i++){var toInherit=inheritanceList[i];if(typeof toInherit==="undefined"||toInherit===null||typeof toInherit!=="function"||typeof toInherit.$hash$==="undefined"){throw new ReferenceError("Invalid parent class or interface:"+toInherit)}if(typeof templateConstructor.$parents[toInherit.$hash$]!=="undefined"){throw Error("Duplicate toInherit class or interface: "+toInherit)}templateConstructor.$parents[toInherit.$hash$]=toInherit;for(var k in toInherit.$parents){if(typeof templateConstructor.$parents[k]!=="undefined"){throw Error("Duplicate inherited class or interface: "+k)}templateConstructor.$parents[k]=toInherit.$parents[k]}}}return templateConstructor}pkg.dumpError=function(e){if(typeof console!=="undefined"&&typeof console.log!=="undefined"){var msg="zebkit.err [";if(typeof Date!=="undefined"){var date=new Date;msg=msg+date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear()+" "+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()}console.log(msg+"] : "+e);if(e===null||typeof e==="undefined"){console.log("Unknown error")}else{console.log(e.stack?e.stack:e)}}};pkg.URI=URI;pkg.CNAME="$";pkg.CDNAME="";pkg.$FN=isString.name!=="isString"?function(f){if(typeof f.$methodName==="undefined"){var mt=f.toString().match(/^function\s+([^\s(]+)/);f.$methodName=mt===null?pkg.CDNAME:typeof mt[1]==="undefined"?pkg.CDNAME:mt[1]}return f.$methodName}:function(f){return f.name};pkg.isIE=isInBrowser&&(Object.hasOwnProperty.call(window,"ActiveXObject")||!!window.ActiveXObject||window.navigator.userAgent.indexOf("Edge")>-1);pkg.isFF=isInBrowser&&window.mozInnerScreenX!==null;pkg.isMacOS=isInBrowser&&navigator.platform.toUpperCase().indexOf("MAC")!==-1;pkg.isString=isString;pkg.isNumber=isNumber;pkg.isBoolean=isBoolean;pkg.$global=$global;pkg.$Map=function(){var Map=function(){this.keys=[];this.values=[];this.size=0};Map.prototype={set:function(key,value){var i=this.keys.indexOf(key);if(i<0){this.keys.push(key);this.values.push(value);this.size++}else{this.values[i]=value}return this},delete:function(key){var i=this.keys.indexOf(key);if(i<0){return false}this.keys.splice(i,1);this.values.splice(i,1);this.size--;return true},get:function(key){var i=this.keys.indexOf(key);return i<0?undefined:this.values[i]},clear:function(){this.keys=[];this.keys.length=0;this.values=[];this.values.length=0;this.size=0},has:function(key){return this.keys.indexOf(key)>=0},forEach:function(callback,context){var $this=arguments.length<2?this:context;for(var i=0;i<this.size;i++){callback.call($this,this.values[i],this.keys[i],this)}}};return Map};if(typeof Map==="undefined"&&(typeof pkg.$global!=="undefined"||typeof pkg.$global.Map==="undefined")){pkg.$global.Map=pkg.$Map()}pkg.clone=function(obj,map){if(obj===null||typeof obj==="undefined"||obj.$notCloneable===true||(typeof obj==="string"||obj.constructor===String)||(typeof obj==="boolean"||obj.constructor===Boolean)||(typeof obj==="number"||obj.constructor===Number)){return obj}map=map||new Map;var t=map.get(obj);if(typeof t!=="undefined"){return t}if(typeof obj.$clone!=="undefined"){return obj.$clone(map)}if(Array.isArray(obj)){var naobj=[];map.set(obj,naobj);map[obj]=naobj;for(var i=0;i<obj.length;i++){naobj[i]=pkg.clone(obj[i],map)}return naobj}if(obj.clazz===pkg.Class){var clazz=pkg.Class(obj,[]);clazz.inheritProperties=true;return clazz}if(typeof obj==="function"||obj.constructor!==Object){return obj}var nobj={};map.set(obj,nobj);for(var k in obj){if(obj.hasOwnProperty(k)===true){nobj[k]=pkg.clone(obj[k],map)}}return nobj};pkg.newInstance=function(clazz,args){if(arguments.length>1&&args.length>0){var f=function(){};f.prototype=clazz.prototype;var o=new f;clazz.apply(o,args);return o}return new clazz};pkg.getPropertySetter=function(obj,name){var pi=obj.constructor.$propertyInfo,m=null;if(typeof pi!=="undefined"){if(typeof pi[name]==="undefined"){m=obj["set"+name[0].toUpperCase()+name.substring(1)];pi[name]=typeof m==="function"?m:null}return pi[name]}m=obj["set"+name[0].toUpperCase()+name.substring(1)];return typeof m==="function"?m:null};pkg.properties=function(target,p){for(var k in p){if(k!=="clazz"&&k[0]!=="$"&&p.hasOwnProperty(k)&&typeof p[k]!=="undefined"&&typeof p[k]!=="function"){if(k[0]==="-"){delete target[k.substring(1)]}else{var v=p[k],m=zebkit.getPropertySetter(target,k);if(v!==null&&typeof v.$new!=="undefined"){v=v.$new()}if(m===null){target[k]=v}else{if(Array.isArray(v))m.apply(target,v);else m.call(target,v)}}}}return target};function $make_proto(props,superProto){if(superProto===null){return function $prototype(clazz){for(var k in props){if(props.hasOwnProperty(k)){this[k]=props[k]}}}}else{return function $prototype(clazz){superProto.call(this,clazz);for(var k in props){if(props.hasOwnProperty(k)){this[k]=props[k]}}}}}pkg.Interface=make_template(null,function(){var $Interface=make_template(pkg.Interface,function(){if(typeof this==="undefined"||this.constructor!==$Interface){if(arguments.length!==1){throw new Error("Invalid number of arguments. Properties set is expected")}if(arguments[0].constructor!==Object){throw new Error("Invalid argument type. Properties set is expected")}var clone=$Interface.$clone();clone.prototype.$prototype=$make_proto(arguments[0],$Interface.prototype.$prototype);return clone}else{if(arguments.length>1){throw new Error("One or zero argument is expected")}return new(pkg.Class($Interface,arguments.length>0?arguments[0]:[]))}});if(arguments.length>1){throw new Error("Invalid number of arguments. List of methods or properties is expected")}$Interface.$abstractMethods=0;var arg=arguments.length===0?[]:arguments[0];if(arg.constructor===Object){arg=[$make_proto(arg,null)]}else if(Array.isArray(arg)===false){throw new Error("Invalid argument type. List of methods pr properties is expected")}if(arg.length>0){var proto=$Interface.prototype,isAbstract=false;for(var i=0;i<arg.length;i++){var method=arg[i];if(method==="abstract"){isAbstract=true}else{if(typeof method!=="function"){throw new Error("Method is expected instead of "+method)}var name=pkg.$FN(method);if(name===pkg.CDNAME){throw new Error("Constructor declaration is not allowed in interface")}if(typeof proto[name]!=="undefined"){throw new Error("Duplicated interface method '"+name+"(...)'")}if(name==="$clazz"){method.call($Interface,$Interface)}else if(isAbstract===true){(function(name){proto[name]=function(){throw new Error("Abstract method '"+name+"(...)' is not implemented")};proto[name].$isAbstract=true;$Interface.$abstractMethods++})(name)}else{proto[name]=method}}}}$Interface.$clone=function(){var clone=pkg.Interface(),k=null;for(k in this){if(this.hasOwnProperty(k)){clone[k]=pkg.clone(this[k])}}var proto=this.prototype;for(k in proto){if(k!=="clazz"&&proto.hasOwnProperty(k)===true){clone.prototype[k]=pkg.clone(proto[k])}}return clone};$Interface.clazz.$name="zebkit.Interface";return $Interface});var mixing=pkg.$mixing=function(clazz,methods){if(Array.isArray(methods)===false){throw new Error("Methods array is expected ("+methods+")")}var names={};for(var i=0;i<methods.length;i++){var method=methods[i],methodName=pkg.$FN(method);if(typeof method.methodBody!=="undefined"){throw new Error("Proxy method '"+methodName+"' cannot be mixed in a class")}if(methodName===pkg.CDNAME){methodName=pkg.CNAME}else if(methodName[0]==="$"){if(methodName==="$prototype"){method.call(clazz.prototype,clazz);if(clazz.prototype[pkg.CDNAME]){clazz.prototype[pkg.CNAME]=clazz.prototype[pkg.CDNAME];delete clazz.prototype[pkg.CDNAME]}continue}if(methodName==="$clazz"){method.call(clazz);continue}}if(names[methodName]===true){throw new Error("Duplicate declaration of '"+methodName+"(...)' method")}var existentMethod=clazz.prototype[methodName];if(typeof existentMethod!=="undefined"&&typeof existentMethod!=="function"){throw new Error("'"+methodName+"(...)' method clash with a field")}if(typeof existentMethod==="undefined"&&methodName===pkg.CNAME){clazz.prototype[methodName]=method}else{clazz.prototype[methodName]=ProxyMethod(methodName,method,clazz)}names[methodName]=true}};pkg.Class=make_template(null,function(){if(arguments.length===0){throw new Error("No class method list was found")}if(Array.isArray(arguments[arguments.length-1])===false){throw new Error("No class methods have been passed")}if(arguments.length>1&&typeof arguments[0]!=="function"){throw new ReferenceError("Invalid parent class or interface '"+arguments[0]+"'")}var classMethods=arguments[arguments.length-1],parentClass=null,toInherit=[];if(arguments.length>0&&(arguments[0]===null||arguments[0].clazz===pkg.Class)){parentClass=arguments[0]}for(var i=0;i<arguments.length-1;i++){toInherit[i]=arguments[i];if(parentClass===null||i>0){if(typeof toInherit[i]==="undefined"||toInherit[i]===null){throw new ReferenceError("Undefined inherited interface ["+i+"] ")}else if(toInherit[i].clazz!==pkg.Interface){throw new ReferenceError("Inherited interface is not an Interface ( ["+i+"] '"+toInherit[i]+"'')")}}}var classTemplate=make_template(pkg.Class,function(){if(classTemplate.$uniqueness===true){this.$hash$="$ZkIo"+$$$++}if(arguments.length>0){var a=arguments[arguments.length-1];if(Array.isArray(a)===true&&typeof a[0]==="function"){a=a[0];var args=[classTemplate],k=arguments.length-2;for(;k>=0&&arguments[k].clazz===pkg.Interface;k--){args.push(arguments[k])}args.push(arguments[arguments.length-1]);var cl=pkg.Class.apply(null,args),f=function(){};cl.$name=classTemplate.$name;f.prototype=cl.prototype;var o=new f;args=[];for(var i=0;i<k+1;i++){args[i]=arguments[i]}cl.apply(o,args);o.constructor=cl;return o}}if(typeof this.$!=="undefined"){return this.$.apply(this,arguments)}},toInherit);classTemplate.$propertyInfo={};classTemplate.$parent=parentClass;if(parentClass!==null){for(var k in parentClass.prototype){if(parentClass.prototype.hasOwnProperty(k)){var f=parentClass.prototype[k];classTemplate.prototype[k]=typeof f!=="undefined"&&f!==null&&f.hasOwnProperty("methodBody")?ProxyMethod(f.methodName,f.methodBody,f.boundTo):f}}}classTemplate.prototype.extend=function(){var clazz=this.clazz,l=arguments.length,f=arguments[l-1],hasArray=Array.isArray(f),i=0;if(this.$isExtended!==true){clazz=pkg.Class(clazz,[]);this.$isExtended=true;clazz.$name=this.clazz.$name;this.clazz=clazz}if(hasArray){var init=null;for(i=0;i<f.length;i++){var n=pkg.$FN(f[i]);if(n===pkg.CDNAME){init=f[i]}else{if(typeof this[n]!=="undefined"&&typeof this[n]!=="function"){throw new Error("Method '"+n+"' clash with a property")}this[n]=ProxyMethod(n,f[i],clazz)}}if(init!==null){init.call(this)}l--}for(i=0;i<arguments.length-(hasArray?1:0);i++){if(arguments[i].clazz!==pkg.Interface){throw new Error("Invalid argument "+arguments[i]+" Interface is expected.")}var I=arguments[i];if(typeof clazz.$parents[I.$hash$]!=="undefined"){throw new Error("Interface has been already inherited")}cpMethods(I.prototype,this,clazz);clazz.$parents[I.$hash$]=I}return this};classTemplate.prototype.$super=function(){if($caller!==null){for(var $s=$caller.boundTo.$parent;$s!==null;$s=$s.$parent){var m=$s.prototype[$caller.methodName];if(typeof m!=="undefined"){return m.apply(this,arguments)}}var cln=this.clazz&&this.clazz.$name?this.clazz.$name+".":"";throw new ReferenceError("Method '"+cln+($caller.methodName===pkg.CNAME?"constructor":$caller.methodName)+"("+arguments.length+")"+"' not found")}else{throw new Error("$super is called outside of class context")}};classTemplate.prototype.$supera=function(args){if($caller!==null){for(var $s=$caller.boundTo.$parent;$s!==null;$s=$s.$parent){var m=$s.prototype[$caller.methodName];if(typeof m!=="undefined"){return m.apply(this,args)}}var cln=this.clazz&&this.clazz.$name?this.clazz.$name+".":"";throw new ReferenceError("Method '"+cln+($caller.methodName===pkg.CNAME?"constructor":$caller.methodName)+"("+arguments.length+")"+"' not found")}else{throw new Error("$super is called outside of class context")}};classTemplate.prototype.$$super=function(){if($caller!==null){for(var $s=$caller.boundTo.$parent;$s!==null;$s=$s.$parent){var m=$s.prototype[$caller.methodName];if(typeof m!=="undefined"){return m.apply(this,arguments)}}}else{throw new Error("$super is called outside of class context")}};classTemplate.prototype.$getSuper=function(name){if($caller!==null){for(var $s=$caller.boundTo.$parent;$s!==null;$s=$s.$parent){var m=$s.prototype[name];if(typeof m==="function"){return m}}return null}throw new Error("$super is called outside of class context")};classTemplate.prototype.$genHash=function(){if(typeof this.$hash$==="undefined"){this.$hash$="$ZeInGen"+$$$++}return this.$hash$};classTemplate.prototype.$clone=function(map){map=map||new Map;var f=function(){};f.prototype=this.constructor.prototype;var nobj=new f;map.set(this,nobj);for(var k in this){if(this.hasOwnProperty(k)){var t=map.get(this[k]);if(t!==undefined){nobj[k]=t}else{nobj[k]=zebkit.clone(this[k],map)}}}map.clear();nobj.constructor=this.constructor;if(typeof nobj.$hash$!=="undefined"){nobj.$hash$="$zObj_"+$$$++}nobj.clazz=this.clazz;return nobj};classTemplate.prototype.clazz=classTemplate;if(typeof classTemplate.prototype.properties==="undefined"){classTemplate.prototype.properties=function(p){return pkg.properties(this,p)}}if(toInherit.length>0){for(var i=toInherit[0].clazz===pkg.Interface?0:1;i<toInherit.length;i++){var ic=toInherit[i];cpMethods(ic.prototype,classTemplate.prototype,classTemplate);for(var sk in ic){if(sk[0]!=="$"&&ic.hasOwnProperty(sk)===true&&classTemplate.hasOwnProperty(sk)===false){classTemplate[sk]=pkg.clone(ic[sk])}}}}mixing(classTemplate,classMethods);classTemplate.$uniqueness=false;if(parentClass!==null){for(var key in parentClass){if(key[0]!=="$"&&parentClass.hasOwnProperty(key)&&classTemplate.hasOwnProperty(key)===false){classTemplate[key]=pkg.clone(parentClass[key])}}if(parentClass.$uniqueness===true){classTemplate.hashable()}}classTemplate.hashable=function(){if(this.$uniqueness!==true){this.$uniqueness=true;this.prototype.toString=$toString}return this};classTemplate.hashless=function(){if(this.$uniqueness===true){this.$uniqueness=false;this.prototype.toString=Object.prototype.toString}return this};classTemplate.extend=function(){var methods=arguments[arguments.length-1],hasMethod=Array.isArray(methods);if(hasMethod&&this.$isExtended!==true){var A=this.$parent!==null?pkg.Class(this.$parent,[]):pkg.Class([]);for(var name in this.prototype){if(name!=="clazz"&&this.prototype.hasOwnProperty(name)){var f=this.prototype[name];if(typeof f==="function"){A.prototype[name]=typeof f.methodBody!=="undefined"?ProxyMethod(name,f.methodBody,f.boundTo):f;if(A.prototype[name].boundTo===this){A.prototype[name].boundTo=A;if(f.boundTo===this){f.boundTo=A}}}}}this.$parent=A;this.$isExtended=true}if(hasMethod){mixing(this,methods)}for(var i=0;i<arguments.length-(hasMethod?1:0);i++){var I=arguments[i];if(I===null||typeof I==="undefined"||I.clazz!==zebkit.Interface){throw new Error("Interface is expected")}if(typeof this.$parents[I.$hash$]!=="undefined"){throw new Error("Interface has been already inherited")}cpMethods(I.prototype,this.prototype,this);this.$parents[I.$hash$]=I}};classTemplate.isInherit=function(clazz){if(this!==clazz){if(clazz.clazz===this.clazz){for(var p=this.$parent;p!==null;p=p.$parent){if(p===clazz){return true}}}else{if(this.$parents[clazz.$hash$]===clazz){return true}}}return false};classTemplate.clazz.$name="zebkit.Class";if(toInherit.length>0){for(var i=0;i<toInherit.length;i++){if(typeof toInherit[i].inheritedWidth==="function"){toInherit[i].inheritedWidth(classTemplate)}}}return classTemplate});var $cachedO=pkg.$cachedO={},$cachedE=pkg.$cachedE=[];pkg.$cacheSize=7777;pkg.$cache=function(key){if(pkg.$global.hasOwnProperty(key)){return pkg.$global[key]}if($cachedO.hasOwnProperty(key)===true){var e=$cachedO[key];if(e.i<$cachedE.length-1){var pn=$cachedE[e.i+1];$cachedE[e.i]=pn;$cachedE[++e.i]=key;$cachedO[pn].i--}return e.o}var ctx=pkg.$global,i=0,j=0;for(;ctx!=null;){i=key.indexOf(".",j);if(i<0){ctx=ctx[key.substring(j,key.length)];break}ctx=ctx[key.substring(j,i)];j=i+1}if(ctx!=null){if($cachedE.length>=pkg.$cacheSize){var n=$cachedE[0];$cachedE[0]=key;$cachedO[key]={o:ctx,i:0};delete $cachedO[n]}else{$cachedO[key]={o:ctx,i:$cachedE.length};$cachedE[$cachedE.length]=key}return ctx}throw new Error("Reference '"+key+"' not found")};pkg.Class.forName=function(name){return pkg.$cache(name)};pkg.Class.newInstance=function(){return pkg.newInstance(this,arguments)};pkg.instanceOf=function(obj,clazz){if(clazz!==null&&typeof clazz!=="undefined"){if(obj===null||typeof obj==="undefined"){return false}else if(typeof obj.clazz==="undefined"){return obj instanceof clazz}else{return typeof obj.clazz!=="undefined"&&obj.clazz!==null&&(obj.clazz===clazz||obj.clazz.$parents.hasOwnProperty(clazz.$hash$))}}throw new Error("instanceOf(): null class")};pkg.Dummy=pkg.Class([]);pkg.DoIt=DoIt;pkg.EventProducer=pkg.Interface([function $prototype(){this.on=function(){var cb=arguments[arguments.length-1],pt=null,nm=null;if(cb===null||isString(cb)){throw new Error("Invalid event handler")}if(arguments.length===1){return this._.add(cb)}else if(arguments.length===2){if(arguments[0]===null){throw new Error("Invalid event or path")}else if(arguments[0][0]==="."||arguments[0][0]==="/"||arguments[0][0]==="#"){pt=arguments[0]}else{return this._.add(arguments[0],cb)}}else if(arguments.length===3){pt=arguments[1];nm=arguments[0];if(pt===null){return this._.add(nm,cb)}}this.byPath(pt,function(node){if(typeof node._!=="undefined"){if(nm!==null){if(typeof node._[nm]!=="undefined"){node._.add(nm,cb)}}else{node._.add(cb)}}return false});return cb};this.off=function(){var pt=null,fn=null,nm=null;if(arguments.length===0){return this._.remove()}else if(arguments.length===1){if(isString(arguments[0])&&(arguments[0][0]==="."||arguments[0][0]==="/"||arguments[0][0]==="#")){pt=arguments[0]}else{return this._.remove(arguments[0])}}else if(arguments.length===2){if(isString(arguments[1])){pt=arguments[1];nm=arguments[0]}else{if(isString(arguments[1])){nm=arguments[1]}else{fn=arguments[1]}if(arguments[0][0]==="."||arguments[0][0]==="/"||arguments[0][0]==="#"){pt=arguments[0]}else{throw new Error("Path is expected")}}}this.byPath(pt,function(node){if(typeof node._!=="undefined"){if(fn!==null){node._.remove(fn)}else if(nm!==null){if(typeof node._[nm]!=="undefined"){node._.remove(nm)}}else{node._.remove()}}return false})};this.fire=function(){var pt=null,args=null,nm=arguments[0];if(arguments.length>=0&&arguments.length<3){if(arguments.length===0){nm="fired"}if(this._.hasEvent(nm)===false){throw new Error("Listener doesn't '"+nm+"' support the event")}var fn=this._[nm];args=arguments.length===2?arguments[1]:this;return arguments.length===2&&Array.isArray(args)?fn.apply(this._,args):fn.call(this._,args)}else if(arguments.length===3){pt=arguments[1];args=arguments[2]}else{throw new Error("Invalid number of arguments")}this.byPath(pt,function(n){var ec=n._;if(typeof ec!=="undefined"&&n._.hasEvent(nm)){if(args!==null&&Array.isArray(args)){ec[nm].apply(ec,args)}else{ec[nm].call(ec,args)}}return false})}}])});if(isInBrowser){zebkit.then(function(){var jn=this.join(),$interval=zenv.setInterval(function(){if(document.readyState==="complete"){zenv.clearInterval($interval);jn(zebkit)}},100)})}return zebkit})();zebkit.package("util",function(pkg,Class){pkg.$validateValue=function(value){if(arguments.length<2){throw new Error("Invalid arguments list. List of valid values is expected")}for(var i=1;i<arguments.length;i++){if(arguments[i]===value){return value}}var values=Array.prototype.slice.call(arguments).slice(1);throw new Error("Invalid value '"+value+"',the following values are expected: "+values.join(","))};pkg.format=function(s,obj,ph){if(arguments.length<3)ph="";var rg=/\$\{([0-9]+\s*,)?(.?,)?([a-zA-Z_][a-zA-Z0-9_]*)\}/g,r=[],i=0,j=0,m=null;while((m=rg.exec(s))!==null){r[i++]=s.substring(j,m.index);j=m.index+m[0].length;var v=obj[m[3]],mn="get"+m[3][0].toUpperCase()+m[3].substring(1),f=obj[mn];if(typeof f==="function"){v=f.call(obj)}if(typeof m[1]!=="undefined"){var ml=parseInt(m[1].substring(0,m[1].length-1).trim()),ph2=typeof m[2]!=="undefined"?m[2].substring(0,m[2].length-1):ph;if(v===null||typeof v==="undefined"){ph2=ph;v=""}else{v=""+v}for(var k=v.length;k<ml;k++){v=ph2+v}}if(v===null||typeof v==="undefined")v=ph;r[i++]=v}if(i>0){if(j<s.length){r[i++]=s.substring(j)}return pkg.format(r.join(""),obj,ph)}return s};pkg.image=function(ph,fireErr){if(arguments.length<2){fireErr=false}var d=new zebkit.DoIt,jn=d.join();zebkit.environment.loadImage(ph,function(img){jn(img)},function(img,e){if(fireErr===true){d.error(e)}else{jn(img)}});return d};pkg.Event=Class([function $prototype(){this.source=null}]);var PATH_RE=/^[.]?(\/[\/]?)([^\[\/]+)\s*(\[\s*\@([a-zA-Z_][a-zA-Z0-9_\.]*)\s*(\=\s*[0-9]+|\=\s*true|\=\s*false|\=\s*null|\=\s*\'[^']*\')?\s*\])?/;pkg.findInTree=function(root,path,cb,eq,m){if(root===null||typeof root==="undefined"){throw new Error("Null tree root")}if(arguments.length<5){path=path.trim();if(path[0]==="#"){path="//*[@id='"+path.substring(1).trim()+"']"}else if(path==="."){return cb(root)}else if(path[0]==="."&&path[1]==="/"){root={kids:[root]};path=path.substring(1)}m=null}if(eq===null||arguments.length<4){eq=function(n,fragment){return n.path===fragment}}if(typeof root.kids!=="undefined"&&root.kids!==null&&root.kids.length>0){if(m===null||m[0].length!==m.input.length){m=path.match(PATH_RE);if(m===null){throw new Error("Cannot resolve path '"+path+"'")}if(m[0].length!==path.length){path=path.substring(m[0].length)}if(typeof m[3]!=="undefined"&&typeof m[5]!=="undefined"){m[5]=m[5].substring(1).trim();if(m[5][0]==="'"){m[5]=m[5].substring(1,m[5].length-1)}else if(m[5]==="true"){m[5]=true}else if(m[5]==="false"){m[5]=false}else if(m[5]==="null"){m[5]=null}else{var vv=parseInt(m[5],10);if(isNaN(vv)===false)m[5]=vv}}}var isTerminal=m[0].length===m.input.length,pathDelim=m[1],pathValue=m[2];for(var i=0;i<root.kids.length;i++){var kid=root.kids[i],isMatch=false;if(pathValue==="*"||(eq(kid,pathValue)?pathValue[0]!=="!":pathValue[0]==="!")){if(typeof m[3]!=="undefined"){var attrName=m[4].trim();if(typeof kid[attrName]!=="undefined"&&(typeof m[5]==="undefined"||kid[attrName]===m[5])){isMatch=true}}else{isMatch=true}}if(isMatch===true&&isTerminal===true&&cb(kid)===true){return true}if(isMatch===true&&isTerminal===false||pathDelim==="//"){if(pkg.findInTree(kid,path,cb,eq,m)===true){return true}}}}return false};pkg.PathSearch=zebkit.Interface([function $prototype(){this.byPath=function(path,cb){if(typeof this.$normalizePath!=="undefined"){path=this.$normalizePath(path)}if(arguments.length===2){if(arguments[1]===null){var r=[];pkg.findInTree(this,path,function(n){r.push(n);return false},typeof this.$matchPath!=="undefined"?this.$matchPath:null);return r}else{pkg.findInTree(this,path,cb,typeof this.$matchPath!=="undefined"?this.$matchPath:null)}}else{var res=null;pkg.findInTree(this,path,function(n){res=n;return true},typeof this.$matchPath!=="undefined"?this.$matchPath:null);return res}}}]);pkg.rgb=Class([function(r,g,b,a){if(arguments.length===1){if(zebkit.isString(r)){this.s=r;if(r[0]==="#"){r=parseInt(r.substring(1),16)}else{if(r[0]==="r"&&r[1]==="g"&&r[2]==="b"){var i=r.indexOf("(",3),p=r.substring(i+1,r.indexOf(")",i+1)).split(",");this.r=parseInt(p[0].trim(),10);this.g=parseInt(p[1].trim(),10);this.b=parseInt(p[2].trim(),10);if(p.length>3){this.a=parseInt(p[3].trim(),10);this.isOpaque=this.a===1}return}}}this.r=r>>16;this.g=r>>8&255;this.b=r&255}else{this.r=r;this.g=g;this.b=b;if(arguments.length>3)this.a=a}if(this.s===null){this.s=typeof this.a!=="undefined"?"rgba("+this.r+","+this.g+","+this.b+","+this.a+")":"#"+(this.r<16?"0"+this.r.toString(16):this.r.toString(16))+(this.g<16?"0"+this.g.toString(16):this.g.toString(16))+(this.b<16?"0"+this.b.toString(16):this.b.toString(16))}},function $prototype(){this.s=null;this.isOpaque=true;this.toString=function(){return this.s}},function $clazz(){this.black=new this(0);this.white=new this(16777215);this.red=new this(255,0,0);this.blue=new this(0,0,255);this.green=new this(0,255,0);this.gray=new this(128,128,128);this.lightGray=new this(211,211,211);this.darkGray=new this(169,169,169);this.orange=new this(255,165,0);this.yellow=new this(255,255,0);this.pink=new this(255,192,203);this.cyan=new this(0,255,255);this.magenta=new this(255,0,255);this.darkBlue=new this(0,0,140);this.transparent=new this(0,0,0,0);this.mergeable=false}]);pkg.intersection=function(x1,y1,w1,h1,x2,y2,w2,h2,r){r.x=x1>x2?x1:x2;r.width=Math.min(x1+w1,x2+w2)-r.x;r.y=y1>y2?y1:y2;r.height=Math.min(y1+h1,y2+h2)-r.y};pkg.isIntersect=function(x1,y1,w1,h1,x2,y2,w2,h2){return Math.min(x1+w1,x2+w2)-(x1>x2?x1:x2)>0&&Math.min(y1+h1,y2+h2)-(y1>y2?y1:y2)>0};pkg.unite=function(x1,y1,w1,h1,x2,y2,w2,h2,r){r.x=x1<x2?x1:x2;r.y=y1<y2?y1:y2;r.width=Math.max(x1+w1,x2+w2)-r.x;r.height=Math.max(y1+h1,y2+h2)-r.y};var letterRE=/[A-Za-z]/;pkg.isLetter=function(ch){if(ch.length!==1)throw new Error("Incorrect character");return letterRE.test(ch)};var $NewListener=function(){var clazz=function(){};clazz.eventNames=arguments.length===0?["fired"]:Array.prototype.slice.call(arguments);clazz.ListenersClass=function(){var args=this.eventNames.slice();for(var i=0;i<arguments.length;i++)args.push(arguments[i]);return $NewListener.apply(this,args)};if(clazz.eventNames.length===1){var $ename=clazz.eventNames[0];clazz.prototype.v=null;clazz.prototype.add=function(){var ctx=this,l=arguments[arguments.length-1];if(typeof l!=="function"){ctx=l;l=l[$ename];if(typeof l!=="function"){return null}}if(arguments.length>1&&arguments[0]!==$ename){throw new Error("Unknown event type :"+$ename)}if(this.v===null){this.v=[]}this.v.push(ctx,l);return l};clazz.prototype.remove=function(l){if(this.v!==null){if(arguments.length===0){this.v.length=0}else{var name=arguments.length>1||zebkit.isString(arguments[0])?arguments[0]:null,fn=arguments.length>1?arguments[1]:name===null?arguments[0]:null,i=0;if(name!==null&&name!==$ename){throw new Error("Unknown event type :"+name)}if(fn===null){this.v.length=0}else{while((i=this.v.indexOf(fn))>=0){if(i%2>0)i--;this.v.splice(i,2)}}}}};clazz.prototype.hasHandler=function(l){if(zebkit.isString(l)){return this.v!==null&&l===$ename&&this.v.length>0}else{return this.v.length>0&&this.v.indexOf(l)>=0}};clazz.prototype[$ename]=function(){if(this.v!==null){for(var i=0;i<this.v.length;i+=2){if(this.v[i+1].apply(this.v[i],arguments)===true){return true}}}return false};clazz.prototype.hasEvent=function(nm){return nm===$ename}}else{var names={};for(var i=0;i<clazz.eventNames.length;i++){names[clazz.eventNames[i]]=true}clazz.prototype.$methods=null;clazz.prototype.add=function(l){if(this.$methods===null){this.$methods={}}var n=null,k=null,nms=typeof this.$names!=="undefined"?this.$names:names;if(arguments.length>1){n=arguments[0];l=arguments[arguments.length-1]}if(typeof l==="function"){if(n!==null&&nms.hasOwnProperty(n)===false){throw new Error("Unknown event type "+n)}if(n===null){for(k in nms){if(this.$methods.hasOwnProperty(k)===false){this.$methods[k]=[]}this.$methods[k].push(this,l)}}else{if(this.$methods.hasOwnProperty(n)===false){this.$methods[n]=[]}this.$methods[n].push(this,l)}}else{var b=false;for(k in nms){if(typeof l[k]==="function"){b=true;if(this.$methods.hasOwnProperty(k)===false){this.$methods[k]=[]}this.$methods[k].push(l,l[k])}}if(b===false){return null}}return l};clazz.prototype.hasHandler=function(l){if(zebkit.isString(l)){return this.$methods!==null&&this.$methods.hasOwnProperty(l)&&this.$methods[l].length>0}else{for(var k in this.$methods){var v=this.$methods[k];if(v.indexOf(l)>=0){return true}}return false}};clazz.prototype.addEvents=function(){if(typeof this.$names==="undefined"){this.$names={};for(var k in names){this.$names[k]=names[k]}}for(var i=0;i<arguments.length;i++){var name=arguments[i];if(name===null||typeof name==="undefined"||typeof this[name]!=="undefined"){throw new Error("Invalid "+name+" (event name)")}this[name]=function(name){return function(){if(this.$methods!==null){if(this.$methods.hasOwnProperty(name)){var c=this.$methods[name];for(var i=0;i<c.length;i+=2){if(c[i+1].apply(c[i],arguments)===true){return true}}}}return false}}(name);this.$names[name]=true}};clazz.prototype.addEvents.apply(clazz.prototype,clazz.eventNames);clazz.prototype.remove=function(){if(this.$methods!==null){var k=null;if(arguments.length===0){for(k in this.$methods){if(this.$methods.hasOwnProperty(k))this.$methods[k].length=0}this.$methods={}}else{var name=arguments.length>1||zebkit.isString(arguments[0])?arguments[0]:null,fn=arguments.length>1?arguments[1]:name===null?arguments[0]:null,i=0,v=null;if(name!==null){if(this.$methods.hasOwnProperty(name)){if(fn===null){this.$methods[name].length=0;delete this.$methods[name]}else{v=this.$methods[name];while((i=v.indexOf(fn))>=0){if(i%2>0)i--;v.splice(i,2)}if(v.length===0){delete this.$methods[name]}}}}else{for(k in this.$methods){v=this.$methods[k];while((i=v.indexOf(fn))>=0){if(i%2>0)i--;v.splice(i,2)}if(v.length===0){delete this.$methods[k]}}}}}};clazz.prototype.hasEvent=function(nm){if(typeof this.$names!=="undefined"){return this.$names.hasOwnProperty(nm)}else{return names.hasOwnProperty(nm)}}}return clazz};pkg.Listeners=$NewListener();pkg.ListenersClass=$NewListener;pkg.Position=Class(zebkit.EventProducer,[function(pi){this._=new this.clazz.Listeners;this.isValid=false;this.currentLine=this.currentCol=this.offset=0;this.setMetric(pi)},function $clazz(){this.Listeners=pkg.ListenersClass("posChanged");this.Metric=zebkit.Interface(["abstract",function getLines(){},function getLineSize(){},function getMaxOffset(){}])},function $prototype(){this.setOffset=function(o){if(o<0)o=0;else{if(o===null)o=-1;else{var max=this.metrics.getMaxOffset();if(o>=max)o=max}}if(o!==this.offset){var prevOffset=this.offset,prevLine=this.currentLine,prevCol=this.currentCol,p=this.getPointByOffset(o);this.offset=o;if(p!==null){this.currentLine=p[0];this.currentCol=p[1]}else{this.currentLine=this.currentCol=-1}this.isValid=true;this._.posChanged(this,prevOffset,prevLine,prevCol)}return o};this.seek=function(off){return this.setOffset(this.offset+off)};this.setRowCol=function(r,c){if(r!==this.currentLine||c!==this.currentCol){var prevOffset=this.offset,prevLine=this.currentLine,prevCol=this.currentCol;this.offset=this.getOffsetByPoint(r,c);this.currentLine=r;this.currentCol=c;this._.posChanged(this,prevOffset,prevLine,prevCol)}};this.inserted=function(off,size){if(this.offset>=0&&off<=this.offset){this.isValid=false;this.setOffset(this.offset+size)}};this.removed=function(off,size){if(this.offset>=0&&this.offset>=off){this.isValid=false;this.setOffset(this.offset>=off+size?this.offset-size:off)}};this.getPointByOffset=function(off){if(off>=0){var m=this.metrics,max=m.getMaxOffset();if(off>max){throw new Error("Out of bounds:"+off)}if(max===0)return[m.getLines()>0?0:-1,0];if(off===0)return[0,0];var d=0,sl=0,so=0;if(this.isValid===true&&this.offset!==-1){sl=this.currentLine;so=this.offset-this.currentCol;if(off>this.offset)d=1;else{if(off<this.offset)d=-1;else return[sl,this.currentCol]}}else{d=~~(max/off)===0?-1:1;if(d<0){sl=m.getLines()-1;so=max-m.getLineSize(sl)}}for(;sl<m.getLines()&&sl>=0;sl+=d){var ls=m.getLineSize(sl);if(off>=so&&off<so+ls){return[sl,off-so]}so+=d>0?ls:-m.getLineSize(sl-1)}}return null};this.getOffsetByPoint=function(row,col){var startOffset=0,startLine=0,m=this.metrics,i=0;if(row>=m.getLines()){throw new RangeError(row)}if(col>=m.getLineSize(row)){throw new RangeError(col)}if(this.isValid===true&&this.offset!==-1){startOffset=this.offset-this.currentCol;startLine=this.currentLine}if(startLine<=row){for(i=startLine;i<row;i++){startOffset+=m.getLineSize(i)}}else{for(i=startLine-1;i>=row;i--){startOffset-=m.getLineSize(i)}}return startOffset+col};this.seekLineTo=function(t,num){if(this.offset<0){this.setOffset(0)}else{if(arguments.length===1)num=1;var prevOffset=this.offset,prevLine=this.currentLine,prevCol=this.currentCol,maxCol=0,i=0;switch(t){case"begin":if(this.currentCol>0){this.offset-=this.currentCol;this.currentCol=0}break;case"end":maxCol=this.metrics.getLineSize(this.currentLine);if(this.currentCol<maxCol-1){this.offset+=maxCol-this.currentCol-1;this.currentCol=maxCol-1}break;case"up":if(this.currentLine>0){this.offset-=this.currentCol+1;this.currentLine--;for(i=0;this.currentLine>0&&i<num-1;i++,this.currentLine--){this.offset-=this.metrics.getLineSize(this.currentLine)}maxCol=this.metrics.getLineSize(this.currentLine);if(this.currentCol<maxCol){this.offset-=maxCol-this.currentCol-1}else{this.currentCol=maxCol-1}}break;case"down":if(this.currentLine<this.metrics.getLines()-1){this.offset+=this.metrics.getLineSize(this.currentLine)-this.currentCol;this.currentLine++;var size=this.metrics.getLines()-1;for(i=0;this.currentLine<size&&i<num-1;i++,this.currentLine++){this.offset+=this.metrics.getLineSize(this.currentLine)}maxCol=this.metrics.getLineSize(this.currentLine);if(this.currentCol<maxCol){this.offset+=this.currentCol}else{this.currentCol=maxCol-1;this.offset+=this.currentCol}}break;default:throw new Error(""+t)}this._.posChanged(this,prevOffset,prevLine,prevCol)}};this.setMetric=function(p){if(p===null||typeof p==="undefined"){throw new Error("Null metric")}if(p!==this.metrics){this.metrics=p;this.setOffset(null)}}}]);pkg.SingleColPosition=Class(pkg.Position,[function $prototype(){this.setRowCol=function(r,c){this.setOffset(r)};this.setOffset=function(o){if(o<0)o=0;else{if(o===null)o=-1;else{var max=this.metrics.getMaxOffset();if(o>=max)o=max}}if(o!==this.offset){var prevOffset=this.offset,prevLine=this.currentLine,prevCol=this.currentCol;this.currentLine=this.offset=o;this.isValid=true;this._.posChanged(this,prevOffset,prevLine,prevCol)}return o};this.seekLineTo=function(t,num){if(this.offset<0){this.setOffset(0)}else{if(arguments.length===1){num=1}switch(t){case"begin":case"end":break;case"up":if(this.offset>0){this.setOffset(this.offset-n)}break;case"down":if(this.offset<this.metrics.getLines()-1){this.setOffset(this.offset+n)}break;default:throw new Error(""+t)}}}}]);pkg.TasksSet=Class([function(c){this.tasks=Array(arguments.length>0?c:5);for(var i=0;i<this.tasks.length;i++){this.tasks[i]=new this.clazz.Task(this)}},function $clazz(){this.Task=Class([function(set){this.taskSet=set;this.isStarted=false},function $prototype(){this.task=null;this.ri=this.si=0;this.shutdown=function(){return this.taskSet.shutdown(this)};this.pause=function(){if(this.task===null){throw new Error("Stopped task cannot be paused")}if(this.isStarted===true){this.isStarted=false;return true}return false};this.resume=function(t){if(this.task===null){throw new Error("Stopped task cannot be paused")}this.si=arguments.length>0?t:0;if(this.isStarted===true){return false}this.isStarted=true;return true}}])},function $prototype(){this.quantum=40;this.pid=-1;this.count=0;this.shutdownAll=function(){for(var i=0;i<this.tasks.length;i++){this.shutdown(this.tasks[i])}};this.shutdown=function(t){if(t.task!==null){this.count--;t.task=null;t.isStarted=false;t.ri=t.si=0;return true}if(this.count===0&&this.pid>=0){zebkit.environment.clearInterval(this.pid);this.pid=-1}return false};this.runOnce=function(f,startIn){this.run(f,startIn,-1)};this.run=function(f,si,ri){if(f===null||typeof f==="undefined"){throw new Error(""+f)}var $this=this;function dispatcher(){var c=0;for(var i=0;i<$this.tasks.length;i++){var t=$this.tasks[i];if(t.task!==null){c++}if(t.isStarted===true){if(t.si<=0){try{if(typeof t.task.run!=="undefined"){t.task.run(t)}else{t.task(t)}if(t.ri<0){t.shutdown()}}catch(e){zebkit.dumpError(e)}t.si+=t.ri}else{t.si-=$this.quantum}}}if(c===0&&$this.pid>=0){zebkit.environment.clearInterval($this.pid);$this.pid=-1}}for(var i=0;i<this.tasks.length;i++){var j=(i+this.count)%this.tasks.length,t=this.tasks[j];if(t.task===null){t.si=arguments.length>1?si:0;t.ri=arguments.length>2?ri:-1;t.isStarted=true;t.task=f;this.count++;if(this.count>0&&this.pid<0){this.pid=zebkit.environment.setInterval(dispatcher,this.quantum)}return t}}throw new Error("Out of active tasks limit ("+this.tasks.length+")")}}]);pkg.tasksSet=new pkg.TasksSet(7);pkg.Fireable=zebkit.Interface();pkg.Zson=zebkit.Class([function(root){if(arguments.length>0){this.root=root}this.classAliases={}},function $prototype(){this.url=null;this.root=null;this.content=null;this.usePropertySetters=true;this.get=function(key){if(key===null||typeof key==="undefined"){throw new Error("Null key")}var ignore=false;if(key[0]==="?"){key=key.substring(1).trim();ignore=true}var v=this.$get(key.split("."),this.root);if(ignore===false&&typeof v==="undefined"){throw new Error("Property '"+key+"' not found")}return v};this.$get=function(keys,root){if(keys.length===0){throw new Error("No keys were found")}var v=root;for(var i=0;i<keys.length;i++){v=v[keys[i]];if(typeof v==="undefined"){return undefined}}return v!==null&&v.$new?v.$new():v};this.$isAtomic=function(v){return v===null||typeof v==="undefined"||(typeof v==="string"||v.constructor===String)||(typeof v==="number"||v.constructor===Number)||(typeof v==="boolean"||v.constructor===Boolean)};this.callMethod=function(name,d){var m=this[name.substring(1).trim()],ts=this.$runner.$tasks.length,bs=this.$runner.$busy;if(typeof m!=="function"){throw new Error("Method '"+name+"' cannot be found")}var args=this.buildValue(Array.isArray(d)?d:[d]),$this=this;if(this.$runner.$tasks.length===ts&&this.$runner.$busy===bs){var res=m.apply(this,args);if(res instanceof zebkit.DoIt){return(new zebkit.DoIt).till(this.$runner).then(function(){var jn=this.join();res.then(function(res){jn(res);return res}).then(function(res){return res})}).catch(function(e){$this.$runner.error(e)})}else{return res}}else{return(new zebkit.DoIt).till(this.$runner).then(function(){if(args instanceof zebkit.DoIt){var jn=this.join();args.then(function(res){jn(res);return res})}else{return args}}).then(function(args){var res=m.apply($this,args);if(res instanceof zebkit.DoIt){var jn=this.join();res.then(function(res){jn(res);return res})}else{return res}}).then(function(res){return res}).catch(function(e){$this.$runner.error(e)})}};this.$resolveRef=function(target,names){var fn=function(ref,rn){rn.then(function(target){if(target!=null&&target.hasOwnProperty(ref)===true){var v=target[ref];if(v instanceof zebkit.DoIt){var jn=this.join();v.then(function(res){jn.call(rn,res);return res})}else{return v}}else{return undefined}})};for(var j=0;j<names.length;j++){var ref=names[j];if(target.hasOwnProperty(ref)){var v=target[ref];if(v instanceof zebkit.DoIt){var rn=new zebkit.DoIt,trigger=rn.join();for(var k=j;k<names.length;k++){fn(names[k],rn)}trigger.call(rn,target);return rn}else{target=target[ref]}}else{return undefined}}return target};this.$buildArray=function(d){var hasAsync=false;for(var i=0;i<d.length;i++){var v=this.buildValue(d[i]);if(v instanceof zebkit.DoIt){hasAsync=true;this.$assignValue(d,i,v)}else{d[i]=v}}if(hasAsync){return(new zebkit.DoIt).till(this.$runner).then(function(){return d})}else{return d}};this.$buildClass=function(k,d){var classname=k.substring(1).trim(),args=d[k],clz=null,busy=this.$runner.$busy,tasks=this.$runner.$tasks.length;delete d[k];if(classname[0]==="?"){classname=classname.substring(1).trim();try{clz=this.resolveClass(classname[0]==="*"?classname.substring(1).trim():classname)}catch(e){return null}}else{clz=this.resolveClass(classname[0]==="*"?classname.substring(1).trim():classname)}args=this.buildValue(Array.isArray(args)?args:[args]);if(classname[0]==="*"){return function(clazz,args){return{$new:function(){return zebkit.newInstance(clazz,args)}}}(clz,args)}var props=this.buildValue(d);if(this.$runner.$busy===busy&&this.$runner.$tasks.length===tasks){var inst=zebkit.newInstance(clz,args);this.merge(inst,props,true);return inst}else{var $this=this;return(new zebkit.DoIt).till(this.$runner).then(function(){var jn1=this.join(),jn2=this.join();if(args instanceof zebkit.DoIt){args.then(function(res){jn1(res);return res})}else{jn1(args)}if(props instanceof zebkit.DoIt){props.then(function(res){jn2(res);return res})}else{jn2(props)}}).then(function(args,props){var inst=zebkit.newInstance(clz,args);$this.merge(inst,props,true);return inst})}};this.$buildRef=function(d){var idx=-1;if(d[2]==="<"||d[2]==="."||d[2]==="/"){var path=null,type=null,$this=this;if(d[2]==="<"){idx=d.indexOf(">");if(idx<=4){throw new Error("Invalid content type in URL '"+d+"'")}path=d.substring(idx+1,d.length-1).trim();type=d.substring(3,idx).trim()}else{path=d.substring(2,d.length-1).trim();type="json"}if(type==="js"){return this.expr(path)}if(this.url!==null&&zebkit.URI.isAbsolute(path)===false){var pURL=new zebkit.URI(this.url).getParent();if(pURL!==null){path=zebkit.URI.join(pURL,path)}}if(type==="json"){var bag=new this.clazz;bag.usePropertySetters=this.usePropertySetters;var bg=bag.then(path).catch();this.$runner.then(bg.then(function(res){return res.root}));return bg}else if(type==="img"){if(this.url!==null&&zebkit.URI.isAbsolute(path)===false){path=zebkit.URI.join(new zebkit.URI(this.url).getParent(),path)}return pkg.image(path,false)}else if(type==="txt"){return new zebkit.io.GET(path).then(function(r){return r.responseText}).catch(function(e){$this.$runner.error(e)})}else{throw new Error("Invalid content type "+type)}}else{idx=2;if(d[2]==="?"){idx++}var name=d.substring(idx,d.length-1).trim(),names=name.split("."),targets=[this.content,this.root,zebkit.$global];for(var i=0;i<targets.length;i++){var target=targets[i];if(target!==null){var value=this.$resolveRef(target,names);if(typeof value!=="undefined"){return value}}}if(idx===2){throw new Error("Reference '"+name+"' cannot be resolved")}else{return d}}};this.buildValue=function(d){if(typeof d==="undefined"||d===null||d instanceof zebkit.DoIt||(typeof d==="number"||d.constructor===Number)||(typeof d==="boolean"||d.constructor===Boolean)){return d}if(Array.isArray(d)){return this.$buildArray(d)}if(typeof d==="string"||d.constructor===String){if(d[0]==="%"&&d[1]==="{"&&d[d.length-1]==="}"){return this.$buildRef(d)}else{return d}}var k=null;for(k in d){if(k[0]==="@"&&d.hasOwnProperty(k)===true){return this.$buildClass(k,d)}break}for(k in d){if(d.hasOwnProperty(k)){var v=d[k];if(k[0]==="."||k[0]==="#"){delete d[k];if(k[0]==="#"){this.callMethod(k,v,d)}else{return this.callMethod(k,v,d)}}else if(k[0]==="%"){delete d[k];this.mixin(d,this.$buildRef(k))}else{this.$assignValue(d,k,this.buildValue(v))}}}return d};this.$assignValue=function(o,k,v){o[k]=v;if(v instanceof zebkit.DoIt){var $this=this;this.$runner.then(v.then(function(res){o[k]=res;return res}))}};this.$assignProperty=function(o,m,v){this.$runner.then(function(res){if(Array.isArray(v)){m.apply(o,v)}else{m.call(o,v)}return res})};this.merge=function(dest,src,recursively){if(arguments.length<3){recursively=true}for(var k in src){if(src.hasOwnProperty(k)){var sv=src[k],dv=dest[k];if(this.usePropertySetters===true){var m=zebkit.getPropertySetter(dest,k);if(m!==null){this.$assignProperty(dest,m,sv);continue}}if(this.$isAtomic(dv)||Array.isArray(dv)||this.$isAtomic(sv)||Array.isArray(sv)||typeof sv.clazz!=="undefined"){this.$assignValue(dest,k,sv)}else if(recursively===true){if(dv!=null&&typeof dv.clazz!=="undefined"&&dv.clazz.mergeable===false){this.$assignValue(dest,k,sv)}else{this.merge(dv,sv)}}}}return dest};this.mixin=function(dest,src){if(src instanceof zebkit.DoIt){var $this=this;this.$runner.then(src.then(function(src){for(var k in src){if(src.hasOwnProperty(k)&&(typeof dest[k]==="undefined"||dest[k]===null)){$this.$assignValue(dest,k,src[k])}}}))}else{for(var k in src){if(src.hasOwnProperty(k)&&(typeof dest[k]==="undefined"||dest[k]===null)){this.$assignValue(dest,k,src[k])}}}};this.resolveClass=function(className){return this.classAliases.hasOwnProperty(className)?this.classAliases[className]:zebkit.Class.forName(className)};this.addClassAliases=function(aliases){for(var k in aliases){this.classAliases[k]=Class.forName(aliases[k].trim())}};this.expr=function(expr){if(expr.length>200){throw new Error("Out of evaluated script limit")}return eval("'use strict';"+expr)};this.then=function(json,fn){if(json===null||typeof json==="undefined"||zebkit.isString(json)&&json.trim().length===0){throw new Error("Null content")}this.$runner=new zebkit.DoIt;var $this=this;this.$runner.then(function(){if(zebkit.isString(json)){json=json.trim();if((json[0]!=="["||json[json.length-1]!=="]")&&(json[0]!=="{"||json[json.length-1]!=="}")){$this.url=json+(json.lastIndexOf("?")>0?"&":"?")+(new Date).getTime().toString();var join=this.join();zebkit.io.GET($this.url).then(function(r){join.call($this,r.responseText)}).catch(function(e){$this.$runner.error(e)})}else{return json}}else{return json}}).then(function(json){if(zebkit.isString(json)){try{$this.content=JSON.parse(json)}catch(e){throw new Error("JSON format error: "+e)}}else{$this.content=json}$this.$assignValue($this,"content",$this.buildValue($this.content))}).then(function(){if($this.root!==null){$this.merge($this.root,$this.content)}else{$this.root=$this.content}return $this});if(arguments.length>1){this.$runner.then(fn)}return this.$runner}}])});zebkit.package("io",function(pkg,Class){var HEX="0123456789ABCDEF",b64str="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";pkg.UID=function(size){if(arguments.length===0)size=16;var id="";for(var i=0;i<size;i++)id=id+HEX[~~(Math.random()*16)];return id};pkg.b64encode=function(input){var out=[],i=0,len=input.length,c1,c2,c3;if(typeof ArrayBuffer!=="undefined"){if(input instanceof ArrayBuffer){input=new Uint8Array(input)}input.charCodeAt=function(i){return this[i]}}if(Array.isArray(input)){input.charCodeAt=function(i){return this[i]}}while(i<len){c1=input.charCodeAt(i++)&255;out.push(b64str.charAt(c1>>2));if(i===len){out.push(b64str.charAt((c1&3)<<4),"==");break}c2=input.charCodeAt(i++);out.push(b64str.charAt((c1&3)<<4|(c2&240)>>4));if(i===len){out.push(b64str.charAt((c2&15)<<2),"=");break}c3=input.charCodeAt(i++);out.push(b64str.charAt((c2&15)<<2|(c3&192)>>6),b64str.charAt(c3&63))}return out.join("")};pkg.b64decode=function(input){var output=[],chr1,chr2,chr3,enc1,enc2,enc3,enc4;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(input.length%4!==0)input+="=";for(var i=0;i<input.length;){enc1=b64str.indexOf(input.charAt(i++));enc2=b64str.indexOf(input.charAt(i++));enc3=b64str.indexOf(input.charAt(i++));enc4=b64str.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output.push(String.fromCharCode(chr1));if(enc3!==64)output.push(String.fromCharCode(chr2));if(enc4!==64)output.push(String.fromCharCode(chr3))}return output.join("")};pkg.dateToISO8601=function(d){function pad(n){return n<10?"0"+n:n}return[d.getUTCFullYear(),"-",pad(d.getUTCMonth()+1),"-",pad(d.getUTCDate()),"T",pad(d.getUTCHours()),":",pad(d.getUTCMinutes()),":",pad(d.getUTCSeconds()),"Z"].join("")};pkg.ISO8601toDate=function(v){var regexp=["([0-9]{4})(-([0-9]{2})(-([0-9]{2})","(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?","(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?"].join(""),d=v.match(new RegExp(regexp)),offset=0,date=new Date(d[1],0,1);if(d[3])date.setMonth(d[3]-1);if(d[5])date.setDate(d[5]);if(d[7])date.setHours(d[7]);if(d[8])date.setMinutes(d[8]);if(d[10])date.setSeconds(d[10]);if(d[12])date.setMilliseconds(Number("0."+d[12])*1e3);if(d[14]){offset=Number(d[16])*60+Number(d[17]);offset*=d[15]==="-"?1:-1}offset-=date.getTimezoneOffset();date.setTime(Number(date)+offset*60*1e3);return date};pkg.HTTP=Class([function(url){this.url=url;this.header={}},function $prototype(){this.GET=function(q){var u=this.url+(arguments.length===0||q===null?"":(this.url.indexOf("?")>0?"&":"?")+zebkit.URI.toQS(q,true));return this.SEND("GET",u)};this.POST=function(d){if(d!==null&&zebkit.isString(d)===false&&d.constructor===Object){d=zebkit.URI.toQS(d,false)}return this.SEND("POST",this.url,d)};this.SEND=function(method,url,data){var req=zebkit.environment.getHttpRequest();req.open(method,url,true);for(var k in this.header){req.setRequestHeader(k,this.header[k])}return new zebkit.DoIt(function(){var jn=this.join(),$this=this;req.onreadystatechange=function(){if(req.readyState===4){if(req.status>=400||req.status<100){var e=new Error("HTTP error '"+req.statusText+"', code = "+req.status+" '"+url+"'");e.status=req.status;e.statusText=req.statusText;e.readyState=req.readyState;$this.error(e)}else{jn(req)}}};try{req.send(arguments.length>2?data:null)}catch(e){this.error(e)}})}}]);pkg.GET=function(url){var http=new pkg.HTTP(url);return http.GET.apply(http,Array.prototype.slice.call(arguments,1))};pkg.POST=function(url){var http=new pkg.HTTP(url);return http.POST.apply(http,Array.prototype.slice.call(arguments,1))};pkg.Service=Class([function(url,methods){var $this=this;this.url=url;if(Array.isArray(methods)===false){methods=[methods]}for(var i=0;i<methods.length;i++){(function(){var name=methods[i];$this[name]=function(){var args=Array.prototype.slice.call(arguments);return this.send(url,this.encode(name,args)).then(function(req){if(req.status===200){return $this.decode(req.responseText)}else{this.error(new Error("Status: "+req.status+", '"+req.statusText+"'"))}})}})()}},function $prototype(){this.contentType=null;this.send=function(url,data){var http=new pkg.HTTP(url);if(this.contentType!==null){http.header["Content-Type"]=this.contentType}return http.POST(data)}}]);pkg.Service.invoke=function(clazz,url,method){var rpc=new clazz(url,method);return function(){return rpc[method].apply(rpc,arguments)}};pkg.JRPC=Class(pkg.Service,[function $prototype(){this.version="2.0";this.contentType="application/json; charset=ISO-8859-1;";this.encode=function(name,args){return zebkit.environment.stringifyJSON({jsonrpc:this.version,method:name,params:args,id:pkg.UID()})};this.decode=function(r){if(r===null||r.length===0){throw new Error("Empty JSON result string")}r=zebkit.environment.parseJSON(r);if(typeof r.error!=="undefined"){throw new Error(r.error.message)}if(typeof r.result==="undefined"||typeof r.id==="undefined"){throw new Error("Wrong JSON response format")}return r.result}}]);pkg.JRPC.invoke=function(url,method){return pkg.Service.invoke(pkg.JRPC,url,method)};pkg.Base64=function(s){if(arguments.length>0)this.encoded=pkg.b64encode(s)};pkg.Base64.prototype.toString=function(){return this.encoded};pkg.Base64.prototype.decode=function(){return pkg.b64decode(this.encoded)};pkg.XRPC=Class(pkg.Service,[function $prototype(){this.contentType="text/xml";this.encode=function(name,args){var p=['<?xml version="1.0"?>\n<methodCall><methodName>',name,"</methodName><params>"];for(var i=0;i<args.length;i++){p.push("<param>");this.encodeValue(args[i],p);p.push("</param>")}p.push("</params></methodCall>");return p.join("")};this.encodeValue=function(v,p){if(v===null){throw new Error("Null is not allowed")}if(zebkit.isString(v)){v=v.replace("<","&lt;");v=v.replace("&","&amp;");p.push("<string>",v,"</string>")}else{if(zebkit.isNumber(v)){if(Math.round(v)===v){p.push("<i4>",v.toString(),"</i4>")}else{p.push("<double>",v.toString(),"</double>")}}else{if(zebkit.isBoolean(v)){p.push("<boolean>",v?"1":"0","</boolean>")}else{if(v instanceof Date){p.push("<dateTime.iso8601>",pkg.dateToISO8601(v),"</dateTime.iso8601>")}else{if(Array.isArray(v)){p.push("<array><data>");for(var i=0;i<v.length;i++){p.push("<value>");this.encodeValue(v[i],p);p.push("</value>")}p.push("</data></array>")}else{if(v instanceof pkg.Base64){p.push("<base64>",v.toString(),"</base64>")}else{p.push("<struct>");for(var k in v){if(v.hasOwnProperty(k)){p.push("<member><name>",k,"</name><value>");this.encodeValue(v[k],p);p.push("</value></member>")}}p.push("</struct>")}}}}}}};this.decodeValue=function(node){var tag=node.tagName.toLowerCase(),i=0;if(tag==="struct"){var p={};for(i=0;i<node.childNodes.length;i++){var member=node.childNodes[i],key=member.childNodes[0].childNodes[0].nodeValue.trim();p[key]=this.decodeValue(member.childNodes[1].childNodes[0])}return p}if(tag==="array"){var a=[];node=node.childNodes[0];for(i=0;i<node.childNodes.length;i++){a[i]=this.decodeValue(node.childNodes[i].childNodes[0])}return a}var v=node.childNodes[0].nodeValue.trim();switch(tag){case"datetime.iso8601":return pkg.ISO8601toDate(v);case"boolean":return v==="1";case"int":case"i4":return parseInt(v,10);case"double":return Number(v);case"base64":var b64=new pkg.Base64;b64.encoded=v;return b64;case"string":return v}throw new Error("Unknown tag "+tag)};this.decode=function(r){var p=zebkit.environment.parseXML(r),c=p.getElementsByTagName("fault");if(c.length>0){var err=this.decodeValue(c[0].getElementsByTagName("struct")[0]);throw new Error(err.faultString)}c=p.getElementsByTagName("methodResponse")[0];c=c.childNodes[0].childNodes[0];if(c.tagName.toLowerCase()==="param"){return this.decodeValue(c.childNodes[0].childNodes[0])}throw new Error("Incorrect XML-RPC response")}}]);pkg.XRPC.invoke=function(url,method){return pkg.Service.invoke(pkg.XRPC,url,method)}});zebkit.package("data",function(pkg,Class){pkg.descent=function descent(a,b){if(typeof a==="undefined"||a===null)return 1;return zebkit.isString(a)?a.localeCompare(b):a-b};pkg.ascent=function ascent(a,b){if(b===null||typeof b==="undefined")return 1;return zebkit.isString(b)?b.localeCompare(a):b-a};pkg.DataModel=zebkit.Interface();pkg.TextModel=Class(pkg.DataModel,[function $clazz(){this.Listeners=zebkit.util.ListenersClass("textUpdated")}]);pkg.Text=Class(pkg.TextModel,zebkit.EventProducer,[function(s){this.$lines=[new this.clazz.Line("")];this._=new this.clazz.Listeners;this.setValue(arguments.length===0||s===null?"":s)},function $clazz(){this.Line=function(s){this.$s=s};this.Line.prototype.toString=function(){return this.$s}},function $prototype(){this.textLength=0;this.calcLineByOffset=function(start,startOffset,o){if(arguments.length===1){startOffset=start=0}for(;start<this.$lines.length;start++){var line=this.$lines[start].$s;if(o>=startOffset&&o<=startOffset+line.length){return[start,startOffset]}startOffset+=line.length+1}return[]};this.calcLineOffset=function(line){var off=0;for(var i=0;i<line;i++){off+=this.$lines[i].$s.length+1}return off};this.$lineTags=function(i){return this.$lines[i]};this.getLine=function(line){if(line<0||line>=this.$lines.length)throw RangeError(line);return this.$lines[line].$s};this.getValue=function(){return this.$lines.join("\n")};this.getLines=function(){return this.$lines.length};this.getTextLength=function(){return this.textLength};this.removeLines=function(start,size){if(start<0||start>=this.$lines.length){throw new RangeError(start)}if(arguments.length===1){size=1}else if(size<=0){throw new Error("Invalid number of lines : "+size)}if(start+size>this.$lines.length){size=this.$lines.length-start}var end=start+size-1,off=this.calcLineOffset(start),olen=start!==end?this.calcLineOffset(end)+this.$lines[end].$s.length+1-off:this.$lines[start].$s.length+1;if(start===this.$lines.length-1){off--}this.$lines.splice(start,size);this._.textUpdated(this,false,off,olen,start,size)};this.insertLines=function(startLine){if(startLine<0||startLine>this.$lines.length){throw new RangeError(startLine)}var off=this.calcLineOffset(startLine),offlen=0;if(startLine===this.$lines.length){off--}for(var i=1;i<arguments.length;i++){offlen+=arguments[i].length+1;this.$lines.splice(startLine+i-1,0,new this.clazz.Line(arguments[i]))}this._.textUpdated(this,true,off,offlen,startLine,arguments.length-1)};this.write=function(s,offset){if(s.length>0){var slen=s.length,info=this.calcLineByOffset(0,0,offset),line=this.$lines[info[0]].$s,j=0,lineOff=offset-info[1],tmp=line.substring(0,lineOff)+s+line.substring(lineOff);for(;j<slen&&s[j]!=="\n";j++);if(j>=slen){this.$lines[info[0]].$s=tmp;j=1}else{this.$lines.splice(info[0],1);j=this.parse(info[0],tmp,this.$lines)}if(slen>0){this.textLength+=slen;this._.textUpdated(this,true,offset,slen,info[0],j);return true}}return false};this.remove=function(offset,size){if(size>0){var i1=this.calcLineByOffset(0,0,offset),i2=this.calcLineByOffset(i1[0],i1[1],offset+size),l1=this.$lines[i1[0]].$s,l2=this.$lines[i2[0]].$s,off1=offset-i1[1],off2=offset+size-i2[1],buf=l1.substring(0,off1)+l2.substring(off2);if(i2[0]===i1[0]){this.$lines.splice(i1[0],1,new this.clazz.Line(buf))}else{this.$lines.splice(i1[0],i2[0]-i1[0]+1);this.$lines.splice(i1[0],0,new this.clazz.Line(buf))}if(size>0){this.textLength-=size;this._.textUpdated(this,false,offset,size,i1[0],i2[0]-i1[0]+1);return true}}return false};this.parse=function(startLine,text,lines){var size=text.length,prevIndex=0,prevStartLine=startLine;for(var index=0;index<=size;prevIndex=index,startLine++){var fi=text.indexOf("\n",index);index=fi<0?size:fi;this.$lines.splice(startLine,0,new this.clazz.Line(text.substring(prevIndex,index)));index++}return startLine-prevStartLine};this.setValue=function(text){var old=this.getValue();if(old!==text){if(old.length>0){var numLines=this.getLines(),txtLen=this.getTextLength();this.$lines.length=0;this.$lines=[new this.clazz.Line("")];this._.textUpdated(this,false,0,txtLen,0,numLines)}this.$lines=[];this.parse(0,text,this.$lines);this.textLength=text.length;this._.textUpdated(this,true,0,this.textLength,0,this.getLines());return true}return false}}]);pkg.SingleLineTxt=Class(pkg.TextModel,zebkit.EventProducer,[function(s,max){if(arguments.length>1){this.maxLen=max}this._=new this.clazz.Listeners;this.setValue(arguments.length===0||s===null?"":s)},function $prototype(){this.buf="";this.extra=0;this.maxLen=-1;this.$lineTags=function(i){return this};this.getValue=function(){return this.buf};this.getLines=function(){return 1};this.getTextLength=function(){return this.buf.length};this.getLine=function(line){if(line!==0){throw new RangeError(line)}return this.buf};this.write=function(s,offset){var j=s.indexOf("\n");if(j>=0){s=s.substring(0,j)}var l=this.maxLen>0&&this.buf.length+s.length>=this.maxLen?this.maxLen-this.buf.length:s.length;if(l!==0){var nl=this.buf.substring(0,offset)+s.substring(0,l)+this.buf.substring(offset);if(typeof this.validate!=="function"||this.validate(nl)){this.buf=nl;if(l>0){this._.textUpdated(this,true,offset,l,0,1);return true}}}return false};this.remove=function(offset,size){if(size>0){var nl=this.buf.substring(0,offset)+this.buf.substring(offset+size);if(nl.length!==this.buf.length&&(typeof this.validate!=="function"||this.validate(nl))){this.buf=nl;this._.textUpdated(this,false,offset,size,0,1);return true}}return false};this.setValue=function(text){if(typeof this.validate==="function"&&this.validate(text)===false){return false}var i=text.indexOf("\n");if(i>=0){text=text.substring(0,i)}if((this.buf===null||this.buf!==text)&&(typeof this.validate!=="function"||this.validate(text))){if(this.buf!==null&&this.buf.length>0){this._.textUpdated(this,false,0,this.buf.length,0,1)}if(this.maxLen>0&&text.length>this.maxLen){text=text.substring(0,this.maxLen)}this.buf=text;this._.textUpdated(this,true,0,text.length,0,1);return true}return false};this.setMaxLength=function(max){if(max!==this.maxLen){this.maxLen=max;this.setValue("")}}}]);pkg.ListModel=Class(pkg.DataModel,zebkit.EventProducer,[function(){this._=new this.clazz.Listeners;this.$data=arguments.length===0?[]:arguments[0]},function $clazz(){this.Listeners=zebkit.util.ListenersClass("elementInserted","elementRemoved","elementSet")},function $prototype(){this.get=function(i){if(i<0||i>=this.$data.length){throw new RangeError(i)}return this.$data[i]};this.add=function(o){this.$data.push(o);this._.elementInserted(this,o,this.$data.length-1)};this.removeAll=function(){var size=this.$data.length;for(var i=size-1;i>=0;i--)this.removeAt(i)};this.removeAt=function(i){var re=this.$data[i];this.$data.splice(i,1);this._.elementRemoved(this,re,i)};this.remove=function(o){for(var i=0;i<this.$data.length;i++){if(this.$data[i]===o)this.removeAt(i)}};this.insert=function(i,o){if(i<0||i>this.$data.length){throw new RangeError(i)}this.$data.splice(i,0,o);this._.elementInserted(this,o,i)};this.count=function(){return this.$data.length};this.setAt=function(i,o){if(i<0||i>=this.$data.length){throw new RangeError(i)}var pe=this.$data[i];this.$data[i]=o;this._.elementSet(this,o,pe,i);return pe};this.contains=function(o){return this.indexOf(o)>=0};this.indexOf=function(o){return this.$data.indexOf(o)}}]);pkg.Item=Class([function(v){this.kids=[];if(arguments.length>0){this.value=v}},function $prototype(){this.parent=null;this.value=null}]).hashable();pkg.TreeModel=Class(pkg.DataModel,zebkit.EventProducer,[function(r){if(arguments.length===0){this.root=new pkg.Item}else{this.root=zebkit.instanceOf(r,pkg.Item)?r:this.clazz.create(r)}this._=new this.clazz.Listeners},function $clazz(){this.Listeners=zebkit.util.ListenersClass("itemModified","itemRemoved","itemInserted");this.create=function(r,p){var item=new pkg.Item(r.hasOwnProperty("value")?r.value:r);item.parent=arguments.length<2?null:p;if(typeof r.kids!=="undefined"&&r.kids!==null){for(var i=0;i<r.kids.length;i++){item.kids[i]=this.create(r.kids[i],item)}}return item};this.findOne=function(root,value){var res=null;this.find(root,value,function(item){res=item;return true});return res};this.find=function(root,value,cb){if(arguments.length<3){var res=[];this.find(root,value,function(item){res.push(item);return false});return res}if(root.value===value){if(cb.call(this,root)===true){return true}}if(typeof root.kids!=="undefined"&&root.kids!==null){for(var i=0;i<root.kids.length;i++){if(this.find(root.kids[i],value,cb)){return true}}}return false};this.print=function(root,render,shift){if(zebkit.instanceOf(root,pkg.TreeModel)){root=root.root}if(arguments.length<2){shift="";render=null}else if(arguments.length===2){if(zebkit.isString(render)){shift=render;render=null}else{shift=""}}var b=typeof root.kids!=="undefined"&&root.kids!==null,v=render!==null?render(root):(root.value===null?"<null>":root.value)+" {"+(b?root.kids.length:0)+"}";if(b){shift=shift+"    ";for(var i=0;i<root.kids.length;i++){this.print(root.kids[i],render,shift)}}}},function $prototype(){this.root=null;this.iterate=function(r,f){var res=f.call(this,r);if(res===1||res===2){return r}for(var i=0;i<r.kids.length;i++){res=this.iterate(r.kids[i],f);if(res===2)return res}};this.setValue=function(item,v){var prev=item.value;item.value=v;this._.itemModified(this,item,prev)};this.add=function(to,item){if(arguments.length<2){to=this.root}this.insert(to,item,to.kids.length)};this.insert=function(to,item,i){if(i<0||to.kids.length<i)throw new RangeError(i);if(zebkit.isString(item)){item=new pkg.Item(item)}to.kids.splice(i,0,item);item.parent=to;this._.itemInserted(this,item)};this.remove=function(item){if(item===this.root){this.root=null}else{if(typeof item.kids!=="undefined"){for(var i=item.kids.length-1;i>=0;i--){this.remove(item.kids[i])}}item.parent.kids.splice(item.parent.kids.indexOf(item),1)}try{this._.itemRemoved(this,item)}catch(e){item.parent=null;throw e}item.parent=null};this.removeKids=function(item){for(var i=item.kids.length-1;i>=0;i--){this.remove(item.kids[i])}}}]);pkg.Matrix=Class(pkg.DataModel,zebkit.EventProducer,[function(){this._=new this.clazz.Listeners;if(arguments.length===1){this.$objs=arguments[0];this.cols=this.$objs.length>0?this.$objs[0].length:0;this.rows=this.$objs.length}else{this.$objs=[];this.rows=this.cols=0;if(arguments.length>1){this.setRowsCols(arguments[0],arguments[1])}}},function $clazz(){this.Listeners=zebkit.util.ListenersClass("matrixResized","cellModified","matrixSorted","matrixRowInserted","matrixColInserted")},function $prototype(){this.get=function(row,col){if(row<0||row>=this.rows){throw new RangeError(row)}if(col<0||col>=this.cols){throw new RangeError(col)}return this.$objs[row]==null?undefined:this.$objs[row][col]};this.geti=function(i){return this.get(~~(i/this.cols),i%this.cols)};this.put=function(row,col,obj){var nr=this.rows,nc=this.cols;if(row>=nr)nr+=row-nr+1;if(col>=nc)nc+=col-nc+1;this.setRowsCols(nr,nc);var old=this.$objs[row]!=null?this.$objs[row][col]:undefined;if(obj!==old){if(typeof this.$objs[row]==="undefined")this.$objs[row]=[];this.$objs[row][col]=obj;this._.cellModified(this,row,col,old)}};this.puti=function(i,obj){this.put(~~(i/this.cols),i%this.cols,obj)};this.setRowsCols=function(rows,cols){if(rows!==this.rows||cols!==this.cols){var pc=this.cols,pr=this.rows;this.cols=cols;this.rows=rows;if(this.$objs.length>rows){this.$objs.length=rows}if(pc>cols){for(var i=0;i<this.$objs.length;i++){if(typeof this.$objs[i]!=="undefined"&&this.$objs[i].length>cols){this.$objs[i].length=cols}}}this._.matrixResized(this,pr,pc)}};this.setRows=function(rows){this.setRowsCols(rows,this.cols)};this.setCols=function(cols){this.setRowsCols(this.rows,cols)};this.removeRows=function(begrow,count){if(arguments.length===1){count=1}if(begrow<0||begrow+count>this.rows){throw new RangeError(begrow)}this.$objs.splice(begrow,count);this.rows-=count;this._.matrixResized(this,this.rows+count,this.cols)};this.removeCols=function(begcol,count){if(arguments.length===1){count=1}if(begcol<0||begcol+count>this.cols){throw new RangeError(begcol)}for(var i=0;i<this.$objs.length;i++){if(this.$objs[i]!=null&&this.$objs[i].length>0){this.$objs[i].splice(begcol,count)}}this.cols-=count;this._.matrixResized(this,this.rows,this.cols+count)};this.insertRows=function(row,count){if(arguments.length===1){count=1}var i=0;if(row<=this.$objs.length-1){for(i=0;i<count;i++){this.$objs.splice(row,0,undefined);this._.matrixRowInserted(this,row+i)}}else{for(i=0;i<count;i++){this._.matrixRowInserted(this,row+i)}}this.rows+=count;this._.matrixResized(this,this.rows-count,this.cols)};this.insertCols=function(col,count){if(arguments.length===1){count=1}if(this.$objs.length>0){for(var j=0;j<count;j++){for(var i=0;i<this.rows;i++){if(this.$objs[i]!=null&&j<=this.$objs[i].length){this.$objs[i].splice(col,0,undefined)}}this._.matrixColInserted(this,col+j)}}this.cols+=count;this._.matrixResized(this,this.rows,this.cols-count)};this.sortCol=function(col,f){if(arguments.length<2){f=pkg.descent}this.$objs.sort(function(a,b){return f(a[col],b[col])});this._.matrixSorted(this,{col:col,func:f,name:zebkit.$FN(f).toLowerCase()})}}])});zebkit.package("layout",function(pkg,Class){pkg.getDirectChild=function(parent,child){for(;child!==null&&child.parent!==parent;child=child.parent){}return child};pkg.Layout=new zebkit.Interface(["abstract",function doLayout(target){},function calcPreferredSize(target){}]);pkg.getDirectAt=function(x,y,p){for(var i=0;i<p.kids.length;i++){var c=p.kids[i];if(c.isVisible===true&&c.x<=x&&c.y<=y&&c.x+c.width>x&&c.y+c.height>y){return i}}return-1};pkg.getTopParent=function(c){for(;c!==null&&c.parent!==null;c=c.parent);return c};pkg.toParentOrigin=function(x,y,c,p){if(arguments.length===1){c=x;x=y=0;p=null}else{if(arguments.length<4)p=null}while(c!==null&&c!==p){x+=c.x;y+=c.y;c=c.parent}if(c===null){}return{x:x,y:y}};pkg.toChildOrigin=function(x,y,p,c){while(c!==p){x-=c.x;y-=c.y;c=c.parent}return{x:x,y:y}};pkg.getMaxPreferredSize=function(target){var maxWidth=0,maxHeight=0;for(var i=0;i<target.kids.length;i++){var l=target.kids[i];if(l.isVisible===true){var ps=l.getPreferredSize();if(ps.width>maxWidth)maxWidth=ps.width;if(ps.height>maxHeight)maxHeight=ps.height}}return{width:maxWidth,height:maxHeight}};pkg.isAncestorOf=function(p,c){for(;c!==null&&c!==p;c=c.parent);return c!==null};pkg.Layoutable=Class(pkg.Layout,zebkit.EventProducer,zebkit.util.PathSearch,[function(){this.kids=[];this.layout=this},function $prototype(){this.x=this.y=this.height=this.width=this.cachedHeight=0;this.psWidth=this.psHeight=this.cachedWidth=-1;this.isLayoutValid=this.isValid=false;this.layout=null;this.constraints=this.parent=null;this.isVisible=true;this.$matchPath=function(node,name){if(name[0]==="~"){return typeof node.clazz!=="undefined"&&node.clazz!==null&&zebkit.instanceOf(node,zebkit.Class.forName(name.substring(1)))}else{return typeof node.clazz.$name!=="undefined"&&node.clazz.$name===name}};this.setId=function(id){this.id=id;return this};this.properties=function(path,props){if(arguments.length===1){return zebkit.properties(this,path)}this.byPath(path,function(kid){zebkit.properties(kid,props)});return this};this.property=function(){var p={};if(arguments.length>2){p[arguments[1]]=arguments[2];return this.properties(arguments[0],p)}else{p[arguments[0]]=arguments[1];return this.properties(p)}};this.validateMetric=function(){if(this.isValid===false){if(typeof this.recalc==="function")this.recalc();this.isValid=true}};this.invalidateLayout=function(){this.isLayoutValid=false;if(this.parent!==null)this.parent.invalidateLayout()};this.invalidate=function(){this.isValid=this.isLayoutValid=false;this.cachedWidth=-1;if(this.parent!==null){this.parent.invalidate()}};this.validate=function(){if(this.isValid===false){this.validateMetric()}if(this.width>0&&this.height>0&&this.isLayoutValid===false&&this.isVisible===true){this.layout.doLayout(this);for(var i=0;i<this.kids.length;i++){this.kids[i].validate()}this.isLayoutValid=true;if(typeof this.laidout!=="undefined")this.laidout()}};this.getPreferredSize=function(){this.validateMetric();if(this.cachedWidth<0){var ps=this.psWidth<0||this.psHeight<0?this.layout.calcPreferredSize(this):{width:0,height:0};ps.width=this.psWidth>=0?this.psWidth:ps.width+this.getLeft()+this.getRight();ps.height=this.psHeight>=0?this.psHeight:ps.height+this.getTop()+this.getBottom();this.cachedWidth=ps.width;this.cachedHeight=ps.height;return ps}return{width:this.cachedWidth,height:this.cachedHeight}};this.getTop=function(){return 0};this.getLeft=function(){return 0};this.getBottom=function(){return 0};this.getRight=function(){return 0};this.setParent=function(o){if(o!==this.parent){this.parent=o;this.invalidate()}};this.setLayout=function(m){if(m===null||typeof m==="undefined"){throw new Error("Null layout")}if(this.layout!==m){var pl=this.layout;this.layout=m;this.invalidate()}return this};this.calcPreferredSize=function(target){return{width:10,height:10}};this.doLayout=function(target){};this.indexOf=function(c){return this.kids.indexOf(c)};this.insert=function(i,constr,d){if(d.constraints!==null)constr=d.constraints;else d.constraints=constr;if(i===this.kids.length)this.kids.push(d);else this.kids.splice(i,0,d);d.setParent(this);if(typeof this.kidAdded!=="undefined"){this.kidAdded(i,constr,d)}this.invalidate();return d};this.setLocation=function(xx,yy){if(xx!==this.x||this.y!==yy){var px=this.x,py=this.y;this.x=xx;this.y=yy;if(typeof this.relocated!=="undefined"){this.relocated(px,py)}}return this};this.setBounds=function(x,y,w,h){this.setLocation(x,y);this.setSize(w,h);return this};this.setSize=function(w,h){if(w!==this.width||h!==this.height){var pw=this.width,ph=this.height;this.width=w;this.height=h;this.isLayoutValid=false;if(typeof this.resized!=="undefined"){this.resized(pw,ph)}}return this};this.byConstraints=function(constr){if(arguments.length===2){var res=null;constr=arguments[1];this.byPath(arguments[0],function(kid){if(kid.constraints===constr){res=kid;return true}else{return false}});return res}else{if(this.kids.length>0){for(var i=0;i<this.kids.length;i++){var l=this.kids[i];if(constr===l.constraints){return l}}}return null}};this.$setConstraints=function(c){this.constraints=c;return this};this.remove=function(c){return this.removeAt(this.kids.indexOf(c))};this.removeAt=function(i){var obj=this.kids[i];obj.setParent(null);if(obj.constraints!==null)obj.constraints=null;this.kids.splice(i,1);if(typeof this.kidRemoved!=="undefined"){this.kidRemoved(i,obj)}this.invalidate();return obj};this.removeMe=function(){var i=-1;if(this.parent!==null&&(i=this.parent.indexOf(this))>=0){this.parent.removeAt(i)}};this.setPreferredSize=function(w,h){if(w!==this.psWidth||h!==this.psHeight){this.psWidth=w;this.psHeight=h;this.invalidate()}return this};this.setAt=function(i,d){var constr=this.kids[i].constraints,pd=this.removeAt(i);if(d!==null)this.insert(i,constr,d);return pd};this.add=function(constr,d){return arguments.length===1?this.insert(this.kids.length,null,constr):this.insert(this.kids.length,constr,d)}}]);pkg.StackLayout=Class(pkg.Layout,[function $prototype(){this.calcPreferredSize=function(target){return pkg.getMaxPreferredSize(target)};this.doLayout=function(t){var top=t.getTop(),hh=t.height-t.getBottom()-top,left=t.getLeft(),ww=t.width-t.getRight()-left;for(var i=0;i<t.kids.length;i++){var l=t.kids[i];if(l.isVisible===true){var ctr=l.constraints===null?null:l.constraints;if(ctr==="usePsSize"){var ps=l.getPreferredSize();l.setBounds(left+Math.floor((ww-ps.width)/2),top+Math.floor((hh-ps.height)/2),ps.width,ps.height)}else{l.setBounds(left,top,ww,hh)}}}}}]);pkg.BorderLayout=Class(pkg.Layout,[function(hgap,vgap){if(arguments.length>0){this.hgap=this.vgap=hgap;if(arguments.length>1){this.vgap=vgap}}},function $prototype(){this.hgap=this.vgap=0;this.calcPreferredSize=function(target){var center=null,left=null,right=null,top=null,bottom=null,topRight=null,d=null;for(var i=0;i<target.kids.length;i++){var l=target.kids[i];if(l.isVisible===true){switch(l.constraints){case null:case undefined:case"center":center=l;break;case"top":top=l;break;case"bottom":bottom=l;break;case"left":left=l;break;case"right":right=l;break;default:throw new Error("Invalid constraints: "+l.constraints)}}}var dim={width:0,height:0};if(right!==null){d=right.getPreferredSize();dim.width=d.width+this.hgap;dim.height=d.height>dim.height?d.height:dim.height}if(left!==null){d=left.getPreferredSize();dim.width+=d.width+this.hgap;dim.height=d.height>dim.height?d.height:dim.height}if(center!==null){d=center.getPreferredSize();dim.width+=d.width;dim.height=d.height>dim.height?d.height:dim.height}if(top!==null){d=top.getPreferredSize();dim.width=d.width>dim.width?d.width:dim.width;dim.height+=d.height+this.vgap}if(bottom!==null){d=bottom.getPreferredSize();dim.width=d.width>dim.width?d.width:dim.width;dim.height+=d.height+this.vgap}return dim};this.doLayout=function(target){var t=target.getTop(),b=target.height-target.getBottom(),l=target.getLeft(),r=target.width-target.getRight(),center=null,left=null,top=null,bottom=null,right=null;for(var i=0;i<target.kids.length;i++){var kid=target.kids[i];if(kid.isVisible===true){switch(kid.constraints){case null:case undefined:case"center":if(center!==null){throw new Error("Component with center constraints is already defined")}center=kid;break;case"top":if(top!==null){throw new Error("Component with top constraints is already defined")}kid.setBounds(l,t,r-l,kid.getPreferredSize().height);t+=kid.height+this.vgap;top=kid;break;case"bottom":if(bottom!==null){throw new Error("Component with bottom constraints is already defined")}var bh=kid.getPreferredSize().height;kid.setBounds(l,b-bh,r-l,bh);b-=bh+this.vgap;bottom=kid;break;case"left":if(left!==null){throw new Error("Component with left constraints is already defined")}left=kid;break;case"right":if(right!==null){throw new Error("Component with right constraints is already defined")}right=kid;break;default:throw new Error("Invalid constraints: '"+kid.constraints+"'")}}}if(right!==null){var rw=right.getPreferredSize().width;right.setBounds(r-rw,t,rw,b-t);r-=rw+this.hgap}if(left!==null){left.setBounds(l,t,left.getPreferredSize().width,b-t);l+=left.width+this.hgap}if(center!==null){center.setBounds(l,t,r-l,b-t)}}}]);pkg.RasterLayout=Class(pkg.Layout,[function(usePsSize){if(arguments.length>0){this.usePsSize=usePsSize}},function $prototype(){this.usePsSize=false;this.calcPreferredSize=function(c){var m={width:0,height:0};for(var i=0;i<c.kids.length;i++){var kid=c.kids[i];if(kid.isVisible===true){var ps=this.usePsSize?kid.getPreferredSize():{width:kid.width,height:kid.height},px=kid.x+ps.width,py=kid.y+ps.height;if(px>m.width)m.width=px;if(py>m.height)m.height=py}}return m};this.doLayout=function(c){var r=c.getRight(),b=c.getBottom(),t=c.getTop(),l=c.getLeft();for(var i=0;i<c.kids.length;i++){var kid=c.kids[i],ww=0,hh=0;if(kid.isVisible===true){if(this.usePsSize){var ps=kid.toPreferredSize();ww=ps.width;hh=ps.height}else{ww=kid.width;hh=kid.height}var ctr=kid.constraints===null?null:kid.constraints;if(ctr!==null){var x=kid.x,y=kid.y,size=null;if(ctr==="top"||ctr==="topRight"||ctr==="topLeft"){y=t}else if(ctr==="bottom"||ctr==="bottomLeft"||ctr==="bottomRight"){y=c.height-hh-b}else if(ctr==="center"||ctr==="left"||ctr==="right"){y=Math.floor((c.height-hh)/2)}if(ctr==="left"||ctr==="topLeft"||ctr==="bottomLeft"){x=l}else if(ctr==="right"||ctr==="topRight"||ctr==="bottomRight"){x=c.width-ww-r}else if(ctr==="center"||ctr==="top"||ctr==="bottom"){x=Math.floor((c.width-ww)/2)}kid.setLocation(x,y)}}}}}]);pkg.FlowLayout=Class(pkg.Layout,[function(ax,ay,dir,g){if(arguments.length===1){this.gap=ax}else{if(arguments.length>1){this.ax=ax;this.ay=ay}if(arguments.length>2){this.direction=zebkit.util.$validateValue(dir,"horizontal","vertical")}if(arguments.length>3)this.gap=g}},function $prototype(){this.gap=0;this.ax="left";this.ay="center";this.direction="horizontal";this.stretchLast=false;this.calcPreferredSize=function(c){var m={width:0,height:0},cc=0;for(var i=0;i<c.kids.length;i++){var a=c.kids[i];if(a.isVisible===true){var d=a.getPreferredSize();if(this.direction==="horizontal"){m.width+=d.width;m.height=d.height>m.height?d.height:m.height}else{m.width=d.width>m.width?d.width:m.width;m.height+=d.height}cc++}}var add=this.gap*(cc>0?cc-1:0);if(this.direction==="horizontal")m.width+=add;else m.height+=add;return m};this.doLayout=function(c){var psSize=this.calcPreferredSize(c),t=c.getTop(),l=c.getLeft(),lastOne=null,ew=c.width-l-c.getRight(),eh=c.height-t-c.getBottom(),px=(this.ax==="right"?ew-psSize.width:this.ax==="center"?Math.floor((ew-psSize.width)/2):0)+l,py=(this.ay==="bottom"?eh-psSize.height:this.ay==="center"?Math.floor((eh-psSize.height)/2):0)+t;for(var i=0;i<c.kids.length;i++){var a=c.kids[i];if(a.isVisible===true){var d=a.getPreferredSize(),ctr=a.constraints===null?null:a.constraints;if(this.direction==="horizontal"){ctr=ctr||this.ay;if(ctr==="stretch"){d.height=c.height-t-c.getBottom()}a.setLocation(px,ctr==="stretch"?t:ctr==="top"?py:ctr==="bottom"?Math.floor(psSize.height-d.height)+py:Math.floor((psSize.height-d.height)/2)+py);px+=d.width+this.gap}else{ctr=ctr||this.ax;if(ctr==="stretch"){d.width=c.width-l-c.getRight()}a.setLocation(ctr==="stretch"?l:ctr==="left"?px:ctr==="right"?px+Math.floor(psSize.width-d.width):px+Math.floor((psSize.width-d.width)/2),py);py+=d.height+this.gap}a.setSize(d.width,d.height);lastOne=a}}if(lastOne!==null&&this.stretchLast===true){if(this.direction==="horizontal"){lastOne.setSize(c.width-lastOne.x-c.getRight(),lastOne.height)}else{lastOne.setSize(lastOne.width,c.height-lastOne.y-c.getBottom())}}}}]);pkg.ListLayout=Class(pkg.Layout,[function(ax,gap){if(arguments.length===1){this.gap=ax}else if(arguments.length>1){this.ax=zebkit.util.$validateValue(ax,"stretch","left","right","center");this.gap=gap}},function $prototype(){this.ax="stretch";this.gap=0;this.calcPreferredSize=function(lw){var w=0,h=0,c=0;for(var i=0;i<lw.kids.length;i++){var kid=lw.kids[i];if(kid.isVisible===true){var d=kid.getPreferredSize();h+=d.height+(c>0?this.gap:0);c++;if(w<d.width)w=d.width}}return{width:w,height:h}};this.doLayout=function(lw){var x=lw.getLeft(),y=lw.getTop(),psw=lw.width-x-lw.getRight();for(var i=0;i<lw.kids.length;i++){var cc=lw.kids[i];if(cc.isVisible===true){var d=cc.getPreferredSize(),constr=cc.constraints===null?this.ax:cc.constraints;cc.setSize(constr==="stretch"?psw:d.width,d.height);cc.setLocation(constr==="stretch"?x:x+(constr==="right"?psw-cc.width:constr==="center"?Math.floor((psw-cc.width)/2):0),y);y+=d.height+this.gap}}}}]);pkg.PercentLayout=Class(pkg.Layout,[function(dir,gap,stretch){if(arguments.length>0){this.direction=zebkit.util.$validateValue(dir,"horizontal","vertical");if(arguments.length>1)this.gap=gap;if(arguments.length>2)this.stretch=stretch}},function $prototype(){this.direction="horizontal";this.gap=2;this.stretch=true;this.doLayout=function(target){var right=target.getRight(),top=target.getTop(),bottom=target.getBottom(),left=target.getLeft(),size=target.kids.length,rs=-this.gap*(size===0?0:size-1),loc=0,ns=0;if(this.direction==="horizontal"){rs+=target.width-left-right;loc=left}else{rs+=target.height-top-bottom;loc=top}for(var i=0;i<size;i++){var l=target.kids[i],c=l.constraints,useps=c==="usePsSize";if(this.direction==="horizontal"){ns=size-1===i?target.width-right-loc:useps?l.getPreferredSize().width:~~(rs*c/100);var yy=top,hh=target.height-top-bottom;if(this.stretch===false){var ph=hh;hh=l.getPreferredSize().height;yy=top+Math.floor((ph-hh)/2)}l.setBounds(loc,yy,ns,hh)}else{ns=size-1===i?target.height-bottom-loc:useps?l.getPreferredSize().height:Math.floor(rs*c/100);var xx=left,ww=target.width-left-right;if(this.stretch===false){var pw=ww;ww=l.getPreferredSize().width;xx=left+Math.floor((pw-ww)/2)}l.setBounds(xx,loc,ww,ns)}loc+=ns+this.gap}};this.calcPreferredSize=function(target){var max=0,size=target.kids.length,as=this.gap*(size===0?0:size-1);for(var i=0;i<size;i++){var d=target.kids[i].getPreferredSize();if(this.direction==="horizontal"){if(d.height>max)max=d.height;as+=d.width}else{if(d.width>max)max=d.width;as+=d.height}}return this.direction==="horizontal"?{width:as,height:max}:{width:max,height:as}}}]);pkg.Constraints=Class([function(ax,ay,p){if(arguments.length>0){this.ax=ax;if(arguments.length>1)this.ay=ay;if(arguments.length>2)this.setPadding(p);zebkit.util.$validateValue(this.ax,"stretch","left","center","right");zebkit.util.$validateValue(this.ay,"stretch","top","center","bottom")}},function $prototype(){this.top=this.bottom=this.left=this.right=0;this.ay=this.ax="stretch";this.rowSpan=this.colSpan=1;this.setPadding=function(t,l,b,r){if(arguments.length===1){this.top=this.bottom=this.left=this.right=t}else{this.top=t;this.bottom=b;this.left=l;this.right=r}return this}}]);pkg.GridLayout=Class(pkg.Layout,[function(r,c,stretchRows,stretchCols){this.rows=r;this.cols=c;this.colSizes=Array(c+1);this.rowSizes=Array(r+1);this.constraints=new pkg.Constraints;if(arguments.length>2){this.stretchRows=stretchRows===true}if(arguments.length>3){this.stretchCols=stretchCols===true}},function $prototype(){this.stretchCols=false;this.stretchRows=false;this.setPadding=function(){this.constraints.setPadding.apply(this.constraints,arguments);return this};this.setDefaultConstraints=function(c){this.constraints=c;return this};this.calcCols=function(c){this.colSizes[this.cols]=0;for(var i=0;i<this.cols;i++){this.colSizes[i]=this.calcCol(i,c);this.colSizes[this.cols]+=this.colSizes[i]}return this.colSizes};this.calcRows=function(c){this.rowSizes[this.rows]=0;for(var i=0;i<this.rows;i++){this.rowSizes[i]=this.calcRow(i,c);this.rowSizes[this.rows]+=this.rowSizes[i]}return this.rowSizes};this.calcRow=function(row,c){var max=0,s=row*this.cols;for(var i=s;i<c.kids.length&&i<s+this.cols;i++){var a=c.kids[i];if(a.isVisible===true){var arg=a.constraints||this.constraints,d=a.getPreferredSize().height;d+=arg.top+arg.bottom;if(d>max)max=d}}return max};this.calcCol=function(col,c){var max=0;for(var i=col;i<c.kids.length;i+=this.cols){var a=c.kids[i];if(a.isVisible===true){var arg=a.constraints||this.constraints,d=a.getPreferredSize().width+arg.left+arg.right;if(d>max)max=d}}return max};this.calcPreferredSize=function(c){return{width:this.calcCols(c)[this.cols],height:this.calcRows(c)[this.rows]}};this.doLayout=function(c){var rows=this.rows,cols=this.cols,colSizes=this.calcCols(c),rowSizes=this.calcRows(c),top=c.getTop(),left=c.getLeft(),cc=0,i=0;if(this.stretchCols){var dw=c.width-left-c.getRight()-colSizes[cols];for(i=0;i<cols;i++){colSizes[i]=colSizes[i]+(colSizes[i]!==0?Math.floor(dw*colSizes[i]/colSizes[cols]):0)}}if(this.stretchRows){var dh=c.height-top-c.getBottom()-rowSizes[rows];for(i=0;i<rows;i++){rowSizes[i]=rowSizes[i]+(rowSizes[i]!==0?Math.floor(dh*rowSizes[i]/rowSizes[rows]):0)}}for(i=0;i<rows&&cc<c.kids.length;i++){var xx=left;for(var j=0;j<cols&&cc<c.kids.length;j++,cc++){var l=c.kids[cc];if(l.isVisible===true){var arg=l.constraints||this.constraints,d=l.getPreferredSize(),cellW=colSizes[j],cellH=rowSizes[i];cellW-=arg.left+arg.right;cellH-=arg.top+arg.bottom;if("stretch"===arg.ax)d.width=cellW;if("stretch"===arg.ay)d.height=cellH;l.setSize(d.width,d.height);l.setLocation(xx+arg.left+("stretch"===arg.ax?0:arg.ax==="right"?cellW-d.width:arg.ax==="center"?Math.floor((cellW-d.width)/2):0),top+arg.top+("stretch"===arg.ay?0:arg.ay==="bottom"?cellH-d.height:arg.ay==="center"?Math.floor((cellH-d.height)/2):0));xx+=colSizes[j]}}top+=rowSizes[i]}}}])});zebkit.package("ui",function(pkg,Class){"use strict";pkg.Manager=Class([function(){if(pkg.events!==null&&typeof pkg.events!=="undefined"){pkg.events.on(this)}}]);pkg.CompEvent=Class(zebkit.util.Event,[function $prototype(){this.kid=this.constraints=null;this.prevX=this.prevY=this.index=-1;this.prevWidth=this.prevHeight=-1}]);pkg.KeyEvent=Class(zebkit.util.Event,[function $prototype(){this.code=null;this.key=null;this.device="keyboard";this.altKey=false;this.shiftKey=false;this.ctrlKey=false;this.metaKey=false;this.repeat=0;this.timeStamp=0;this.getModifierState=function(m){if(m==="Meta"){return this.metaKey}if(m==="Control"){return this.ctrlKey}if(m==="Shift"){return this.shiftKey}if(m==="Alt"){return this.altKey}throw new Error("Unknown modifier key '"+m+"'")}}]);pkg.PointerEvent=Class(zebkit.util.Event,[function $prototype(){this.pointerType="mouse";this.touchCounter=0;this.pageX=-1;this.pageY=-1;this.target=null;this.identifier=null;this.shiftKey=this.altKey=this.metaKey=this.ctrlKey=false;this.pressure=.5;this.absX=0;this.absY=0;this.x=0;this.y=0;this.update=function(source,ax,ay){if(this.source===source&&this.source.parent===source.parent&&source.x===this.$px&&source.y===this.$py){this.x+=ax-this.absX;this.y+=ay-this.absY;this.absX=ax;this.absY=ay;this.source=source}else{this.source=source;this.absX=ax;this.absY=ay;while(source.parent!==null){ax-=source.x;ay-=source.y;source=source.parent}this.x=ax;this.y=ay}this.$px=source.x;this.$py=source.y;return this};this.isAction=function(){throw new Error("Not implemented")};this.getTouches=function(){throw new Error("Not implemented")}}]);pkg.EventManager=Class(pkg.Manager,zebkit.EventProducer,[function(){this._=new this.clazz.Listerners;this.$super()},function $clazz(argument){var eventNames=["keyTyped","keyReleased","keyPressed","pointerDragged","pointerDragStarted","pointerDragEnded","pointerMoved","pointerClicked","pointerDoubleClicked","pointerPressed","pointerReleased","pointerEntered","pointerExited","focusLost","focusGained","compSized","compMoved","compEnabled","compShown","compAdded","compRemoved"];this.$CHILD_EVENTS_MAP={};for(var i=0;i<eventNames.length;i++){var eventName=eventNames[i];this.$CHILD_EVENTS_MAP[eventName]="child"+eventName[0].toUpperCase()+eventName.substring(1)}this.Listerners=zebkit.util.ListenersClass.apply(this,eventNames)},function $prototype(clazz){var $CEM=clazz.$CHILD_EVENTS_MAP;this.regEvents=function(){this._.addEvents.apply(this._,arguments);for(var i=0;i<arguments.length;i++){var eventName=arguments[i];$CEM[eventName]="child"+eventName[0].toUpperCase()+eventName.substring(1)}};this.fire=function(id,e){var childEvent=$CEM[id];e.id=id;if(typeof e.source.suppressEvent!=="undefined"&&e.source.suppressEvent(e)===true){return true}if(this._[id](e)===false){if(typeof e.source[id]!=="undefined"&&e.source[id].call(e.source,e)===true){return true}for(var t=e.source.parent;t!==null;t=t.parent){if(typeof t[childEvent]!=="undefined"){t[childEvent].call(t,e)}}return false}else{return true}}}]);this.events=new pkg.EventManager;pkg.Clipboard=Class(pkg.Manager,[function $prototype(){this.getDestination=function(){return pkg.focusManager.focusOwner}}]);pkg.CursorManager=Class(pkg.Manager,[function $prototype(){this.cursorType="default"}]);pkg.$configWith=function(pkg,path){if(arguments.length<2){var fn=pkg.fullname();path=fn.substring(fn.indexOf(".")+1)+".json"}if(path[0]!=="/"){var root=zebkit.config["ui.theme.path"];if(typeof root==="undefined"){root=typeof zebkit.config["ui.theme.name"]==="undefined"?"rs/themes/dark":"rs/themes/"+zebkit.config["ui.theme.name"]}if(root[0]!=="/"){path=zebkit.URI.join(zebkit.ui.$url,root,path)}else{path=zebkit.URI.join(root,path)}}zebkit.then(function(){this.till(new zebkit.util.Zson(pkg).then(path))})};pkg.zCanvas=Class([]);pkg.$getPS=function(l){return l!==null&&l.isVisible===true?l.getPreferredSize():{width:0,height:0}};pkg.$cvp=function(c,r){if(c.width>0&&c.height>0&&c.isVisible===true){var p=c.parent,px=-c.x,py=-c.y;if(arguments.length<2){r={x:0,y:0,width:c.width,height:c.height}}else{r.x=r.y=0;r.width=c.width;r.height=c.height}while(p!==null&&r.width>0&&r.height>0){var xx=r.x>px?r.x:px,yy=r.y>py?r.y:py,w1=r.x+r.width,w2=px+p.width,h1=r.y+r.height,h2=py+p.height;r.width=(w1<w2?w1:w2)-xx;r.height=(h1<h2?h1:h2)-yy;r.x=xx;r.y=yy;px-=p.x;py-=p.y;p=p.parent}return r.width>0&&r.height>0?r:null}return null};pkg.makeFullyVisible=function(d,c){if(arguments.length===1){c=d;d=c.parent}var right=d.getRight(),top=d.getTop(),bottom=d.getBottom(),left=d.getLeft(),xx=c.x,yy=c.y;if(xx<left)xx=left;if(yy<top)yy=top;if(xx+c.width>d.width-right)xx=d.width+right-c.width;if(yy+c.height>d.height-bottom)yy=d.height+bottom-c.height;c.setLocation(xx,yy)};pkg.calcOrigin=function(x,y,w,h,px,py,t,tt,ll,bb,rr){if(arguments.length<8){tt=t.getTop();ll=t.getLeft();bb=t.getBottom();rr=t.getRight()}var dw=t.width,dh=t.height;if(dw>0&&dh>0){if(dw-ll-rr>w){var xx=x+px;if(xx<ll)px+=ll-xx;else{xx+=w;if(xx>dw-rr)px-=xx-dw+rr}}if(dh-tt-bb>h){var yy=y+py;if(yy<tt)py+=tt-yy;else{yy+=h;if(yy>dh-bb)py-=yy-dh+bb}}return[px,py]}return[0,0]};pkg.Font=Class([function(family,style,size){if(arguments.length===1){this.size=this.clazz.decodeSize(family);if(this.size===null){family=family.trim();if(family==="bold"||family==="italic"){this.style=family}else{var re=/([a-zA-Z_\- ]+)?(([0-9]+px|[0-9]+em)\s+([,\"'a-zA-Z_ \-]+))?/,m=family.match(re);if(typeof m[4]!=="undefined"){this.family=m[4].trim()}if(typeof m[3]!=="undefined"){this.size=m[3].trim()}if(typeof m[1]!=="undefined"){this.style=m[1].trim()}this.s=family}}}else if(arguments.length===2){this.family=family;this.size=this.clazz.decodeSize(style);this.style=this.size===null?style:null}else if(arguments.length===3){this.family=family;this.style=style;this.size=this.clazz.decodeSize(size)}if(this.size===null){this.size=this.clazz.size+"px"}if(this.s===null){this.s=(this.style!==null?this.style+" ":"")+this.size+" "+this.family}var mt=zebkit.environment.fontMetrics(this.s);this.height=mt.height;this.ascent=mt.ascent},function $clazz(){this.family="Arial, Helvetica";this.style=null;this.size=14;this.mergeable=false;this.decodeSize=function(s,defaultSize){if(arguments.length<2){defaultSize=this.size}if(zebkit.isString(s)){var size=Number(s);if(isNaN(size)){var m=s.match(/^([0-9]+)(%)$/);if(m!==null&&typeof m[1]!=="undefined"&&m[2]!=="undefined"){size=Math.floor(defaultSize*parseInt(m[1],10)/100);return size+"px"}else{return/^([0-9]+)(em|px)$/.test(s)===true?s:null}}else{if(s[0]==="+"){size=defaultSize+size}else if(s[0]==="-"){size=defaultSize-size}return size+"px"}}return s===null?null:s+"px"}},function $prototype(clazz){this.s=null;this.family=clazz.family;this.style=clazz.style;this.size=clazz.size;this.toString=function(){return this.s};this.stringWidth=function(s){if(s.length===0){return 0}else{var fm=zebkit.environment.fontMeasure;if(fm.font!==this.s){fm.font=this.s}return fm.measureText(s).width+.5|0}};this.charsWidth=function(s,off,len){var fm=zebkit.environment.fontMeasure;if(fm.font!==this.s){fm.font=this.s}return fm.measureText(len===1?s[off]:s.substring(off,off+len)).width+.5|0};this.resize=function(size){var nsize=this.clazz.decodeSize(size,this.height);if(nsize===null){throw new Error("Invalid font size : "+size)}return new this.clazz(this.family,this.style,nsize)};this.restyle=function(style){return new this.clazz(this.family,style,this.height+"px")}}]);var $paintTask=null,$paintTasks=[],temporary={x:0,y:0,width:0,height:0},COMP_EVENT=new pkg.CompEvent;pkg.$doPaint=function(){for(var i=$paintTasks.length-1;i>=0;i--){var canvas=$paintTasks.shift();try{if(canvas.isValid===false||canvas.isLayoutValid===false){canvas.validate()}if(canvas.$da.width>0){canvas.$context.save();if(canvas.bg===null||canvas.bg.isOpaque!==true){canvas.$context.clearRect(canvas.$da.x,canvas.$da.y,canvas.$da.width,canvas.$da.height)}canvas.$context.clipRect(canvas.$da.x,canvas.$da.y,canvas.$da.width,canvas.$da.height);canvas.$da.width=-1;canvas.$waitingForPaint=false;canvas.paintComponent(canvas.$context);canvas.$context.restore()}else{canvas.$waitingForPaint=false}}catch(ex){try{if(canvas!==null){canvas.$waitingForPaint=false;canvas.$da.width=-1;if(canvas.$context!==null){canvas.$context.restoreAll()}}}catch(exx){$paintTask=null;$paintTasks.length=0;throw exx}zebkit.dumpError(ex)}}$paintTask=null;if($paintTasks.length!==0){$paintTask=zebkit.environment.animate(pkg.$doPaint)}};pkg.Panel=Class(zebkit.layout.Layoutable,[function $prototype(){this.bg=this.border=null;this.repaint=function(x,y,w,h){if(this.isVisible===true&&(this.parent!==null||typeof this.$context!=="undefined")){var canvas=this;for(;typeof canvas.$context==="undefined";canvas=canvas.parent){if(canvas.isVisible===false||canvas.parent===null){return}}if(arguments.length===0){x=y=0;w=this.width;h=this.height}if(w>0&&h>0){var r=pkg.$cvp(this,temporary);if(r!==null){zebkit.util.intersection(r.x,r.y,r.width,r.height,x,y,w,h,r);if(r.width>0&&r.height>0){x=r.x;y=r.y;w=r.width;h=r.height;var cc=this;while(cc!==canvas){x+=cc.x;y+=cc.y;cc=cc.parent}if(x<0){w+=x;x=0}if(y<0){h+=y;y=0}if(w+x>canvas.width)w=canvas.width-x;if(h+y>canvas.height)h=canvas.height-y;if(w>0&&h>0){var da=canvas.$da;if(da.width>0){if(x<da.x||y<da.y||x+w>da.x+da.width||y+h>da.y+da.height){var dax=da.x,day=da.y;if(da.x>x)da.x=x;if(da.y>y)da.y=y;da.width=Math.max(dax+da.width,x+w)-da.x;da.height=Math.max(day+da.height,y+h)-da.y}}else{da.x=x;da.width=w;da.y=y;da.height=h}}}}}if(canvas.$waitingForPaint!==true&&(canvas.isValid===false||canvas.$da.width>0||canvas.isLayoutValid===false)){$paintTasks[$paintTasks.length]=canvas;canvas.$waitingForPaint=true;if($paintTask===null){$paintTask=zebkit.environment.animate(pkg.$doPaint)}}}};this.getEventDestination=function(){var c=this,p=this;while((p=p.parent)!==null){if(typeof p.catchInput!=="undefined"&&(p.catchInput===true||p.catchInput!==false&&p.catchInput(c)===true)){c=p}}return c};this.paintComponent=function(g){var ts=g.$states[g.$curState];if(ts.width>0&&ts.height>0&&this.isVisible===true){if(this.isLayoutValid===false){this.validate()}var b=this.bg!==null&&(this.parent===null||this.bg!==this.parent.bg);if(this.border!==null&&typeof this.border.outline!=="undefined"&&(b===true||typeof this.update!=="undefined")&&this.border.outline(g,0,0,this.width,this.height,this)===true){g.save();g.clip();if(b){this.bg.paint(g,0,0,this.width,this.height,this)}if(typeof this.update!=="undefined"){this.update(g)}g.restore()}else{if(b===true){this.bg.paint(g,0,0,this.width,this.height,this)}if(typeof this.update!=="undefined"){this.update(g)}}if(this.border!==null){this.border.paint(g,0,0,this.width,this.height,this)}if(typeof this.paint!=="undefined"){var left=this.getLeft(),top=this.getTop(),bottom=this.getBottom(),right=this.getRight();if(left>0||right>0||top>0||bottom>0){if(ts.width>0&&ts.height>0){var x1=ts.x>left?ts.x:left,y1=ts.y>top?ts.y:top,cxcw=ts.x+ts.width,cych=ts.y+ts.height,cright=this.width-right,cbottom=this.height-bottom;g.save();g.clipRect(x1,y1,(cxcw<cright?cxcw:cright)-x1,(cych<cbottom?cych:cbottom)-y1);this.paint(g);g.restore()}}else{this.paint(g)}}var count=this.kids.length;for(var i=0;i<count;i++){var kid=this.kids[i];if(kid.isVisible===true&&typeof kid.$context==="undefined"){var kidXW=kid.x+kid.width,c_xw=ts.x+ts.width,kidYH=kid.y+kid.height,c_yh=ts.y+ts.height,iw=(kidXW<c_xw?kidXW:c_xw)-(kid.x>ts.x?kid.x:ts.x),ih=(kidYH<c_yh?kidYH:c_yh)-(kid.y>ts.y?kid.y:ts.y);if(iw>0&&ih>0){g.save();g.translate(kid.x,kid.y);g.clipRect(0,0,kid.width,kid.height);kid.paintComponent(g);g.restore()}}}if(typeof this.paintOnTop!=="undefined"){this.paintOnTop(g)}}};this.top=this.left=this.right=this.bottom=0;this.isEnabled=true;this.getCanvas=function(){var c=this;for(;c!==null&&c.$isRootCanvas!==true;c=c.parent);return c};this.notifyRender=function(o,n){if(o!==null&&typeof o.ownerChanged!=="undefined")o.ownerChanged(null);if(n!==null&&typeof n.ownerChanged!=="undefined")n.ownerChanged(this)};this.load=function(jsonPath){return new zebkit.util.Zson(this).then(jsonPath)};this.getComponentAt=function(x,y){var r=pkg.$cvp(this,temporary);if(r===null||(x<r.x||y<r.y||x>=r.x+r.width||y>=r.y+r.height)){return null}if(this.kids.length>0){for(var i=this.kids.length;--i>=0;){var kid=this.kids[i];kid=kid.getComponentAt(x-kid.x,y-kid.y);if(kid!==null)return kid}}return typeof this.contains==="undefined"||this.contains(x,y)===true?this:null};this.vrp=function(){this.invalidate();if(this.isVisible===true&&this.parent!==null){this.repaint()}};this.getTop=function(){return this.border!==null?this.top+this.border.getTop():this.top};this.getLeft=function(){return this.border!==null?this.left+this.border.getLeft():this.left};this.getBottom=function(){return this.border!==null?this.bottom+this.border.getBottom():this.bottom};this.getRight=function(){return this.border!==null?this.right+this.border.getRight():this.right};this.isInvalidatedByChild=function(c){return true};this.kidAdded=function(index,constr,l){COMP_EVENT.source=this;COMP_EVENT.constraints=constr;COMP_EVENT.kid=l;pkg.events.fire("compAdded",COMP_EVENT);if(l.width>0&&l.height>0){l.repaint()}else{this.repaint(l.x,l.y,1,1)}};this.setConstraints=function(ctr){if(this.constraints!==ctr){this.constraints=ctr;if(this.parent!==null){this.vrp()}}return this};this.kidRemoved=function(i,l){COMP_EVENT.source=this;COMP_EVENT.index=i;COMP_EVENT.kid=l;pkg.events.fire("compRemoved",COMP_EVENT);if(l.isVisible===true){this.repaint(l.x,l.y,l.width,l.height)}};this.relocated=function(px,py){COMP_EVENT.source=this;COMP_EVENT.prevX=px;COMP_EVENT.prevY=py;pkg.events.fire("compMoved",COMP_EVENT);var p=this.parent,w=this.width,h=this.height;if(p!==null&&w>0&&h>0){var x=this.x,y=this.y,nx=x<px?x:px,ny=y<py?y:py;if(nx<0)nx=0;if(ny<0)ny=0;var w1=p.width-nx,w2=w+(x>px?x-px:px-x),h1=p.height-ny,h2=h+(y>py?y-py:py-y);p.repaint(nx,ny,w1<w2?w1:w2,h1<h2?h1:h2)}};this.resized=function(pw,ph){COMP_EVENT.source=this;COMP_EVENT.prevWidth=pw;COMP_EVENT.prevHeight=ph;pkg.events.fire("compSized",COMP_EVENT);if(this.parent!==null){this.parent.repaint(this.x,this.y,this.width>pw?this.width:pw,this.height>ph?this.height:ph)}};this.hasFocus=function(){return pkg.focusManager.hasFocus(this)};this.requestFocus=function(){pkg.focusManager.requestFocus(this)};this.requestFocusIn=function(timeout){if(arguments.length===0){timeout=50}var $this=this;zebkit.util.tasksSet.runOnce(function(){$this.requestFocus()},timeout)};this.setVisible=function(b){if(this.isVisible!==b){this.isVisible=b;this.invalidate();COMP_EVENT.source=this;pkg.events.fire("compShown",COMP_EVENT);if(this.parent!==null){if(b)this.repaint();else{this.parent.repaint(this.x,this.y,this.width,this.height)}}}return this};this.setEnabled=function(b){if(this.isEnabled!==b){this.isEnabled=b;COMP_EVENT.source=this;pkg.events.fire("compEnabled",COMP_EVENT);if(this.kids.length>0){for(var i=0;i<this.kids.length;i++){this.kids[i].setEnabled(b)}}this.repaint()}return this};this.setPadding=function(top,left,bottom,right){if(arguments.length===1){left=bottom=right=top}if(this.top!==top||this.left!==left||this.bottom!==bottom||this.right!==right){this.top=top;this.left=left;this.bottom=bottom;this.right=right;this.vrp()}return this};this.setTopPadding=function(top){if(this.top!==top){this.top=top;this.vrp()}return this};this.setLeftPadding=function(left){if(this.left!==left){this.left=left;this.vrp()}return this};this.setBottomPadding=function(bottom){if(this.bottom!==bottom){this.bottom=bottom;this.vrp()}return this};this.setRightPadding=function(right){if(this.right!==right){this.right=right;this.vrp()}return this};this.setBorder=function(v){var old=this.border;v=pkg.$view(v);if(v!=old){this.border=v;this.notifyRender(old,v);if(old===null||v===null||old.getTop()!==v.getTop()||old.getLeft()!==v.getLeft()||old.getBottom()!==v.getBottom()||old.getRight()!==v.getRight()){this.invalidate()}if(v!==null&&typeof v.activate!=="undefined"){v.activate(this.hasFocus()?"focuson":"focusoff",this)}this.repaint()}return this};this.setBackground=function(v){var old=this.bg;v=pkg.$view(v);if(v!==old){this.bg=v;this.notifyRender(old,v);this.repaint()}return this};this.setKids=function(a){if(arguments.length===1&&zebkit.instanceOf(a,pkg.Panel)){this.add(a)}else{var i=0;if(arguments.length>1){for(i=0;i<arguments.length;i++){var kid=arguments[i];if(kid!==null){this.add(typeof kid.$new!=="undefined"?kid.$new():kid)}}}else{if(Array.isArray(a)){for(i=0;i<a.length;i++){if(a[i]!==null){this.add(a[i])}}}else{var kids=a;for(var k in kids){if(kids.hasOwnProperty(k)){this.add(k,kids[k])}}}}}};this.focused=function(){if(this.border!==null&&typeof this.border.activate!=="undefined"){var id=this.hasFocus()?"focuson":"focusoff";if(typeof this.border.views[id]!=="undefined"){this.border.activate(id,this);this.repaint()}}};this.removeAll=function(){if(this.kids.length>0){var size=this.kids.length,mx1=Number.MAX_VALUE,my1=mx1,mx2=0,my2=0;for(;size>0;size--){var child=this.kids[size-1];if(child.isVisible===true){var xx=child.x,yy=child.y;mx1=mx1<xx?mx1:xx;my1=my1<yy?my1:yy;mx2=Math.max(mx2,xx+child.width);my2=Math.max(my2,yy+child.height)}this.removeAt(size-1)}this.repaint(mx1,my1,mx2-mx1,my2-my1)}return this};this.toFront=function(){if(this.parent!==null&&this.parent.kids[this.parent.kids.length-1]!==this){var p=this.parent;p.kids.splice(p.indexOf(this),1);p.kids[p.kids.length]=this;p.vrp()}return this};this.toBack=function(){if(this.parent!==null&&this.parent.kids[0]!==this){var p=this.parent;p.kids.splice(p.indexOf(this),1);p.kids.unshift(this);p.vrp()}return this};this.toPreferredSize=function(){var ps=this.getPreferredSize();this.setSize(ps.width,ps.height);return ps};this.toView=function(target){return new pkg.CompRender(this)};this.paintViewAt=function(g,ax,ay,v){var x=this.getLeft(),y=this.getTop(),ps=v.getPreferredSize();if(ax==="center"){x=Math.floor((this.width-ps.width)/2)}else if(ax==="right"){x=this.width-this.getRight()-ps.width}if(ay==="center"){y=Math.floor((this.height-ps.height)/2)}else if(ay==="bottom"){y=this.height-this.getBottom()-ps.height}v.paint(g,x,y,ps.width,ps.height,this)};this[""]=function(l){if(typeof this.kids==="undefined"){this.kids=[]}if(this.layout===null){this.layout=this}if(this.clazz.inheritProperties===true){var hierarchy=[],pp=this.clazz;while(pp.$parent!==null&&pp.inheritProperties===true){pp=pp.$parent;hierarchy[hierarchy.length]=pp}for(var i=hierarchy.length;i>=0;i--){this.properties(hierarchy[i])}}this.properties(this.clazz);if(arguments.length>0){if(l.constructor===Object){this.properties(l)}else{this.setLayout(l)}}}}]);pkg.RootLayerMix=zebkit.Interface([function $clazz(){this.id="root"},function $prototype(){this.getFocusRoot=function(){return this}}]);pkg.RootLayer=Class(pkg.Panel,pkg.RootLayerMix,[]);pkg.font=new pkg.Font("Arial",14);pkg.smallFont=new pkg.Font("Arial",10);pkg.boldFont=new pkg.Font("Arial","bold",12);pkg.$view=function(v){if(v===null||typeof v.paint!=="undefined"){return v}if(zebkit.isString(v)){if(typeof zebkit.util.rgb[v]!=="undefined"){return zebkit.util.rgb[v]}if(typeof pkg.borders!=="undefined"&&typeof pkg.borders[v]!=="undefined"){return pkg.borders[v]}if(v.length>0&&(v[0]==="#"||v.length>2&&v[0]==="r"&&v[1]==="g"&&v[2]==="b")){return new zebkit.util.rgb(v)}return new pkg.StringRender(v)}if(Array.isArray(v)){return new pkg.CompositeView(v)}if(typeof v!=="function"){return new pkg.ViewSet(v)}var vv=new pkg.View;vv.paint=v;return vv};zebkit.util.rgb.prototype.paint=function(g,x,y,w,h,d){if(this.s!==g.fillStyle){g.fillStyle=this.s}if(typeof g.$states!=="undefined"){var t=g.$states[g.$curState],rx=x>t.x?x:t.x,rw=Math.min(x+w,t.x+t.width)-rx;if(rw>0){var ry=y>t.y?y:t.y,rh=Math.min(y+h,t.y+t.height)-ry;if(rh>0)g.fillRect(rx,ry,rw,rh)}}else{g.fillRect(x,y,w,h)}};zebkit.util.rgb.prototype.getPreferredSize=function(){return{width:0,height:0}};zebkit.util.rgb.gap=0;zebkit.util.rgb.prototype.getTop=zebkit.util.rgb.prototype.getLeft=zebkit.util.rgb.prototype.getRight=zebkit.util.rgb.prototype.getBottom=function(){return this.gap};pkg.View=Class([function $prototype(){this.gap=2;this.getRight=this.getLeft=this.getBottom=this.getTop=function(){return this.gap};this.getPreferredSize=function(){return{width:0,height:0}};this.paint=function(g,x,y,w,h,c){}}]);pkg.Render=Class(pkg.View,[function(target){this.setTarget(target)},function $prototype(){this.target=null;this.setTarget=function(o){if(this.target!==o){var old=this.target;this.target=o;if(typeof this.targetWasChanged!=="undefined"){this.targetWasChanged(old,o)}}}}]);pkg.Sunken=Class(pkg.View,[function(brightest,middle,darkest){if(arguments.length>0)this.brightest=brightest;if(arguments.length>1)this.middle=middle;if(arguments.length>2)this.darkest=darkest},function $prototype(){this.brightest="white";this.middle="gray";this.darkest="black";this.paint=function(g,x1,y1,w,h,d){var x2=x1+w-1,y2=y1+h-1;g.setColor(this.middle);g.drawLine(x1,y1,x2-1,y1);g.drawLine(x1,y1,x1,y2-1);g.setColor(this.brightest);g.drawLine(x2,y1,x2,y2+1);g.drawLine(x1,y2,x2,y2);g.setColor(this.darkest);g.drawLine(x1+1,y1+1,x1+1,y2);g.drawLine(x1+1,y1+1,x2,y1+1)}}]);pkg.Etched=Class(pkg.View,[function(brightest,middle){if(arguments.length>0)this.brightest=brightest;if(arguments.length>1)this.middle=middle},function $prototype(){this.brightest="white";this.middle="gray";this.paint=function(g,x1,y1,w,h,d){var x2=x1+w-1,y2=y1+h-1;g.setColor(this.middle);g.drawLine(x1,y1,x1,y2-1);g.drawLine(x2-1,y1,x2-1,y2);g.drawLine(x1,y1,x2,y1);g.drawLine(x1,y2-1,x2-1,y2-1);g.setColor(this.brightest);g.drawLine(x2,y1,x2,y2);g.drawLine(x1+1,y1+1,x1+1,y2-1);g.drawLine(x1+1,y1+1,x2-1,y1+1);g.drawLine(x1,y2,x2+1,y2)}}]);pkg.Raised=Class(pkg.View,[function(brightest,middle){if(arguments.length>0)this.brightest=brightest;if(arguments.length>1)this.middle=middle},function $prototype(){this.brightest="white";this.middle="gray";this.paint=function(g,x1,y1,w,h,d){var x2=x1+w-1,y2=y1+h-1;g.setColor(this.brightest);g.drawLine(x1,y1,x2,y1);g.drawLine(x1,y1,x1,y2);g.setColor(this.middle);g.drawLine(x2,y1,x2,y2+1);g.drawLine(x1,y2,x2,y2)}}]);pkg.Dotted=Class(pkg.View,[function(c){if(arguments.length>0)this.color=c},function $prototype(){this.color="black";this.paint=function(g,x,y,w,h,d){g.setColor(this.color);g.drawDottedRect(x,y,w,h)}}]);pkg.Shape=Class(pkg.View,[function(c,w){if(arguments.length>0)this.color=c;if(arguments.length>1)this.width=this.gap=w},function $prototype(){this.color="gray";this.gap=this.width=1;this.paint=function(g,x,y,w,h,d){if(g.lineWidth!==this.width){g.lineWidth=this.width}this.outline(g,x,y,w,h,d);g.setColor(this.color);g.stroke()}}]);pkg.TriangleShape=Class(pkg.Shape,[function $prototype(){this.outline=function(g,x,y,w,h,d){g.beginPath();w-=2*this.width;h-=2*this.width;g.moveTo(x+w-1,y);g.lineTo(x+w-1,y+h-1);g.lineTo(x,y+h-1);g.closePath();return true}}]);pkg.Border=Class(pkg.View,[function(c,w,r){if(arguments.length>0)this.color=c;if(arguments.length>1)this.width=this.gap=w;if(arguments.length>2)this.radius=r},function $prototype(){this.color="gray";this.gap=this.width=1;this.radius=0;this.sides=15;this.setSides=function(top,left,bottom,right){this.sides=0;for(var i=0;i<arguments.length;i++){if(arguments[i]==="top")this.sides|=1;else if(arguments[i]==="left")this.sides|=2;else if(arguments[i]==="bottom")this.sides|=4;else if(arguments[i]==="right")this.sides|=8}return this};this.paint=function(g,x,y,w,h,d){if(this.color!==null&&this.width>0){var ps=g.lineWidth;if(g.lineWidth!==this.width){g.lineWidth=this.width}if(this.radius>0){this.outline(g,x,y,w,h,d);g.setColor(this.color);g.stroke()}else if(this.sides!==15){g.setColor(this.color);if((this.sides&1)>0){g.drawLine(x,y,x+w,y,this.width)}if((this.sides&8)>0){g.drawLine(x+w-this.width,y,x+w-this.width,y+h,this.width)}if((this.sides&4)>0){g.drawLine(x,y+h-this.width,x+w,y+h-this.width,this.width)}if((this.sides&2)>0){g.drawLine(x,y,x,y+h,this.width)}}else{var dt=this.width/2;g.beginPath();g.rect(x+dt,y+dt,w-this.width,h-this.width);g.closePath();g.setColor(this.color);g.stroke()}if(g.lineWidth!==ps)g.lineWidth=ps}};this.outline=function(g,x,y,w,h,d){if(this.radius<=0){return false}var r=this.radius,dt=this.width/2,xx=x+w-dt,yy=y+h-dt;x+=dt;y+=dt;g.beginPath();g.moveTo(x+r,y);g.lineTo(xx-r,y);g.quadraticCurveTo(xx,y,xx,y+r);g.lineTo(xx,yy-r);g.quadraticCurveTo(xx,yy,xx-r,yy);g.lineTo(x+r,yy);g.quadraticCurveTo(x,yy,x,yy-r);g.lineTo(x,y+r);g.quadraticCurveTo(x,y,x+r,y);g.closePath();return true}}]);pkg.RoundBorder=Class(pkg.View,[function(col,width){if(arguments.length>0){if(zebkit.isNumber(col))this.width=col;else{this.color=col;if(zebkit.isNumber(width))this.width=width}}this.gap=this.width},function $prototype(){this.width=1;this.color=null;this.fillColor=null;this.paint=function(g,x,y,w,h,d){if(this.color!==null&&this.width>0){this.outline(g,x,y,w,h,d);g.setColor(this.color);g.stroke();if(this.fillColor!==null){g.setColor(this.fillColor);g.fill()}}};this.outline=function(g,x,y,w,h,d){g.lineWidth=this.width;if(w===h){g.beginPath();g.arc(Math.floor(x+w/2)+(w%2===0?0:.5),Math.floor(y+h/2)+(h%2===0?0:.5),Math.floor((w-g.lineWidth)/2),0,2*Math.PI,false);g.closePath()}else{g.ovalPath(x,y,w,h)}return true};this.getPreferredSize=function(){var s=this.width*8;return{width:s,height:s}}}]);pkg.CompRender=Class(pkg.Render,[function $prototype(){this.getPreferredSize=function(){return this.target===null||this.target.isVisible===false?{width:0,height:0}:this.target.getPreferredSize()};this.paint=function(g,x,y,w,h,d){var c=this.target;if(c!==null&&c.isVisible){var prevW=-1,prevH=0,parent=null;if(w!==c.width||h!==c.height){if(c.getCanvas()!==null){parent=c.parent;c.parent=null}prevW=c.width;prevH=c.height;c.setSize(w,h)}c.validate();g.translate(x,y);try{c.paintComponent(g)}catch(e){if(parent!==null){c.parent=parent}g.translate(-x,-y);throw e}g.translate(-x,-y);if(prevW>=0){c.setSize(prevW,prevH);if(parent!==null){c.parent=parent}c.validate()}}}}]);pkg.Gradient=Class(pkg.View,[function(){this.colors=Array.prototype.slice.call(arguments,0);if(arguments.length>2){this.orient=arguments[arguments.length-1];this.colors.pop()}},function $prototype(){this.orient="vertical";this.gradient=null;this.gy2=this.gy1=this.gx2=this.gx1=0;this.paint=function(g,x,y,w,h,dd){var d=this.orient==="horizontal"?[0,1]:[1,0],x1=x*d[1],y1=y*d[0],x2=(x+w-1)*d[1],y2=(y+h-1)*d[0];if(this.gradient===null||this.gx1!==x1||this.gx2!==x2||this.gy1!==y1||this.gy2!==y2){this.gx1=x1;this.gx2=x2;this.gy1=y1;this.gy2=y2;this.gradient=g.createLinearGradient(x1,y1,x2,y2);for(var i=0;i<this.colors.length;i++){this.gradient.addColorStop(i,this.colors[i].toString())}}g.fillStyle=this.gradient;g.fillRect(x,y,w,h)}}]);pkg.Radial=Class(pkg.View,[function(){this.colors=Array.prototype.slice.call(arguments,0)},function $prototype(){this.gradient=null;this.paint=function(g,x,y,w,h,d){var cx1=Math.floor(w/2),cy1=Math.floor(h/2);this.gradient=g.createRadialGradient(cx1,cy1,10,cx1,cy1,w>h?w:h);for(var i=0;i<this.colors.length;i++){this.gradient.addColorStop(i,this.colors[i].toString())}g.fillStyle=this.gradient;g.fillRect(x,y,w,h)}}]);pkg.Picture=Class(pkg.Render,[function(img,x,y,w,h){this.setTarget(img);if(arguments.length>4){this.x=x;this.y=y;this.width=w;this.height=h}},function $prototype(){this.x=this.y=this.width=this.height=0;this.paint=function(g,x,y,w,h,d){if(this.target!==null&&this.target.complete===true&&this.target.naturalWidth>0&&w>0&&h>0){if(this.width>0){g.drawImage(this.target,this.x,this.y,this.width,this.height,x,y,w,h)}else{g.drawImage(this.target,x,y,w,h)}}};this.getPreferredSize=function(){var img=this.target;return img===null||img.naturalWidth<=0||img.complete!==true?{width:0,height:0}:this.width>0?{width:this.width,height:this.height}:{width:img.width,height:img.height}}}]);pkg.Pattern=Class(pkg.Render,[function $prototype(){this.pattern=null;this.paint=function(g,x,y,w,h,d){if(this.pattern===null){this.pattern=g.createPattern(this.target,"repeat")}g.beginPath();g.rect(x,y,w,h);g.closePath();g.fillStyle=this.pattern;g.fill()};this.targetWasChanged=function(o,n){this.pattern=null}}]);pkg.CompositeView=Class(pkg.View,[function(){this.views=[];var args=arguments.length===1?arguments[0]:arguments;for(var i=0;i<args.length;i++){this.views[i]=pkg.$view(args[i]);this.$recalc(this.views[i])}},function $prototype(){this.left=this.right=this.bottom=this.top=this.height=this.width=0;this.getTop=function(){return this.top};this.getLeft=function(){return this.left};this.getBottom=function(){return this.bottom};this.getRight=function(){return this.right};this.getPreferredSize=function(){return{width:this.width,height:this.height}};this.$recalc=function(v){var b=0,ps=v.getPreferredSize();if(typeof v.getLeft!=="undefined"){b=v.getLeft();if(b>this.left)this.left=b}if(typeof v.getRight!=="undefined"){b=v.getRight();if(b>this.right)this.right=b}if(typeof v.getTop!=="undefined"){b=v.getTop();if(b>this.top)this.top=b}if(typeof v.getBottom!=="undefined"){b=v.getBottom();if(b>this.bottom)this.bottom=b}if(ps.width>this.width)this.width=ps.width;if(ps.height>this.height)this.height=ps.height;if(typeof this.voutline==="undefined"&&typeof v.outline!=="undefined"){this.voutline=v}};this.iterate=function(f){for(var i=0;i<this.views.length;i++){f.call(this,i,this.views[i])}};this.recalc=function(){this.left=this.right=this.bottom=this.top=this.height=this.width=0;this.iterate(function(k,v){this.$recalc(v)})};this.ownerChanged=function(o){this.iterate(function(k,v){if(v!==null&&typeof v.ownerChanged!=="undefined"){v.ownerChanged(o)}})};this.paint=function(g,x,y,w,h,d){var ctx=false;for(var i=0;i<this.views.length;i++){var v=this.views[i];v.paint(g,x,y,w,h,d);if(i<this.views.length-1&&typeof v.outline==="function"&&v.outline(g,x,y,w,h,d)){if(ctx===false){g.save();ctx=true}g.clip()}}if(ctx===true){g.restore()}};this.count=function(){return this.views.length};this.outline=function(g,x,y,w,h,d){return typeof this.voutline!=="undefined"&&this.voutline.outline(g,x,y,w,h,d)}}]);pkg.ViewSet=Class(pkg.CompositeView,[function(args){if(arguments.length===0||args===null){throw new Error(""+args)}this.views={};this.$size=0;for(var k in args){this.views[k]=pkg.$view(args[k]);this.$size++;if(this.views[k]!==null){this.$recalc(this.views[k])}}this.activate("*")},function $prototype(){this.activeView=null;this.paint=function(g,x,y,w,h,d){if(this.activeView!==null){this.activeView.paint(g,x,y,w,h,d)}};this.count=function(){return $size};this.activate=function(id){var old=this.activeView;if(id===null){return(this.activeView=null)!==old}if(this.views.hasOwnProperty(id)){return(this.activeView=this.views[id])!==old}if(id.length>1&&id[0]!=="*"&&id[id.length-1]!=="*"){var i=id.indexOf(".");if(i>0){var k=id.substring(0,i+1)+"*";if(this.views.hasOwnProperty(k)){return(this.activeView=this.views[k])!==old}else{k="*"+id.substring(i);if(this.views.hasOwnProperty(k)){return(this.activeView=this.views[k])!==old}}}}return this.views.hasOwnProperty("*")?(this.activeView=this.views["*"])!==old:false};this.iterate=function(f){for(var k in this.views){f.call(this,k,this.views[k])}}}]);pkg.LineView=Class(pkg.View,[function(side,color,lineWidth){if(arguments.length>0)this.side=side;if(arguments.length>1)this.color=color;if(arguments.length>2)this.lineWidth=lineWidth},function $prototype(){this.side="top";this.color="black";this.lineWidth=1;this.paint=function(g,x,y,w,h,t){g.setColor(this.color);g.beginPath();g.lineWidth=this.lineWidth;var d=this.lineWidth/2;if(this.side==="top"){g.moveTo(x,y+d);g.lineTo(x+w-1,y+d)}else if(this.side==="bottom"){g.moveTo(x,y+h-d);g.lineTo(x+w-1,y+h-d)}g.stroke()};this.getPreferredSize=function(){return{width:this.lineWidth,height:this.lineWidth}}}]);pkg.ArrowView=Class(pkg.View,[function(d,col,w,h){if(arguments.length>0)this.direction=d;if(arguments.length>1)this.color=col;if(arguments.length>2)this.width=this.height=w;if(arguments.length>3)this.height=h},function $prototype(){this.lineWidth=1;this.fill=true;this.gap=0;this.color="black";this.width=this.height=8;this.direction="bottom";this.outline=function(g,x,y,w,h,d){x+=this.gap;y+=this.gap;w-=this.gap*2;h-=this.gap*2;var dt=this.lineWidth/2,w2=Math.round(w/2)-(w%2===0?0:dt),h2=Math.round(h/2)-(h%2===0?0:dt);g.beginPath();if("bottom"===this.direction){g.moveTo(x,y+dt);g.lineTo(x+w-1,y+dt);g.lineTo(x+w2,y+h-dt);g.lineTo(x+dt,y+dt)}else if("top"===this.direction){g.moveTo(x,y+h-dt);g.lineTo(x+w-1,y+h-dt);g.lineTo(x+w2,y);g.lineTo(x+dt,y+h-dt)}else if("left"===this.direction){g.moveTo(x+w-dt,y);g.lineTo(x+w-dt,y+h-1);g.lineTo(x,y+h2);g.lineTo(x+w+dt,y)}else if("right"===this.direction){g.moveTo(x+dt,y);g.lineTo(x+dt,y+h-1);g.lineTo(x+w,y+h2);g.lineTo(x-dt,y)}else{throw new Error(""+this.direction)}return true};this.setGap=function(gap){this.gap=gap;return this};this.paint=function(g,x,y,w,h,d){this.outline(g,x,y,w,h,d);g.setColor(this.color);g.lineWidth=this.lineWidth;if(this.fill===true){g.fill()}else{g.stroke()}};this.getPreferredSize=function(){return{width:this.width+this.gap*2,height:this.height+this.gap*2}}}]);pkg.BaseTextRender=Class(pkg.Render,[function $clazz(){this.font=pkg.font;this.color="gray";this.disabledColor="white"},function $prototype(clazz){this.owner=null;this.lineIndent=1;this.getMaxOffset=this.getLineSize=this.getLines=function(){return 0};this.setFont=function(f){if(zebkit.instanceOf(f,pkg.Font)===false&&f!==null){f=zebkit.newInstance(pkg.Font,arguments)}if(f!=this.font){this.font=f;if(this.owner!==null&&this.owner.isValid===true){this.owner.invalidate()}if(typeof this.invalidate!=="undefined"){this.invalidate()}}return this};this.resizeFont=function(size){return this.setFont(this.font.resize(size))};this.restyleFont=function(style){return this.setFont(this.font.restyle(style))};this.getLineHeight=function(){return this.font.height};this.setColor=function(c){if(c!=this.color){this.color=c.toString()}return this};this.ownerChanged=function(v){this.owner=v};this.targetWasChanged=function(o,n){if(this.owner!==null&&this.owner.isValid){this.owner.invalidate()}if(typeof this.invalidate!=="undefined"){this.invalidate()}}}]);pkg.StringRender=Class(pkg.BaseTextRender,[function $prototype(){this.stringWidth=-1;this[""]=function(txt,font,color){this.setTarget(txt);this.font=arguments.length>1?font:this.clazz.font;this.color=arguments.length>2?color:this.clazz.color};this.getMaxOffset=function(){return this.target.length};this.getLineSize=function(l){return this.target.length+1};this.getLines=function(){return 1};this.calcLineWidth=function(){if(this.stringWidth<0){this.stringWidth=this.font.stringWidth(this.target)}return this.stringWidth};this.invalidate=function(){this.stringWidth=-1};this.paint=function(g,x,y,w,h,d){if(this.font.s!==g.font){g.setFont(this.font)}if(d!==null&&typeof d.getStartSelection!=="undefined"){var startSel=d.getStartSelection(),endSel=d.getEndSelection();if(startSel!==null&&endSel!==null&&startSel.col!==endSel.col&&d.selectionView!==null){d.selectionView.paint(g,x+this.font.charsWidth(this.target,0,startSel.col),y,this.font.charsWidth(this.target,startSel.col,endSel.col-startSel.col),this.getLineHeight(),d)}}if(this.color!==g.fillStyle){g.fillStyle=this.color}if(d!==null&&d.isEnabled===false){g.fillStyle=d!==null&&d.disabledColor!==null&&typeof d.disabledColor!=="undefined"?d.disabledColor:this.clazz.disabledColor}g.fillText(this.target,x,y)};this.getValue=function(){return this.target};this.setValue=function(s){this.setTarget(s)};this.getLine=function(l){if(l<0||l>1){throw new RangeError}return this.target};this.getPreferredSize=function(){if(this.stringWidth<0){this.stringWidth=this.font.stringWidth(this.target)}return{width:this.stringWidth,height:this.font.height}}}]);pkg.TextRender=Class(pkg.BaseTextRender,zebkit.util.Position.Metric,[function $prototype(){this[""]=function(text){this.color=this.clazz.color;this.font=this.clazz.font;this.textWidth=this.textHeight=this.startInvLine=this.invLines=0;this.setTarget(zebkit.isString(text)?new zebkit.data.Text(text):text)};this.getLines=function(){return this.target.getLines()};this.getLineSize=function(l){return this.target.getLine(l).length+1};this.getMaxOffset=function(){return this.target.getTextLength()};this.paintLine=function(g,x,y,line,d){g.fillText(this.getLine(line),x,y)};this.getLine=function(r){return this.target.getLine(r)};this.getValue=function(){return this.target===null?null:this.target.getValue()};this.setValue=function(s){this.target.setValue(s)};this.calcLineWidth=function(line){if(this.invLines>0)this.recalc();return this.target.$lineTags(line).$lineWidth};this.recalc=function(){if(this.invLines>0&&this.target!==null){var model=this.target,i=0;if(this.invLines>0){for(i=this.startInvLine+this.invLines-1;i>=this.startInvLine;i--){model.$lineTags(i).$lineWidth=this.font.stringWidth(this.getLine(i))}this.startInvLine=this.invLines=0}this.textWidth=0;var size=model.getLines();for(i=0;i<size;i++){var len=model.$lineTags(i).$lineWidth;if(len>this.textWidth){this.textWidth=len}}this.textHeight=this.getLineHeight()*size+(size-1)*this.lineIndent}};this.textUpdated=function(src,b,off,size,ful,updatedLines){if(b===false){if(this.invLines>0){var p1=ful-this.startInvLine,p2=this.startInvLine+this.invLines-ful-updatedLines;this.invLines=(p1>0?p1:0)+(p2>0?p2:0)+1;this.startInvLine=this.startInvLine<ful?this.startInvLine:ful}else{this.startInvLine=ful;this.invLines=1}if(this.owner!==null&&this.owner.isValid!==true){this.owner.invalidate()}}else{if(this.invLines>0){if(ful<=this.startInvLine)this.startInvLine+=updatedLines-1;else if(ful<this.startInvLine+size){size+=updatedLines-1}}this.invalidate(ful,updatedLines)}};this.invalidate=function(start,size){if(arguments.length===0){start=0;size=this.getLines();if(size===0){this.invLines=0;return}}if(size>0&&(this.startInvLine!==start||size!==this.invLines)){if(this.invLines===0){this.startInvLine=start;this.invLines=size}else{var e=this.startInvLine+this.invLines;this.startInvLine=start<this.startInvLine?start:this.startInvLine;this.invLines=Math.max(start+size,e)-this.startInvLine}if(this.owner!==null){this.owner.invalidate()}}};this.getPreferredSize=function(){if(this.invLines>0&&this.target!==null){this.recalc()}return{width:this.textWidth,height:this.textHeight}};this.paint=function(g,x,y,w,h,d){var ts=g.$states[g.$curState];if(ts.width>0&&ts.height>0){var lineIndent=this.lineIndent,lineHeight=this.getLineHeight(),lilh=lineHeight+lineIndent,startInvLine=0;w=ts.width<w?ts.width:w;h=ts.height<h?ts.height:h;if(y<ts.y){startInvLine=Math.floor((lineIndent+ts.y-y)/lilh);h+=ts.y-startInvLine*lineHeight-startInvLine*lineIndent}else{if(y>ts.y+ts.height)return}var size=this.getLines();if(startInvLine<size){var lines=Math.floor((h+lineIndent)/lilh)+((h+lineIndent)%lilh>lineIndent?1:0),i=0;if(startInvLine+lines>size){lines=size-startInvLine}y+=startInvLine*lilh;if(this.font.s!==g.font){g.setFont(this.font)}if(d===null||d.isEnabled===true){if(this.color!=g.fillStyle){g.fillStyle=this.color}var p1=null,p2=null,bsel=false;if(lines>0&&d!==null&&typeof d.getStartSelection!=="undefined"){p1=d.getStartSelection();p2=d.getEndSelection();bsel=p1!==null&&(p1.row!==p2.row||p1.col!==p2.col)}for(i=0;i<lines;i++){if(bsel===true){var line=i+startInvLine;if(line>=p1.row&&line<=p2.row){var s=this.getLine(line),lw=this.calcLineWidth(line),xx=x;if(line===p1.row){var ww=this.font.charsWidth(s,0,p1.col);xx+=ww;lw-=ww;if(p1.row===p2.row){lw-=this.font.charsWidth(s,p2.col,s.length-p2.col)}}else if(line===p2.row){lw=this.font.charsWidth(s,0,p2.col)}this.paintSelection(g,xx,y,lw===0?1:lw,lilh,line,d);if(this.color!==g.fillStyle)g.fillStyle=this.color}}this.paintLine(g,x,y,i+startInvLine,d);y+=lilh}}else{var dcol=d!==null&&d.disabledColor!==null&&typeof d.disabledColor!=="undefined"?d.disabledColor:pkg.TextRender.disabledColor;for(i=0;i<lines;i++){g.setColor(dcol);this.paintLine(g,x,y,i+startInvLine,d);y+=lilh}}}}};this.paintSelection=function(g,x,y,w,h,line,d){if(d.selectionView!==null){d.selectionView.paint(g,x,y,w,h,d)}}},function targetWasChanged(o,n){if(o!==null)o.off(this);if(n!==null){n.on(this)}this.$super(o,n)}]);pkg.WrappedTextRender=new Class(pkg.TextRender,[function $prototype(){this.brokenLines=null;this.lastWidth=-1;this.breakLine=function(w,startIndex,line,lines){if(line===""){lines.push(line)}else{var breakIndex=startIndex<line.length?startIndex:line.length-1,direction=0;for(;breakIndex>=0&&breakIndex<line.length;){var substrLen=this.font.charsWidth(line,0,breakIndex+1);if(substrLen<w){if(direction<0)break;else direction=1;breakIndex++}else if(substrLen>w){breakIndex--;if(direction>0)break;else direction=-1}else{break}}if(breakIndex>=0){lines.push(line.substring(0,breakIndex+1));if(breakIndex<line.length-1){this.breakLine(w,startIndex,line.substring(breakIndex+1),lines)}}}};this.breakToLines=function(w){var m=this.target,startIndex=0,res=[];for(var i=0;i<m.getLines();i++){var line=m.getLine(i);this.breakLine(w,startIndex,line,res)}return res};this.getLines=function(){return this.brokenLines.length};this.getLine=function(i){return this.brokenLines[i]}},function invalidate(sl,len){this.$super(sl,len);if(this.brokenLines!==null){this.brokenLines.length=0}this.lastWidth=-1},function getPreferredSize(pw,ph){if(arguments.length===2){if(this.lastWidth<0||this.lastWidth!==pw){this.lastWidth=pw;this.brokenLines=this.breakToLines(pw)}return{width:pw,height:this.brokenLines.length*this.getLineHeight()+(this.brokenLines.length-1)*this.lineIndent}}return this.$super()},function paint(g,x,y,w,h,d){if(this.lastWidth<0||this.lastWidth!==w){this.lastWidth=w;this.brokenLines=this.breakToLines(w)}this.$super(g,x,y,w,h,d)}]);pkg.DecoratedTextRender=zebkit.Class(pkg.TextRender,[function(text){this.decorations={underline:null,strike:null};this.$super(text)},function $prototype(){this.lineWidth=1;this.setDecoration=function(id,color){if(id===null||typeof id==="undefined"){throw new Error}this.decorations[id]=color;return this};this.setDecorations=function(d){this.decorations=zebkit.clone(d);if(typeof this.decorations.underline==="undefined"){this.decorations.underline=null}if(typeof this.decorations.strike==="undefined"){this.decorations.strike=null}return this}},function paintLine(g,x,y,line,d){this.$super(g,x,y,line,d);var lw=this.calcLineWidth(line),lh=this.getLineHeight(line);if(this.decorations.underline!==null){g.lineWidth=this.lineWidth;g.setColor(this.decorations.underline);g.drawLine(x,y+lh-1,x+lw,y+lh-1)}if(this.decorations.strike!==null){var yy=y+Math.round(lh/2)-1;g.setColor(this.decorations.strike);g.lineWidth=this.lineWidth;g.drawLine(x,yy,x+lw,yy)}}]);pkg.BoldTextRender=Class(pkg.TextRender,[function $clazz(){this.font=pkg.boldFont}]);pkg.PasswordText=Class(pkg.TextRender,[function(text){if(arguments.length===0){text=new zebkit.data.SingleLineTxt("")}this.$super(text)},function $prototype(){this.echo="*";this.showLast=true;this.setEchoChar=function(ch){if(this.echo!==ch){this.echo=ch;if(this.target!==null){this.invalidate(0,this.target.getLines())}}return this}},function getLine(r){var buf=[],ln=this.$super(r);for(var i=0;i<ln.length;i++){buf[i]=this.echo}if(this.showLast&&ln.length>0){buf[ln.length-1]=ln[ln.length-1]}return buf.join("")}]);pkg.TabBorder=Class(pkg.View,[function(t,w){if(arguments.length>1){this.width=w}if(arguments.length>0){this.state=t}this.left=this.top=this.bottom=this.right=6+this.width},function $prototype(){this.state="out";this.width=1;this.fillColor1="#DCF0F7";this.fillColor2="white";this.fillColor3="#F3F3F3";this.onColor1="black";this.onColor2="#D9D9D9";this.offColor="#A1A1A1";this.paint=function(g,x,y,w,h,d){var xx=x+w-1,yy=y+h-1,o=d.parent.orient,t=this.state,s=this.width,ww=0,hh=0,dt=s/2;g.beginPath();g.lineWidth=s;switch(o){case"left":g.moveTo(xx+1,y+dt);g.lineTo(x+s*2,y+dt);g.lineTo(x+dt,y+s*2);g.lineTo(x+dt,yy-s*2+dt);g.lineTo(x+s*2,yy+dt);g.lineTo(xx+1,yy+dt);if(d.isEnabled===true){g.setColor(t==="over"?this.fillColor1:this.fillColor2);g.fill()}g.setColor(t==="selected"||t==="over"?this.onColor1:this.offColor);g.stroke();if(d.isEnabled===true){ww=Math.floor((w-6)/2);g.setColor(this.fillColor3);g.fillRect(xx-ww+1,y+s,ww,h-s-1)}if(t==="out"){g.setColor(this.onColor2);g.drawLine(x+2*s+1,yy-s,xx+1,yy-s,s)}break;case"right":xx-=dt;g.moveTo(x,y+dt);g.lineTo(xx-2*s,y+dt);g.lineTo(xx,y+2*s);g.lineTo(xx,yy-2*s);g.lineTo(xx-2*s,yy+dt);g.lineTo(x,yy+dt);if(d.isEnabled===true){g.setColor(t==="over"?this.fillColor1:this.fillColor2);g.fill()}g.setColor(t==="selected"||t==="over"?this.onColor1:this.offColor);g.stroke();if(d.isEnabled===true){ww=Math.floor((w-6)/2);g.setColor(this.fillColor3);g.fillRect(x,y+s,ww,h-s-1)}if(t==="out"){g.setColor(this.onColor2);g.drawLine(x,yy-s,xx-s-1,yy-s,s)}break;case"top":g.moveTo(x+dt,yy+1);g.lineTo(x+dt,y+s*2);g.lineTo(x+s*2,y+dt);g.lineTo(xx-s*2+s,y+dt);g.lineTo(xx+dt,y+s*2);g.lineTo(xx+dt,yy+1);if(d.isEnabled===true){g.setColor(t==="over"?this.fillColor1:this.fillColor2);g.fill()}g.setColor(t==="selected"||t==="over"?this.onColor1:this.offColor);g.stroke();if(d.isEnabled===true){g.setColor(this.fillColor3);hh=Math.floor((h-6)/2);g.fillRect(x+s,yy-hh+1,w-s-1,hh)}if(t==="selected"){g.setColor(this.onColor2);g.beginPath();g.moveTo(xx+dt-s,yy+1);g.lineTo(xx+dt-s,y+s*2);g.stroke()}break;case"bottom":yy-=dt;g.moveTo(x+dt,y);g.lineTo(x+dt,yy-2*s);g.lineTo(x+2*s+dt,yy);g.lineTo(xx-2*s,yy);g.lineTo(xx+dt,yy-2*s);g.lineTo(xx+dt,y);if(d.isEnabled===true){g.setColor(t==="over"?this.fillColor1:this.fillColor2);g.fill()}g.setColor(t==="selected"||t==="over"?this.onColor1:this.offColor);g.stroke();if(d.isEnabled===true){g.setColor(this.fillColor3);hh=Math.floor((h-6)/2);g.fillRect(x+s,y,w-s-1,hh)}if(t==="selected"){g.setColor(this.onColor2);g.beginPath();g.moveTo(xx+dt-s,y);g.lineTo(xx+dt-s,yy-s-1);g.stroke()}break;default:throw new Error("Invalid tab alignment")}};this.getTop=function(){return this.top};this.getBottom=function(){return this.bottom};this.getLeft=function(){return this.left};this.getRight=function(){return this.right}}]);pkg.TitledBorder=Class(pkg.Render,[function(b,a){if(arguments.length>1){this.lineAlignment=zebkit.util.$validateValue(a,"bottom","top","center")}this.setTarget(b)},function $prototype(){this.lineAlignment="bottom";this.getTop=function(){return this.target.getTop()};this.getLeft=function(){return this.target.getLeft()};this.getRight=function(){return this.target.getRight()};this.getBottom=function(){return this.target.getBottom()};this.outline=function(g,x,y,w,h,d){var xx=x+w,yy=y+h;if(typeof d.getTitleInfo!=="undefined"){var r=d.getTitleInfo();if(r!==null){switch(r.orient){case"bottom":var bottom=this.target.getBottom();switch(this.lineAlignment){case"center":yy=r.y+Math.floor((r.height-bottom)/2)+bottom;break;case"top":yy=r.y+r.height+bottom;break;case"bottom":yy=r.y;break}break;case"top":var top=this.target.getTop();switch(this.lineAlignment){case"center":y=r.y+Math.floor((r.height-top)/2);break;case"top":y=r.y-top;break;case"bottom":y=r.y+r.height;break}break;case"left":var left=this.target.getLeft();switch(this.lineAlignment){case"center":x=r.x+Math.floor((r.width-left)/2);break;case"top":x=r.x-left;break;case"bottom":x=r.x+r.width;break}break;case"right":var right=this.target.getRight();switch(this.lineAlignment){case"center":xx=r.x+Math.floor((r.width-right)/2)+right;break;case"top":xx=r.x+r.width+right;break;case"bottom":xx=r.x;break}break}}}if(this.target!==null&&typeof this.target.outline!=="undefined"&&this.target.outline(g,x,y,xx-x,yy-y,d)===true){return true}g.beginPath();g.rect(x,y,xx-x,yy-y);g.closePath();return true};this.$isIn=function(clip,x,y,w,h){var rx=clip.x>x?clip.x:x,ry=clip.y>y?clip.y:y,rw=Math.min(clip.x+clip.width,x+w)-rx,rh=Math.min(clip.y+clip.height,y+h)-ry;return clip.x===rx&&clip.y===ry&&clip.width===rw&&clip.height===rh};this.paint=function(g,x,y,w,h,d){if(typeof d.getTitleInfo!=="undefined"){var r=d.getTitleInfo();if(r!==null){var xx=x+w,yy=y+h,t=g.$states[g.$curState];switch(r.orient){case"top":var top=this.target.getTop();switch(this.lineAlignment){case"center":y=r.y+Math.floor((r.height-top)/2);break;case"top":y=r.y-top;break;case"bottom":y=r.y+r.height;break}if(this.$isIn(t,x+this.target.getLeft(),y,w-this.target.getRight()-this.target.getLeft(),yy-y-this.target.getBottom())){return}g.save();g.beginPath();g.moveTo(x,y);g.lineTo(r.x,y);g.lineTo(r.x,y+top);g.lineTo(r.x+r.width,y+top);g.lineTo(r.x+r.width,y);g.lineTo(xx,y);g.lineTo(xx,yy);g.lineTo(x,yy);g.lineTo(x,y);break;case"bottom":var bottom=this.target.getBottom();switch(this.lineAlignment){case"center":yy=r.y+Math.floor((r.height-bottom)/2)+bottom;break;case"top":yy=r.y+r.height+bottom;break;case"bottom":yy=r.y;break}if(this.$isIn(t,x+this.target.getLeft(),y+this.target.getTop(),w-this.target.getRight()-this.target.getLeft(),yy-y-this.target.getTop())){return}g.save();g.beginPath();g.moveTo(x,y);g.lineTo(xx,y);g.lineTo(xx,yy);g.lineTo(r.x+r.width,yy);g.lineTo(r.x+r.width,yy-bottom);g.lineTo(r.x,yy-bottom);g.lineTo(r.x,yy);g.lineTo(x,yy);g.lineTo(x,y);break;case"left":var left=this.target.getLeft();switch(this.lineAlignment){case"center":x=r.x+Math.floor((r.width-left)/2);break;case"top":x=r.x-left;break;case"bottom":x=r.x+r.width;break}if(this.$isIn(t,x,y+this.target.getTop(),xx-x-this.target.getRight(),h-this.target.getTop()-this.target.getBottom())){return}g.save();g.beginPath();g.moveTo(x,y);g.lineTo(xx,y);g.lineTo(xx,yy);g.lineTo(x,yy);g.lineTo(x,r.y+r.height);g.lineTo(x+left,r.y+r.height);g.lineTo(x+left,r.y);g.lineTo(x,r.y);g.lineTo(x,y);break;case"right":var right=this.target.getRight();switch(this.lineAlignment){case"center":xx=r.x+Math.floor((r.width-right)/2)+right;break;case"top":xx=r.x+r.width+right;break;case"bottom":xx=r.x;break}if(this.$isIn(t,x+this.target.getLeft(),y+this.target.getTop(),xx-x-this.target.getLeft(),h-this.target.getTop()-this.target.getBottom())){return}g.save();g.beginPath();g.moveTo(x,y);g.lineTo(xx,y);g.lineTo(xx,r.y);g.lineTo(xx-right,r.y);g.lineTo(xx-right,r.y+r.height);g.lineTo(xx,r.y+r.height);g.lineTo(xx,yy);g.lineTo(x,yy);g.lineTo(x,y);break;default:throw new Error("Invalid title orientation "+r.orient)}g.closePath();g.clip();this.target.paint(g,x,y,xx-x,yy-y,d);g.restore()}}else{this.target.paint(g,x,y,w,h,d)}}}]);pkg.CheckboxView=Class(pkg.View,[function(color){if(arguments.length>0)this.color=color},function $prototype(){this.color="rgb(65, 131, 255)";this.paint=function(g,x,y,w,h,d){g.beginPath();g.strokeStyle=this.color;g.lineWidth=2;g.moveTo(x+1,y+2);g.lineTo(x+w-3,y+h-3);g.stroke();g.beginPath();g.moveTo(x+w-2,y+2);g.lineTo(x+2,y+h-2);g.stroke();g.lineWidth=1}}]);pkg.BunldeView=Class(pkg.View,[function(dir,color){if(arguments.length>0){this.direction=zebkit.util.$validateValue(dir,"vertical","horizontal");if(arguments.length>1)this.color=color}},function $prototype(){this.color="#AAAAAA";this.direction="vertical";this.paint=function(g,x,y,w,h,d){g.beginPath();var r=0;if(this.direction==="vertical"){r=w/2;g.arc(x+r,y+r,r,Math.PI,0,false);g.lineTo(x+w,y+h-r);g.arc(x+r,y+h-r,r,0,Math.PI,false);g.lineTo(x,y+r)}else{r=h/2;g.arc(x+r,y+r,r,.5*Math.PI,1.5*Math.PI,false);g.lineTo(x+w-r,y);g.arc(x+w-r,y+h-r,r,1.5*Math.PI,.5*Math.PI,false);g.lineTo(x+r,y+h)}g.setColor(this.color);g.fill()}}]);pkg.RadioView=Class(pkg.View,[function(col1,col2){if(arguments.length>0){this.color1=col1;if(arguments.length>1){this.color2=col2}}},function $prototype(){this.color1="rgb(15, 81, 205)";this.color2="rgb(65, 131, 255)";this.paint=function(g,x,y,w,h,d){g.beginPath();if(g.fillStyle!=this.color1){g.fillStyle=this.color1}g.arc(Math.floor(x+w/2),Math.floor(y+h/2),Math.floor(w/3-.5),0,2*Math.PI,1,false);g.fill();g.beginPath();if(g.fillStyle!=this.color2){g.fillStyle=this.color2}g.arc(Math.floor(x+w/2),Math.floor(y+h/2),Math.floor(w/4-.5),0,2*Math.PI,1,false);g.fill()}}]);pkg.ToggleView=Class(pkg.View,[function(plus,color,bg,size){if(arguments.length>0){this.plus=plus;if(arguments.length>1){this.color=color;if(arguments.length>2){this.bg=bg;if(arguments.length>3){this.width=this.height=size}}}}},function $prototype(){this.color="white";this.bg="lightGray";this.plus=false;this.br=new pkg.Border("rgb(65, 131, 215)",1,3);this.width=this.height=12;this.paint=function(g,x,y,w,h,d){if(this.bg!==null&&(this.br===null||this.br.outline(g,x,y,w,h,d)===false)){g.beginPath();g.rect(x,y,w,h)}if(this.bg!==null){g.setColor(this.bg);g.fill()}if(this.br!==null){this.br.paint(g,x,y,w,h,d)}g.setColor(this.color);g.lineWidth=2;x+=2;w-=4;h-=4;y+=2;g.beginPath();g.moveTo(x,y+h/2);g.lineTo(x+w,y+h/2);if(this.plus){g.moveTo(x+w/2,y);g.lineTo(x+w/2,y+h)}g.stroke();g.lineWidth=1};this.getPreferredSize=function(){return{width:this.width,height:this.height}}}]);pkg.CaptionBgView=Class(pkg.View,[function(bg,gap,radius){if(arguments.length>0){this.bg=bg;if(arguments.length>1){this.gap=gap;if(arguments.length>2){this.radius=radius}}}},function $prototype(){this.gap=this.radius=6;this.bg="#66CCFF";this.paint=function(g,x,y,w,h,d){this.outline(g,x,y,w,h,d);g.setColor(this.bg);g.fill()};this.outline=function(g,x,y,w,h,d){g.beginPath();g.moveTo(x+this.radius,y);g.lineTo(x+w-this.radius*2,y);g.quadraticCurveTo(x+w,y,x+w,y+this.radius);g.lineTo(x+w,y+h);g.lineTo(x,y+h);g.lineTo(x,y+this.radius);g.quadraticCurveTo(x,y,x+this.radius,y);return true}}]);pkg.FocusEvent=Class(zebkit.util.Event,[function $prototype(){this.related=null}]);var FOCUS_EVENT=new pkg.FocusEvent;pkg.FocusManager=Class(pkg.Manager,[function $prototype(){this.focusOwner=null;this.$freeFocus=function(comp){if(this.focusOwner!==null&&(this.focusOwner===comp||zebkit.layout.isAncestorOf(comp,this.focusOwner))){this.requestFocus(null)}};this.compEnabled=function(e){var c=e.source;if(c.isVisible===true&&c.isEnabled===false&&this.focusOwner!==null){this.$freeFocus(c)}};this.compShown=function(e){var c=e.source;if(c.isEnabled===true&&c.isVisible===false&&this.focusOwner!==null){this.$freeFocus(c)}};this.compRemoved=function(e){var c=e.kid;if(c.isEnabled===true&&c.isVisible===true&&this.focusOwner!==null){this.$freeFocus(c)}};this.hasFocus=function(c){return this.focusOwner===c};this.keyPressed=function(e){if("Tab"===e.code){var cc=this.ff(e.source,e.shiftKey?-1:1);if(cc!==null){this.requestFocus(cc)}return true}};this.findFocusable=function(c){return this.isFocusable(c)?c:this.fd(c,0,1)};this.isFocusable=function(c){var d=c.getCanvas();if(d!==null&&(c.canHaveFocus===true||typeof c.canHaveFocus==="function"&&c.canHaveFocus()===true)){for(;c!==d&&c!==null;c=c.parent){if(c.isVisible===false||c.isEnabled===false){return false}}return c===d}return false};this.fd=function(t,index,d){if(t.kids.length>0){var isNComposite=typeof t.catchInput==="undefined"||t.catchInput===false;for(var i=index;i>=0&&i<t.kids.length;i+=d){var cc=t.kids[i];if(cc.isEnabled===true&&cc.isVisible===true&&cc.width>0&&cc.height>0&&(isNComposite||t.catchInput!==true&&t.catchInput(cc)===false)&&(cc.canHaveFocus===true||typeof cc.canHaveFocus!=="undefined"&&cc.canHaveFocus!==false&&cc.canHaveFocus()||(cc=this.fd(cc,d>0?0:cc.kids.length-1,d))!==null)){return cc}}}return null};this.ff=function(c,d){var top=c;while(top!==null&&typeof top.getFocusRoot==="undefined"){top=top.parent}if(top===null){return null}top=top.getFocusRoot();if(top===null){return null}if(typeof top.traverseFocus!=="undefined"){return top.traverseFocus(c,d)}for(var index=d>0?0:c.kids.length-1;c!==top.parent;){var cc=this.fd(c,index,d);if(cc!==null){return cc}cc=c;c=c.parent;if(c!==null)index=d+c.indexOf(cc)}return this.fd(top,d>0?0:top.kids.length-1,d)};this.requestFocus=function(c){if(c!==this.focusOwner&&(c===null||this.isFocusable(c))){var oldFocusOwner=this.focusOwner;if(c!==null){var nf=c.getEventDestination();if(nf===null||oldFocusOwner===nf){return}this.focusOwner=nf}else{this.focusOwner=c}if(oldFocusOwner!==null){var ofc=oldFocusOwner.getCanvas();FOCUS_EVENT.source=oldFocusOwner;FOCUS_EVENT.related=this.focusOwner;oldFocusOwner.focused();pkg.events.fire("focusLost",FOCUS_EVENT)}if(this.focusOwner!==null){FOCUS_EVENT.source=this.focusOwner;FOCUS_EVENT.related=oldFocusOwner;this.focusOwner.focused();pkg.events.fire("focusGained",FOCUS_EVENT)}}};this.pointerPressed=function(e){if(e.isAction()){this.requestFocus(e.source)}}}]);pkg.events.regEvents("shortcutFired");pkg.ShortcutEvent=Class(zebkit.util.Event,[function(src,shortcut,keys){this.source=src;this.shortcut=shortcut;this.keys=keys}]);var SHORTCUT_EVENT=new pkg.ShortcutEvent;pkg.ShortcutManager=Class(pkg.Manager,[function $prototype(){this.keyPath=[];this.keyPressed=function(e){if(e.code===null||this.keyPath.length>5){this.keyPath=[]}else if(e.repeat===1){this.keyPath[this.keyPath.length]=e.code}var fo=pkg.focusManager.focusOwner;if(this.keyPath.length>1){var sh=this.keyShortcuts;for(var i=0;i<this.keyPath.length;i++){var code=this.keyPath[i];if(sh.hasOwnProperty(code)){sh=sh[code]}else{sh=null;break}}if(sh!==null){SHORTCUT_EVENT.source=fo;SHORTCUT_EVENT.shortcut=sh;SHORTCUT_EVENT.keys=this.keyPath.join("+");pkg.events.fire("shortcutFired",SHORTCUT_EVENT)}}};this.keyReleased=function(e){if(e.key==="Meta"){this.keyPath=[]}else{for(var i=0;i<this.keyPath.length;i++){if(this.keyPath[i]===e.code){this.keyPath.splice(i,1);break}}}};this.setShortcuts=function(shortcuts){for(var id in shortcuts){var shortcut=shortcuts[id];id=id.trim();if(Array.isArray(shortcut)===false){shortcut=[shortcut]}for(var j=0;j<shortcut.length;j++){var keys=shortcut[j].replace(/\s+/g,"").split("+"),st=this.keyShortcuts,len=keys.length;for(var i=0;i<len;i++){var key=keys[i];if(i===len-1){st[key]=id}else if(st.hasOwnProperty(key)===false||zebkit.isString(st[key])){st[key]={}}st=st[key]}}}}},function(shortcuts){this.$super();this.keyShortcuts={};if(arguments.length>0){this.setShortcuts(shortcuts.common);if(zebkit.isMacOS===true&&typeof shortcuts.osx!=="undefined"){this.setShortcuts(shortcuts.osx)}}}]);pkg.Cursor={DEFAULT:"default",MOVE:"move",WAIT:"wait",TEXT:"text",HAND:"pointer",NE_RESIZE:"ne-resize",SW_RESIZE:"sw-resize",SE_RESIZE:"se-resize",NW_RESIZE:"nw-resize",S_RESIZE:"s-resize",W_RESIZE:"w-resize",N_RESIZE:"n-resize",E_RESIZE:"e-resize",COL_RESIZE:"col-resize",HELP:"help"};pkg.$ViewsSetterMix=zebkit.Interface([function $prototype(){this.setViews=function(v){if(typeof this.views==="undefined"){this.views={}}var b=false;for(var k in v){if(v.hasOwnProperty(k)){var nv=pkg.$view(v[k]);if(this.views[k]!==nv){this.views[k]=nv;b=true}}}if(b===true){this.vrp()}return this}}]);pkg.$component=function(desc,instance){var hasInstance=arguments.length>1;if(zebkit.isString(desc)){var m=desc.match(/^(\[[x ]?\])/),txt=null;if(m!==null){txt=desc.substring(m[1].length);var ch=hasInstance&&typeof instance.clazz.Checkbox!=="undefined"?new instance.clazz.Checkbox(txt):new pkg.Checkbox(txt);ch.setValue(m[1].indexOf("x")>0);return ch}else{m=desc.match(/^@\((.*)\)(\:[0-9]+x[0-9]+)?/);if(m!==null){var path=m[1];txt=desc.substring(path.length+3+(typeof m[2]!=="undefined"?m[2].length:0)).trim();var img=hasInstance&&typeof instance.clazz.ImagePan!=="undefined"?new instance.clazz.ImagePan(path):new pkg.ImagePan(path);if(typeof m[2]!=="undefined"){var s=m[2].substring(1).split("x"),w=parseInt(s[0],10),h=parseInt(s[1],10);img.setPreferredSize(w,h)}if(txt.length===0){return img}return hasInstance&&typeof instance.clazz.ImageLabel!=="undefined"?new instance.clazz.ImageLabel(txt,img):new pkg.ImageLabel(txt,img)}else{return hasInstance&&typeof instance.clazz.Label!=="undefined"?new instance.clazz.Label(desc):new pkg.Label(desc)}}}else if(Array.isArray(desc)){if(desc.length>0&&Array.isArray(desc[0])){var model=new zebkit.data.Matrix(desc.length,desc[0].length);for(var row=0;row<model.rows;row++){for(var col=0;col<model.cols;col++){model.put(row,col,desc[row][col])}}return new pkg.grid.Grid(model)}else{var clz=hasInstance&&typeof instance.clazz.Combo!=="undefined"?instance.clazz.Combo:pkg.Combo,combo=new clz(new clz.CompList(true)),selectedIndex=-1;for(var i=0;i<desc.length;i++){var ss=desc[i];if(zebkit.isString(ss)){if(selectedIndex===-1&&ss.length>1&&ss[0]==="*"){selectedIndex=i;desc[i]=ss.substring(1)}}combo.list.add(pkg.$component(desc[i],combo.list))}combo.select(selectedIndex);return combo}}else if(desc instanceof Image){return hasInstance&&typeof instance.clazz.ImagePan!=="undefined"?new instance.clazz.ImagePan(desc):new pkg.ImagePan(desc)}else if(zebkit.instanceOf(desc,pkg.View)){var v=hasInstance&&typeof instance.clazz.ViewPan!=="undefined"?new instance.clazz.ViewPan:new pkg.ViewPan;v.setView(desc);return v}return desc};pkg.ViewPan=Class(pkg.Panel,[function $prototype(){this.view=null;this.paint=function(g){if(this.view!==null){var l=this.getLeft(),t=this.getTop();this.view.paint(g,l,t,this.width-l-this.getRight(),this.height-t-this.getBottom(),this)}};this.setView=function(v){var old=this.view;v=pkg.$view(v);if(v!==old){this.view=v;this.notifyRender(old,v);this.vrp()}return this};this.calcPreferredSize=function(t){return this.view!==null?this.view.getPreferredSize():{width:0,height:0}}}]);pkg.ImagePan=Class(pkg.ViewPan,[function(img,w,h){this.setImage(arguments.length>0?img:null);this.$super();if(arguments.length>2){this.setPreferredSize(w,h)}},function $prototype(){this.$runner=null;this.setImage=function(img){var $this=this;if(img!==null){var isPic=zebkit.instanceOf(img,pkg.Picture),imgToLoad=isPic?img.target:img;this.setView(isPic?img:new pkg.Picture(img));this.$runner=zebkit.util.image(imgToLoad);this.$runner.then(function(img){$this.$runner=null;$this.setView(isPic?img:new pkg.Picture(img));$this.vrp();if(typeof $this.imageLoaded!=="undefined"){$this.imageLoaded(img)}for(var t=$this.parent;t!==null;t=t.parent){if(typeof t.childImageLoaded!=="undefined"){t.childImageLoaded(img)}}}).catch(function(e){console.log(img);zebkit.dumpError(e);$this.$runner=null;$this.setView(null)})}else{if(this.$runner===null){this.setView(null)}else{this.$runner.then(function(){$this.setView(null)})}}return this}}]);pkg.Line=Class(pkg.Panel,[function(){this.$super();if(arguments.length>0){this.setColors.apply(this,arguments)}},function $prototype(){this.colors=["gray"];this.lineWidth=1;this.setColor=function(c){this.setColors(c);return this};this.setColors=function(){this.colors=arguments.length===1?Array.isArray(arguments[0])?arguments[0].slice(0):[arguments[0]]:Array.prototype.slice.call(arguments);this.repaint();return this};this.paint=function(g){var isHor=this.width>this.height,left=this.getLeft(),right=this.getRight(),top=this.getTop(),bottom=this.getBottom(),xy=isHor?top:left;for(var i=0;i<this.colors.length;i++){if(this.colors[i]!==null){g.setColor(this.colors[i]);if(isHor===true){g.drawLine(this.left,xy,this.width-right-left,xy,this.lineWidth)}else{g.drawLine(xy,top,xy,this.height-top-bottom,this.lineWidth)}}xy+=this.lineWidth}};this.calcPreferredSize=function(target){var s=this.colors.length*this.lineWidth;return{width:s,height:s}}}]);pkg.Label=Class(pkg.ViewPan,[function(r){if(arguments.length===0){this.setView(new pkg.StringRender(""))}else{if(typeof r==="string"||r.constructor===String){this.setView(r.length===0||r.indexOf("\n")>=0?new pkg.TextRender(new zebkit.data.Text(r)):new pkg.StringRender(r))}else if(typeof r.clazz!=="undefined"&&typeof r.getTextLength!=="undefined"&&typeof r.getLines!=="undefined"){this.setView(new pkg.TextRender(r))}else{this.setView(r)}}this.$super()},function $prototype(){this.getValue=function(){return this.view.getValue()};this.setModel=function(m){this.setView(zebkit.isString(m)?new pkg.StringRender(m):new pkg.TextRender(m));return this};this.getModel=function(){return this.view!==null?this.view.target:null};this.getColor=function(){return this.view.color};this.getFont=function(){return this.view.font};this.setValue=function(s){if(s===null)s="";var old=this.view.getValue();if(old!==s){this.view.setValue(s);this.repaint()}return this};this.setColor=function(c){var old=this.view.color;if(old!==c){this.view.setColor(c);this.repaint()}return this};this.setFont=function(f){var old=this.view.font;this.view.setFont.apply(this.view,arguments);if(old!=this.view.font){this.repaint()}return this}}]);pkg.BoldLabel=Class(pkg.Label,[]);pkg.ImageLabel=Class(pkg.Panel,[function(txt,path){var img=zebkit.instanceOf(path,pkg.ImagePan)?path:new this.clazz.ImagePan(path),lab=zebkit.instanceOf(txt,pkg.Panel)?txt:new this.clazz.Label(txt);img.constraints="image";lab.constraints="label";if(typeof this.kids==="undefined"){this.kids=[]}this.layout=new zebkit.layout.FlowLayout("left","center","horizontal",6);this.add(img);this.add(lab);this.$super();lab.setVisible(txt!==null)},function $clazz(){this.ImagePan=Class(pkg.ImagePan,[]);this.Label=Class(pkg.Label,[])},function $prototype(){this.setCaption=function(c){var lab=this.byConstraints("label");lab.setValue(c);lab.setVisible(c!==null);return this};this.setImage=function(p){var lab=this.byConstraints("image");image.setImage(p);image.setVisible(p!==null);return this};this.setFont=function(){var lab=this.byConstraints("label");if(lab!==null){lab.setFont.apply(lab,arguments)}return this};this.setColor=function(c){var lab=this.byConstraints("label");if(lab!==null){lab.setColor(c)}return this};this.getCaption=function(){return this.byConstraints("label")};this.setImgAlignment=function(a){var b=false,img=this.byConstraints("image"),i=this.indexOf(img);if(a==="top"||a==="bottom"){if(this.layout.direction!=="vertical"){this.layout.direction="vertical";b=true}}else if(a==="left"||a==="right"){if(this.layout.direction!=="horizontal"){this.layout.direction="horizontal";b=true}}if(this.layout.ax!=="center"){this.layout.ax="center";b=true}if(this.layout.ay!=="center"){this.layout.ay="center";b=true}if((a==="top"||a==="left")&&i!==0){this.insert("image",0,this.removeAt(i));b=false}else if((a==="bottom"||a==="right")&&i!==1){this.add("image",this.removeAt(i));b=false}if(b){this.vrp()}return this};this.setImgPreferredSize=function(w,h){if(arguments.length===1)h=w;this.byConstraints("image").setPreferredSize(w,h);return this}}]);pkg.Progress=Class(pkg.Panel,[function(){this.setBundleView("darkBlue");this._=new zebkit.util.Listeners;this.$super()},function $prototype(){this.value=0;this.bundleWidth=this.bundleHeight=6;this.gap=2;this.maxValue=20;this.bundleView=this.titleView=null;this.orient="horizontal";this.paint=function(g){var left=this.getLeft(),right=this.getRight(),top=this.getTop(),bottom=this.getBottom(),rs=this.orient==="horizontal"?this.width-left-right:this.height-top-bottom,bundleSize=this.orient==="horizontal"?this.bundleWidth:this.bundleHeight;if(rs>=bundleSize){var vLoc=Math.floor(rs*this.value/this.maxValue),x=left,y=this.height-bottom,bundle=this.bundleView,wh=this.orient==="horizontal"?this.height-top-bottom:this.width-left-right;while(x<vLoc+left&&this.height-vLoc-bottom<y){if(this.orient==="horizontal"){bundle.paint(g,x,top,bundleSize,wh,this);x+=bundleSize+this.gap}else{bundle.paint(g,left,y-bundleSize,wh,bundleSize,this);y-=bundleSize+this.gap}}if(this.titleView!==null){var ps=this.bundleView.getPreferredSize();this.titleView.paint(g,Math.floor((this.width-ps.width)/2),Math.floor((this.height-ps.height)/2),ps.width,ps.height,this)}}};this.calcPreferredSize=function(l){var bundleSize=this.orient==="horizontal"?this.bundleWidth:this.bundleHeight,v1=this.maxValue*bundleSize+(this.maxValue-1)*this.gap,ps=this.bundleView.getPreferredSize();ps=this.orient==="horizontal"?{width:v1,height:this.bundleHeight>=0?this.bundleHeight:ps.height}:{width:this.bundleWidth>=0?this.bundleWidth:ps.width,height:v1};if(this.titleView!==null){var tp=this.titleView.getPreferredSize();ps.width=Math.max(ps.width,tp.width);ps.height=Math.max(ps.height,tp.height)}return ps}},function setOrientation(o){if(o!==this.orient){this.orient=zebkit.util.$validateValue(o,"horizontal","vertical");this.vrp()}return this},function setMaxValue(m){if(m!==this.maxValue){this.maxValue=m;this.setValue(this.value);this.vrp()}return this},function setValue(p){p=p%(this.maxValue+1);if(this.value!==p){var old=this.value;this.value=p;this._.fired(this,old);this.repaint()}return this},function setGap(g){if(this.gap!==g){this.gap=g;this.vrp()}return this},function setBundleView(v){if(this.bundleView!=v){this.bundleView=pkg.$view(v);this.vrp()}return this},function setBundleSize(w,h){if(w!==this.bundleWidth&&h!==this.bundleHeight){this.bundleWidth=w;this.bundleHeight=h;this.vrp()}return this}]);pkg.StatePan=Class(pkg.ViewPan,[function $prototype(){this.state=null;this.setState=function(s){if(s!==this.state){var prev=this.state;this.state=s;this.stateUpdated(prev,s)}return this};this.stateUpdated=function(o,n){var b=false,id=typeof this.toViewId!=="undefined"?this.toViewId(n):n;if(id!==null){for(var i=0;i<this.kids.length;i++){var kid=this.kids[i];if(typeof kid.setState!=="undefined"){kid.setState(id)}}if(this.border!==null&&typeof this.border.activate!=="undefined"){b=this.border.activate(id,this)===true||b}if(this.view!==null&&typeof this.view.activate!=="undefined"){b=this.view.activate(id,this)===true||b}if(this.bg!==null&&typeof this.bg.activate!=="undefined"){b=this.bg.activate(id,this)===true||b}if(b){this.repaint()}}};this.syncState=function(){this.stateUpdated(this.state,this.state)}},function setView(v){if(v!=this.view){this.$super(v);if(typeof this.kids!=="undefined"){this.syncState(this.state,this.state)}}return this},function setBorder(v){if(v!=this.border){this.$super(v);this.syncState(this.state,this.state)}return this},function setBackground(v){if(v!=this.bg){this.$super(v);this.syncState(this.state,this.state)}return this}]);var OVER="over",PRESSED_OVER="pressed.over",OUT="out",PRESSED_OUT="pressed.out",DISABLED="disabled";pkg.EvStatePan=Class(pkg.StatePan,[function $prototype(){this.state=OUT;this.$isIn=false;this.toViewId=function(state){return state};this._keyPressed=function(e){if(this.state!==PRESSED_OVER&&this.state!==PRESSED_OUT&&(e.code==="Enter"||e.code==="Space")){this.setState(PRESSED_OVER)}};this._keyReleased=function(e){if(this.state===PRESSED_OVER||this.state===PRESSED_OUT){var prev=this.state;this.setState(OVER);if(this.$isIn===false)this.setState(OUT)}};this._pointerEntered=function(e){if(this.isEnabled===true){this.setState(this.state===PRESSED_OUT?PRESSED_OVER:OVER);this.$isIn=true}};this._pointerPressed=function(e){if(this.state!==PRESSED_OVER&&this.state!==PRESSED_OUT&&e.isAction()){this.setState(PRESSED_OVER)}};this._pointerReleased=function(e){if((this.state===PRESSED_OVER||this.state===PRESSED_OUT)&&e.isAction()){if(e.source===this){this.setState(e.x>=0&&e.y>=0&&e.x<this.width&&e.y<this.height?OVER:OUT)}else{var p=zebkit.layout.toParentOrigin(e.x,e.y,e.source,this);this.$isIn=p.x>=0&&p.y>=0&&p.x<this.width&&p.y<this.height;this.setState(this.$isIn?OVER:OUT)}}};this.childKeyPressed=function(e){this._keyPressed(e)};this.childKeyReleased=function(e){this._keyReleased(e)};this.childPointerEntered=function(e){this._pointerEntered(e)};this.childPointerPressed=function(e){this._pointerPressed(e)};this.childPointerReleased=function(e){this._pointerReleased(e)};this.childPointerExited=function(e){if(e.x>=0&&e.y>=0&&e.x<e.source.width&&e.y<e.source.height){this.$isIn=false}else{var p=zebkit.layout.toParentOrigin(e.x,e.y,e.source,this);this.$isIn=p.x>=0&&p.y>=0&&p.x<this.width&&p.y<this.height}if(this.$isIn===false){this.setState(this.state===PRESSED_OVER?PRESSED_OUT:OUT)}};this.keyPressed=function(e){this._keyPressed(e)};this.keyReleased=function(e){this._keyReleased(e)};this.pointerEntered=function(e){this._pointerEntered()};this.pointerExited=function(e){if(this.isEnabled===true){this.setState(this.state===PRESSED_OVER?PRESSED_OUT:OUT);this.$isIn=false}};this.pointerPressed=function(e){this._pointerPressed(e)};this.pointerReleased=function(e){this._pointerReleased(e)};this.pointerDragged=function(e){if(e.isAction()){var pressed=this.state===PRESSED_OUT||this.state===PRESSED_OVER;if(e.x>0&&e.y>0&&e.x<this.width&&e.y<this.height){this.setState(pressed?PRESSED_OVER:OVER)}else{this.setState(pressed?PRESSED_OUT:OUT)}}}},function setEnabled(b){this.$super(b);this.setState(b?OUT:DISABLED);return this}]);pkg.CompositeEvStatePan=Class(pkg.EvStatePan,[function $prototype(){this.canHaveFocus=true;this.catchInput=true;this.focusComponent=null;this.focusMarkerView=null;this.focusMarkerGaps=2;this.paintOnTop=function(g){var fc=this.focusComponent;if(this.focusMarkerView!==null&&fc!==null&&this.hasFocus()){this.focusMarkerView.paint(g,fc.x-this.focusMarkerGaps,fc.y-this.focusMarkerGaps,this.focusMarkerGaps*2+fc.width,this.focusMarkerGaps*2+fc.height,this)}};this.setFocusMarkerView=function(c){if(c!=this.focusMarkerView){this.focusMarkerView=pkg.$view(c);this.repaint()}return this};this.setCanHaveFocus=function(b){if(this.canHaveFocus!==b){var fm=pkg.focusManager;if(b===false&&fm.focusOwner===this){fm.requestFocus(null)}this.canHaveFocus=b}return this};this.setFocusAnchorComponent=function(c){if(this.focusComponent!==c){if(c!==null&&this.kids.indexOf(c)<0){throw new Error("Focus component doesn't exist")}this.focusComponent=c;this.repaint()}return this}},function focused(){this.$super();this.repaint()},function kidRemoved(i,l){if(l===this.focusComponent){this.focusComponent=null}this.$super(i,l)}]);pkg.ButtonRepeatMix=zebkit.Interface([function $prototype(){this.isFireByPress=false;this.firePeriod=-1;this.startIn=400;this.$repeatTask=null;this.setFireParams=function(b,firePeriod,startIn){if(this.$repeatTask!==null){this.$repeatTask.shutdown()}this.isFireByPress=b;this.firePeriod=firePeriod;if(arguments.length>2){this.startIn=startIn}return this};this.$fire=function(){this.fire();if(typeof this.fired!=="undefined"){this.fired()}}},function stateUpdated(o,n){this.$super(o,n);if(n==="pressed.over"){if(this.isFireByPress===true){this.$fire();if(this.firePeriod>0){var $this=this;this.$repeatTask=zebkit.util.tasksSet.run(function(){if($this.state==="pressed.over"){$this.$fire()}},this.startIn,this.firePeriod)}}}else{if(this.firePeriod>0&&this.$repeatTask!==null){this.$repeatTask.shutdown()}if(n==="over"&&(o==="pressed.over"&&this.isFireByPress===false)){this.$fire()}}}]);pkg.ArrowButton=Class(pkg.EvStatePan,zebkit.util.Fireable,pkg.ButtonRepeatMix,[function(direction){this._=new zebkit.util.Listeners;this.cursorType=pkg.Cursor.HAND;if(arguments.length>0){this.direction=zebkit.util.$validateValue(direction,"left","right","top","bottom")}var clz=typeof this.clazz.$colors!=="undefined"?this.clazz:pkg.ArrowButton;this.setView({out:new clz.ArrowView(this.direction,clz.$colors.out),over:new clz.ArrowView(this.direction,clz.$colors.over),"pressed.over":new clz.ArrowView(this.direction,clz.$colors["pressed.over"]),disabled:new clz.ArrowView(this.direction,clz.$colors.disabled)});this.$super();this.syncState(this.state,this.state)},function $clazz(){this.ArrowView=Class(pkg.ArrowView,[]);this.$colors={out:"red",over:"red","pressed.over":"black",disabled:"lightGray"}},function $prototype(){this.direction="left";this.setArrowDirection=function(d){this.iterateArrowViews(function(k,v){if(v!==null)v.direction=d});this.repaint();return this};this.setArrowSize=function(w,h){if(arguments.length<2)h=w;this.iterateArrowViews(function(k,v){if(v!==null){v.width=w;v.height=h}});this.vrp();return this};this.setArrowColors=function(pressedColor,overColor,outColor){var views=this.view.views;if(views.out!==null&&typeof views.out!=="undefined"){views.out.color=outColor}if(views.over.color!==null&&typeof views.over!=="undefined"){views.over.color=overColor}if(views["pressed.over"]!==null&&typeof views["pressed.over"]!=="undefined"){views["pressed.over"].color=pressedColor}this.repaint();return this};this.iterateArrowViews=function(callback){var views=this.view.views;for(var k in views){if(views.hasOwnProperty(k)){callback.call(this,k,views[k])}}return this}}]);pkg.Button=Class(pkg.CompositeEvStatePan,zebkit.util.Fireable,pkg.ButtonRepeatMix,[function(t){this._=new zebkit.util.Listeners;this.$super();if(arguments.length>0&&t!==null){t=pkg.$component(t,this);this.add(t);this.setFocusAnchorComponent(t)}},function $clazz(){this.Label=Class(pkg.Label,[]);this.ViewPan=Class(pkg.ViewPan,[function(v){this.$super();this.setView(v)},function $prototype(){this.setState=function(id){if(this.view!==null&&typeof this.view.activate!=="undefined"){this.activate(id)}}}]);this.ImageLabel=Class(pkg.ImageLabel,[])},function $prototype(){this.canHaveFocus=true}]);pkg.SwitchManager=Class(zebkit.EventProducer,[function(){this._=new zebkit.util.Listeners},function $prototype(){this.value=false;this.getValue=function(o){return this.value};this.setValue=function(o,b){if(this.getValue(o)!==b){this.value=b;this.updated(o,b)}return this};this.toggle=function(o){this.setValue(o,!this.getValue(o));return this};this.updated=function(o,b){if(o!==null)o.switched(b);this._.fired(this,o)};this.install=function(o){o.switched(this.getValue(o))};this.uninstall=function(o){}}]);pkg.Group=Class(pkg.SwitchManager,[function(un){this.$super();this.selected=null;if(arguments.length>0){this.allowNoneSelected=un}},function $prototype(){this.allowNoneSelected=false;this.getValue=function(o){return o===this.selected};this.setValue=function(o,b){if(this.allowNoneSelected&&b===false&&this.selected!==null){var old=this.selected;this.selected=null;this.updated(old,false)}else if(b&&this.selected!==o){this.clearSelected();this.selected=o;this.updated(this.selected,true)}return this};this.clearSelected=function(){if(this.selected!==null){var old=this.selected;this.selected=null;this.updated(old,false)}}}]);pkg.Switchable=zebkit.Interface([function $prototype(){this.manager=null;this.setValue=function(b){this.manager.setValue(this,b);return this};this.toggle=function(){this.manager.toggle(this);return this};this.getValue=function(){return this.manager?this.manager.getValue(this):false};this.setSwitchManager=function(m){if(m===null||typeof m==="undefined"){throw new Error("Null switch manager")}if(this.manager!==m){if(this.manager!==null)this.manager.uninstall(this);this.manager=m;this.manager.install(this)}return this}}]);pkg.Checkbox=Class(pkg.CompositeEvStatePan,pkg.Switchable,[function(c,m){if(arguments.length<2){m=new pkg.SwitchManager}if(arguments.length>0){if(c!==null&&zebkit.isString(c)){c=new this.clazz.Label(c)}}this.$super();this.box=new this.clazz.Box;this.add(this.box);if(c!==null){this.add(c);this.setFocusAnchorComponent(c)}this.setSwitchManager(m)},function $clazz(){this.Box=Class(pkg.StatePan,[]);this.Label=Class(pkg.Label,[])},function $prototype(){this.switched=function(b){this.stateUpdated(this.state,this.state)};this.toViewId=function(state){if(this.isEnabled===true){if(this.getValue()){return this.state==="over"?"pressed.over":"pressed.out"}return this.state==="over"?"over":"out"}return this.getValue()?"pressed.disabled":"disabled"}},function keyPressed(e){if(zebkit.instanceOf(this.manager,pkg.Group)&&this.getValue()){var d=0;if(e.code==="ArrowLeft"||e.code==="ArrowUp"){d=-1}else if(e.code==="ArrowRight"||e.code==="ArrowDown"){d=1}if(d!==0){var p=this.parent;for(var i=p.indexOf(this)+d;i<p.kids.length&&i>=0;i+=d){var l=p.kids[i];if(l.isVisible===true&&l.isEnabled===true&&zebkit.instanceOf(l,pkg.Checkbox)&&l.manager===this.manager){l.requestFocus();l.setValue(true);break}}return}}this.$super(e)},function stateUpdated(o,n){if(o==="pressed.over"&&n==="over"){this.toggle()}this.$super(o,n)},function kidRemoved(index,c){if(this.box===c){this.box=null}this.$super(index,c)}]);pkg.Radiobox=Class(pkg.Checkbox,[function(c,group){if(arguments.length<2){this.$super(c,new pkg.Group)}else{this.$super(c,group)}}]);pkg.Link=Class(pkg.Button,[function(s){this.view=new pkg.DecoratedTextRender(s);this.overDecoration="underline";this.$super(null);if(this.colors===null){this.colors={"pressed.over":"blue",out:"white",over:"white","pressed.out":"black",disabled:"gray"}}this.stateUpdated(this.state,this.state)},function $prototype(){this.colors=null;this.cursorType=pkg.Cursor.HAND;this.setFont=function(f){var old=this.view!==null?this.view.font:null;this.view.setFont.apply(this.view,arguments);if(old!==this.view.font){this.vrp()}return this};this.setColor=function(state,c){if(this.colors[state]!==c){this.colors[state]=c;this.syncState()}return this};this.setColors=function(colors){this.colors=zebkit.clone(colors);this.syncState();return this};this.setValue=function(s){this.view.setValue(s.toString());this.repaint();return this}},function stateUpdated(o,n){this.$super(o,n);var k=this.toViewId(n),b=false;if(this.view!==null&&this.view.color!==this.colors[k]&&this.colors[k]!==null&&typeof this.colors[k]!=="undefined"){this.view.setColor(this.colors[k]);b=true}if(this.view.decorations!=null&&this.overDecoration!=null&&this.isEnabled){if(n==="over"){this.view.setDecoration(this.overDecoration,this.colors[k]);b=true}else if(this.view.decorations[this.overDecoration]!=null){this.view.setDecoration(this.overDecoration,null);b=true}}if(b){this.repaint()}}]);pkg.Button.Link=Class(pkg.Link,[]);pkg.Toolbar=Class(pkg.Panel,[function(){this._=new zebkit.util.Listeners;this.$super()},function $clazz(){this.ToolPan=Class(pkg.EvStatePan,[function(c){this.$super(new zebkit.layout.BorderLayout);this.add("center",c)},function getContentComponent(){return this.kids[0]},function stateUpdated(o,n){this.$super(o,n);if(o==="pressed.over"&&n==="over"){this.parent._.fired(this)}}]);this.ImagePan=Class(pkg.ImagePan,[]);this.Line=Class(pkg.Line,[]);this.Checkbox=Class(pkg.Checkbox,[]);this.Radiobox=Class(pkg.Radiobox,[])},function $prototype(){this.isDecorative=function(c){return zebkit.instanceOf(c,pkg.EvStatePan)===false};this.addRadio=function(g,c){var cbox=new this.clazz.Radiobox(c,g);cbox.setCanHaveFocus(false);return this.add(cbox)};this.addSwitcher=function(c){var cbox=new this.clazz.Checkbox(c);cbox.setCanHaveFocus(false);return this.add(cbox)};this.addImage=function(img){this.validateMetric();return this.add(new this.clazz.ImagePan(img))};this.addLine=function(){var line=new this.clazz.Line;line.constraints="stretch";return this.addDecorative(line)}},function addDecorative(c){return this.$getSuper("insert").call(this,this.kids.length,null,c)},function insert(i,id,d){if(d==="-"){var line=new this.clazz.Line;line.constraints="stretch";return this.$super(i,null,line)}else if(Array.isArray(d)){d=new this.clazz.Combo(d)}return this.$super(i,id,new this.clazz.ToolPan(d))}]);pkg.BorderPan=Class(pkg.Panel,[function(title,center,o,a){if(arguments.length>0){title=pkg.$component(title,this)}if(arguments.length>2){this.orient=o}if(arguments.length>3){this.alignment=a}this.$super();if(arguments.length>0)this.add("caption",title);if(arguments.length>1)this.add("center",center)},function $clazz(){this.Label=Class(pkg.Label,[]);this.ImageLabel=Class(pkg.ImageLabel,[]);this.Checkbox=Class(pkg.Checkbox,[])},function $prototype(){this.label=this.content=null;this.vGap=this.hGap=2;this.indent=4;this.orient="top";this.alignment="left";this.getTitleInfo=function(){return this.label!==null?{x:this.label.x,y:this.label.y,width:this.label.width,height:this.label.height,orient:this.orient}:null};this.calcPreferredSize=function(target){var ps=this.content!==null&&this.content.isVisible===true?this.content.getPreferredSize():{width:0,height:0};if(this.label!==null&&this.label.isVisible===true){var lps=this.label.getPreferredSize();ps.height+=lps.height;ps.width=Math.max(ps.width,lps.width+this.indent)}ps.width+=this.hGap*2;ps.height+=this.vGap*2;return ps};this.doLayout=function(target){var h=0,right=this.getRight(),left=this.getLeft(),top=this.orient==="top"?this.top:this.getTop(),bottom=this.orient==="bottom"?this.bottom:this.getBottom();if(this.label!==null&&this.label.isVisible===true){var ps=this.label.getPreferredSize();h=ps.height;this.label.setBounds(this.alignment==="left"?left+this.indent:this.alignment==="right"?this.width-right-ps.width-this.indent:Math.floor((this.width-ps.width)/2),this.orient==="bottom"?this.height-bottom-ps.height:top,ps.width,h)}if(this.content!==null&&this.content.isVisible===true){this.content.setBounds(left+this.hGap,(this.orient==="bottom"?top:top+h)+this.vGap,this.width-right-left-2*this.hGap,this.height-top-bottom-h-2*this.vGap)}};this.setGaps=function(vg,hg){if(this.vGap!==vg||hg!==this.hGap){this.vGap=vg;this.hGap=hg;this.vrp()}return this};this.setOrientation=function(o){if(this.orient!==o){this.orient=zebkit.util.$validateValue(o,"top","bottom");this.vrp()}return this};this.setAlignment=function(a){if(this.alignment!==a){this.alignment=zebkit.util.$validateValue(a,"left","right","center");this.vrp()}return this}},function setBorder(br){br=pkg.$view(br);if(zebkit.instanceOf(br,pkg.TitledBorder)===false){br=new pkg.TitledBorder(br,"center")}return this.$super(br)},function kidAdded(index,ctr,lw){this.$super(index,ctr,lw);if(ctr===null&&this.content===null||"center"===ctr){this.content=lw}else if(this.label===null){this.label=lw}},function kidRemoved(index,lw){this.$super(index,lw);if(lw===this.label){this.label=null}else if(this.content===lw){this.content=null}}]);pkg.SplitPan=Class(pkg.Panel,[function(f,s,o){if(arguments.length>2){this.orient=o}this.$super();if(arguments.length>0)this.add("left",f);if(arguments.length>1)this.add("right",s);this.add("center",new this.clazz.Bar(this))},function $clazz(){this.Bar=Class(pkg.EvStatePan,[function(target){this.target=target;this.$super()},function $prototype(){this.prevLoc=0;this.pointerDragged=function(e){var x=this.x+e.x,y=this.y+e.y;if(this.target.orient==="vertical"){if(this.prevLoc!==x){x=this.target.normalizeBarLoc(x);if(x>0){this.prevLoc=x;this.target.setGripperLoc(x)}}}else{if(this.prevLoc!==y){y=this.target.normalizeBarLoc(y);if(y>0){this.prevLoc=y;this.target.setGripperLoc(y)}}}};this.pointerDragStarted=function(e){var x=this.x+e.x,y=this.y+e.y;if(e.isAction()){if(this.target.orient==="vertical"){x=this.target.normalizeBarLoc(x);if(x>0)this.prevLoc=x}else{y=this.target.normalizeBarLoc(y);if(y>0)this.prevLoc=y}}};this.pointerDragEnded=function(e){var xy=this.target.normalizeBarLoc(this.target.orient==="vertical"?this.x+e.x:this.y+e.y);if(xy>0)this.target.setGripperLoc(xy)};this.getCursorType=function(t,x,y){return this.target.orient==="vertical"?pkg.Cursor.W_RESIZE:pkg.Cursor.N_RESIZE}}])},function $prototype(){this.leftMinSize=this.rightMinSize=50;this.isMoveable=true;this.gap=1;this.orient="vertical";this.minXY=this.maxXY=0;this.barLocation=70;this.leftComp=this.rightComp=this.gripper=null;this.normalizeBarLoc=function(xy){if(xy<this.minXY)xy=this.minXY;else{if(xy>this.maxXY)xy=this.maxXY}return xy>this.maxXY||xy<this.minXY?-1:xy};this.setOrientation=function(o){if(o!==this.orient){this.orient=zebkit.util.$validateValue(o,"horizontal","vertical");this.vrp()}return this};this.setGripperLoc=function(l){if(l!==this.barLocation){this.barLocation=l;this.vrp()}return this};this.calcPreferredSize=function(c){var fSize=pkg.$getPS(this.leftComp),sSize=pkg.$getPS(this.rightComp),bSize=pkg.$getPS(this.gripper);if(this.orient==="horizontal"){bSize.width=Math.max(fSize.width>sSize.width?fSize.width:sSize.width,bSize.width);bSize.height=fSize.height+sSize.height+bSize.height+2*this.gap}else{bSize.width=fSize.width+sSize.width+bSize.width+2*this.gap;bSize.height=Math.max(fSize.height>sSize.height?fSize.height:sSize.height,bSize.height)}return bSize};this.doLayout=function(target){var right=this.getRight(),top=this.getTop(),bottom=this.getBottom(),left=this.getLeft(),bSize=pkg.$getPS(this.gripper);if(this.orient==="horizontal"){var w=this.width-left-right;if(this.barLocation<top)this.barLocation=top;else{if(this.barLocation>this.height-bottom-bSize.height){this.barLocation=this.height-bottom-bSize.height}}if(this.gripper!==null){if(this.isMoveable){this.gripper.setBounds(left,this.barLocation,w,bSize.height)}else{this.gripper.toPreferredSize();this.gripper.setLocation(Math.floor((w-bSize.width)/2),this.barLocation)}}if(this.leftComp!==null){this.leftComp.setBounds(left,top,w,this.barLocation-this.gap-top)}if(this.rightComp!==null){this.rightComp.setLocation(left,this.barLocation+bSize.height+this.gap);this.rightComp.setSize(w,this.height-this.rightComp.y-bottom)}}else{var h=this.height-top-bottom;if(this.barLocation<left)this.barLocation=left;else{if(this.barLocation>this.width-right-bSize.width){this.barLocation=this.width-right-bSize.width}}if(this.gripper!==null){if(this.isMoveable===true){this.gripper.setBounds(this.barLocation,top,bSize.width,h)}else{this.gripper.setBounds(this.barLocation,Math.floor((h-bSize.height)/2),bSize.width,bSize.height)}}if(this.leftComp!==null){this.leftComp.setBounds(left,top,this.barLocation-left-this.gap,h)}if(this.rightComp!==null){this.rightComp.setLocation(this.barLocation+bSize.width+this.gap,top);this.rightComp.setSize(this.width-this.rightComp.x-right,h)}}};this.setGap=function(g){if(this.gap!==g){this.gap=g;this.vrp()}return this};this.setLeftMinSize=function(m){if(this.leftMinSize!==m){this.leftMinSize=m;this.vrp()}return this};this.setRightMinSize=function(m){if(this.rightMinSize!==m){this.rightMinSize=m;this.vrp()}return this};this.setGripperMovable=function(b){if(b!==this.isMoveable){this.isMoveable=b;this.vrp()}return this}},function kidAdded(index,ctr,c){this.$super(index,ctr,c);if(ctr===null&&this.leftComp===null||"left"===ctr){this.leftComp=c}else if(ctr===null&&this.rightComp===null||"right"===ctr){this.rightComp=c}else{if("center"===ctr)this.gripper=c;else throw new Error(""+ctr)}},function kidRemoved(index,c){this.$super(index,c);if(c===this.leftComp)this.leftComp=null;else{if(c===this.rightComp){this.rightComp=null}else{if(c===this.gripper)this.gripper=null}}},function resized(pw,ph){var ps=this.gripper.getPreferredSize();if(this.orient==="vertical"){this.minXY=this.getLeft()+this.gap+this.leftMinSize;this.maxXY=this.width-this.gap-this.rightMinSize-ps.width-this.getRight()}else{this.minXY=this.getTop()+this.gap+this.leftMinSize;this.maxXY=this.height-this.gap-this.rightMinSize-ps.height-this.getBottom()}this.$super(pw,ph)}]);pkg.CollapsiblePan=Class(pkg.Panel,pkg.Switchable,[function(lab,content,sm){this.$super();this.titlePan=new this.clazz.TitlePan;this.add("top",this.titlePan);this.titlePan.add(new this.clazz.TogglePan(this));this.titlePan.add(pkg.$component(arguments.length===0||lab===null?"":lab,this));if(arguments.length>1&&content!==null){this.contentPan=content;this.add("center",this.contentPan)}this.setSwitchManager(arguments.length>2?sm:new pkg.SwitchManager)},function $clazz(){this.Label=Class(pkg.Label,[]);this.ImageLabel=Class(pkg.ImageLabel,[]);this.TitlePan=Class(pkg.StatePan,[]);this.TogglePan=Class(pkg.StatePan,[function(sw){if(zebkit.instanceOf(sw,pkg.Switchable)===false){throw new Error("Passed component has to implement Switchable interface")}this.switchable=sw;this.$super()},function $prototype(){this.switchable=null;this.cursorType=pkg.Cursor.HAND;this.pointerPressed=function(e){if(e.isAction()){this.switchable.toggle()}}}]);this.GroupPan=Class(pkg.Panel,[function $clazz(){this.Group=Class(pkg.Group,[function(target){this.target=target;this.$super(true)},function setValue(o,v){var selected=this.selected;this.$super(o,v);if(v===false&&selected!==null&&this.selected===null){var i=this.target.indexOf(selected);i=(i+1)%this.target.kids.length;if(this.target.kids[i]!==selected){this.setValue(this.target.kids[i],true)}}return this}])},function $prototype(){this.doLayout=function(t){var y=t.getTop(),x=t.getLeft(),w=t.width-x-t.getRight(),eh=t.height-y-t.getBottom(),kid=null,i=0;for(i=0;i<t.kids.length;i++){kid=t.kids[i];if(kid.isVisible){if(kid.getValue()===false){var psh=kid.getPreferredSize().height;eh-=psh;kid.setSize(w,psh)}}}for(i=0;i<t.kids.length;i++){kid=t.kids[i];if(kid.isVisible){kid.setLocation(x,y);if(kid.getValue()){kid.setSize(w,eh)}y+=kid.height}}};this.calcPreferredSize=function(t){var w=0,h=0;for(var i=0;i<t.kids.length;i++){var kid=t.kids[i];if(kid.isVisible){var ps=kid.getPreferredSize();h+=ps.height;if(ps.width>w)w=ps.width}}return{width:w,height:h}};this.compAdded=function(e){e.kid.setSwitchManager(this.group);if(this.group.selected===null){this.group.setValue(e.kid,true)}};this.compRemoved=function(e){if(this.group.selected===e.kid){this.group.setValue(e.kid,false)}e.kid.setSwitchManager(null)}},function(){this.group=new this.clazz.Group(this);this.$super();for(var i=0;i<arguments.length;i++){arguments[i].setSwitchManager(this.group);this.add(arguments[i])}}])},function $prototype(){this.contentPan=null;this.titlePan=null;this.switched=function(){var value=this.getValue();if(this.contentPan!==null){this.contentPan.setVisible(value)}if(this.titlePan!==null){this.titlePan.setState(value?"on":"off")}};this.compEnabled=function(e){if(this.titlePan!==null){var v=this.getValue();this.titlePan.setState(this.isEnable?v?"on":"off":v?"dison":"disoff")}};this.compRemoved=function(e){if(this.titlePan===e.kid){this.titlePan=null}else if(e.kid===this.contentPan){this.contentPan=null}}}]);pkg.StatusBarPan=Class(pkg.Panel,[function(gap){if(arguments.length===0){gap=2}this.setPadding(gap,0,0,0);this.$super(new zebkit.layout.PercentLayout("horizontal",gap))},function $prototype(){this.setBorderView=function(v){if(v!=this.borderView){this.borderView=v;for(var i=0;i<this.kids.length;i++){this.kids[i].setBorder(this.borderView)}this.repaint()}return this}},function insert(i,s,d){d.setBorder(this.borderView);this.$super(i,s,d)}]);pkg.StackPan=Class(pkg.Panel,[function(){this.$super(new zebkit.layout.StackLayout);for(var i=0;i<arguments.length;i++){this.add(arguments[i])}}]);pkg.ScrollManager=Class(zebkit.EventProducer,[function(c){this._=new this.clazz.Listeners;this.target=c},function $clazz(){this.Listeners=zebkit.util.ListenersClass("scrolled")},function $prototype(){this.sx=this.sy=0;this.getSX=function(){return this.sx};this.getSY=function(){return this.sy};this.scrollXTo=function(v){this.scrollTo(v,this.getSY())};this.scrollYTo=function(v){this.scrollTo(this.getSX(),v)};this.scrollTo=function(x,y){var psx=this.getSX(),psy=this.getSY();if(psx!==x||psy!==y){this.sx=x;this.sy=y;if(typeof this.scrollStateUpdated!=="undefined")this.scrollStateUpdated(x,y,psx,psy);if(typeof this.target.catchScrolled!=="undefined")this.target.catchScrolled(psx,psy);this._.scrolled(psx,psy)}return this};this.makeVisible=function(x,y,w,h){var p=pkg.calcOrigin(x,y,w,h,this.getSX(),this.getSY(),this.target);this.scrollTo(p[0],p[1]);return this}}]);pkg.Scroll=Class(pkg.Panel,zebkit.util.Position.Metric,[function(t){if(arguments.length>0){this.orient=zebkit.util.$validateValue(t,"vertical","horizontal")}this.bundleLoc=0;this.startDragLoc=Number.MAX_VALUE;this.$super(this);var b=this.orient==="vertical";this.add("center",b?new pkg.Scroll.VBundle:new pkg.Scroll.HBundle);this.add("top",b?new pkg.Scroll.VDecButton:new pkg.Scroll.HDecButton);this.add("bottom",b?new pkg.Scroll.VIncButton:new pkg.Scroll.HIncButton);this.setPosition(new zebkit.util.SingleColPosition(this))},function $clazz(){this.isDragable=true;this.ArrowButton=Class(pkg.ArrowButton,[function $prototype(){this.isFireByPress=true;this.firePeriod=20}]);this.VIncButton=Class(this.ArrowButton,[]);this.VDecButton=Class(this.ArrowButton,[]);this.HIncButton=Class(this.ArrowButton,[]);this.HDecButton=Class(this.ArrowButton,[]);this.VBundle=Class(pkg.Panel,[]);this.HBundle=Class(pkg.Panel,[]);this.MIN_BUNDLE_SIZE=16},function $prototype(){this.incBt=this.decBt=this.bundle=this.position=null;this.extra=this.max=100;this.pageIncrement=20;this.unitIncrement=5;this.orient="vertical";this.isInBundle=function(x,y){var bn=this.bundle;return bn!==null&&bn.isVisible===true&&bn.x<=x&&bn.y<=y&&bn.x+bn.width>x&&bn.y+bn.height>y};this.amount=function(){var db=this.decBt;return this.orient==="vertical"?this.incBt.y-db.y-db.height:this.incBt.x-db.x-db.width};this.pixel2value=function(p){var db=this.decBt;return this.orient==="vertical"?Math.floor(this.max*(p-db.y-db.height)/(this.amount()-this.bundle.height)):Math.floor(this.max*(p-db.x-db.width)/(this.amount()-this.bundle.width))};this.value2pixel=function(){var db=this.decBt,bn=this.bundle,off=this.position.offset;return this.orient==="vertical"?db.y+db.height+Math.floor((this.amount()-bn.height)*off/this.max):db.x+db.width+Math.floor((this.amount()-bn.width)*off/this.max)};this.catchInput=function(child){return child===this.bundle||this.bundle.kids.length>0&&zebkit.layout.isAncestorOf(this.bundle,child)};this.posChanged=function(target,po,pl,pc){if(this.bundle!==null){if(this.orient==="horizontal"){this.bundle.setLocation(this.value2pixel(),this.getTop())}else{this.bundle.setLocation(this.getLeft(),this.value2pixel())}}};this.getLines=function(){return this.max};this.getLineSize=function(line){return 1};this.getMaxOffset=function(){return this.max};this.fired=function(src){this.position.setOffset(this.position.offset+(src===this.incBt?this.unitIncrement:-this.unitIncrement))};this.pointerDragged=function(e){if(Number.MAX_VALUE!==this.startDragLoc){this.position.setOffset(this.pixel2value(this.bundleLoc-this.startDragLoc+(this.orient==="horizontal"?e.x:e.y)))}};this.pointerDragStarted=function(e){if(this.isDragable===true&&this.isInBundle(e.x,e.y)){this.startDragLoc=this.orient==="horizontal"?e.x:e.y;this.bundleLoc=this.orient==="horizontal"?this.bundle.x:this.bundle.y}};this.pointerDragEnded=function(e){this.startDragLoc=Number.MAX_VALUE};this.pointerClicked=function(e){if(this.isInBundle(e.x,e.y)===false&&e.isAction()){var d=this.pageIncrement;if(this.orient==="vertical"){if(e.y<(this.bundle!==null?this.bundle.y:Math.floor(this.height/2)))d=-d}else{if(e.x<(this.bundle!==null?this.bundle.x:Math.floor(this.width/2)))d=-d}this.position.setOffset(this.position.offset+d)}};this.calcPreferredSize=function(target){var ps1=pkg.$getPS(this.incBt),ps2=pkg.$getPS(this.decBt),ps3=pkg.$getPS(this.bundle);if(this.orient==="horizontal"){ps1.width+=ps2.width+ps3.width;ps1.height=Math.max(ps1.height>ps2.height?ps1.height:ps2.height,ps3.height)}else{ps1.height+=ps2.height+ps3.height;ps1.width=Math.max(ps1.width>ps2.width?ps1.width:ps2.width,ps3.width)}return ps1};this.doLayout=function(target){var right=this.getRight(),top=this.getTop(),bottom=this.getBottom(),left=this.getLeft(),ew=this.width-left-right,eh=this.height-top-bottom,b=this.orient==="horizontal",ps1=pkg.$getPS(this.decBt),ps2=pkg.$getPS(this.incBt),minbs=this.clazz.MIN_BUNDLE_SIZE;this.decBt.setBounds(left,top,b?ps1.width:ew,b?eh:ps1.height);this.incBt.setBounds(b?this.width-right-ps2.width:left,b?top:this.height-bottom-ps2.height,b?ps2.width:ew,b?eh:ps2.height);if(this.bundle!==null&&this.bundle.isVisible===true){var am=this.amount();if(am>minbs){var bsize=Math.max(Math.min(Math.floor(this.extra*am/this.max),am-minbs),minbs);this.bundle.setBounds(b?this.value2pixel():left,b?top:this.value2pixel(),b?bsize:ew,b?eh:bsize)}else{this.bundle.setSize(0,0)}}};this.setMaximum=function(m){if(m!==this.max){this.max=m;if(this.position.offset>this.max){this.position.setOffset(this.max)}this.vrp()}return this};this.setValue=function(v){this.position.setOffset(v);return this};this.setPosition=function(p){if(p!==this.position){if(this.position!==null)this.position.off(this);this.position=p;if(this.position!==null){this.position.on(this);this.position.setMetric(this);this.position.setOffset(0)}}return this};this.setExtraSize=function(e){if(e!==this.extra){this.extra=e;this.vrp()}return this}},function kidAdded(index,ctr,lw){this.$super(index,ctr,lw);if("center"===ctr){this.bundle=lw}else if("bottom"===ctr){this.incBt=lw;this.incBt.on(this)}else if("top"===ctr){this.decBt=lw;this.decBt.on(this)}else{throw new Error("Invalid constraints : "+ctr)}},function kidRemoved(index,lw){this.$super(index,lw);if(lw===this.bundle){this.bundle=null}else if(lw===this.incBt){this.incBt.off(this);this.incBt=null}else if(lw===this.decBt){this.decBt.off(this);this.decBt=null}}]);pkg.ScrollPan=Class(pkg.Panel,[function(c,scrolls,autoHide){if(arguments.length<2){scrolls="both"}this.$isPosChangedLocked=false;this.$super();if(arguments.length>0&&c!==null){this.add("center",c)}if(arguments.length<2||scrolls==="both"||scrolls==="horizontal"){this.add("bottom",new pkg.Scroll("horizontal"))}if(arguments.length<2||scrolls==="both"||scrolls==="vertical"){this.add("right",new pkg.Scroll("vertical"))}if(arguments.length>2){this.setAutoHide(autoHide)}},function $clazz(){this.ContentPanLayout=Class(zebkit.layout.Layout,[function $prototype(){this.calcPreferredSize=function(t){return t.kids[0].getPreferredSize()};this.doLayout=function(t){var kid=t.kids[0];if(kid.constraints==="stretch"){var ps=kid.getPreferredSize(),w=t.parent.hBar!==null?ps.width:t.width,h=t.parent.vBar!==null?ps.height:t.height;kid.setSize(w,h)}else{kid.toPreferredSize()}}}]);var SM=this.ContentPanScrollManager=Class(pkg.ScrollManager,[function $prototype(){this.getSX=function(){return this.target.x};this.getSY=function(){return this.target.y};this.scrollStateUpdated=function(sx,sy,psx,psy){this.target.setLocation(sx,sy)}}]);var contentPanLayout=new this.ContentPanLayout;this.ContentPan=Class(pkg.Panel,[function(c){this.$super(contentPanLayout);this.scrollManager=new SM(c);this.add(c)}])},function $prototype(){this.hBar=this.vBar=this.scrollObj=null;this.autoHide=false;this.$interval=0;this.setAutoHide=function(b){if(this.autoHide!==b){this.autoHide=b;if(this.hBar!==null){if(this.hBar.incBt!==null)this.hBar.incBt.setVisible(b===false);if(this.hBar.decBt!==null)this.hBar.decBt.setVisible(b===false);if(b===true){this.hBar.toBack()}else{this.hBar.toFront()}}if(this.vBar!==null){if(this.vBar.incBt!==null)this.vBar.incBt.setVisible(b===false);if(this.vBar.decBt!==null)this.vBar.decBt.setVisible(b===false);if(b===true){this.vBar.toBack()}else{this.vBar.toFront()}}if(this.$interval!==0){zebkit.environment.clearInterval(this.$interval);$this.$interval=0}this.vrp()}return this};this.scrollTo=function(sx,sy){this.scrollObj.scrollManager.scrollTo(sx,sy)};this.scrollXTo=function(sx){this.scrollObj.scrollManager.scrollXTo(sx)};this.scrollYTo=function(sx,sy){this.scrollObj.scrollManager.scrollYTo(sy)};this.doScroll=function(dx,dy,source){var b=false,v=0;if(dy!==0&&this.vBar!==null&&this.vBar.isVisible===true){v=this.vBar.position.offset+dy;if(v>=0)this.vBar.position.setOffset(v);else this.vBar.position.setOffset(0);b=true}if(dx!==0&&this.hBar!==null&&this.hBar.isVisible===true){v=this.hBar.position.offset+dx;if(v>=0)this.hBar.position.setOffset(v);else this.hBar.position.setOffset(0);b=true}return b};this.scrolled=function(psx,psy){this.validate();try{this.$isPosChangedLocked=true;if(this.hBar!==null){this.hBar.position.setOffset(-this.scrollObj.scrollManager.getSX())}if(this.vBar!==null){this.vBar.position.setOffset(-this.scrollObj.scrollManager.getSY())}if(this.scrollObj.scrollManager==null)this.invalidate();this.$isPosChangedLocked=false}catch(e){this.$isPosChangedLocked=false;throw e}};this.calcPreferredSize=function(target){return pkg.$getPS(this.scrollObj)};this.doLayout=function(target){var sman=this.scrollObj===null?null:this.scrollObj.scrollManager,right=this.getRight(),top=this.getTop(),bottom=this.getBottom(),left=this.getLeft(),ww=this.width-left-right,maxH=ww,hh=this.height-top-bottom,maxV=hh,so=this.scrollObj.getPreferredSize(),vps=this.vBar===null?{width:0,height:0}:this.vBar.getPreferredSize(),hps=this.hBar===null?{width:0,height:0}:this.hBar.getPreferredSize();if(this.hBar!==null&&this.autoHide===false&&(so.width>ww||so.height>hh&&so.width>ww-vps.width)){maxV-=hps.height}maxV=so.height>maxV?so.height-maxV:-1;if(this.vBar!==null&&this.autoHide===false&&(so.height>hh||so.width>ww&&so.height>hh-hps.height)){maxH-=vps.width}maxH=so.width>maxH?so.width-maxH:-1;var sy=sman.getSY(),sx=sman.getSX();if(this.vBar!==null){if(maxV<0){if(this.vBar.isVisible===true){this.vBar.setVisible(false);sman.scrollTo(sx,0);this.vBar.position.setOffset(0)}sy=0}else{this.vBar.setVisible(true)}}if(this.hBar!==null){if(maxH<0){if(this.hBar.isVisible===true){this.hBar.setVisible(false);sman.scrollTo(0,sy);this.hBar.position.setOffset(0)}}else{this.hBar.setVisible(true)}}if(this.scrollObj.isVisible===true){this.scrollObj.setBounds(left,top,ww-(this.autoHide===false&&this.vBar!==null&&this.vBar.isVisible===true?vps.width:0),hh-(this.autoHide===false&&this.hBar!==null&&this.hBar.isVisible===true?hps.height:0))}if(this.$interval===0&&this.autoHide===true){hps.height=vps.width=0}if(this.hBar!==null&&this.hBar.isVisible===true){this.hBar.setBounds(left,this.height-bottom-hps.height,ww-(this.vBar!==null&&this.vBar.isVisible===true?vps.width:0),hps.height);this.hBar.setMaximum(maxH)}if(this.vBar!==null&&this.vBar.isVisible===true){this.vBar.setBounds(this.width-right-vps.width,top,vps.width,hh-(this.hBar!==null&&this.hBar.isVisible===true?hps.height:0));this.vBar.setMaximum(maxV)}};this.posChanged=function(target,prevOffset,prevLine,prevCol){if(this.$isPosChangedLocked===false){if(this.autoHide===true){if(this.$interval===0&&(this.vBar!==null&&this.vBar.isVisible===true||this.hBar!==null&&this.hBar.isVisible===true)){var $this=this;if(this.vBar!==null)this.vBar.toFront();if(this.hBar!==null)this.hBar.toFront();this.vrp();$this.$hiddingCounter=2;$this.$targetBar=null;var listener=pkg.events.on({pointerMoved:function(e){$this.$hiddingCounter=1},pointerExited:function(e){$this.$targetBar=null},pointerEntered:function(e){if(e.source===$this.vBar){$this.$targetBar=$this.vBar}else{if(e.source===$this.hBar){$this.$targetBar=$this.hBar;return}$this.$targetBar=null}}});this.$interval=zebkit.environment.setInterval(function(){if($this.$hiddingCounter--===0&&$this.$targetBar===null){zebkit.environment.clearInterval($this.$interval);$this.$interval=0;pkg.events.off(listener);$this.doLayout()}},500)}}if(this.vBar!==null&&this.vBar.position===target){this.scrollObj.scrollManager.scrollYTo(-this.vBar.position.offset)}else if(this.hBar!==null&&this.hBar.position===target){this.scrollObj.scrollManager.scrollXTo(-this.hBar.position.offset)}}};this.setIncrements=function(hUnit,hPage,vUnit,vPage){if(this.hBar!==null){if(hUnit!==-1)this.hBar.unitIncrement=hUnit;if(hPage!==-1)this.hBar.pageIncrement=hPage}if(this.vBar!==null){if(vUnit!==-1)this.vBar.unitIncrement=vUnit;if(vPage!==-1)this.vBar.pageIncrement=vPage}return this}},function insert(i,ctr,c){if("center"===ctr){if(c.scrollManager==null){c=new this.clazz.ContentPan(c)}this.scrollObj=c;c.scrollManager.on(this)}else{if("bottom"===ctr||"top"===ctr){this.hBar=c}else if("left"===ctr||"right"===ctr){this.vBar=c}else{throw new Error("Invalid constraints")}if(c.incBt!==null)c.incBt.setVisible(!this.autoHide);if(c.decBt!==null)c.decBt.setVisible(!this.autoHide);c.position.on(this)}return this.$super(i,ctr,c)},function kidRemoved(index,comp){this.$super(index,comp);if(comp===this.scrollObj){this.scrollObj.scrollManager.off(this);this.scrollObj=null}else if(comp===this.hBar){this.hBar.position.off(this);this.hBar=null}else if(comp===this.vBar){this.vBar.position.off(this);this.vBar=null}}]);pkg.MobileScrollMan=Class(pkg.Manager,[function $prototype(){this.$timer=this.identifier=this.target=null;this.pointerDragStarted=function(e){if(e.touchCounter===1&&e.pointerType==="touch"){this.$identifier=e.identifier;this.$target=e.source;while(this.$target!==null&&typeof this.$target.doScroll==="undefined"){this.$target=this.$target.parent}if(this.$target!==null&&typeof this.$target.pointerDragged!=="undefined"){this.$target=null}}};this.pointerDragged=function(e){if(e.touchCounter===1&&this.$target!==null&&this.$identifier===e.identifier&&e.direction!==null){this.$target.doScroll(-e.dx,-e.dy,"touch")}};this.$taskMethod=function(){var bar=this.$target.vBar,o=bar.position.offset;this.$dt=Math.tan(42*Math.PI/180)*this.$dt;bar.position.setOffset(o-Math.round(this.$dt));this.$counter++;if(o===bar.position.offset){this.$target=null;zebkit.environment.clearInterval(this.$timer);this.$timer=null}};this.pointerDragEnded=function(e){if(this.$target!==null&&this.$timer===null&&this.$identifier===e.identifier&&(e.direction==="bottom"||e.direction==="top")&&this.$target.vBar!==null&&this.$target.vBar.isVisible&&e.dy!==0){this.$dt=2*e.dy;this.$counter=0;var $this=this;this.$timer=zebkit.environment.setInterval(function(){$this.$taskMethod($this)},50)}};this.pointerPressed=function(e){if(this.$timer!==null){zebkit.environment.clearInterval(this.$timer);this.$timer=null}this.$target=null}}]);pkg.Slider=Class(pkg.Panel,pkg.$ViewsSetterMix,[function(o){this._=new zebkit.util.Listeners;this.views={gauge:null};if(arguments.length>0){this.orient=zebkit.util.$validateValue(o,"vertical","horizontal")}this.setValues(0,20,[0,5,10],2,1);this.setScaleStep(1);this.$super();this.views.bundle=this.orient==="horizontal"?this.views.hbundle:this.views.vbundle;if(typeof this.views.bundle==="undefined"){this.views.bundle=null}this.provider=new this.clazz.ViewProvider},function $clazz(){this.ViewProvider=Class([function(color,font){this.render=new pkg.BoldTextRender("");zebkit.properties(this,this.clazz);if(arguments.length>0){this.color=color}if(arguments.length>1){this.font=font}this.render.setColor(this.color);this.render.setFont(this.font)},function $prototype(){this.color="white";this.font=new pkg.Font("Arial","bold",12);this.getView=function(d,o){this.render.setValue(o!==null&&typeof o!=="undefined"?o.toString():"");return this.render}}])},function $prototype(){this.max=this.min=this.value=this.roughStep=this.exactStep=0;this.netSize=this.gap=3;this.correctDt=this.scaleStep=this.psW=this.psH=0;this.intervals=this.pl=null;this.canHaveFocus=true;this.orient="horizontal";this.isShowScale=this.isShowTitle=true;this.dragged=this.isIntervalMode=false;this.getValue=function(){return this.value};this.paintNums=function(g,loc){if(this.isShowTitle===true)for(var i=0;i<this.pl.length;i++){var render=this.provider.getView(this,this.getPointValue(i)),d=render.getPreferredSize();if(this.orient==="horizontal"){render.paint(g,this.pl[i]-Math.floor(d.width/2),loc,d.width,d.height,this)}else{render.paint(g,loc,this.pl[i]-Math.floor(d.height/2),d.width,d.height,this)}}};this.getScaleSize=function(){var bs=this.views.bundle===null?{width:0,height:0}:this.views.bundle.getPreferredSize();return this.orient==="horizontal"?this.width-this.getLeft()-this.getRight()-bs.width:this.height-this.getTop()-this.getBottom()-bs.height};this.pointerDragged=function(e){if(this.dragged){this.setValue(this.findNearest(e.x+(this.orient==="horizontal"?this.correctDt:0),e.y+(this.orient==="horizontal"?0:this.correctDt)))}};this.paint=function(g){var i=0;if(this.pl===null){this.pl=Array(this.intervals.length);var l=this.min;for(i=0;i<this.pl.length;i++){l+=this.intervals[i];this.pl[i]=this.value2loc(l)}}var left=this.getLeft(),top=this.getTop(),right=this.getRight(),bottom=this.getBottom(),bnv=this.views.bundle,gauge=this.views.gauge,bs=bnv===null?{width:0,height:0}:bnv.getPreferredSize(),gs=gauge===null?{width:0,height:0}:gauge.getPreferredSize(),w=this.width-left-right-2,h=this.height-top-bottom-2;if(this.orient==="horizontal"){var topY=top+Math.floor((h-this.psH)/2)+1,by=topY;if(this.isEnabled===true){if(gauge!==null){gauge.paint(g,left+1,topY+Math.floor((bs.height-gs.height)/2),w,gs.height,this)}}else{g.setColor("gray");g.strokeRect(left+1,topY+Math.floor((bs.height-gs.height)/2),w,gs.height)}topY+=bs.height;if(this.isShowScale===true){topY+=this.gap;g.setColor(this.isEnabled===true?this.scaleColor:"gray");g.beginPath();for(i=this.min;i<=this.max;i+=this.scaleStep){var xx=this.value2loc(i)+.5;g.moveTo(xx,topY);g.lineTo(xx,topY+this.netSize)}for(i=0;i<this.pl.length;i++){g.moveTo(this.pl[i]+.5,topY);g.lineTo(this.pl[i]+.5,topY+2*this.netSize)}g.stroke();topY+=2*this.netSize}this.paintNums(g,topY);if(bnv!==null){bnv.paint(g,this.getBundleLoc(this.value),by,bs.width,bs.height,this)}}else{var leftX=left+Math.floor((w-this.psW)/2)+1,bx=leftX;if(this.isEnabled===true){if(gauge!==null){gauge.paint(g,leftX+Math.floor((bs.width-gs.width)/2),top+1,gs.width,h,this)}}else{g.setColor("gray");g.strokeRect(leftX+Math.floor((bs.width-gs.width)/2),top+1,gs.width,h)}leftX+=bs.width;if(this.isShowScale===true){leftX+=this.gap;g.setColor(this.scaleColor);g.beginPath();for(i=this.min;i<=this.max;i+=this.scaleStep){var yy=this.value2loc(i)+.5;g.moveTo(leftX,yy);g.lineTo(leftX+this.netSize,yy)}for(i=0;i<this.pl.length;i++){g.moveTo(leftX,this.pl[i]+.5);g.lineTo(leftX+2*this.netSize,this.pl[i]+.5)}g.stroke();leftX+=2*this.netSize}this.paintNums(g,leftX);if(bnv!==null){bnv.paint(g,bx,this.getBundleLoc(this.value),bs.width,bs.height,this)}}if(this.hasFocus()&&this.views.marker!=null){this.views.marker.paint(g,left,top,w+2,h+2,this)}};this.findNearest=function(x,y){var v=this.loc2value(this.orient==="horizontal"?x:y);if(this.isIntervalMode){var nearest=Number.MAX_VALUE,res=0;for(var i=0;i<this.intervals.length;i++){var pv=this.getPointValue(i),dt=Math.abs(pv-v);if(dt<nearest){nearest=dt;res=pv}}return res}v=this.exactStep*Math.floor((v+v%this.exactStep)/this.exactStep);if(v>this.max){v=this.max}else if(v<this.min){v=this.min}return v};this.value2loc=function(v){var ps=this.views.bundle===null?{width:0,height:0}:this.views.bundle.getPreferredSize(),l=Math.floor(this.getScaleSize()*(v-this.min)/(this.max-this.min));return this.orient==="vertical"?this.height-Math.floor(ps.height/2)-this.getBottom()-l:this.getLeft()+Math.floor(ps.width/2)+l};this.loc2value=function(xy){var ps=this.views.bundle===null?{width:0,height:0}:this.views.bundle.getPreferredSize(),sl=this.orient==="vertical"?this.getLeft()+Math.floor(ps.width/2):this.getTop()+Math.floor(ps.height/2),ss=this.getScaleSize();if(this.orient==="vertical"){xy=this.height-xy}if(xy<sl){xy=sl}else if(xy>sl+ss){xy=sl+ss}return this.min+Math.floor((this.max-this.min)*(xy-sl)/ss)};this.nextValue=function(value,s,d){if(this.isIntervalMode){return this.getNeighborPoint(value,d)}var v=value+d*s;if(v>this.max){v=this.max}else if(v<this.min){v=this.min}return v};this.getBundleLoc=function(v){var bs=this.views.bundle===null?{width:0,height:0}:this.views.bundle.getPreferredSize();return this.value2loc(v)-(this.orient==="horizontal"?Math.floor(bs.width/2):Math.floor(bs.height/2))};this.getBundleBounds=function(v){var bs=this.views.bundle===null?{width:0,height:0}:this.views.bundle.getPreferredSize();return this.orient==="horizontal"?{x:this.getBundleLoc(v),y:this.getTop()+Math.floor((this.height-this.getTop()-this.getBottom()-this.psH)/2)+1,width:bs.width,height:bs.height}:{x:this.getLeft()+Math.floor((this.width-this.getLeft()-this.getRight()-this.psW)/2)+1,y:this.getBundleLoc(v),width:bs.width,height:bs.height}};this.getNeighborPoint=function(v,d){var left=this.min+this.intervals[0],right=this.getPointValue(this.intervals.length-1),i=0,start=0;if(v<left){return left}else if(v>right){return right}if(d>0){start=this.min;for(i=0;i<this.intervals.length;i++){start+=this.intervals[i];if(start>v)return start}return right}else{start=right;for(i=this.intervals.length-1;i>=0;i--){if(start<v)return start;start-=this.intervals[i]}return left}};this.calcPreferredSize=function(l){return{width:this.psW+2,height:this.psH+2}};this.recalc=function(){var ps=this.views.bundle!==null?this.views.bundle.getPreferredSize():{width:0,height:0},ns=this.isShowScale?this.gap+2*this.netSize:0,dt=this.max-this.min,hMax=0,wMax=0;if(this.isShowTitle&&this.intervals.length>0){for(var i=0;i<this.intervals.length;i++){var d=this.provider.getView(this,this.getPointValue(i)).getPreferredSize();if(d.height>hMax)hMax=d.height;if(d.width>wMax)wMax=d.width}}if(this.orient==="horizontal"){this.psW=dt*2+ps.width;this.psH=ps.height+ns+hMax}else{this.psW=ps.width+ns+wMax;this.psH=dt*2+ps.height}};this.setValue=function(v){if(v<this.min||v>this.max){throw new Error("Value is out of bounds: "+v)}var prev=this.value;if(this.value!==v){this.value=v;this._.fired(this,prev);this.repaint()}return this};this.getPointValue=function(i){var v=this.min+this.intervals[0];for(var j=0;j<i;j++,v+=this.intervals[j]);return v};this.keyPressed=function(e){var b=this.isIntervalMode,v=null;switch(e.code){case"ArrowDown":case"ArrowLeft":v=this.nextValue(this.value,this.exactStep,-1);if(v>=this.min)this.setValue(v);break;case"ArrowUp":case"ArrowRight":v=this.nextValue(this.value,this.exactStep,1);if(v<=this.max)this.setValue(v);break;case"Home":this.setValue(b?this.getPointValue(0):this.min);break;case"End":this.setValue(b?this.getPointValue(this.intervals.length-1):this.max);break}};this.pointerPressed=function(e){if(e.isAction()){var x=e.x,y=e.y,bb=this.getBundleBounds(this.value);if(x<bb.x||y<bb.y||x>=bb.x+bb.width||y>=bb.y+bb.height){var l=this.orient==="horizontal"?x:y,v=this.loc2value(l);if(this.value!=v){this.setValue(this.isJumpOnPress?v:this.nextValue(this.value,this.roughStep,v<this.value?-1:1))}}}};this.pointerDragStarted=function(e){var r=this.getBundleBounds(this.value);if(e.x>=r.x&&e.y>=r.y&&e.x<r.x+r.width&&e.y<r.y+r.height){this.dragged=true;this.correctDt=this.orient==="horizontal"?r.x+Math.floor(r.width/2)-e.x:r.y+Math.floor(r.height/2)-e.y}};this.pointerDragEnded=function(e){this.dragged=false}},function focused(){this.$super();this.repaint()},function setScaleGap(g){if(g!==this.gap){this.gap=g;this.vrp()}return this},function setScaleColor(c){if(c!==this.scaleColor){this.scaleColor=c;if(this.provider===this)this.render.setColor(c);this.repaint()}return this},function setScaleStep(s){if(s!==this.scaleStep){this.scaleStep=s;this.repaint()}return this},function setShowScale(b){if(this.isShowScale!==b){this.isShowScale=b;this.vrp()}return this},function setShowTitle(b){if(this.isShowTitle!==b){this.isShowTitle=b;this.vrp()}return this},function setViewProvider(p){if(p!==this.provider){this.provider=p;this.vrp()}return this},function setValues(min,max,intervals,roughStep,exactStep){if(roughStep<=0||exactStep<0||min>=max||min+roughStep>max||min+exactStep>max){throw new Error("["+min+","+max+"], "+roughStep+","+exactStep)}var i=0,start=min;for(i=0;i<intervals.length;i++){start+=intervals[i];if(start>max||intervals[i]<0)throw new Error}this.min=min;this.max=max;this.roughStep=roughStep;this.exactStep=exactStep;this.intervals=Array(intervals.length);for(i=0;i<intervals.length;i++){this.intervals[i]=intervals[i]}if(this.value<min||this.value>max){this.setValue(this.isIntervalMode?min+intervals[0]:min)}this.vrp();return this},function invalidate(){this.pl=null;this.$super()}]);pkg.Tabs=Class(pkg.Panel,pkg.$ViewsSetterMix,[function(o){this.vgap=this.hgap=this.tabAreaX=0;this.repaintWidth=this.repaintHeight=this.repaintX=this.repaintY=0;this.tabAreaY=this.tabAreaWidth=this.tabAreaHeight=0;this.overTab=this.selectedIndex=-1;this._=new zebkit.util.Listeners;this.pages=[];this.views={};if(typeof pkg.Tabs.font!=="undefined")this.render.setFont(pkg.Tabs.font);if(typeof pkg.Tabs.fontColor!=="undefined")this.render.setColor(pkg.Tabs.fontColor);this.$super();if(arguments.length>0){this.setAlignment(o)}},function $clazz(){this.TabView=Class(pkg.CompRender,[function(icon,caption){if(arguments.length===0){caption=""}else if(arguments.length===1){caption=icon;icon=null}var tp=new this.clazz.TabPan;this.$super(tp);var $this=this;tp.getImagePan().imageLoaded=function(img){$this.vrp();if($this.owner!==null&&$this.owner.parent!==null){$this.owner.repaint()}};var r1=new this.clazz.captionRender(caption),r2=new this.clazz.captionRender(caption);r2.setColor(this.clazz.fontColor);r1.setColor(this.clazz.selectedFontColor);r2.setFont(this.clazz.font);r1.setFont(this.clazz.selectedFont);this.getCaptionPan().setView(new pkg.ViewSet({selected:r1,"*":r2},[function setFont(id,f){var v=this.views[id];if(v){v.setFont(s);this.recalc()}return this},function setCaption(id,s){var v=this.views[id];if(v){v.setValue(s);this.recalc()}return this},function getCaption(id){var v=this.views[id];return v==null?null:v.getValue()}]));this.setIcon(icon)},function $clazz(){this.captionRender=pkg.StringRender;this.font=pkg.font;this.TabPan=Class(pkg.Panel,[function(){this.$super();this.add(new pkg.ImagePan(null));this.add(new pkg.ViewPan)},function getImagePan(){return this.kids[0]},function getViewPan(){return this.kids[1]}])},function $prototype(){this.owner=null;this.ownerChanged=function(v){this.owner=v};this.vrp=function(){if(this.owner!==null)this.owner.vrp()};this.setCaption=function(b,s){if(arguments.length===1){this.setCaption(true,b);this.setCaption(false,b)}else{this.getCaptionPan().view.setCaption(this.$toId(b),s);this.vrp()}return this};this.getCaption=function(b){return this.getCaptionPan().view.getCaption(this.$toId(b))};this.setColor=function(b,c){if(arguments.length===1){this.setColor(true,b);this.setColor(false,b)}else{var v=this.getCaptionPan().view.views[this.$toId(b)];if(v){v.setColor(c);this.vrp()}}return this};this.setFont=function(b,f){if(arguments.length===1){this.setFont(true,b);this.setFont(false,b)}else{this.getCaptionPan().view.setFont(this.$toId(b),f);this.vrp()}return this};this.getCaptionPan=function(){return this.target.getViewPan()};this.setIcon=function(c){this.target.getImagePan().setImage(c);this.target.getImagePan().setVisible(c!==null);return this};this.selected=function(tabs,i,b){this.getCaptionPan().view.activate(this.$toId(b),this)};this.$toId=function(b){return b?"selected":"*"}}])},function $prototype(){this.orient="top";this.sideSpace=1;this.canHaveFocus=true;this.pointerMoved=function(e){var i=this.getTabAt(e.x,e.y);if(this.overTab!==i){this.overTab=i;if(this.views.over){this.repaint(this.repaintX,this.repaintY,this.repaintWidth,this.repaintHeight)}}};this.pointerDragEnded=function(e){var i=this.getTabAt(e.x,e.y);if(this.overTab!==i){this.overTab=i;if(this.views.over){this.repaint(this.repaintX,this.repaintY,this.repaintWidth,this.repaintHeight)}}};this.pointerExited=function(e){if(this.overTab>=0){this.overTab=-1;if(this.views.over){this.repaint(this.repaintX,this.repaintY,this.repaintWidth,this.repaintHeight)}}};this.next=function(page,d){for(;page>=0&&page<Math.floor(this.pages.length/2);page+=d){if(this.isTabEnabled(page)===true){return page}}return-1};this.getTitleInfo=function(){var b=this.orient==="left"||this.orient==="right",res=b?{x:this.tabAreaX,y:0,width:this.tabAreaWidth,height:0,orient:this.orient}:{x:0,y:this.tabAreaY,width:0,height:this.tabAreaHeight,orient:this.orient};if(this.selectedIndex>=0){var r=this.getTabBounds(this.selectedIndex);if(b){res.y=r.y;res.height=r.height}else{res.x=r.x;res.width=r.width}}return res};this.isTabEnabled=function(index){return this.kids[index].isEnabled};this.paintOnTop=function(g){var ts=g.$states[g.$curState];if(zebkit.util.isIntersect(this.repaintX,this.repaintY,this.repaintWidth,this.repaintHeight,ts.x,ts.y,ts.width,ts.height)){if(this.selectedIndex>0){var r=this.getTabBounds(this.selectedIndex)}var i=0;for(i=0;i<this.selectedIndex;i++){this.paintTab(g,i)}for(i=this.selectedIndex+1;i<Math.floor(this.pages.length/2);i++){this.paintTab(g,i)}if(this.selectedIndex>=0){this.paintTab(g,this.selectedIndex);if(this.hasFocus()){this.drawMarker(g,this.getTabBounds(this.selectedIndex))}}}};this.drawMarker=function(g,r){var marker=this.views.marker;if(marker){var bv=this.views.out,left=bv?bv.getLeft():0,top=bv?bv.getTop():0;marker.paint(g,r.x+left,r.y+top,r.width-left-(bv==null?0:bv.getRight()),r.height-top-(bv==null?0:bv.getBottom()),this)}};this.paintTab=function(g,pageIndex){var b=this.getTabBounds(pageIndex),page=this.kids[pageIndex],tab=this.views.out,tabover=this.views.over,tabon=this.views.selected,v=this.pages[pageIndex*2],ps=v.getPreferredSize();if(this.selectedIndex===pageIndex&&tabon){tabon.paint(g,b.x,b.y,b.width,b.height,page)}else if(tab){tab.paint(g,b.x,b.y,b.width,b.height,page)}if(this.overTab>=0&&this.overTab===pageIndex&&tabover){tabover.paint(g,b.x,b.y,b.width,b.height,page)}v.paint(g,b.x+Math.floor((b.width-ps.width)/2),b.y+Math.floor((b.height-ps.height)/2),ps.width,ps.height,page)};this.getTabBounds=function(i){return this.pages[2*i+1]};this.calcPreferredSize=function(target){var max=zebkit.layout.getMaxPreferredSize(target);if(this.orient==="bottom"||this.orient==="top"){max.width=Math.max(max.width,2*this.sideSpace+this.tabAreaWidth);max.height+=this.tabAreaHeight+this.sideSpace}else{max.width+=this.tabAreaWidth+this.sideSpace;max.height=Math.max(max.height,2*this.sideSpace+this.tabAreaHeight)}return max};this.doLayout=function(target){var right=this.orient==="right"?this.right:this.getRight(),top=this.orient==="top"?this.top:this.getTop(),bottom=this.orient==="bottom"?this.bottom:this.getBottom(),left=this.orient==="left"?this.left:this.getLeft(),b=this.orient==="top"||this.orient==="bottom";if(b){this.repaintX=this.tabAreaX=left;this.repaintY=this.tabAreaY=this.orient==="top"?top:this.height-bottom-this.tabAreaHeight;if(this.orient==="bottom"){this.repaintY-=this.border!==null?this.border.getBottom():0}}else{this.repaintX=this.tabAreaX=this.orient==="left"?left:this.width-right-this.tabAreaWidth;this.repaintY=this.tabAreaY=top;if(this.orient==="right"){this.repaintX-=this.border!==null?this.border.getRight():0}}var count=this.kids.length,sp=2*this.sideSpace,xx=this.orient==="right"?this.tabAreaX:this.tabAreaX+this.sideSpace,yy=this.orient==="bottom"?this.tabAreaY:this.tabAreaY+this.sideSpace,r=null,i=0;for(i=0;i<count;i++){r=this.getTabBounds(i);r.x=xx;r.y=yy;if(b){xx+=r.width;if(i===this.selectedIndex){xx-=sp;if(this.orient==="bottom"){r.y-=this.border!==null?this.border.getBottom():0}}}else{yy+=r.height;if(i===this.selectedIndex){yy-=sp;if(this.orient==="right"){r.x-=this.border!==null?this.border.getRight():0}}}}if(this.selectedIndex>=0){var dt=0;r=this.getTabBounds(this.selectedIndex);if(b){r.x-=this.sideSpace;r.y-=this.orient==="top"?this.sideSpace:0;dt=r.x<left?left-r.x:r.x+r.width>this.width-right?this.width-right-r.x-r.width:0}else{r.x-=this.orient==="left"?this.sideSpace:0;r.y-=this.sideSpace;dt=r.y<top?top-r.y:r.y+r.height>this.height-bottom?this.height-bottom-r.y-r.height:0}for(i=0;i<count;i++){var br=this.getTabBounds(i);if(b)br.x+=dt;else br.y+=dt}}for(i=0;i<count;i++){var l=this.kids[i];if(i===this.selectedIndex){if(b){l.setBounds(left+this.hgap,(this.orient==="top"?top+this.repaintHeight:top)+this.vgap,this.width-left-right-2*this.hgap,this.height-this.repaintHeight-top-bottom-2*this.vgap)}else{l.setBounds((this.orient==="left"?left+this.repaintWidth:left)+this.hgap,top+this.vgap,this.width-this.repaintWidth-left-right-2*this.hgap,this.height-top-bottom-2*this.vgap)}}else{l.setSize(0,0)}}};this.recalc=function(){var count=Math.floor(this.pages.length/2);if(count>0){this.tabAreaHeight=this.tabAreaWidth=0;var bv=this.views.out?this.views.out:null,b=this.orient==="left"||this.orient==="right",max=0,i=0,r=null,hadd=bv===null?0:bv.getLeft()+bv.getRight(),vadd=bv===null?0:bv.getTop()+bv.getBottom();for(i=0;i<count;i++){var ps=this.pages[i*2]!=null?this.pages[i*2].getPreferredSize():{width:0,height:0};r=this.getTabBounds(i);if(b){r.height=ps.height+vadd;if(ps.width+hadd>max)max=ps.width+hadd;this.tabAreaHeight+=r.height}else{r.width=ps.width+hadd;if(ps.height+vadd>max)max=ps.height+vadd;this.tabAreaWidth+=r.width}}for(i=0;i<count;i++){r=this.getTabBounds(i);if(b)r.width=max;else r.height=max}if(b){this.tabAreaWidth=max+this.sideSpace;this.tabAreaHeight+=2*this.sideSpace;this.repaintHeight=this.tabAreaHeight;this.repaintWidth=this.tabAreaWidth+(this.border!==null?this.orient==="left"?this.border.getLeft():this.border.getRight():0)}else{this.tabAreaWidth+=2*this.sideSpace;this.tabAreaHeight=this.sideSpace+max;this.repaintWidth=this.tabAreaWidth;this.repaintHeight=this.tabAreaHeight+(this.border!==null?this.orient==="top"?this.border.getTop():this.border.getBottom():0)}if(this.selectedIndex>=0){r=this.getTabBounds(this.selectedIndex);if(b){r.height+=2*this.sideSpace;r.width+=this.sideSpace+(this.border!==null?this.orient==="left"?this.border.getLeft():this.border.getRight():0)}else{r.height+=this.sideSpace+(this.border!==null?this.orient==="top"?this.border.getTop():this.border.getBottom():0);r.width+=2*this.sideSpace}}}};this.getTabAt=function(x,y){this.validate();if(x>=this.tabAreaX&&y>=this.tabAreaY&&x<this.tabAreaX+this.tabAreaWidth&&y<this.tabAreaY+this.tabAreaHeight){var tb=null;if(this.selectedIndex>=0){tb=this.getTabBounds(this.selectedIndex);if(x>=tb.x&&y>=tb.y&&x<tb.x+tb.width&&y<tb.y+tb.height){return i}}for(var i=0;i<Math.floor(this.pages.length/2);i++){if(this.selectedIndex!==i){tb=this.getTabBounds(i);if(x>=tb.x&&y>=tb.y&&x<tb.x+tb.width&&y<tb.y+tb.height){return i}}}}return-1};this.keyPressed=function(e){if(this.selectedIndex!==-1&&this.pages.length>0){var nxt=0;switch(e.code){case"ArrowUp":case"ArrowLeft":nxt=this.next(this.selectedIndex-1,-1);if(nxt>=0)this.select(nxt);break;case"ArrowDown":case"ArrowRight":nxt=this.next(this.selectedIndex+1,1);if(nxt>=0)this.select(nxt);break}}};this.pointerClicked=function(e){if(e.isAction()){var index=this.getTabAt(e.x,e.y);if(index>=0&&this.isTabEnabled(index))this.select(index)}};this.select=function(index){if(this.selectedIndex!==index){var prev=this.selectedIndex;this.selectedIndex=index;if(prev>=0){this.pages[prev*2].selected(this,prev,false)}if(index>=0){this.pages[index*2].selected(this,index,true)}this._.fired(this,this.selectedIndex);this.vrp()}return this};this.getTab=function(pageIndex){return this.pages[pageIndex*2]};this.setSideSpace=function(sideSpace){if(sideSpace!==this.sideSpace){this.sideSpace=sideSpace;this.vrp()}return this};this.setPageGaps=function(vg,hg){if(this.vgap!==vg||hg!==this.hgap){this.vgap=vg;this.hgap=hg;this.vrp()}return this};this.setAlignment=function(o){if(this.orient!==o){this.orient=zebkit.util.$validateValue(o,"top","bottom","left","right");this.vrp()}return this};this.enableTab=function(i,b){var c=this.kids[i];if(c.isEnabled!==b){c.setEnabled(b);if(b===false&&this.selectedIndex===i){this.select(-1)}this.repaint()}return this}},function focused(){this.$super();if(this.selectedIndex>=0){var r=this.getTabBounds(this.selectedIndex);this.repaint(r.x,r.y,r.width,r.height)}else if(this.hasFocus()===false){this.select(this.next(0,1))}},function kidAdded(index,constr,c){if(this.selectedIndex>=0&&index<=this.selectedIndex){this.selectedIndex++}if(this.selectedIndex<0){this.select(this.next(0,1))}return this.$super(index,constr,c)},function insert(index,constr,c){var render=null;if(zebkit.instanceOf(constr,this.clazz.TabView)){render=constr}else{render=new this.clazz.TabView(constr===null?"Page "+index:constr);render.ownerChanged(this)}this.pages.splice(index*2,0,render,{x:0,y:0,width:0,height:0});var r=this.$super(index,constr,c);this.repaint();return r},function removeAt(i){if(this.selectedIndex>=0&&i<=this.selectedIndex){if(i===this.selectedIndex){this.select(-1)}else{this.selectedIndex--;this.repaint()}}this.pages.splice(i*2,2);return this.$super(i)},function removeAll(){this.select(-1);this.pages.splice(0,this.pages.length);this.pages.length=0;this.$super()},function setSize(w,h){if(this.width!==w||this.height!==h){if(this.orient==="right"||this.orient==="bottom"){this.tabAreaX=-1}this.$super(w,h)}return this}]);pkg.TextField=Class(pkg.Label,[function(render,maxCol){this.history=Array(100);this.historyPos=-1;this.redoCounter=this.undoCounter=this.curY=this.curW=this.curH=0;this.scrollManager=new pkg.ScrollManager(this);if(arguments.length===0){maxCol=-1;render=new pkg.TextRender(new zebkit.data.SingleLineTxt)}else if(arguments.length>1){if(arguments.length===1){if(zebkit.isNumber(render)){maxCol=render;render=null}else{maxCol=-1}}if(zebkit.isString(render)){render=new pkg.TextRender(new zebkit.data.SingleLineTxt(render))}else if(zebkit.instanceOf(render,zebkit.data.TextModel)){render=new pkg.TextRender(render)}}this.$super(render);if(maxCol>0){this.setPSByRowsCols(-1,maxCol)}},function $clazz(){this.HintRender=Class(pkg.StringRender,[])},function $prototype(){this.$blinkTask=null;this.selectionView=this.hint=null;this.vkMode="indirect";this.startLine=this.startCol=this.endLine=this.endCol=this.curX=0;this.startOff=this.endOff=-1;this.selection=this.position=null;this.blinkingPeriod=-1;this.blinkMe=true;this.blinkMeCounter=0;this.cursorType=pkg.Cursor.TEXT;this.textAlign="left";this.curView=null;this.canHaveFocus=this.isEditable=true;this.setBlinking=function(period){if(arguments.length===0){period=500}if(period!==this.blinkingPeriod){this.blinkingPeriod=period;this.repaintCursor()}return this};this.setTextAlignment=function(a){if(this.textAlign!==a){this.textAlign=a;this.vrp()}return this};this.textUpdated=function(src,b,off,size,startLine,lines){if(this.position!==null){if(b===true){if(this.startOff!==this.endOff){var start=this.startOff<this.endOff?this.startOff:this.endOff,end=this.startOff>this.endOff?this.startOff:this.endOff;if(off<=start){start+=size;end+=size}else{if(off<=end){if(off<end)end+=size;off=start}}this.remove(start,end-start)}this.endOff=this.startOff=-1;this.position.inserted(off,size)}else{this.position.removed(off,size)}}};this.getTextRowColAt=function(x,y){var lines=this.getLines();y-=this.scrollManager.getSY()+this.getTop();x-=this.scrollManager.getSX();if(this.textAlign==="left"){x-=this.getLeft()}else{x-=this.width-this.view.getPreferredSize().width-this.getRight()}if(x>=0&&y>=0&&lines>0){var lh=this.view.getLineHeight(),li=this.view.lineIndent,row=y<0?0:Math.floor((y+li)/(lh+li))+((y+li)%(lh+li)>li?1:0)-1;if(row<lines&&row>=0){var s=this.view.getLine(row),pdt=1e6,pcol=-1;for(var col=Math.floor(x/this.view.calcLineWidth(row)*s.length);col>=0&&col<=s.length;){var l=this.view.font.charsWidth(s,0,col),dt=Math.abs(l-x);if(dt>=pdt){return{row:row,col:pcol}}pdt=dt;pcol=col;col+=l>x?-1:1}return{row:row,col:s.length}}}return null};this.findNextWord=function(t,line,col,d){if(line<0||line>=t.getLines()){return null}var ln=t.getLine(line);col+=d;if(col<0&&line>0){return{row:line-1,col:t.getLine(line-1).length}}else if(col>ln.length&&line<t.getLines()-1){return{row:line+1,col:0}}var b=false;for(;col>=0&&col<ln.length;col+=d){if(b){if(d>0){if(zebkit.util.isLetter(ln[col]))return{row:line,col:col}}else{if(!zebkit.util.isLetter(ln[col]))return{row:line,col:col+1}}}else{b=d>0?!zebkit.util.isLetter(ln[col]):zebkit.util.isLetter(ln[col])}}return d>0?{row:line,col:ln.length}:{row:line,col:0}};this.getSubString=function(r,start,end){var res=[],sr=start.row,er=end.row;for(var i=sr;i<er+1;i++){var ln=r.getLine(i);if(i!==sr){res.push("\n")}else{ln=ln.substring(start.col)}if(i===er){ln=ln.substring(0,end.col-(sr===er?start.col:0))}res.push(ln)}return res.join("")};this.removeSelected=function(){if(this.hasSelection()){var start=this.startOff<this.endOff?this.startOff:this.endOff;this.remove(start,(this.startOff>this.endOff?this.startOff:this.endOff)-start);this.clearSelection()}};this.startSelection=function(){if(this.startOff<0&&this.position!==null){var pos=this.position;this.endLine=this.startLine=pos.currentLine;this.endCol=this.startCol=pos.currentCol;this.endOff=this.startOff=pos.offset}};this.keyTyped=function(e){if(this.isEditable===true&&e.ctrlKey===false&&e.metaKey===false&&e.key!=="\t"){this.write(this.position.offset,e.key)}};this.selectAll=function(){this.select(0,this.getMaxOffset());return this};this.shortcutFired=function(e){if(e.shortcut==="SELECTALL"){this.selectAll()}else{var d=e.shortcut==="PREVWORDSELECT"||e.shortcut==="PREVWORD"?-1:1;if(e.shortcut==="PREVWORDSELECT"||e.shortcut==="NEXTWORDSELECT"||e.shortcut==="NEXTPAGESELECT"||e.shortcut==="PREVPAGESELECT"){this.startSelection()}switch(e.shortcut){case"UNDO":this.undo();break;case"REDO":this.redo();break;case"NEXTPAGESELECT":case"NEXTPAGE":this.position.seekLineTo("down",this.pageSize());break;case"PREVPAGESELECT":case"PREVPAGE":this.position.seekLineTo("up",this.pageSize());break;case"NEXTWORDSELECT":case"PREVWORDSELECT":case"PREVWORD":case"NEXTWORD":{var p=this.findNextWord(this.view.target,this.position.currentLine,this.position.currentCol,d);if(p!==null){this.position.setRowCol(p.row,p.col)}}break}}};this.keyPressed=function(e){if(this.isFiltered(e)===false){var position=this.position;if(e.shiftKey){this.startSelection()}switch(e.code){case"ArrowDown":position.seekLineTo("down");break;case"ArrowUp":position.seekLineTo("up");break;case"ArrowLeft":if(e.ctrlKey===false&&e.metaKey===false){position.seek(-1)}break;case"ArrowRight":if(e.ctrlKey===false&&e.metaKey===false){position.seek(1)}break;case"End":if(e.ctrlKey){position.seekLineTo("down",this.getLines()-position.currentLine-1)}else{position.seekLineTo("end")}break;case"Home":if(e.ctrlKey){position.seekLineTo("up",position.currentLine)}else{position.seekLineTo("begin")}break;case"PageDown":position.seekLineTo("down",this.pageSize());break;case"PageUp":position.seekLineTo("up",this.pageSize());break;case"Delete":if(this.hasSelection()&&this.isEditable===true){this.removeSelected()}else{if(this.isEditable===true){this.remove(position.offset,1)}}break;case"Backspace":if(this.isEditable===true){if(this.hasSelection()){this.removeSelected()}else{if(this.isEditable===true&&position.offset>0){position.seek(-1);this.remove(position.offset,1)}}}break;default:return}if(e.shiftKey===false){this.clearSelection()}}};this.isFiltered=function(e){var code=e.code;return code==="Shift"||code==="Control"||code==="Tab"||code==="Alt"||e.altKey};this.remove=function(pos,size){if(this.isEditable===true){var position=this.position;if(pos>=0&&pos+size<=this.getMaxOffset()){if(size<1e4){this.historyPos=(this.historyPos+1)%this.history.length;this.history[this.historyPos]=[-1,pos,this.getValue().substring(pos,pos+size)];if(this.undoCounter<this.history.length)this.undoCounter++}if(this.view.target.remove(pos,size)){this.repaint();return true}}}return false};this.write=function(pos,s){if(this.isEditable===true){if(s.length<1e4){this.historyPos=(this.historyPos+1)%this.history.length;this.history[this.historyPos]=[1,pos,s.length];if(this.undoCounter<this.history.length){this.undoCounter++}}if(this.view.target.write(s,pos)){this.repaint();return true}}return false};this.recalc=function(){var r=this.view;if(this.position.offset>=0){var l=r.getLine(this.position.currentLine);if(this.textAlign==="left"){this.curX=r.font.charsWidth(l,0,this.position.currentCol)+this.getLeft()}else{this.curX=this.width-this.getRight()-this.view.getPreferredSize().width+r.font.charsWidth(l,0,this.position.currentCol)}this.curY=this.position.currentLine*(r.getLineHeight()+r.lineIndent)+this.getTop()}this.curH=r.getLineHeight()-1};this.catchScrolled=function(psx,psy){this.repaint()};this.drawCursor=function(g){if(this.position.offset>=0&&this.curView!==null&&this.blinkMe&&this.hasFocus()){if(this.textAlign==="left"){this.curView.paint(g,this.curX,this.curY,this.curW,this.curH,this)}else{this.curView.paint(g,this.curX-this.curW,this.curY,this.curW,this.curH,this)}}};this.pointerDragStarted=function(e){if(e.isAction()&&this.getMaxOffset()>0){this.startSelection()}};this.pointerDragEnded=function(e){if(e.isAction()&&this.hasSelection()===false){this.clearSelection()}};this.pointerDragged=function(e){if(e.isAction()){var p=this.getTextRowColAt(e.x,e.y);if(p!==null)this.position.setRowCol(p.row,p.col)}};this.select=function(startOffset,endOffset){if(endOffset<startOffset||startOffset<0||endOffset>this.getMaxOffset()){throw new Error("Invalid selection offsets")}if(this.startOff!==startOffset||endOffset!==this.endOff){if(startOffset===endOffset){this.clearSelection()}else{this.startOff=startOffset;var p=this.position.getPointByOffset(startOffset);this.startLine=p[0];this.startCol=p[1];this.endOff=endOffset;p=this.position.getPointByOffset(endOffset);this.endLine=p[0];this.endCol=p[1];this.repaint()}}return this};this.hasSelection=function(){return this.startOff!==this.endOff};this.posChanged=function(target,po,pl,pc){this.recalc();var position=this.position;if(position.offset>=0){this.blinkMeCounter=0;this.blinkMe=true;var lineHeight=this.view.getLineHeight(),top=this.getTop();this.scrollManager.makeVisible(this.textAlign==="left"?this.curX:this.curX-this.curW,this.curY,this.curW,lineHeight);if(pl>=0){if(this.startOff>=0){this.endLine=position.currentLine;this.endCol=position.currentCol;this.endOff=position.offset}var minUpdatedLine=pl<position.currentLine?pl:position.currentLine,li=this.view.lineIndent,bottom=this.getBottom(),left=this.getLeft(),y1=lineHeight*minUpdatedLine+minUpdatedLine*li+top+this.scrollManager.getSY();if(y1<top){y1=top}if(y1<this.height-bottom){var h=((pl>position.currentLine?pl:position.currentLine)-minUpdatedLine+1)*(lineHeight+li);if(y1+h>this.height-bottom){h=this.height-bottom-y1}this.repaint(left,y1,this.width-left-this.getRight(),h)}}else{this.repaint()}}};this.paintOnTop=function(g){if(this.hint!==null&&this.getMaxOffset()===0){var ps=this.hint.getPreferredSize(),yy=Math.floor((this.height-ps.height)/2),xx="left"===this.textAlign?this.getLeft()+this.curW:this.width-ps.width-this.getRight()-this.curW;this.hint.paint(g,xx,yy,this.width,this.height,this)}};this.setHint=function(hint){this.hint=zebkit.isString(hint)?new this.clazz.HintRender(hint):pkg.$view(hint);this.repaint();return this};this.undo=function(){if(this.undoCounter>0){var h=this.history[this.historyPos];this.historyPos--;if(h[0]===1){this.remove(h[1],h[2])}else{this.write(h[1],h[2])}this.undoCounter-=2;this.redoCounter++;this.historyPos--;if(this.historyPos<0){this.historyPos=this.history.length-1}this.repaint()}return this};this.redo=function(){if(this.redoCounter>0){var h=this.history[(this.historyPos+1)%this.history.length];if(h[0]===1)this.remove(h[1],h[2]);else this.write(h[1],h[2]);this.redoCounter--;this.repaint()}return this};this.getStartSelection=function(){return this.startOff!==this.endOff?this.startOff<this.endOff?{row:this.startLine,col:this.startCol}:{row:this.endLine,col:this.endCol}:null};this.getEndSelection=function(){return this.startOff!==this.endOff?this.startOff<this.endOff?{row:this.endLine,col:this.endCol}:{row:this.startLine,col:this.startCol}:null};this.getSelectedText=function(){return this.startOff!==this.endOff?this.getSubString(this.view,this.getStartSelection(),this.getEndSelection()):null};this.getLines=function(){return this.position===null?-1:this.position.metrics.getLines()};this.getMaxOffset=function(){return this.position===null?-1:this.position.metrics.getMaxOffset()};this.focusGained=function(e){if(this.position.offset<0){this.position.setOffset(this.textAlign==="left"||this.getLines()>1?0:this.getMaxOffset())}else{if(this.hint!==null){this.repaint()}else{this.repaintCursor()}}if(this.isEditable===true&&this.blinkingPeriod>0){this.blinkMeCounter=0;this.blinkMe=true;var $this=this;this.$blinkTask=zebkit.util.tasksSet.run(function(){$this.blinkMeCounter=($this.blinkMeCounter+1)%3;if($this.blinkMeCounter===0){$this.blinkMe=!$this.blinkMe;$this.repaintCursor()}},~~(this.blinkingPeriod/3),~~(this.blinkingPeriod/3))}};this.focusLost=function(e){this.repaintCursor();if(this.isEditable===true){if(this.hint!==null)this.repaint();if(this.blinkingPeriod>0){if(this.$blinkTask!==null){this.$blinkTask.shutdown();this.$blinkTask=null}this.blinkMe=true}}};this.repaintCursor=function(){if(this.curX>0&&this.curW>0&&this.curH>0){this.repaint(this.curX+this.scrollManager.getSX(),this.curY+this.scrollManager.getSY(),this.curW,this.curH)}};this.clearSelection=function(){if(this.startOff>=0){var b=this.hasSelection();this.endOff=this.startOff=-1;if(b){this.repaint()}}return this};this.pageSize=function(){var height=this.height-this.getTop()-this.getBottom(),indent=this.view.lineIndent,textHeight=this.view.getLineHeight();return((height+indent)/(textHeight+indent)+.5|0)+((height+indent)%(textHeight+indent)>indent?1:0)};this.clipPaste=function(txt){if(txt!==null){this.removeSelected();this.write(this.position.offset,txt)}};this.clipCopy=function(){return this.getSelectedText()};this.cut=function(){var t=this.getSelectedText();if(this.isEditable===true)this.removeSelected();return t};this.setPosition=function(p){if(this.position!==p){if(this.position!==null){this.position.off(this)}this.position=p;if(this.position!==null){this.position.on(this)}this.invalidate()}return this};this.setCursorView=function(v){this.curW=1;this.curView=pkg.$view(v);this.vrp();return this};this.setPSByRowsCols=function(r,c){var tr=this.view,w=c>0?tr.font.stringWidth("W")*c:this.psWidth,h=r>0?r*tr.getLineHeight()+(r-1)*tr.lineIndent:this.psHeight;this.setPreferredSize(w,h);return this};this.setEditable=function(b){if(b!==this.isEditable){this.isEditable=b;if(b&&this.blinkingPeriod>0&&this.hasFocus()){if(this.$blinkTask!==null){this.$blinkTask.shutdown()}this.blinkMe=true}this.vrp()}return this};this.pointerDoubleClicked=function(e){if(e.isAction()){this.select(0,this.getMaxOffset())}};this.pointerPressed=function(e){if(e.isAction()){if(e.shiftKey){this.startSelection()}else{this.clearSelection()}var p=this.getTextRowColAt(e.x,e.y);if(p!==null)this.position.setRowCol(p.row,p.col)}};this.setSelectionView=function(c){if(c!=this.selectionView){this.selectionView=pkg.$view(c);if(this.hasSelection()){this.repaint()}}return this};this.calcPreferredSize=function(t){var ps=this.view.getPreferredSize();ps.width+=this.curW;return ps};this.paint=function(g){var sx=this.scrollManager.getSX(),sy=this.scrollManager.getSY(),l=this.getLeft(),t=this.getTop(),r=this.getRight();try{g.translate(sx,sy);if(this.textAlign==="left"){this.view.paint(g,l,t,this.width-l-r,this.height-t-this.getBottom(),this)}else{this.view.paint(g,this.width-r-this.view.getPreferredSize().width,t,this.width-l-r,this.height-t-this.getBottom(),this)}this.drawCursor(g)}catch(e){g.translate(-sx,-sy);throw e}g.translate(-sx,-sy)}},function setView(v){if(v!=this.view){if(this.view!==null&&this.view.target!==null&&typeof this.view.target.on!=="undefined"){this.view.target.off(this)}this.$super(v);if(this.position===null){this.setPosition(new zebkit.util.Position(this.view))}else{this.position.setMetric(this.view)}if(this.view!==null&&this.view.target!==null&&typeof this.view.target.on!=="undefined"){this.view.target.on(this)}}return this},function setValue(s){var txt=this.getValue();if(txt!==s){if(this.position!==null){this.position.setOffset(0)}this.scrollManager.scrollTo(0,0);this.$super(s)}return this},function setEnabled(b){this.clearSelection();this.$super(b);return this}]);pkg.TextArea=Class(pkg.TextField,[function(txt){if(arguments.length===0)txt="";this.$super(new zebkit.data.Text(txt))}]);pkg.PassTextField=Class(pkg.TextField,[function(txt,size,showLast){if(arguments.length===1){showLast=false;size=-1;if(zebkit.isBoolean(txt)){showLast=txt;txt=""}else if(zebkit.isNumber(txt)){size=txt;txt=""}}else if(arguments.length===0){showLast=false;size=-1;txt=""}else if(arguments.length===2){showLast=false}var pt=new pkg.PasswordText(new zebkit.data.SingleLineTxt(txt,size));pt.showLast=showLast;this.$super(pt);if(size>0){this.setPSByRowsCols(-1,size)}},function setShowLast(b){if(this.showLast!==b){this.view.showLast=b;this.repaint()}return this}]);pkg.BaseList=Class(pkg.Panel,zebkit.util.Position.Metric,pkg.$ViewsSetterMix,[function(m,b){if(arguments.length===0){m=[];b=false}else if(arguments.length===1){if(zebkit.isBoolean(m)){b=m;m=[]}else{b=false}}else{if(m===null)m=[]}this.selectedIndex=-1;this._=new this.clazz.Listeners;this.isComboMode=b;this.scrollManager=new pkg.ScrollManager(this);this.$super();this.setPosition(new zebkit.util.Position(this));this.setModel(m)},function $clazz(){this.Listeners=zebkit.util.ListenersClass("selected")},function $prototype(){this.scrollManager=this.position=this.model=null;this.canHaveFocus=true;this.setValue=function(v){if(v===null){this.select(-1)}else if(this.model!==null){for(var i=0;i<this.model.count();i++){if(this.model.get(i)===v&&this.isItemSelectable(i)){this.select(i);return i}}}return-1};this.getValue=function(){return this.getSelected()};this.isItemSelectable=function(i){return true};this.getSelected=function(){return this.selectedIndex<0?null:this.model.get(this.selectedIndex)};this.lookupItem=function(ch){var count=this.model===null?0:this.model.count();if(zebkit.util.isLetter(ch)&&count>0){var index=this.selectedIndex<0?0:this.selectedIndex+1;ch=ch.toLowerCase();for(var i=0;i<count-1;i++){var idx=(index+i)%count,item=this.model.get(idx).toString();if(this.isItemSelectable(idx)&&item.length>0&&item[0].toLowerCase()===ch){return idx}}}return-1};this.isSelected=function(i){return i===this.selectedIndex};this.$pointerMoved=function(x,y){if(this.isComboMode===true&&this.model!==null){var index=this.getItemIdxAt(x,y);if(index!==this.position.offset&&(index<0||this.isItemSelectable(index)===true)){this.$triggeredByPointer=true;if(index<0)this.position.setOffset(null);else this.position.setOffset(index);this.notifyScrollMan(index);this.$triggeredByPointer=false}}};this.getItemLocation=function(index){this.validate();var y=this.getTop()+this.scrollManager.getSY();for(var i=0;i<index;i++){y+=this.getItemSize(i).height}return{x:this.getLeft(),y:y}};this.getItemSize=function(i){throw new Error("Not implemented")};this.getLines=function(){return this.model===null?0:this.model.count()};this.getLineSize=function(l){return 1};this.getMaxOffset=function(){return this.getLines()-1};this.catchScrolled=function(psx,psy){this.repaint()};this.getItemIdxAt=function(x,y){return-1};this.calcMaxItemSize=function(){var maxH=0,maxW=0;this.validate();if(this.model!==null){for(var i=0;i<this.model.count();i++){var is=this.getItemSize(i);if(is.height>maxH)maxH=is.height;if(is.width>maxW)maxW=is.width}}return{width:maxW,height:maxH}};this.repaintByOffsets=function(p,n){this.validate();var xx=this.width-this.getRight(),l=0,count=this.model===null?0:this.model.count();if(p>=0&&p<count){l=this.getItemLocation(p);this.repaint(l.x,l.y,xx-l.x,this.getItemSize(p).height)}if(n>=0&&n<count){l=this.getItemLocation(n);this.repaint(l.x,l.y,xx-l.x,this.getItemSize(n).height)}};this.drawViewAt=function(g,id,index){if(index>=0&&this.views.hasOwnProperty(id)&&this.views[id]!==null&&this.isItemSelectable(index)){var is=this.getItemSize(index),l=this.getItemLocation(index);this.drawView(g,id,this.views[id],l.x,l.y,is.width,is.height)}};this.drawView=function(g,id,v,x,y,w,h){this.views[id].paint(g,x,y,w,h,this)};this.update=function(g){if(this.isComboMode===true||this.hasFocus()===true){this.drawViewAt(g,"marker",this.position.offset)}this.drawViewAt(g,"select",this.selectedIndex)};this.paintOnTop=function(g){if(this.isComboMode===true||this.hasFocus()){this.drawViewAt(g,"top.marker",this.position.offset)}};this.select=function(index){if(index===null||typeof index==="undefined"){throw new Error("Null index")}if(this.model!==null&&index>=this.model.count()){throw new RangeError(index)}if(this.selectedIndex!==index){if(index<0||this.isItemSelectable(index)){var prev=this.selectedIndex;this.selectedIndex=index;this.notifyScrollMan(index);this.repaintByOffsets(prev,this.selectedIndex);this.fireSelected(prev)}}else{this.fireSelected(null)}};this.fireSelected=function(prev){this._.selected(this,prev)};this.pointerClicked=function(e){if(this.model!==null&&e.isAction()&&this.model.count()>0){this.$select(this.position.offset<0?0:this.position.offset)}};this.pointerReleased=function(e){if(this.model!==null&&this.model.count()>0&&e.isAction()&&this.position.offset!==this.selectedIndex){this.position.setOffset(this.selectedIndex)}};this.pointerPressed=function(e){if(e.isAction()&&this.model!==null&&this.model.count()>0){var index=this.getItemIdxAt(e.x,e.y);if(index>=0&&this.position.offset!==index&&this.isItemSelectable(index)){this.position.setOffset(index)}}};this.pointerDragged=this.pointerMoved=this.pointerEntered=function(e){this.$pointerMoved(e.x,e.y)};this.pointerExited=function(e){this.$pointerMoved(-10,-10)};this.pointerDragEnded=function(e){if(this.model!==null&&this.model.count()>0&&this.position.offset>=0){this.select(this.position.offset<0?0:this.position.offset)}};this.keyPressed=function(e){if(this.model!==null&&this.model.count()>0){var po=this.position.offset;switch(e.code){case"End":if(e.ctrlKey){this.position.setOffset(this.position.metrics.getMaxOffset())}else{this.position.seekLineTo("end")}break;case"Home":if(e.ctrlKey)this.position.setOffset(0);else this.position.seekLineTo("begin");break;case"ArrowRight":this.position.seek(1);break;case"ArrowDown":this.position.seekLineTo("down");break;case"ArrowLeft":this.position.seek(-1);break;case"ArrowUp":this.position.seekLineTo("up");break;case"PageUp":this.position.seek(this.pageSize(-1));break;case"PageDown":this.position.seek(this.pageSize(1));break;case"Space":case"Enter":this.$select(this.position.offset);break}}};this.$select=function(o){this.select(o)};this.keyTyped=function(e){var i=this.lookupItem(e.key);if(i>=0)this.$select(i)};this.elementInserted=function(target,e,index){this.invalidate();if(this.selectedIndex>=0&&this.selectedIndex>=index){this.selectedIndex++}this.position.inserted(index,1);this.repaint()};this.elementRemoved=function(target,e,index){this.invalidate();if(this.selectedIndex===index||this.model.count()===0){this.select(-1)}else{if(this.selectedIndex>index){this.selectedIndex--}}this.position.removed(index,1);this.repaint()};this.elementSet=function(target,e,pe,index){if(this.selectedIndex===index){this.select(-1)}this.vrp()};this.findSelectable=function(off,d){var c=this.model.count(),i=0,dd=Math.abs(d);while(this.isItemSelectable(off)===false&&i<c){off=(c+off+d)%c;i+=dd}return i<c?off:-1};this.posChanged=function(target,prevOffset,prevLine,prevCol){var off=this.position.offset;if(off>=0){off=this.findSelectable(off,prevOffset<off?1:-1);if(off!==this.position.offset){this.position.setOffset(off);this.repaintByOffsets(prevOffset,off);return}}if(this.isComboMode===true){this.notifyScrollMan(off)}else{this.select(off)}this.repaintByOffsets(prevOffset,off)};this.setModel=function(m){if(m!==this.model){if(m!==null&&Array.isArray(m)){m=new zebkit.data.ListModel(m)}if(this.model!==null&&typeof this.model._!=="undefined"){this.model.off(this)}this.model=m;if(this.model!==null&&typeof this.model._!=="undefined"){this.model.on(this)}this.vrp()}return this};this.setPosition=function(c){if(c!==this.position){if(this.position!==null){this.position.off(this)}this.position=c;this.position.on(this);this.position.setMetric(this);this.repaint()}return this};this.setViewProvider=function(v){if(this.provider!==v){if(typeof v==="function"){var o=new zebkit.Dummy;o.getView=v;v=o}this.provider=v;this.vrp()}return this};this.notifyScrollMan=function(index){if(index>=0&&this.scrollManager!==null){this.validate();var is=this.getItemSize(index);if(is.width>0&&is.height>0){var l=this.getItemLocation(index);this.scrollManager.makeVisible(l.x-this.scrollManager.getSX(),l.y-this.scrollManager.getSY(),is.width,is.height)}}};this.pageSize=function(d){var offset=this.position.offset;if(offset>=0){var vp=pkg.$cvp(this,{});if(vp!==null){var sum=0,i=offset;for(;i>=0&&i<=this.position.metrics.getMaxOffset()&&sum<vp.height;i+=d){sum+=this.getItemSize(i).height}return i-offset-d}}return 0}},function focused(){this.$super();this.repaint()}]);pkg.List=Class(pkg.BaseList,[function(m,b){this.firstVisible=-1;this.firstVisibleY=this.psWidth_=this.psHeight_=0;this.visValid=false;this.setViewProvider(new this.clazz.ViewProvider);this.$supera(arguments)},function $clazz(){this.ViewProvider=Class([function(f,c){this.render=new pkg.StringRender("");zebkit.properties(this,this.clazz);if(arguments.length>0)this.render.setFont(f);if(arguments.length>1)this.render.setColor(c)},function $prototype(){this.setColor=function(c){this.render.setColor(c);return this};this.setFont=function(f){this.render.setFont(f);return this};this.getView=function(target,value,i){if(value!==null){if(typeof value.toView!=="undefined")return value.toView();if(typeof value.paint!=="undefined")return value;this.render.setValue(value.toString());return this.render}else{return null}}}])},function $prototype(){this.heights=this.widths=this.vArea=null;this.gap=2;this.setItemGap=function(g){if(this.gap!==g){this.gap=g;this.vrp()}return this};this.paint=function(g){this.vVisibility();if(this.firstVisible>=0){var sx=this.scrollManager.getSX(),sy=this.scrollManager.getSY();try{g.translate(sx,sy);var y=this.firstVisibleY,x=this.getLeft(),yy=this.vArea.y+this.vArea.height-sy,count=this.model.count(),dg=this.gap*2;for(var i=this.firstVisible;i<count;i++){if(i!==this.selectedIndex&&typeof this.provider.getCellColor==="function"){var bc=this.provider.getCellColor(this,i);if(bc!==null){g.setColor(bc);g.fillRect(x,y,this.width,this.heights[i])}}this.provider.getView(this,this.model.get(i),i).paint(g,x+this.gap,y+this.gap,this.widths[i]-dg,this.heights[i]-dg,this);y+=this.heights[i];if(y>yy)break}g.translate(-sx,-sy)}catch(e){g.translate(-sx,-sy);throw e}}};this.recalc=function(){this.psWidth_=this.psHeight_=0;if(this.model!==null){var count=this.model.count();if(this.heights===null||this.heights.length!==count){this.heights=Array(count)}if(this.widths===null||this.widths.length!==count){this.widths=Array(count)}var provider=this.provider;if(provider!==null){var dg=2*this.gap;for(var i=0;i<count;i++){var ps=provider.getView(this,this.model.get(i),i).getPreferredSize();this.heights[i]=ps.height+dg;this.widths[i]=ps.width+dg;if(this.widths[i]>this.psWidth_){this.psWidth_=this.widths[i]}this.psHeight_+=this.heights[i]}}}};this.calcPreferredSize=function(l){return{width:this.psWidth_,height:this.psHeight_}};this.vVisibility=function(){this.validate();var prev=this.vArea;this.vArea=pkg.$cvp(this,{});if(this.vArea===null){this.firstVisible=-1}else{if(this.visValid===false||(prev===null||prev.x!==this.vArea.x||prev.y!==this.vArea.y||prev.width!==this.vArea.width||prev.height!==this.vArea.height)){var top=this.getTop();if(this.firstVisible>=0){var dy=this.scrollManager.getSY();while(this.firstVisibleY+dy>=top&&this.firstVisible>0){this.firstVisible--;this.firstVisibleY-=this.heights[this.firstVisible]}}else{this.firstVisible=0;this.firstVisibleY=top}if(this.firstVisible>=0){var count=this.model===null?0:this.model.count(),hh=this.height-this.getBottom();for(;this.firstVisible<count;this.firstVisible++){var y1=this.firstVisibleY+this.scrollManager.getSY(),y2=y1+this.heights[this.firstVisible]-1;if(y1>=top&&y1<hh||y2>=top&&y2<hh||y1<top&&y2>=hh){break}this.firstVisibleY+=this.heights[this.firstVisible]}if(this.firstVisible>=count)this.firstVisible=-1}this.visValid=true}}};this.getItemLocation=function(index){this.validate();var y=this.getTop()+this.scrollManager.getSY();for(var i=0;i<index;i++){y+=this.heights[i]}return{x:this.getLeft(),y:y}};this.getItemSize=function(i){this.validate();return{width:this.widths[i],height:this.heights[i]}};this.getItemIdxAt=function(x,y){this.vVisibility();if(this.vArea!==null&&this.firstVisible>=0){var yy=this.firstVisibleY+this.scrollManager.getSY(),hh=this.height-this.getBottom(),count=this.model.count();for(var i=this.firstVisible;i<count;i++){if(y>=yy&&y<yy+this.heights[i]){return i}yy+=this.heights[i];if(yy>hh)break}}return-1}},function invalidate(){this.visValid=false;this.firstVisible=-1;this.$super()},function drawView(g,id,v,x,y,w,h){this.$super(g,id,v,x,y,this.width-this.getRight()-x,h)},function catchScrolled(psx,psy){this.firstVisible=-1;this.visValid=false;this.$super(psx,psy)}]);pkg.CompList=Class(pkg.BaseList,[function(m,b){this.model=this;this.setViewProvider(new zebkit.Dummy([function $prototype(){this.render=new pkg.CompRender;this.getView=function(target,obj,i){this.render.setTarget(obj);return this.render}}]));this.$supera(arguments)},function $clazz(){this.Label=Class(pkg.Label,[]);this.ImageLabel=Class(pkg.ImageLabel,[]);this.Listeners=this.$parent.Listeners.ListenersClass("elementInserted","elementRemoved","elementSet")},function $prototype(){this.max=null;this.get=function(i){if(i<0||i>=this.kids.length){throw new RangeError(i)}return this.kids[i]};this.contains=function(c){return this.indexOf(c)>=0};this.count=function(){return this.kids.length};this.catchScrolled=function(px,py){};this.getItemLocation=function(i){return{x:this.kids[i].x,y:this.kids[i].y}};this.getItemSize=function(i){return this.kids[i].isVisible===false?{width:0,height:0}:{width:this.kids[i].width,height:this.kids[i].height}};this.recalc=function(){this.max=zebkit.layout.getMaxPreferredSize(this)};this.calcMaxItemSize=function(){this.validate();return{width:this.max.width,height:this.max.height}};this.getItemIdxAt=function(x,y){return zebkit.layout.getDirectAt(x,y,this)};this.isItemSelectable=function(i){return this.model.get(i).isVisible===true&&this.model.get(i).isEnabled===true};this.catchInput=function(child){if(this.isComboMode!==true){var p=child;while(p!==this){if(p.stopCatchInput===true)return false;p=p.parent}}return true};this.setModel=function(m){if(Array.isArray(m)){for(var i=0;i<m.length;i++){this.add(m[i])}}else{throw new Error("Invalid comp list model")}return this}},function setPosition(c){if(c!==this.position){if(zebkit.instanceOf(this.layout,zebkit.util.Position.Metric)){c.setMetric(this.layout)}this.$super(c)}return this},function setLayout(layout){if(layout!==this.layout){this.scrollManager=new pkg.ScrollManager(this,[function $prototype(){this.calcPreferredSize=function(t){return layout.calcPreferredSize(t)};this.doLayout=function(t){layout.doLayout(t);for(var i=0;i<t.kids.length;i++){var kid=t.kids[i];if(kid.isVisible===true){kid.setLocation(kid.x+this.getSX(),kid.y+this.getSY())}}};this.scrollStateUpdated=function(sx,sy,px,py){this.target.vrp()}}]);this.$super(this.scrollManager);if(this.position!==null){this.position.setMetric(zebkit.instanceOf(layout,zebkit.util.Position.Metric)?layout:this)}}return this},function setAt(i,item){if(i<0||i>=this.kids.length){throw new RangeError(i)}return this.$super(i,item)},function insert(i,constr,e){if(arguments.length===2){e=constr;constr=null}if(i<0||i>this.kids.length){throw new RangeError(i)}return this.$super(i,constr,zebkit.instanceOf(e,pkg.Panel)?e:new this.clazz.Label(""+e))},function kidAdded(index,constr,e){this.$super(index,constr,e);this.model._.elementInserted(this,e,index)},function kidRemoved(index,e){this.$super(index,e);this.model._.elementRemoved(this,e,index)}]);pkg.Combo=Class(pkg.Panel,[function(list,editable){if(arguments.length===1&&zebkit.isBoolean(list)){editable=list;list=null}if(arguments.length===0){editable=false}if(arguments.length===0||list===null){list=new this.clazz.List(true)}if(zebkit.instanceOf(list,pkg.BaseList)===false){list=list.length>0&&zebkit.instanceOf(list[0],pkg.Panel)?new this.clazz.CompList(list,true):new this.clazz.List(list,true)}this.maxPadHeight=0;this.$lockListSelEvent=false;this._=new this.clazz.Listeners;this.setList(list);this.$super();this.add("center",editable?new this.clazz.EditableContentPan:new this.clazz.ReadonlyContentPan);this.add("right",new this.clazz.Button)},function $clazz(){this.Listeners=zebkit.util.ListenersClass("selected");this.ContentPan=Class(pkg.Panel,[function $prototype(){this.comboValueUpdated=function(combo,value){};this.getCombo=function(){for(var p=this.parent;p!==null&&zebkit.instanceOf(p,pkg.Combo)===false;p=p.parent);return p}}]);this.ComboPadPan=Class(pkg.ScrollPan,[function $prototype(){this.$closeTime=0;this.adjustToComboSize=true;this.owner=null;this.childKeyPressed=function(e){if(e.code==="Escape"&&this.parent!==null){this.removeMe();if(this.owner!==null)this.owner.requestFocus()}}},function setParent(l){this.$super(l);if(l===null&&this.owner!==null){this.owner.requestFocus()}this.$closeTime=l===null?(new Date).getTime():0}]);this.ReadonlyContentPan=Class(this.ContentPan,[function $prototype(){this.calcPsByContent=false;this.getCurrentView=function(){var list=this.getCombo().list,selected=list.getSelected();return selected!==null?list.provider.getView(list,selected,list.selectedIndex):null};this.paintOnTop=function(g){var v=this.getCurrentView();if(v!==null){var ps=v.getPreferredSize();v.paint(g,this.getLeft(),this.getTop()+Math.floor((this.height-this.getTop()-this.getBottom()-ps.height)/2),this.width,ps.height,this)}};this.setCalcPsByContent=function(b){if(this.calcPsByContent!==b){this.calcPsByContent=b;this.vrp()}return this};this.calcPreferredSize=function(l){var p=this.getCombo();if(p!==null&&this.calcPsByContent!==true){return p.list.calcMaxItemSize()}var cv=this.getCurrentView();return cv===null?{width:0,height:0}:cv.getPreferredSize()};this.comboValueUpdated=function(combo,value){if(this.calcPsByContent===true)this.invalidate()}}]);this.EditableContentPan=Class(this.ContentPan,[function $clazz(){this.TextField=Class(pkg.TextField,[]);this.Listeners=zebkit.util.ListenersClass("contentUpdated")},function $prototype(){this.canHaveFocus=true;this.textUpdated=function(src,b,off,size,startLine,lines){if(this.dontGenerateUpdateEvent===false){this._.contentUpdated(this,this.textField.getValue())}};this.comboValueUpdated=function(combo,v){this.dontGenerateUpdateEvent=true;try{var txt=v===null?"":v.toString();this.textField.setValue(txt);this.textField.select(0,txt.length)}finally{this.dontGenerateUpdateEvent=false}}},function focused(){this.$super();this.textField.requestFocus()},function(){this.$super();this._=new this.clazz.Listeners;this.isEditable=true;this.dontGenerateUpdateEvent=false;this.textField=new this.clazz.TextField("",-1);this.textField.view.target.on(this);this.add("center",this.textField)}]);this.Button=Class(pkg.Button,[function(){this.setFireParams(true,-1);this.$super()}]);this.List=Class(pkg.List,[]);this.CompList=Class(pkg.CompList,[])},function $prototype(){this.list=null;this.selectionView=this.button=this.content=this.winpad=null;this.paint=function(g){if(this.content!==null&&this.selectionView!==null&&this.hasFocus()){this.selectionView.paint(g,this.content.x,this.content.y,this.content.width,this.content.height,this)}};this.catchInput=function(child){return child!==this.button&&(this.content===null||this.content.isEditable!==true)};this.canHaveFocus=function(){return this.winpad.parent===null&&(this.content!==null&&this.content.isEditable!==true)};this.contentUpdated=function(src,text){if(src===this.content){try{this.$lockListSelEvent=true;if(text===null){this.list.select(-1)}else{var m=this.list.model;for(var i=0;i<m.count();i++){var mv=m.get(i);if(mv!==text){this.list.select(i);break}}}}finally{this.$lockListSelEvent=false}this._.selected(this,text)}};this.select=function(i){this.list.select(i);return this};this.setSelectedIndex=function(i){this.select(i);return this};this.setValue=function(v){return this.list.setValue(v)};this.getValue=function(){return this.list.getValue()};this.pointerPressed=function(e){if(e.isAction()&&this.content!==null&&(new Date).getTime()-this.winpad.$closeTime>100&&e.x>this.content.x&&e.y>this.content.y&&e.x<this.content.x+this.content.width&&e.y<this.content.y+this.content.height){this.showPad()}};this.isPadShown=function(){return this.winpad!==null&&this.winpad.parent!==null&&this.winpad.isVisible===true};this.hidePad=function(){var d=this.getCanvas();if(d!==null&&this.winpad.parent!==null){this.winpad.removeMe();this.requestFocus()}return this};this.showPad=function(){var canvas=this.getCanvas();if(canvas!==null){var ps=this.winpad.getPreferredSize(),p=zebkit.layout.toParentOrigin(0,0,this.winpad.adjustTo==null?this:this.winpad.adjustTo),py=p.y;if(this.maxPadHeight>0&&ps.height>this.maxPadHeight){ps.height=this.maxPadHeight}if(py+this.height+ps.height>canvas.height){if(py-ps.height>=0){py-=ps.height+this.height}else{var hAbove=canvas.height-py-this.height;if(py>hAbove){ps.height=py;py-=ps.height+this.height}else{ps.height=hAbove}}}this.winpad.setBounds(p.x,py+(this.winpad.adjustTo==null?this.height:this.winpad.adjustTo.height),this.winpad.adjustTo==null?this.winpad.adjustToComboSize===true?this.width:ps.width:this.winpad.adjustTo.width,ps.height);this.list.notifyScrollMan(this.list.selectedIndex);canvas.getLayer(pkg.PopupLayerMix.id).add(this,this.winpad);this.list.requestFocus();if(typeof this.padShown!=="undefined"){this.padShown(true)}return this}};this.setList=function(l){if(this.list!==l){this.hidePad();if(this.list!==null)this.list.off(this);this.list=l;if(typeof this.list._!=="undefined")this.list.on(this);var $this=this;this.winpad=new this.clazz.ComboPadPan(this.list,[function setParent(p){this.$super(p);if(typeof $this.padShown!=="undefined"){$this.padShown($this,p!==null)}}]);this.winpad.owner=this;if(this.content!==null){this.content.comboValueUpdated(this,this.list.getSelected())}this.vrp()}return this};this.keyPressed=function(e){if(this.list!==null&&this.list.model!==null){var index=this.list.selectedIndex;switch(e.code){case"Enter":this.showPad();break;case"ArrowLeft":case"ArrowUp":if(index>0)this.list.select(index-1);break;case"ArrowDown":case"ArrowRight":if(this.list.model.count()-1>index)this.list.select(index+1);break}}};this.keyTyped=function(e){this.list.keyTyped(e)};this.setSelectionView=function(c){if(c!==this.selectionView){this.selectionView=pkg.$view(c);this.repaint()}return this};this.setMaxPadHeight=function(h){if(this.maxPadHeight!==h){this.hidePad();this.maxPadHeight=h}return this};this.setEditable=function(b){if(this.content===null||this.content.isEditable!==b){var ctr="center";if(this.content!==null){ctr=this.content.constraints;this.content.removeMe()}this.add(ctr,b?new this.clazz.EditableContentPan:new this.clazz.ReadonlyContentPan)}return this};this.fired=function(src){if((new Date).getTime()-this.winpad.$closeTime>100){this.showPad()}};this.selected=function(src,data){if(this.$lockListSelEvent===false){this.hidePad();if(this.content!==null){this.content.comboValueUpdated(this,this.list.getSelected());if(this.content.isEditable===true){this.content.requestFocus()}this.repaint()}this._.selected(this,data)}}},function focused(){this.$super();this.repaint()},function kidAdded(index,s,c){if(zebkit.instanceOf(c,pkg.Combo.ContentPan)){if(this.content!==null){throw new Error("Content panel is set")}this.content=c;if(this.list!==null){c.comboValueUpdated(this,this.list.getSelected())}}else if(this.button===null){this.button=c}if(zebkit.instanceOf(c,zebkit.util.Fireable)){c.on(this)}this.$super(index,s,c)},function kidRemoved(index,l){if(zebkit.instanceOf(l,zebkit.util.Fireable)){l.off(this)}if(this.content===l){this.content=null}else if(this.button===l){this.button=null}this.$super(index,l)},function setVisible(b){if(b===false){this.hidePad()}this.$super(b);return this},function setParent(p){if(p===null)this.hidePad();this.$super(p)}]);pkg.events.regEvents("menuItemSelected");pkg.MenuEvent=Class(zebkit.util.Event,[function $prototype(){this.index=-1;this.item=null;this.$fillWith=function(src,index,item){this.source=src;this.index=index;this.item=item;return this}}]);var MENU_EVENT=new pkg.MenuEvent;pkg.showPopupMenu=function(context,menu){context.getCanvas().getLayer(pkg.PopupLayerMix.id).add(menu)};pkg.MenuItem=Class(pkg.Panel,[function(c){this.$super();this.add(new this.clazz.CheckStatePan);if(zebkit.isString(c)){var m=c.match(/(\s*\@\(.*\)\s*)?(\s*\[\s*\]|\s*\[\s*x\s*\]|\s*\(\s*x\s*\)|\s*\(\s*\))?\s*(.*)/);if(m===null){throw new Error("Invalid menu item: "+c)}if(typeof m[2]!=="undefined"){var s=m[2].trim();this.setCheckManager(s[0]==="("?new pkg.Group:new pkg.SwitchManager);this.manager.setValue(this,m[2].indexOf("x")>0)}var img=null;if(typeof m[1]!=="undefined"){img=m[1].substring(m[1].indexOf("@(")+2,m[1].lastIndexOf(")")).trim();if(img[0]==="'"){img=img.substring(1,img.length-1)}else{var parts=img.split("."),scope=zebkit.$global;img=null;for(var i=0;i<parts.length;i++){scope=scope[parts[i]];if(typeof scope==="undefined"||scope===null){break}}img=scope}}c=m[3];m=c.match(/(.*)\s*\[\s*@([a-zA-Z_][a-zA-Z0-9_]+)\s*]\s*/);if(m!==null){this.id=m[2].trim();c=m[1].trim()}else{this.id=c.toLowerCase().replace(/[ ]+/,"_")}c=new pkg.ImageLabel(new this.clazz.Label(c),img)}else{this.getCheck().setVisible(false)}this.add(c);this.add(new this.clazz.SubImage);this.setEnabled(c.isEnabled);this.setVisible(c.isVisible)},function $clazz(){this.SubImage=Class(pkg.StatePan,[]);this.Label=Class(pkg.Label,[]);this.CheckStatePan=Class(pkg.ViewPan,[])},function $prototype(){this.gap=8;this.manager=null;this.itemSelected=function(){var content=this.getContent();if(zebkit.instanceOf(content,pkg.Checkbox)){content.setValue(!content.getValue())}if(this.manager!==null){this.manager.setValue(this,!this.manager.getValue(this))}};this.setIcon=function(img){this.getContent().setImage(img);return this};this.setCaption=function(caption){this.getContent().setCaption(caption);return this};this.switched=function(b){this.kids[0].view.activate(b?this.isEnabled===true?"on":"on.disabled":"off",this)};this.getCheck=function(){return this.kids[0]};this.getContent=function(){return this.kids.length>0?this.kids[1]:null};this.getSub=function(){return this.kids.length>1?this.kids[2]:null};this.hideSub=function(){this.getSub().setVisible(false)};this.activateSub=function(b){var kid=this.getSub();kid.setState(b?"arrow":"*");if(this.parent!==null&&this.parent.noSubIfEmpty===true){kid.setVisible(b)}};this.calcPreferredSize=function(target){var cc=0,pw=0,ph=0;for(var i=0;i<target.kids.length;i++){var k=target.kids[i];if(k.isVisible===true){var ps=k.getPreferredSize();pw+=ps.width+(cc>0?this.gap:0);if(ps.height>ph)ph=ps.height;cc++}}return{width:pw,height:ph}};this.doLayout=function(target){var left=this.getCheck(),right=this.getSub(),content=this.getContent(),t=target.getTop(),l=target.getLeft(),eh=target.height-t-target.getBottom(),ew=target.width-l-target.getRight();if(left!==null&&left.isVisible===true){left.toPreferredSize();left.setLocation(l,t+Math.floor((eh-left.height)/2));l+=this.gap+left.width;ew-=this.gap+left.width}if(right!==null&&right.isVisible===true){right.toPreferredSize();right.setLocation(target.width-target.getRight()-right.width,t+Math.floor((eh-right.height)/2));ew-=this.gap+right.width}if(content!==null&&content.isVisible===true){content.toPreferredSize();if(content.width>ew){content.setSize(ew,content.height)}content.setLocation(l,t+Math.floor((eh-content.height)/2))}};this.setCheckState=function(b){if(this.manager===null){this.setCheckManager(new pkg.SwitchManager)}this.manager.setValue(this,b);return this};this.getCheckState=function(){return this.manager.getValue(this)};this.setCheckManager=function(man){if(this.manager!==man){if(this.manager!==null){this.manager.uninstall(this)}this.manager=man;this.manager.install(this)}return this}},function setParent(p){this.$super(p);if(p!==null&&p.noSubIfEmpty===true){this.getSub().setVisible(false)}},function setEnabled(b){this.$super(b);if(this.manager!==null){this.switched(this.manager.getValue(this))}return this}]).hashable();pkg.Menu=Class(pkg.CompList,[function(d){this.menus={};this.$super([],zebkit.isBoolean(d)?d:true);if(Array.isArray(d)){for(var i=0;i<d.length;i++){this.add(d[i])}}else{for(var k in d){if(d.hasOwnProperty(k)){var sub=d[k];this.add(k);if(sub!=null){this.setMenuAt(this.kids.length-1,zebkit.instanceOf(sub,pkg.Menu)?sub:new pkg.Menu(sub))}}}}},function $clazz(){this.MenuItem=Class(pkg.MenuItem,[function $clazz(){this.Label=Class(pkg.MenuItem.Label,[])}]);this.Line=Class(pkg.Line,[]);this.Line.prototype.$isDecorative=true},function $prototype(){this.$parentMenu=null;this.canHaveFocus=true;this.noSubIfEmpty=false;this.isDecorative=function(i){return this.kids[i].$isDecorative===true||this.kids[i].$$isDecorative===true};this.childCompEnabled=this.childCompShown=function(e){var src=e.source;for(var i=0;i<this.kids.length;i++){if(this.kids[i]===src){if(this.isItemSelectable(i)===false){if(i===this.selectedIndex)this.select(-1)}break}}};this.getMenuItem=function(i){if(zebkit.isString(i)===true){var item=this.byPath(i);if(item!==null)return item;for(var k in this.menus){item=this.menus[k].getMenuItem(i);if(item!==null)return item}}return this.kids[i]};this.hasSelectableItems=function(){for(var i=0;i<this.kids.length;i++){if(this.isItemSelectable(i))return true}return false};this.pointerExited=function(e){this.position.setOffset(null)};this.getMenuAt=function(index){if(index<this.kids.length){var hash=this.kids[index].$hash$;return this.menus.hasOwnProperty(hash)?this.menus[hash]:null}else{return null}};this.setMenuAt=function(i,m){if(m===this){throw new Error("Menu cannot be sub-menu of its own")}if(this.isDecorative(i)){throw new Error("Decorative element cannot have a sub-menu")}var p=this.kids[i];if(typeof p.activateSub!=="undefined"){var sub=this.menus[p];if(m!==null){if(sub==null){p.activateSub(true)}}else if(sub!=null){p.activateSub(false)}}if(this.parent!==null&&i===this.selectedIndex){this.select(-1)}if(typeof p.$hash$==="undefined"){throw new Error("Invalid key")}this.menus[p]=m;return this};this.indexMenuOf=function(menu){for(var i=0;i<this.kids.length;i++){if(this.menus[this.kids[i]]===menu){return i}}return-1};this.$canceled=function(m){if(this.$parentMenu!==null&&typeof this.$canceled!=="undefined"){this.$parentMenu.$canceled(m)}};this.$topMenu=function(){if(this.parent!==null){var t=this,p=null;while((p=t.$parentMenu)!==null)t=p;return t}return null};this.doScroll=function(dx,dy,source){var sy=this.scrollManager.getSY(),ps=this.layout.calcPreferredSize(this),eh=this.height-this.getTop()-this.getBottom();if(this.height<ps.height&&sy+ps.height>=eh&&sy-dy<=0){var nsy=sy-dy;if(nsy+ps.height<eh){nsy=eh-ps.height}if(sy!==nsy)this.scrollManager.scrollYTo(nsy)}};this.$hideMenu=function(){if(this.parent!==null){var ch=this.$childMenu();if(ch!==null){ch.$hideMenu()}this.removeMe();this.select(-1)}};this.$childMenu=function(){if(this.parent!==null){for(var k in this.menus){var m=this.menus[k];if(m.$parentMenu===this){return m}}}return null};this.$showSubMenu=function(sub){sub.setLocation(this.x+this.width-10,this.y+this.kids[this.selectedIndex].y);sub.toPreferredSize();this.parent.add(sub);sub.requestFocus()};this.triggerSelectionByPos=function(i){return this.getMenuAt(i)!==null&&this.$triggeredByPointer===true}},function keyPressed(e){if(e.code==="Escape"){if(this.parent!==null){var p=this.$parentMenu;this.$canceled(this);this.$hideMenu();if(p!==null)p.requestFocus()}}else{this.$super(e)}},function insert(i,ctr,c){if(zebkit.isString(c)){return this.$super(i,ctr,c.match(/^\-+$/)!==null?new this.clazz.Line:new this.clazz.MenuItem(c))}return this.$super(i,ctr,c)},function setParent(p){if(p!==null){this.select(-1);this.position.setOffset(null)}else{this.$parentMenu=null}this.$super(p)},function addDecorative(c){if(c.$isDecorative!==true){c.$$isDecorative=true}this.$getSuper("insert").call(this,this.kids.length,null,c)},function kidRemoved(i,c){if(typeof c.$$isDecorative!=="undefined"){delete c.$$isDecorative}this.setMenuAt(i,null);this.$super(i,c)},function isItemSelectable(i){return this.$super(i)&&this.isDecorative(i)===false},function posChanged(target,prevOffset,prevLine,prevCol){var off=target.offset;if(off>=0){var rs=null;if(this.selectedIndex>=0&&off!==this.selectedIndex){var sub=this.getMenuAt(this.selectedIndex);if(sub!==null){sub.$hideMenu();rs=-1;this.requestFocus()}}if(this.parent!==null&&off!==this.selectedIndex&&this.isItemSelectable(off)){if(this.triggerSelectionByPos(off))rs=off}if(rs!==null){this.select(rs)}}this.$super(target,prevOffset,prevLine,prevCol)},function fireSelected(prev){if(this.parent!==null){var sub=null;if(this.selectedIndex>=0){sub=this.getMenuAt(this.selectedIndex);if(sub!==null){if(sub.parent!==null){sub.$hideMenu()}else{sub.$parentMenu=this;this.$showSubMenu(sub)}}else{var k=this.kids[this.selectedIndex];if(typeof k.itemSelected!=="undefined"){k.itemSelected();pkg.events.fire("menuItemSelected",MENU_EVENT.$fillWith(this,this.selectedIndex,this.kids[this.selectedIndex]))}var top=this.$topMenu();if(top!==null){top.$hideMenu()}}}else if(prev>=0){sub=this.getMenuAt(prev);if(sub!==null&&sub.parent!==null){sub.$hideMenu()}pkg.events.fire("menuItemSelected",MENU_EVENT.$fillWith(this,this.selectedIndex,this.kids[prev]))}}this.$super(prev)}]);pkg.Menubar=Class(pkg.Menu,[function $clazz(){this.MenuItem=Class(pkg.MenuItem,[function $clazz(){this.Label=Class(pkg.MenuItem.Label,[])},function(c){this.$super(c);this.hideSub();this.getCheck().setVisible(false)}])},function $prototype(){this.canHaveFocus=false;this.triggerSelectionByPos=function(i){return this.isItemSelectable(i)&&this.selectedIndex>=0};this.$hideMenu=function(){var child=this.$childMenu();if(child!==null){child.$hideMenu()}this.select(-1)};this.$showSubMenu=function(menu){var d=this.getCanvas(),k=this.kids[this.selectedIndex],pop=d.getLayer(pkg.PopupLayer.id);if(menu.hasSelectableItems()){var abs=zebkit.layout.toParentOrigin(0,0,k);menu.setLocation(abs.x,abs.y+k.height+1);menu.toPreferredSize();pop.add(menu);menu.requestFocus()}}},function $canceled(m){this.select(-1)},function $select(i){if(this.selectedIndex>=0&&this.selectedIndex===i){i=-1}this.$super(i)}]);pkg.PopupLayerLayout=Class(zebkit.layout.Layout,[function $prototype(){this.calcPreferredSize=function(target){return{width:0,height:0}};this.doLayout=function(target){for(var i=0;i<target.kids.length;i++){var m=target.kids[i];if(zebkit.instanceOf(m,pkg.Menu)){var ps=m.getPreferredSize(),xx=m.x+ps.width>target.width?target.width-ps.width:m.x,yy=m.y+ps.height>target.height?target.height-ps.height:m.y;m.setSize(ps.width,ps.height);if(xx<0)xx=0;if(yy<0)yy=0;m.setLocation(xx,yy)}}}}]);pkg.PopupLayerMix=zebkit.Interface([function $clazz(){this.id="popup"},function $prototype(){this.$prevFocusOwner=null;this.getFocusRoot=function(){return this};this.childFocusGained=function(e){if(zebkit.instanceOf(e.source,pkg.Menu)){if(e.related!==null&&zebkit.layout.isAncestorOf(this,e.related)===false){this.$prevFocusOwner=e.related}}else{this.$prevFocusOwner=null}if(e.related!==null&&zebkit.layout.isAncestorOf(this,e.related)===false&&zebkit.instanceOf(e.source,pkg.Menu)){this.$prevFocusOwner=e.related}};this.isTriggeredWith=function(e){return e.isAction()===false&&(e.identifier==="rmouse"||e.touchCounter===2)};this.childKeyPressed=function(e){var p=e.source.$parentMenu;if(typeof p!=="undefined"&&p!==null){switch(e.code){case"ArrowRight":if(p.selectedIndex<p.model.count()-1){p.requestFocus();p.position.seekLineTo("down")}break;case"ArrowLeft":if(p.selectedIndex>0){p.requestFocus();p.position.seekLineTo("up")}break}}};this.$topMenu=function(){if(this.kids.length>0){for(var i=this.kids.length-1;i>=0;i--){if(zebkit.instanceOf(this.kids[i],pkg.Menu)){return this.kids[i].$topMenu()}}}return null};this.compRemoved=function(e){if(this.$prevFocusOwner!==null&&this.kids.length===0&&zebkit.instanceOf(e.kid,pkg.Menu)){this.$prevFocusOwner.requestFocus();this.$prevFocusOwner=null}};this.layerPointerClicked=function(e){if(this.kids.length===0&&this.isTriggeredWith(e)){var popup=null;if(typeof e.source.popup!=="undefined"&&e.source.popup!==null){popup=e.source.popup}else if(typeof e.source.getPopup!=="undefined"){popup=e.source.getPopup(e.source,e.x,e.y)}if(popup!==null){popup.setLocation(e.absX,e.absY);this.add(popup);popup.requestFocus()}return true}return false}},function layerPointerPressed(e){if(this.kids.length>0){if(this.$getSuper("getComponentAt").call(this,e.x,e.y)===this){var top=this.$topMenu();if(top!==null){if(zebkit.instanceOf(top,pkg.Menubar)){var origin=zebkit.layout.toParentOrigin(top);if(e.x>=origin.x&&e.y>=origin.y&&e.x<origin.x+top.width&&e.y<origin.y+top.height){return}}top.$hideMenu()}if(this.kids.length>0){this.removeAll()}}}},function getComponentAt(x,y){if(this.kids.length>0){var comp=this.$super(x,y);if(comp!==this){return comp}}return null}]);pkg.PopupLayer=Class(pkg.Panel,pkg.PopupLayerMix,[]);pkg.events.regEvents("winOpened","winActivated");pkg.WinEvent=Class(zebkit.util.Event,[function $prototype(){this.isShown=false;this.isActive=false;this.layer=null;this.$fillWith=function(src,layer,isActive,isShown){this.source=src;this.layer=layer;this.isActive=isActive;this.isShown=isShown;return this}}]);var WIN_EVENT=new pkg.WinEvent;pkg.showModalWindow=function(context,win){pkg.showWindow(context,"modal",win)};pkg.showWindow=function(context,type,win){if(arguments.length<3){win=type;type="info"}return context.getCanvas().getLayer("win").addWin(type,win)};pkg.activateWindow=function(win){var l=win.getCanvas().getLayer("win");l.activate(zebkit.layout.getDirectChild(l,win))};pkg.WinLayerMix=zebkit.Interface([function $clazz(){this.id="win"},function $prototype(){this.activeWin=null;this.topModalIndex=-1;this.layerPointerPressed=function(e){if(this.kids.length>0){if(this.activeWin!==null){if(this.indexOf(this.activeWin)===this.kids.length-1){var x1=this.activeWin.x,y1=this.activeWin.y,x2=x1+this.activeWin.width,y2=y1+this.activeWin.height;if(e.x>=x1&&e.y>=y1&&e.x<=x2&&e.y<=y2){return false}}}for(var i=this.kids.length-1;i>=0&&i>=this.topModalIndex;i--){var d=this.kids[i];if(d.isVisible===true&&d.isEnabled===true&&d.winType!=="info"&&e.x>=d.x&&e.y>=d.y&&e.x<d.x+d.width&&e.y<d.y+d.height){if(d!==this.activeWin){this.activate(d);return true}else{return false}}}if(this.topModalIndex<0&&this.activeWin!==null){this.activate(null);return false}return this.topModalIndex>=0}return false};this.layerKeyPressed=function(e){if(this.kids.length>0&&e.code==="Tab"&&e.shiftKey===true){if(this.activeWin===null){this.activate(this.kids[this.kids.length-1])}else{var winIndex=this.kids.indexOf(this.activeWin)-1;if(winIndex<this.topModalIndex||winIndex<0){winIndex=this.kids.length-1}this.activate(this.kids[winIndex])}return true}return false};this.childFocusGained=function(e){this.activate(zebkit.layout.getDirectChild(this,e.source))};this.getFocusRoot=function(){return this.activeWin};this.getWinType=function(w){return w.winType};this.activate=function(c){if(c!==null&&(this.kids.indexOf(c)<0||c.winType==="info")){throw new Error("Window cannot be activated")}if(c!==this.activeWin){var old=this.activeWin;if(c===null){var type=this.activeWin.winType;if(type==="modal"){throw new Error("Modal window cannot be de-activated")}this.activeWin=null;pkg.events.fire("winActivated",WIN_EVENT.$fillWith(old,this,false,false));if(type==="mdi"&&old.$dontGrabFocus!==true){pkg.focusManager.requestFocus(null)}}else{if(this.kids.indexOf(c)<this.topModalIndex){throw new Error}this.activeWin=c;this.activeWin.toFront();if(old!==null){pkg.events.fire("winActivated",WIN_EVENT.$fillWith(old,this,false,false))}pkg.events.fire("winActivated",WIN_EVENT.$fillWith(c,this,true,false));this.activeWin.validate();if(this.activeWin.winType==="mdi"&&this.activeWin.$dontGrabFocus!==true){var newFocusable=pkg.focusManager.findFocusable(this.activeWin);pkg.focusManager.requestFocus(newFocusable)}}}};this.addWin=function(type,win){if(arguments.length>1){win.winType=type}this.add(win)};this.getComponentAt=function(x,y){return this.activeWin===null?null:this.activeWin.getComponentAt(x-this.activeWin.x,y-this.activeWin.y)}},function kidAdded(index,constr,lw){this.$super(index,constr,lw);if(typeof lw.winType==="undefined"){lw.winType="mdi"}else{zebkit.util.$validateValue(lw.winType,"mdi","modal","info")}if(lw.winType==="modal"){this.topModalIndex=this.kids.length-1;pkg.events.fire("winOpened",WIN_EVENT.$fillWith(lw,this,false,true));this.activate(lw)}else{pkg.events.fire("winOpened",WIN_EVENT.$fillWith(lw,this,false,true))}},function kidRemoved(index,lw){this.$getSuper("kidRemoved").call(this,index,lw);if(this.activeWin===lw){this.activeWin=null;if(lw.winType==="mdi"&&lw.$dontGrabFocus!==true){pkg.focusManager.requestFocus(null)}}var ci=this.kids.indexOf(lw);if(ci<this.topModalIndex){this.topModalIndex--}else if(this.topModalIndex===ci){for(this.topModalIndex=this.kids.length-1;this.topModalIndex>=0;this.topModalIndex--){if(this.kids[this.topModalIndex].winType==="modal"){break}}}pkg.events.fire("winOpened",WIN_EVENT.$fillWith(lw,this,false,false));if(this.topModalIndex>=0){var aindex=this.kids.length-1;while(this.kids[aindex].winType==="info"){aindex--}this.activate(this.kids[aindex])}}]);pkg.WinLayer=Class(pkg.Panel,pkg.WinLayerMix,[]);pkg.Window=Class(pkg.StatePan,[function(s,c){this.state="inactive";this.prevH=this.prevX=this.prevY=0;this.px=this.py=this.dx=this.dy=0;this.prevW=this.action=-1;this.root=c===null||arguments.length<2?this.createContentPan():c;this.caption=this.createCaptionPan();this.title=this.createTitle();this.title.setValue(s===null||arguments.length===0?"":s);this.icons=new pkg.Panel(new zebkit.layout.FlowLayout("left","center","horizontal",2));this.icons.add(new this.clazz.Icon);this.buttons=new pkg.Panel(new zebkit.layout.FlowLayout("center","center"));this.caption.add("center",this.title);this.caption.add("left",this.icons);this.caption.add("right",this.buttons);this.status=new this.clazz.StatusPan;this.sizer=new this.clazz.SizerPan;this.status.add(this.sizer);this.setSizeable(true);this.$super();this.setLayout(new zebkit.layout.BorderLayout(2,2));this.add("center",this.root);this.add("top",this.caption);this.add("bottom",this.status)},function $clazz(){this.CaptionPan=Class(pkg.StatePan,[function $prototype(){this.state="inactive"}]);this.TitleLab=Class(pkg.Label,[]);this.StatusPan=Class(pkg.Panel,[]);this.ContentPan=Class(pkg.Panel,[]);this.SizerPan=Class(pkg.ViewPan,[]);this.Icon=Class(pkg.ImagePan,[]);this.Button=Class(pkg.Button,[])},function $prototype(){var MOVE_ACTION=1,SIZE_ACTION=2;this.sizer=this.caption=null;this.isPopupEditor=true;this.minSize=40;this.isSizeable=true;this.isActive=function(){var c=this.getCanvas();return c!==null&&c.getLayer("win").activeWin===this.getWinContainer()};this.pointerDragStarted=function(e){this.px=e.absX;this.py=e.absY;this.action=this.insideCorner(e.x,e.y)?this.isSizeable?SIZE_ACTION:-1:MOVE_ACTION;if(this.action>0){this.dy=this.dx=0}};this.pointerDragged=function(e){if(this.action>0){var container=null;if(this.action!==MOVE_ACTION){container=this.getWinContainer();var nw=this.dx+container.width,nh=this.dy+container.height;if(nw>this.minSize&&nh>this.minSize){container.setSize(nw,nh)}}this.dx=e.absX-this.px;this.dy=e.absY-this.py;this.px=e.absX;this.py=e.absY;if(this.action===MOVE_ACTION){container=this.getWinContainer();container.setLocation(this.dx+container.x,this.dy+container.y)}}};this.pointerDragEnded=function(e){if(this.action>0){if(this.action===MOVE_ACTION){var container=this.getWinContainer();container.setLocation(this.dx+container.x,this.dy+container.y)}this.action=-1}};this.getWinContainer=function(){return this};this.insideCorner=function(px,py){return this.getComponentAt(px,py)===this.sizer};this.getCursorType=function(target,x,y){return this.isSizeable&&this.insideCorner(x,y)?pkg.Cursor.SE_RESIZE:null};this.catchInput=function(c){var tp=this.caption;return c===tp||zebkit.layout.isAncestorOf(tp,c)&&zebkit.instanceOf(c,pkg.Button)===false||this.sizer===c};this.winOpened=function(e){var state=this.isActive()?"active":"inactive";if(this.caption!==null&&typeof this.caption.setState!=="undefined"){this.caption.setState(state)}this.setState(state)};this.winActivated=function(e){this.winOpened(e)};this.pointerDoubleClicked=function(e){var x=e.x,y=e.y,cc=this.caption;if(this.isSizeable===true&&x>cc.x&&x<cc.y+cc.width&&y>cc.y&&y<cc.y+cc.height){if(this.prevW<0)this.maximize();else this.restore()}};this.isMaximized=function(){return this.prevW!==-1};this.createCaptionPan=function(){return new this.clazz.CaptionPan};this.createContentPan=function(){return new this.clazz.ContentPan};this.createTitle=function(){return new this.clazz.TitleLab};this.setIcon=function(i,icon){if(zebkit.isString(icon)||zebkit.instanceOf(icon,pkg.Picture)){icon=new pkg.ImagePan(icon)}this.icons.setAt(i,icon);return this};this.setSizeable=function(b){if(this.isSizeable!==b){this.isSizeable=b;if(this.sizer!==null){this.sizer.setVisible(b)}}return this};this.maximize=function(){if(this.prevW<0){var d=this.getCanvas(),cont=this.getWinContainer(),left=d.getLeft(),top=d.getTop();this.prevX=cont.x;this.prevY=cont.y;this.prevW=cont.width;this.prevH=cont.height;cont.setBounds(left,top,d.width-left-d.getRight(),d.height-top-d.getBottom())}return this};this.restore=function(){if(this.prevW>=0){this.getWinContainer().setBounds(this.prevX,this.prevY,this.prevW,this.prevH);this.prevW=-1}return this};this.close=function(){this.getWinContainer().removeMe();return this};this.setButtons=function(buttons){for(var i=0;i<this.buttons.length;i++){var kid=this.buttons.kids[i];if(zebkit.instanceOf(kid,zebkit.util.Fireable)){kid.off()}}this.buttons.removeAll();for(var k in buttons){if(buttons.hasOwnProperty(k)){var b=new this.clazz.Button;b.properties(buttons[k]);this.buttons.add(b);(function(t,f){b.on(function(){f.call(t)})})(this,this[k])}}return this}},function focused(){this.$super();if(this.caption!==null){this.caption.repaint()}}]);pkg.Tooltip=Class(pkg.Panel,[function(content){this.$super();if(arguments.length>0){this.add(pkg.$component(content,this));this.toPreferredSize()}},function $clazz(){this.Label=Class(pkg.Label,[]);this.ImageLabel=Class(pkg.ImageLabel,[]);this.TooltipBorder=Class(pkg.View,[function(col,size){if(arguments.length>0)this.color=col;if(arguments.length>1)this.size=size;this.gap=2*this.size},function $prototype(){this.color="black";this.size=2;this.paint=function(g,x,y,w,h,d){if(this.color!==null){this.outline(g,x,y,w,h,d);g.setColor(this.color);g.lineWidth=this.size;g.stroke()}};this.outline=function(g,x,y,w,h,d){g.beginPath();h-=2*this.size;w-=2*this.size;x+=this.size;y+=this.size;var w2=w/2+.5|0,w3_8=3*w/8+.5|0,h2_3=2*h/3+.5|0,h3=h/3+.5|0,w4=w/4+.5|0;g.moveTo(x+w2,y);g.quadraticCurveTo(x,y,x,y+h3);g.quadraticCurveTo(x,y+h2_3,x+w4,y+h2_3);g.quadraticCurveTo(x+w4,y+h,x,y+h);g.quadraticCurveTo(x+w3_8,y+h,x+w2,y+h2_3);g.quadraticCurveTo(x+w,y+h2_3,x+w,y+h3);g.quadraticCurveTo(x+w,y,x+w2,y);g.closePath();return true}}])},function recalc(){this.$contentPs=this.kids.length===0?this.$super():this.kids[0].getPreferredSize()},function getBottom(){return this.$super()+this.$contentPs.height},function getTop(){return this.$super()+(this.$contentPs.height/6+.5|0)},function getLeft(){return this.$super()+(this.$contentPs.height/6+.5|0)},function getRight(){return this.$super()+(this.$contentPs.height/6+.5|0)}]);pkg.TooltipManager=Class(pkg.Manager,[function $prototype(){this.$tooltipX=this.$tooltipY=0;this.$toolTask=this.$targetTooltipLayer=this.$tooltip=this.$target=null;this.hideTooltipByPress=true;this.showTooltipIn=400;this.syncTooltipPosition=true;this.pointerEntered=function(e){if(this.$target===null&&(typeof e.source.tooltip!=="undefined"&&e.source.tooltip!==null||typeof e.source.getTooltip!=="undefined")){var $this=this;this.$target=e.source;this.$targetTooltipLayer=e.source.getCanvas().getLayer("win");this.$tooltipX=e.x;this.$tooltipY=e.y;this.$toolTask=zebkit.util.tasksSet.run(this,this.showTooltipIn,this.showTooltipIn)}};this.pointerExited=function(e){if(this.$target!==null&&(this.$tooltip===null||this.$tooltip.winType==="info")){this.stopShowingTooltip()}};this.pointerMoved=function(e){if(this.$target===e.source){this.$tooltipX=e.x;this.$tooltipY=e.y;if(this.$toolTask!==null){this.$toolTask.resume(this.showTooltipIn)}}};this.run=function(t){if(this.$target!==null){var ntooltip=typeof this.$target.tooltip!=="undefined"&&this.$target.tooltip!==null?this.$target.tooltip:this.$target.getTooltip(this.$target,this.$tooltipX,this.$tooltipY),p=null,tx=0,ty=0;if(this.$tooltip!==ntooltip){if(this.$tooltip!==null){this.hideTooltip()}this.$tooltip=ntooltip;if(ntooltip!==null){p=zebkit.layout.toParentOrigin(this.$tooltipX,this.$tooltipY,this.$target);this.$tooltip.toPreferredSize();tx=p.x;ty=p.y-this.$tooltip.height;var dw=this.$targetTooltipLayer.width;if(tx+this.$tooltip.width>dw){tx=dw-this.$tooltip.width-1}this.$tooltip.setLocation(tx<0?0:tx,ty<0?0:ty);if(typeof this.$tooltip.winType==="undefined"){this.$tooltip.winType="info"}this.$targetTooltipLayer.add(this.$tooltip);if(this.$tooltip.winType!=="info"){pkg.activateWindow(this.$tooltip)}}}else{if(this.$tooltip!==null&&this.syncTooltipPosition===true){p=zebkit.layout.toParentOrigin(this.$tooltipX,this.$tooltipY,this.$target);tx=p.x;ty=p.y-this.$tooltip.height;this.$tooltip.setLocation(tx<0?0:tx,ty<0?0:ty)}}}t.pause()};this.winActivated=function(e){if(e.isActive===false&&this.$tooltip!==null){this.$tooltip.removeMe()}};this.winOpened=function(e){if(e.isShown===false){this.$tooltip=null;if(e.source.winType!=="info"){this.stopShowingTooltip()}}};this.stopShowingTooltip=function(){if(this.$target!==null){this.$target=null}if(this.$toolTask!==null){this.$toolTask.shutdown()}this.hideTooltip()};this.hideTooltip=function(){if(this.$tooltip!==null){this.$tooltip.removeMe();this.$tooltip=null}};this.pointerPressed=function(e){if(this.hideTooltipByPress===true&&e.pointerType==="mouse"&&this.$target!==null&&(this.$tooltip===null||this.$tooltip.winType==="info")){this.stopShowingTooltip()}};this.pointerReleased=function(e){if((this.hideTooltipByPress===false||e.pointerType!=="mouse")&&this.$target!==null&&(this.$tooltip===null||this.$tooltip.winType==="info")){this.stopShowingTooltip()}}}]);pkg.$configWith(pkg)});zebkit.package("ui.tree",function(pkg,Class){"use strict";var ui=pkg.cd("..");pkg.$IM=function(b){this.width=this.height=this.x=this.y=this.viewHeight=0;this.viewWidth=-1;this.isOpen=b};pkg.DefEditors=Class([function(){this.tf=new this.clazz.TextField(new zebkit.data.SingleLineTxt(""))},function $clazz(){this.TextField=Class(ui.TextField,[])},function $prototype(){this.getEditor=function(src,item){var o=item.value;this.tf.setValue(o===null?"":o.toString());return this.tf};this.fetchEditedValue=function(src,editor){return editor.view.target.getValue()};this.shouldStartEdit=function(src,e){return e.id==="pointerDoubleClicked"||e.id==="keyPressed"&&e.code==="Enter"}}]);pkg.DefViews=Class([function(color,font){this.render=new ui.StringRender("");zebkit.properties(this,this.clazz);if(arguments.length>0&&color!==null){this.setColor(color)}if(arguments.length>1&&font!==null){this.setFont(font)}},function $prototype(){this.getView=function(tree,item){if(item.value&&typeof item.value.paint!=="undefined"){return item.value}this.render.setValue(item.value===null?"<null>":item.value);return this.render};this.setFont=function(f){this.render.setFont(f);return this};this.setColor=function(c){this.render.setColor(c);return this}}]);pkg.BaseTree=Class(ui.Panel,[function(d,b){if(arguments.length<2){b=true}this.maxw=this.maxh=0;this.views={};this.viewSizes={};this._isVal=false;this.nodes={};this._=new this.clazz.Listeners;this.setLineColor("gray");this.isOpenVal=b;this.setSelectable(true);this.$super();this.setModel(d);this.scrollManager=new ui.ScrollManager(this)},function $clazz(){this.Listeners=zebkit.util.ListenersClass("toggled","selected","editingStarted","editingStopped")},function $prototype(){this.visibleArea=this.lnColor=null;this.model=this.selected=this.firstVisible=null;this.gapx=this.gapy=2;this.canHaveFocus=true;this.isOpen=function(i){this.validate();return this.$isOpen(i)};this.getItemMetrics=function(i){this.validate();return this.getIM(i)};this.togglePressed=function(root){this.toggle(root)};this.itemPressed=function(root,e){this.select(root)};this.pointerPressed=function(e){if(this.firstVisible!==null&&e.isAction()){var x=e.x,y=e.y,root=this.getItemAt(this.firstVisible,x,y);if(root!==null){x-=this.scrollManager.getSX();y-=this.scrollManager.getSY();var r=this.getToggleBounds(root);if(x>=r.x&&x<r.x+r.width&&y>=r.y&&y<r.y+r.height){this.togglePressed(root)}else{if(x>r.x+r.width)this.itemPressed(root,e)}}}};this.vVisibility=function(){if(this.model===null){this.firstVisible=null}else{var nva=ui.$cvp(this,{});if(nva===null){this.firstVisible=null}else{if(this._isVal===false||(this.visibleArea===null||this.visibleArea.x!==nva.x||this.visibleArea.y!==nva.y||this.visibleArea.width!==nva.width||this.visibleArea.height!==nva.height)){this.visibleArea=nva;if(this.firstVisible!==null){this.firstVisible=this.findOpened(this.firstVisible);this.firstVisible=this.isOverVisibleArea(this.firstVisible)?this.nextVisible(this.firstVisible):this.prevVisible(this.firstVisible)}else{this.firstVisible=-this.scrollManager.getSY()>Math.floor(this.maxh/2)?this.prevVisible(this.findLast(this.model.root)):this.nextVisible(this.model.root)}}}}this._isVal=true};this.recalc=function(){this.maxh=this.maxw=0;if(this.model!==null&&this.model.root!==null){this.$recalc(this.getLeft(),this.getTop(),null,this.model.root,true);this.maxw-=this.getLeft();this.maxh-=this.gapy}};this.getItemBounds=function(root){var metrics=this.getIM(root),toggle=this.getToggleBounds(root),image=this.getIconBounds(root);toggle.x=image.x+image.width+(image.width>0||toggle.width>0?this.gapx:0);toggle.y=metrics.y+Math.floor((metrics.height-metrics.viewHeight)/2);toggle.width=metrics.viewWidth;toggle.height=metrics.viewHeight;return toggle};this.getToggleBounds=function(root){var node=this.getIM(root),d=this.getToggleSize(root);return{x:node.x,y:node.y+Math.floor((node.height-d.height)/2),width:d.width,height:d.height}};this.getToggleView=function(i){var v=i.kids.length>0?this.getIM(i).isOpen?this.views.on:this.views.off:null;return typeof v==="undefined"?null:v};this.getItemPreferredSize=function(root){throw new Error("Not implemented")};this.$recalc=function(x,y,parent,root,isVis){var node=this.getIM(root);if(isVis===true){if(node.viewWidth<0){var viewSize=this.getItemPreferredSize(root);node.viewWidth=viewSize.width;node.viewHeight=viewSize.height}var imageSize=this.getIconSize(root),toggleSize=this.getToggleSize(root);if(parent!==null){var pImg=this.getIconBounds(parent);x=pImg.x+Math.floor((pImg.width-toggleSize.width)/2)}node.x=x;node.y=y;node.width=toggleSize.width+imageSize.width+node.viewWidth+(toggleSize.width>0?this.gapx:0)+10+(imageSize.width>0?this.gapx:0);node.height=Math.max(toggleSize.height>imageSize.height?toggleSize.height:imageSize.height,node.viewHeight);if(node.x+node.width>this.maxw){this.maxw=node.x+node.width}this.maxh+=node.height+this.gapy;x=node.x+toggleSize.width+(toggleSize.width>0?this.gapx:0);y+=node.height+this.gapy}var b=node.isOpen&&isVis===true;if(b){var count=root.kids.length;for(var i=0;i<count;i++){y=this.$recalc(x,y,root,root.kids[i],b)}}return y};this.$isOpen=function(i){return i===null||i.kids.length>0&&this.getIM(i).isOpen&&this.$isOpen(i.parent)};this.getIM=function(item){if(this.nodes.hasOwnProperty(item.$hash$)===false){var node=new pkg.$IM(this.isOpenVal);this.nodes[item.$hash$]=node;return node}return this.nodes[item.$hash$]};this.getItemAt=function(root,x,y){this.validate();if(arguments.length<3){x=arguments[0];y=arguments[1];root=this.model.root}if(this.firstVisible!==null&&y>=this.visibleArea.y&&y<this.visibleArea.y+this.visibleArea.height){var dx=this.scrollManager.getSX(),dy=this.scrollManager.getSY(),found=this.getItemAtInBranch(root,x-dx,y-dy);if(found!==null)return found;var parent=root.parent;while(parent!==null){var count=parent.kids.length;for(var i=parent.kids.indexOf(root)+1;i<count;i++){found=this.getItemAtInBranch(parent.kids[i],x-dx,y-dy);if(found!==null)return found}root=parent;parent=root.parent}}return null};this.getItemAtInBranch=function(root,x,y){if(root!==null){var node=this.getIM(root);if(x>=node.x&&y>=node.y&&x<node.x+node.width&&y<node.y+node.height+this.gapy){return root}if(this.$isOpen(root)){for(var i=0;i<root.kids.length;i++){var res=this.getItemAtInBranch(root.kids[i],x,y);if(res!==null)return res}}}return null};this.getIconView=function(i){return i.kids.length>0?this.getIM(i).isOpen?this.views.open:this.views.close:this.views.leaf};this.getIconSize=function(i){return i.kids.length>0?this.getIM(i).isOpen?this.viewSizes.open:this.viewSizes.close:this.viewSizes.leaf};this.getIconBounds=function(root){var node=this.getIM(root),id=this.getIconSize(root),td=this.getToggleSize(root);return{x:node.x+td.width+(td.width>0?this.gapx:0),y:node.y+Math.floor((node.height-id.height)/2),width:id.width,height:id.height}};this.getToggleSize=function(i){return this.$isOpen(i)?this.viewSizes.on:this.viewSizes.off};this.isOverVisibleArea=function(i){var node=this.getIM(i);return node.y+node.height+this.scrollManager.getSY()<this.visibleArea.y};this.findOpened=function(item){var parent=item.parent;return parent===null||this.$isOpen(parent)?item:this.findOpened(parent)};this.findNext=function(item){if(item!==null){if(item.kids.length>0&&this.$isOpen(item)){return item.kids[0]}var parent=null;while((parent=item.parent)!==null){var index=parent.kids.indexOf(item);if(index+1<parent.kids.length)return parent.kids[index+1];item=parent}}return null};this.findPrev=function(item){if(item!==null){var parent=item.parent;if(parent!==null){var index=parent.kids.indexOf(item);return index-1>=0?this.findLast(parent.kids[index-1]):parent}}return null};this.findLast=function(item){return this.$isOpen(item)&&item.kids.length>0?this.findLast(item.kids[item.kids.length-1]):item};this.prevVisible=function(item){if(item===null||this.isOverVisibleArea(item)){return this.nextVisible(item)}var parent=null;while((parent=item.parent)!==null){for(var i=parent.kids.indexOf(item)-1;i>=0;i--){var child=parent.kids[i];if(this.isOverVisibleArea(child))return this.nextVisible(child)}item=parent}return item};this.isVerVisible=function(item){if(this.visibleArea===null){return false}var node=this.getIM(item),yy1=node.y+this.scrollManager.getSY(),yy2=yy1+node.height-1,by=this.visibleArea.y+this.visibleArea.height;return this.visibleArea.y<=yy1&&yy1<by||this.visibleArea.y<=yy2&&yy2<by||this.visibleArea.y>yy1&&yy2>=by};this.nextVisible=function(item){if(item===null||this.isVerVisible(item)===true){return item}var res=this.nextVisibleInBranch(item),parent=null;if(res!==null){return res}while((parent=item.parent)!==null){var count=parent.kids.length;for(var i=parent.kids.indexOf(item)+1;i<count;i++){res=this.nextVisibleInBranch(parent.kids[i]);if(res!==null)return res}item=parent}return null};this.nextVisibleInBranch=function(item){if(this.isVerVisible(item))return item;if(this.$isOpen(item)){for(var i=0;i<item.kids.length;i++){var res=this.nextVisibleInBranch(item.kids[i]);if(res!==null)return res}}return null};this.paintSelectedItem=function(g,root,node,x,y){var v=this.hasFocus()?this.views.aselect:this.views.iselect;if(v!==null&&typeof v!=="undefined"){v.paint(g,x,y,node.viewWidth,node.viewHeight,this)}};this.paintTree=function(g,item){this.paintBranch(g,item);var parent=null;while((parent=item.parent)!==null){this.paintChild(g,parent,parent.kids.indexOf(item)+1);item=parent}};this.paintBranch=function(g,root){if(root===null)return false;var node=this.getIM(root),dx=this.scrollManager.getSX(),dy=this.scrollManager.getSY();if(zebkit.util.isIntersect(node.x+dx,node.y+dy,node.width,node.height,this.visibleArea.x,this.visibleArea.y,this.visibleArea.width,this.visibleArea.height)){var toggle=this.getToggleBounds(root),toggleView=this.getToggleView(root),image=this.getIconBounds(root),vx=image.x+image.width+this.gapx,vy=node.y+Math.floor((node.height-node.viewHeight)/2);if(toggleView!==null){toggleView.paint(g,toggle.x,toggle.y,toggle.width,toggle.height,this)}if(image.width>0){this.getIconView(root).paint(g,image.x,image.y,image.width,image.height,this)}if(this.selected===root){this.paintSelectedItem(g,root,node,vx,vy)}if(typeof this.paintItem!=="undefined"){this.paintItem(g,root,node,vx,vy)}if(this.lnColor!==null){g.setColor(this.lnColor);var yy=toggle.y+Math.floor(toggle.height/2)+.5;g.beginPath();g.moveTo(toggle.x+(toggleView===null?Math.floor(toggle.width/2):toggle.width-1),yy);g.lineTo(image.x,yy);g.stroke()}}else{if(node.y+dy>this.visibleArea.y+this.visibleArea.height||node.x+dx>this.visibleArea.x+this.visibleArea.width){return false}}return this.paintChild(g,root,0)};this.$y=function(item,isStart){var node=this.getIM(item),th=this.getToggleSize(item).height,ty=node.y+Math.floor((node.height-th)/2),dy=this.scrollManager.getSY(),y=item.kids.length>0?isStart?ty+th:ty-1:ty+Math.floor(th/2);return y+dy<0?-dy-1:y+dy>this.height?this.height-dy:y};this.paintChild=function(g,root,index){var b=this.$isOpen(root);if(root===this.firstVisible&&this.lnColor!==null){g.setColor(this.lnColor);var xx=this.getIM(root).x+Math.floor((b?this.viewSizes.on.width:this.viewSizes.off.width)/2);g.beginPath();g.moveTo(xx+.5,this.getTop());g.lineTo(xx+.5,this.$y(root,false));g.stroke()}if(b===true&&root.kids.length>0){var firstChild=root.kids.length>0?root.kids[0]:null;if(firstChild===null){return true}var x=this.getIM(firstChild).x+Math.floor((this.$isOpen(firstChild)?this.viewSizes.on.width:this.viewSizes.off.width)/2),count=root.kids.length;if(index<count){var node=this.getIM(root),y=index>0?this.$y(root.kids[index-1],true):node.y+Math.floor((node.height+this.getIconSize(root).height)/2);for(var i=index;i<count;i++){var child=root.kids[i];if(this.lnColor!==null){g.setColor(this.lnColor);g.beginPath();g.moveTo(x+.5,y);g.lineTo(x+.5,this.$y(child,false));g.stroke();y=this.$y(child,true)}if(this.paintBranch(g,child)===false){if(this.lnColor!==null&&i+1!==count){g.setColor(this.lnColor);g.beginPath();g.moveTo(x+.5,y);g.lineTo(x+.5,this.height-this.scrollManager.getSY());g.stroke()}return false}}}}return true};this.nextPage=function(item,dir){var sum=0,prev=item;while(item!==null&&sum<this.visibleArea.height){sum+=this.getIM(item).height+this.gapy;prev=item;item=dir<0?this.findPrev(item):this.findNext(item)}return prev};this.paint=function(g){if(this.model!==null){this.vVisibility();if(this.firstVisible!==null){var sx=this.scrollManager.getSX(),sy=this.scrollManager.getSY();try{g.translate(sx,sy);this.paintTree(g,this.firstVisible);g.translate(-sx,-sy)}catch(e){g.translate(-sx,-sy);throw e}}}};this.select=function(item){if(this.isSelectable===true){var old=this.selected,m=null;this.selected=item;if(this.selected!==null){this.makeVisible(this.selected)}this._.selected(this,old);if(old!==null&&this.isVerVisible(old)){m=this.getItemMetrics(old);this.repaint(m.x+this.scrollManager.getSX(),m.y+this.scrollManager.getSY(),m.width,m.height)}if(this.selected!==null&&this.isVerVisible(this.selected)){m=this.getItemMetrics(this.selected);this.repaint(m.x+this.scrollManager.getSX(),m.y+this.scrollManager.getSY(),m.width,m.height)}}};this.makeVisible=function(item){this.validate();var r=this.getItemBounds(item);this.scrollManager.makeVisible(r.x,r.y,r.width,r.height)};this.toggleAll=function(root,b){var model=this.model;if(root.kids.length>0){if(this.getItemMetrics(root).isOpen!==b)this.toggle(root);for(var i=0;i<root.kids.length;i++){this.toggleAll(root.kids[i],b)}}return this};this.toggle=function(item){if(item.kids.length>0){this.validate();var node=this.getIM(item);node.isOpen=node.isOpen?false:true;this.invalidate();this._.toggled(this,item);if(!node.isOpen&&this.selected!==null){var parent=this.selected;do{parent=parent.parent}while(parent!==item&&parent!==null);if(parent===item)this.select(item)}this.repaint()}return this};this.itemInserted=function(model,item){this.vrp()};this.itemRemoved=function(model,item){if(item===this.firstVisible){this.firstVisible=null}if(item===this.selected){this.select(null)}delete this.nodes[item];this.vrp()};this.itemModified=function(model,item,prevValue){var node=this.getIM(item);if(node!==null){node.viewWidth=-1}this.vrp()};this.calcPreferredSize=function(target){return this.model===null?{width:0,height:0}:{width:this.maxw,height:this.maxh}}},function focused(){this.$super();if(this.selected!==null){var m=this.getItemMetrics(this.selected);this.repaint(m.x+this.scrollManager.getSX(),m.y+this.scrollManager.getSY(),m.width,m.height)}},function setSelectable(b){if(this.isSelectable!==b){if(b===false&&this.selected!==null)this.select(null);this.isSelectable=b;this.repaint()}return this},function setLineColor(c){this.lnColor=c;this.repaint();return this},function setGaps(gx,gy){if(gx!==this.gapx||gy!==this.gapy){this.gapx=gx;this.gapy=gy;this.vrp()}return this},function setViews(v){this.viewSizes.on={width:0,height:0};this.viewSizes.off={width:0,height:0};this.viewSizes.open={width:0,height:0};this.viewSizes.close={width:0,height:0};this.viewSizes.leaf={width:0,height:0};for(var k in v){if(v.hasOwnProperty(k)){var vv=ui.$view(v[k]);this.views[k]=vv;if(k!=="aselect"&&k!=="iselect"){this.viewSizes[k]=vv?vv.getPreferredSize():{width:0,height:0};this.vrp()}}}return this},function setModel(d){if(this.model!==d){if(zebkit.instanceOf(d,zebkit.data.TreeModel)===false){d=new zebkit.data.TreeModel(d)}this.select(null);if(this.model!==null&&this.model._)this.model.off(this);this.model=d;if(this.model!==null&&this.model._)this.model.on(this);this.firstVisible=null;delete this.nodes;this.nodes={};this.vrp()}return this},function invalidate(){if(this.isValid===true){this._isVal=false}this.$super()}]);var ui=pkg.cd("..");pkg.Tree=Class(pkg.BaseTree,[function(d,b){if(arguments.length<2){b=true}this.setViewProvider(new pkg.DefViews);this.$super(d,b)},function $prototype(){this.itemGapY=2;this.itemGapX=4;this.editors=null;this.provider=this.editedItem=this.pressedItem=null;this.setFont=function(f){this.provider.setFont(f);this.vrp();return this};this.childKeyPressed=function(e){if(e.code==="Escape"){this.stopEditing(false)}else{if(e.code==="Enter"&&(zebkit.instanceOf(e.source,ui.TextField)===false||zebkit.instanceOf(e.source.view.target,zebkit.data.SingleLineTxt))){this.stopEditing(true)}}};this.catchScrolled=function(psx,psy){if(this.kids.length>0)this.stopEditing(false);if(this.firstVisible===null){this.firstVisible=this.model.root}this.firstVisible=this.y<psy?this.nextVisible(this.firstVisible):this.prevVisible(this.firstVisible);this.repaint()};this.laidout=function(){this.vVisibility()};this.getItemPreferredSize=function(root){var ps=this.provider.getView(this,root).getPreferredSize();ps.width+=this.itemGapX*2;ps.height+=this.itemGapY*2;return ps};this.paintItem=function(g,root,node,x,y){if(root!==this.editedItem){var v=this.provider.getView(this,root);v.paint(g,x+this.itemGapX,y+this.itemGapY,node.viewWidth,node.viewHeight,this)}};this.se=function(item,e){if(item!==null){this.stopEditing(true);if(this.editors!==null&&this.editors.shouldStartEdit(item,e)){this.startEditing(item);return true}}return false};this.pointerClicked=function(e){if(this.se(this.pressedItem,e)){this.pressedItem=null}};this.pointerDoubleClicked=function(e){if(this.se(this.pressedItem,e)){this.pressedItem=null}else{if(this.selected!==null&&this.getItemAt(this.firstVisible,e.x,e.y)===this.selected){this.toggle(this.selected)}}};this.pointerReleased=function(e){if(this.se(this.pressedItem,e))this.pressedItem=null};this.keyTyped=function(e){if(this.selected!==null){switch(e.key){case"+":if(this.isOpen(this.selected)===false){this.toggle(this.selected)}break;case"-":if(this.isOpen(this.selected)){this.toggle(this.selected)}break}}};this.keyPressed=function(e){var newSelection=null;switch(e.code){case"ArrowDown":case"ArrowRight":newSelection=this.findNext(this.selected);break;case"ArrowUp":case"ArrowLeft":newSelection=this.findPrev(this.selected);break;case"Home":if(e.ctrlKey)this.select(this.model.root);break;case"End":if(e.ctrlKey)this.select(this.findLast(this.model.root));break;case"PageDown":if(this.selected!==null)this.select(this.nextPage(this.selected,1));break;case"PageUp":if(this.selected!==null)this.select(this.nextPage(this.selected,-1));break}if(newSelection!==null)this.select(newSelection);this.se(this.selected,e)};this.startEditing=function(item){this.stopEditing(true);if(this.editors!==null){var editor=this.editors.getEditor(this,item);if(editor!==null){this.editedItem=item;var b=this.getItemBounds(this.editedItem),ps=editor.getPreferredSize();editor.setBounds(b.x+this.scrollManager.getSX()+this.itemGapX,b.y-Math.floor((ps.height-b.height+2*this.itemGapY)/2)+this.scrollManager.getSY()+this.itemGapY,ps.width,ps.height);this.add(editor);editor.requestFocus();this._.editingStarted(this,item,editor)}}};this.stopEditing=function(applyData){if(this.editors!==null&&this.editedItem!==null){var item=this.editedItem,oldValue=item.value,editor=this.kids[0];try{if(applyData){this.model.setValue(this.editedItem,this.editors.fetchEditedValue(this.editedItem,this.kids[0]))}}finally{this.editedItem=null;this.removeAt(0);this.requestFocus();this._.editingStopped(this,item,oldValue,editor,applyData)}}}},function toggle(item){this.stopEditing(false);this.$super(item);return this},function itemInserted(target,item){this.stopEditing(false);this.$super(target,item)},function itemRemoved(target,item){this.stopEditing(false);this.$super(target,item)},function setEditorProvider(p){if(p!=this.editors){this.stopEditing(false);this.editors=p}return this},function setViewProvider(p){if(this.provider!=p){this.stopEditing(false);this.provider=p;delete this.nodes;this.nodes={};this.vrp()}return this},function setModel(d){this.stopEditing(false);this.$super(d);return this},function paintSelectedItem(g,root,node,x,y){if(root!==this.editedItem){this.$super(g,root,node,x,y)}},function itemPressed(root,e){this.$super(root,e);if(this.se(root,e)===false)this.pressedItem=root},function pointerPressed(e){this.pressedItem=null;this.stopEditing(true);this.$super(e)}]);var ui=pkg.cd("..");pkg.CompTree=Class(pkg.BaseTree,[function $clazz(){this.Label=Class(ui.Label,[function $prototype(){this.canHaveFocus=true}]);this.Checkbox=Class(ui.Checkbox,[]);this.Combo=Class(ui.Combo,[function keyPressed(e){if(e.code!=="ArrowUp"&&e.code!=="ArrowDown"){this.$super(e)}}]);this.createModel=function(item,root,tree){var mi=new zebkit.data.Item;if(typeof item.value!=="undefined"){mi.value=item.value!==null?item.value:""}else{mi.value=item}mi.value=ui.$component(mi.value,tree);mi.parent=root;if(typeof item.kids!=="undefined"&&item.kids.length>0&&zebkit.instanceOf(item,ui.Panel)===false){for(var i=0;i<item.kids.length;i++){mi.kids[i]=this.createModel(item.kids[i],mi,tree)}}return mi}},function $prototype(){this.$blockCIE=false;this.canHaveFocus=false;this.getItemPreferredSize=function(root){return root.value.getPreferredSize()};this.childKeyTyped=function(e){if(this.selected!==null){switch(e.key){case"+":if(this.isOpen(this.selected)===false){this.toggle(this.selected)}break;case"-":if(this.isOpen(this.selected)){this.toggle(this.selected)}break}}};this.setFont=function(f){this.font=zebkit.isString(f)?new zebkit.ui.Font(f):f;return this};this.childKeyPressed=function(e){if(this.isSelectable===true){var newSelection=e.code==="ArrowDown"?this.findNext(this.selected):e.code==="ArrowUp"?this.findPrev(this.selected):null;if(newSelection!==null){this.select(newSelection)}}};this.childPointerPressed=this.childFocusGained=function(e){if(this.isSelectable===true&&this.$blockCIE!==true){this.$blockCIE=true;try{var item=zebkit.data.TreeModel.findOne(this.model.root,zebkit.layout.getDirectChild(this,e.source));if(item!==null)this.select(item)}finally{this.$blockCIE=false}}};this.childFocusLost=function(e){if(this.isSelectable===true){this.select(null)}};this.catchScrolled=function(psx,psy){this.vrp()};this.doLayout=function(){this.vVisibility();for(var i=0;i<this.kids.length;i++){this.kids[i].setVisible(false)}if(this.firstVisible!==null){var $this=this,fvNode=this.getIM(this.firstVisible),started=0;this.model.iterate(this.model.root,function(item){var node=$this.nodes[item];if(started===0&&item===$this.firstVisible){started=1}if(started===1){var sy=$this.scrollManager.getSY();if(node.y+sy<$this.height){var image=$this.getIconBounds(item),x=image.x+image.width+(image.width>0||$this.getToggleSize(item).width>0?$this.gapx:0)+$this.scrollManager.getSX(),y=node.y+Math.floor((node.height-node.viewHeight)/2)+sy;item.value.setVisible(true);item.value.setLocation(x,y);item.value.width=node.viewWidth;item.value.height=node.viewHeight}else{started=2}}return started===2?2:node.isOpen===false?1:0})}};this.itemInserted=function(target,item){this.add(item.value)}},function itemRemoved(target,item){this.$super(target,item);this.remove(item.value)},function setModel(model){var old=this.model;if(model!==null&&zebkit.instanceOf(model,zebkit.data.TreeModel)===false){model=new zebkit.data.TreeModel(this.clazz.createModel(model,null,this))}this.$super(model);if(old!==this.model){this.removeAll();if(this.model!==null){var $this=this;this.model.iterate(this.model.root,function(item){$this.add(item.value)})}}return this},function recalc(){this.$isMetricUpdated=false;this.$super();if(this.$isMetricUpdated===true){this.repaint()}},function recalc_(x,y,parent,root,isVis){var node=this.getIM(root);if(isVis===true){var viewSize=this.getItemPreferredSize(root);if(this.$isMetricUpdated===false&&(node.viewWidth!==viewSize.width||node.viewHeight!==viewSize.height)){this.$isMetricUpdated=true}node.viewWidth=viewSize.width;node.viewHeight=viewSize.height}return this.$super(x,y,parent,root,isVis)},function select(item){if(this.isSelectable===true){var old=this.selected;if(old!==null&&old.value.hasFocus()){ui.focusManager.requestFocus(null)}this.$super(item);if(item!==null){item.value.requestFocus()}}},function makeVisible(item){item.value.setVisible(true);this.$super(item)}]);zebkit.ui.$configWith(pkg)});zebkit.package("ui.grid",function(pkg,Class){"use strict";var ui=pkg.cd("..");pkg.CellsVisibility=function(){this.hasVisibleCells=function(){return this.fr!==null&&this.fc!==null&&this.lr!==null&&this.lc!==null};this.fr=this.fc=this.lr=this.lc=null};pkg.Metrics=zebkit.Interface(["abstract",function getCellsVisibility(){},function getColWidth(col){},function getRowHeight(row){},function setRowHeight(row,height){},function setColWidth(col,width){}]);pkg.DefViews=Class([function(render){this.render=arguments.length===0||typeof render==="undefined"?new ui.StringRender(""):render;zebkit.properties(this,this.clazz)},function $prototype(){this.setFont=function(f){this.render.setFont(f);return this};this.setColor=function(c){this.render.setColor(c);return this};this.getView=function(target,row,col,obj){if(obj!==null&&typeof obj!=="undefined"){if(typeof obj.toView!=="undefined")return obj.toView();if(typeof obj.paint!=="undefined")return obj;this.render.setValue(obj.toString());return this.render}else{return null}}}]);pkg.DefEditors=Class([function(){this.textEditor=new this.clazz.TextField("",150);this.boolEditor=new this.clazz.Checkbox(null);this.selectorEditor=new this.clazz.Combo;this.editors={}},function $clazz(){this.TextField=Class(ui.TextField,[]);this.Checkbox=Class(ui.Checkbox,[]);this.Combo=Class(ui.Combo,[function padShown(src,b){if(b===false){this.parent.stopEditing(true);this.setSize(0,0)}},function resized(pw,ph){this.$super(pw,ph);if(this.width>0&&this.height>0&&this.hasFocus()){this.showPad()}}]);this.Items=Class([function $prototype(){this.toString=function(){return this.selectedIndex<0?"":this.items[this.selectedIndex]}},function(items,selectedIndex){if(arguments.length<2){selectedIndex=-1}this.items=items;this.selectedIndex=selectedIndex}])},function $prototype(){this.fetchEditedValue=function(grid,row,col,data,editor){if(editor===this.selectorEditor){data.selectedIndex=editor.list.selectedIndex;return data}return editor.getValue()};this.getEditor=function(grid,row,col,v){var editor=null;if(this.editors.hasOwnProperty(col)){editor=this.editors[col];if(editor!==null){editor.setValue(v)}return editor}editor=zebkit.isBoolean(v)?this.boolEditor:zebkit.instanceOf(v,this.clazz.Items)?this.selectorEditor:this.textEditor;if(editor===this.selectorEditor){editor.list.setModel(v.items);editor.list.select(v.selectedIndex)}else{editor.setValue(v)}editor.setPadding(0);var ah=Math.floor((grid.getRowHeight(row)-editor.getPreferredSize().height)/2);editor.setPadding(ah,grid.cellInsetsLeft,ah,grid.cellInsetsRight);return editor};this.shouldStart=function(grid,row,col,e){return e.id==="pointerClicked"};this.shouldCancel=function(grid,row,col,e){return e.id==="keyPressed"&&"Escape"===e.code};this.shouldFinish=function(grid,row,col,e){return e.id==="keyPressed"&&"Enter"===e.code}}]);pkg.BaseCaption=Class(ui.Panel,[function(titles){this._=new this.clazz.Listeners;this.$super();if(arguments.length>0){for(var i=0;i<titles.length;i++){this.putTitle(i,titles[i])}}},function $clazz(){this.Listeners=new zebkit.util.ListenersClass("captionResized")},function $prototype(){this.selectedColRow=-1;this.orient=this.metrics=this.pxy=null;this.minSize=10;this.activeAreaSize=5;this.lineColor="gray";this.isAutoFit=this.isResizable=true;this.getCursorType=function(target,x,y){return this.metrics!==null&&this.selectedColRow>=0&&this.isResizable&&this.metrics.isUsePsMetric===false?this.orient==="horizontal"?ui.Cursor.W_RESIZE:ui.Cursor.S_RESIZE:null};this.pointerDragged=function(e){if(this.pxy!==null){var b=this.orient==="horizontal",rc=this.selectedColRow,ns=(b?this.metrics.getColWidth(rc)+e.x:this.metrics.getRowHeight(rc)+e.y)-this.pxy;this.captionResized(rc,ns);if(ns>this.minSize){this.pxy=b?e.x:e.y}}};this.pointerDragStarted=function(e){if(this.metrics!==null&&this.isResizable&&this.metrics.isUsePsMetric===false){this.calcRowColAt(e.x,e.y);if(this.selectedColRow>=0){this.pxy=this.orient==="horizontal"?e.x:e.y}}};this.pointerDragEnded=function(e){if(this.pxy!==null){this.pxy=null}if(this.metrics!==null){this.calcRowColAt(e.x,e.y)}};this.pointerMoved=function(e){if(this.metrics!==null){this.calcRowColAt(e.x,e.y)}};this.pointerDoubleClicked=function(e){if(this.pxy===null&&this.metrics!==null&&this.selectedColRow>=0&&this.isAutoFit===true){var size=this.getCaptionPS(this.selectedColRow);if(this.orient==="horizontal"){this.metrics.setColWidth(this.selectedColRow,size)}else{this.metrics.setRowHeight(this.selectedColRow,size)}this.captionResized(this.selectedColRow,size)}};this.getCaptionPS=function(rowcol){return 0};this.captionResized=function(rowcol,ns){if(ns>this.minSize){if(this.orient==="horizontal"){var pw=this.metrics.getColWidth(rowcol);this.metrics.setColWidth(rowcol,ns);this._.captionResized(this,rowcol,pw)}else{var ph=this.metrics.getRowHeight(rowcol);this.metrics.setRowHeight(rowcol,ns);this._.captionResized(this,rowcol,ph)}}};this.calcRowColAt=function(x,y){var $this=this;this.selectedColRow=this.getCaptionAt(x,y,function(m,xy,xxyy,wh,i){xxyy+=wh+m.lineSize;return xy<xxyy+$this.activeAreaSize&&xy>xxyy-$this.activeAreaSize})};this.getCaptionAt=function(x,y,f){if(this.metrics!==null&&x>=0&&y>=0&&x<this.width&&y<this.height){var m=this.metrics,cv=m.getCellsVisibility(),isHor=this.orient==="horizontal";if(isHor&&cv.fc!==null||isHor===false&&cv.fr!==null){var gap=m.lineSize,xy=isHor?x:y,xxyy=isHor?cv.fc[1]-this.x-gap+m.getXOrigin():cv.fr[1]-this.y-gap+m.getYOrigin();for(var i=isHor?cv.fc[0]:cv.fr[0];i<=(isHor?cv.lc[0]:cv.lr[0]);i++){var wh=isHor?m.getColWidth(i):m.getRowHeight(i);if(arguments.length>2&&f(m,xy,xxyy,wh,i)||arguments.length<3&&xy>xxyy&&xy<xxyy+wh){return i}xxyy+=wh+gap}}}return-1};this.paintOnTop=function(g){if(this.lineColor!==null&&this.metrics!==null){var v=this.metrics.getCellsVisibility();if(v!==null){var m=this.metrics,b=this.orient==="horizontal",startRC=b?v.fc[0]:v.fr[0],endRC=b?v.lc[0]:v.lr[0],xy=b?v.fc[1]-this.x-m.lineSize+m.getXOrigin():v.fr[1]-this.y-m.lineSize+m.getYOrigin();g.setColor(this.lineColor);for(var i=startRC;i<=endRC;i++){if(i!==0){if(b)g.drawLine(xy,0,xy,this.height,m.lineSize);else g.drawLine(0,xy,this.width,xy,m.lineSize)}xy+=(b?m.getColWidth(i):m.getRowHeight(i))+m.lineSize}}}}},function setParent(p){this.$super(p);this.metrics=this.orient=null;if(p===null||zebkit.instanceOf(p,pkg.Metrics)){this.metrics=p;if(this.constraints!==null){this.orient=this.constraints==="top"||this.constraints==="bottom"?"horizontal":"vertical"}}}]);var ui=pkg.cd("..");pkg.CaptionViewProvider=Class([function(render){if(arguments.length===0||typeof render==="undefined"){render=new ui.StringRender("")}this.render=render;this.render.setFont(pkg.GridCaption.font);this.render.setColor(pkg.GridCaption.fontColor)},function $prototype(){this.render=null;this.meta=null;this.setFont=function(f){this.render.setFont(f);return this};this.setColor=function(c){this.render.setColor(c);return this};this.getView=function(target,rowcol,value){if(value!==null){if(typeof value.toView!=="undefined")return value.toView();if(typeof value.paint!=="undefined")return value;this.render.setValue(value.toString());return this.render}else{return null}};this.$getCellMeta=function(rowcol){if(this.meta===null){this.meta={}}if(this.meta.hasOwnProperty(rowcol)){return this.meta[rowcol]}else{this.meta[rowcol]={ax:null,ay:null,bg:null};return this.meta[rowcol]}};this.getXAlignment=function(target,rowcol){return this.meta===null||this.meta.hasOwnProperty(rowcol)===false?null:this.meta[rowcol].ax};this.getYAlignment=function(target,rowcol){return this.meta===null||this.meta.hasOwnProperty(rowcol)===false?null:this.meta[rowcol].ay};this.getCellBackground=function(target,rowcol){return this.meta===null||this.meta.hasOwnProperty(rowcol)===false?null:this.meta[rowcol].bg};this.setTitleAlignments=function(rowcol,ax,ay){var m=this.$getCellMeta(rowcol);if(m.ax!==ax||m.ay!==ay){m.ax=ax;m.ay=ay;return true}else{return false}};this.setCellBackground=function(rowcol,bg){var m=this.$getCellMeta(rowcol);if(m.bg!==bg){m.bg=ui.$view(bg);return true}else{return false}}}]);pkg.GridCaption=Class(pkg.BaseCaption,[function(titles,render){this.titles={};this.psW=this.psH=0;this.setViewProvider(new pkg.CaptionViewProvider(render));if(arguments.length===0){this.$super()}else{this.$super(titles)}},function $prototype(){this.provider=null;this.defYAlignment=this.defXAlignment="center";this.defCellBg=null;this.setViewProvider=function(p){if(p!==this.provider){this.provider=p;this.vrp()}return this};this.getTitle=function(rowcol){return this.titles.hasOwnProperty(rowcol)?this.titles[rowcol]:null};this.calcPreferredSize=function(l){return{width:this.psW,height:this.psH}};this.setFont=function(f){this.provider.setFont(f);this.vrp();return this};this.setColor=function(c){this.provider.setColor(c);this.repaint();return this};this.recalc=function(){this.psW=this.psH=0;if(this.metrics!==null){var m=this.metrics,isHor=this.orient==="horizontal",size=isHor?m.getGridCols():m.getGridRows();for(var i=0;i<size;i++){var v=this.provider.getView(this,i,this.getTitle(i));if(v!==null){var ps=v.getPreferredSize();if(isHor===true){if(ps.height>this.psH)this.psH=ps.height;this.psW+=ps.width}else{if(ps.width>this.psW)this.psW=ps.width;this.psH+=ps.height}}}if(this.psH===0)this.psH=pkg.Grid.DEF_ROWHEIGHT;if(this.psW===0)this.psW=pkg.Grid.DEF_COLWIDTH}};this.putTitle=function(rowcol,value){if(value===null){if(title!==null){delete this.titles[rowcol]}}else{this.titles[rowcol]=value}this.vrp();return this};this.setTitleAlignments=function(rowcol,xa,ya){if(this.provider.setTitleAlignments(rowcol,xa,ya)){this.repaint()}return this};this.setCellBackground=function(rowcol,bg){if(this.provider.setCellBackground(rowcol,bg)){this.repaint()}return this};this.getCaptionPS=function(rowcol){var v=this.provider.getView(this,rowcol,this.getTitle(rowcol));return v!==null?this.orient==="horizontal"?v.getPreferredSize().width:v.getPreferredSize().height:0}},function paintOnTop(g){if(this.metrics!==null){var cv=this.metrics.getCellsVisibility();if(cv.fc!==null&&cv.lc!==null&&this.orient==="horizontal"||cv.fr!==null&&cv.lr!==null&&this.orient==="vertical"){var isHor=this.orient==="horizontal",gap=this.metrics.lineSize,top=this.getTop(),left=this.getLeft(),bottom=this.getBottom(),right=this.getRight(),x=isHor?cv.fc[1]-this.x+this.metrics.getXOrigin()-gap:left,y=isHor?top:cv.fr[1]-this.y+this.metrics.getYOrigin()-gap,size=isHor?this.metrics.getGridCols():this.metrics.getGridRows();for(var i=isHor?cv.fc[0]:cv.fr[0];i<=(isHor?cv.lc[0]:cv.lr[0]);i++){var ww=isHor?this.metrics.getColWidth(i):this.width-left-right,hh=isHor?this.height-top-bottom:this.metrics.getRowHeight(i),v=this.provider.getView(this,i,this.getTitle(i));if(v!==null){var xa=this.provider.getXAlignment(this,i,v),ya=this.provider.getYAlignment(this,i,v),bg=this.provider.getCellBackground(this,i,v);if(xa===null){xa=this.defXAlignment}if(ya===null){ya=this.defYAlignment}if(bg===null){bg=this.defCellBg}var ps=v.getPreferredSize(),vx=xa==="center"?Math.floor((ww-ps.width)/2):xa==="right"?ww-ps.width-(i===size-1?right:0):i===0?left:0,vy=ya==="center"?Math.floor((hh-ps.height)/2):ya==="bottom"?hh-ps.height-(i===size-1?bottom:0):i===0?top:0;if(bg!==null){if(isHor)bg.paint(g,x,0,ww+gap,this.height,this);else bg.paint(g,0,y,this.width,hh+gap,this)}g.save();g.clipRect(x+gap,y+gap,ww,hh);v.paint(g,x+vx+gap,y+vy+gap,ps.width,ps.height,this);g.restore()}if(isHor)x+=ww+gap;else y+=hh+gap}}this.$super(g)}}]);var ui=pkg.cd("..");pkg.CompGridCaption=Class(pkg.BaseCaption,[function(titles){if(arguments.length===0){this.$super()}else{this.$super(titles)}this.setLayout(new this.clazz.Layout)},function $clazz(){this.Layout=Class(zebkit.layout.Layout,[function $prototype(){this.doLayout=function(target){var m=target.metrics,b=target.orient==="horizontal",top=target.getTop(),left=target.getLeft(),wh=b?target.height-top-target.getBottom():target.width-left-target.getRight(),xy=b?left+m.getXOrigin():top+m.getYOrigin();for(var i=0;i<target.kids.length;i++){var kid=target.kids[i],cwh=b?m.getColWidth(i):m.getRowHeight(i);if(i===0){cwh-=b?left-m.lineSize:top}if(kid.isVisible===true){if(b){kid.setBounds(xy,top,cwh,wh)}else{kid.setBounds(left,xy,wh,cwh)}}xy+=cwh+m.lineSize}};this.calcPreferredSize=function(target){return zebkit.layout.getMaxPreferredSize(target)}}]);this.Link=Class(ui.Link,[]);this.StatusPan=Class(ui.StatePan,[]);var clazz=this;this.TitlePan=Class(ui.Panel,[function(title){this.$super();this.iconPan=new ui.ImagePan(null);this.link=new clazz.Link(title);this.statusPan=new clazz.StatusPan;this.statusPan.setVisible(this.isSortable);this.add(this.iconPan);this.add(this.link);this.add(this.statusPan)},function $clazz(){this.layout=new zebkit.layout.FlowLayout("center","center","horizontal",8)},function $prototype(){this.sortState=0;this.isSortable=false},function getGridCaption(){var c=this.parent;while(c!==null&&zebkit.instanceOf(c,pkg.BaseCaption)===false){c=c.parent}return c},function matrixSorted(target,info){if(this.isSortable){var col=this.parent.indexOf(this);if(info.col===col){this.sortState=info.name==="descent"?1:-1;this.statusPan.setState(info.name)}else{this.sortState=0;this.statusPan.setState("*")}}},function setIcon(path){this.iconPan.setImage(path);return this},function matrixResized(target,prevRows,prevCols){if(this.isSortable){this.sortState=0;this.statusPan.setState("*")}},function fired(target){if(this.isSortable===true){var f=this.sortState===1?zebkit.data.ascent:zebkit.data.descent,model=this.getGridCaption().metrics.model,col=this.parent.indexOf(this);model.sortCol(col,f)}},function kidRemoved(index,kid){if(zebkit.instanceOf(kid,zebkit.util.Fireable)){kid.off(this)}this.$super(index,kid)},function kidAdded(index,constr,kid){if(zebkit.instanceOf(kid,zebkit.util.Fireable)){kid.on(this)}this.$super(index,constr,kid)}])},function $prototype(){this.catchInput=function(t){return zebkit.instanceOf(t,zebkit.util.Fireable)===false};this.scrolled=function(){this.vrp()};this.putTitle=function(rowcol,t){for(var i=this.kids.length-1;i>=0&&i<rowcol;i++){this.add(new this.clazz.TitlePan(""))}if(zebkit.isString(t)){t=new this.clazz.TitlePan(t)}else{if(zebkit.instanceOf(t,ui.View)){var p=new ui.ViewPan;p.setView(t);t=p}}if(rowcol<this.kids.length){this.setAt(rowcol,t)}else{this.add(t)}return this};this.setSortable=function(col,b){var c=this.kids[col];if(c.isSortable!==b){c.isSortable=b;c.statusPan.setVisible(b)}return this};this.matrixSorted=function(target,info){for(var i=0;i<this.kids.length;i++){if(this.kids[i].matrixSorted){this.kids[i].matrixSorted(target,info)}}};this.matrixResized=function(target,prevRows,prevCols){for(var i=0;i<this.kids.length;i++){if(this.kids[i].matrixResized){this.kids[i].matrixResized(target,prevRows,prevCols)}}};this.getCaptionPS=function(rowcol){return rowcol<this.kids.length?this.orient==="horizontal"?this.kids[rowcol].getPreferredSize().width:this.kids[rowcol].getPreferredSize().height:0}},function captionResized(rowcol,ns){this.$super(rowcol,ns);this.vrp()},function setParent(p){if(this.parent!==null&&typeof this.parent.scrollManager!=="undefined"&&this.parent.scrollManager!==null){this.parent.scrollManager.off(this)}if(p!==null&&typeof p.scrollManager!=="undefined"&&p.scrollManager!==null){p.scrollManager.on(this)}this.$super(p)},function insert(i,constr,c){if(zebkit.isString(c)){c=new this.clazz.TitlePan(c)}this.$super(i,constr,c)}]);pkg.LeftCompGridCaption=Class(pkg.CompGridCaption,[function $prototype(){this.constraints="left"}]);pkg.LeftGridCaption=Class(pkg.GridCaption,[function $prototype(){this.constraints="left"}]);var ui=pkg.cd("..");pkg.RowSelMode=Class([function $prototype(){this.selectedIndex=0;this.$blocked=false;this.isSelected=function(row,col){return row>=0&&this.selectedIndex===row};this.select=function(row,col,b){if(arguments.length===1||arguments.length===2&&zebkit.isNumber(col)){b=true}if(this.isSelected(row,col)!==b){if(this.selectedIndex>=0)this.clearSelect();if(b===true){this.selectedIndex=row;this.target._.rowSelected()}}};this.clearSelect=function(){if(this.selectedIndex>=0){this.selectedIndex=-1;this.target._.rowSelected()}};this.posChanged=function(src){if($blocked===false){$blocked=true;try{}finally{$blocked=false}}}}]);pkg.Grid=Class(ui.Panel,zebkit.util.Position.Metric,pkg.Metrics,ui.$ViewsSetterMix,[function(model){this.defCellColor=pkg.DefViews.cellBackground;if(arguments.length===0){model=new this.clazz.Matrix(5,5)}else if(arguments.length===2){model=new this.clazz.Matrix(arguments[0],arguments[1])}this._=new this.clazz.Listeners;this.views={};this.visibility=new pkg.CellsVisibility;this.$super();this.add("corner",new this.clazz.CornerPan);this.setModel(model);this.setViewProvider(new pkg.DefViews);this.setPosition(new zebkit.util.Position(this));this.scrollManager=new ui.ScrollManager(this)},function $clazz(){this.Listeners=zebkit.util.ListenersClass("rowSelected");this.Matrix=Class(zebkit.data.Matrix,[]);this.DEF_COLWIDTH=80;this.DEF_ROWHEIGHT=25;this.CornerPan=Class(ui.Panel,[])},function $prototype(){this.psWidth_=this.psHeight_=this.colOffset=0;this.rowOffset=this.pressedCol=this.selectedIndex=0;this.scrollManager=this.model=this.visibleArea=null;this.editor=this.editors=this.leftCaption=this.topCaption=this.colWidths=null;this.rowHeights=this.position=this.stub=null;this.editingRow=this.editingCol=this.pressedRow=-1;this.navigationMode="row";this.lineSize=this.cellInsetsTop=this.cellInsetsBottom=1;this.cellInsetsLeft=this.cellInsetsRight=2;this.defXAlignment="left";this.defYAlignment="center";this.drawVerLines=this.drawHorLines=true;this.drawSideLines=true;this.lineColor="gray";this.isUsePsMetric=false;this.paintPosMarkerOver=true;this.$topY=function(){return this.getTop()+(this.topCaption===null||this.topCaption.isVisible===false?this.lineSize:this.getTopCaptionHeight())};this.$leftX=function(){return this.getLeft()+(this.leftCaption===null||this.leftCaption.isVisible===false?this.lineSize:this.getLeftCaptionWidth())};this.setDefCellXAlignment=function(ax){this.setDefCellAlignments(ax,this.defYAlignment)};this.setDefCellYAlignment=function(ay){this.setDefCellAlignments(this.defXAlignment,ay)};this.setDefCellAlignments=function(ax,ay){if(this.defXAlignment!==ax||this.defYAlignment!==ay){this.defXAlignment=ax;this.defYAlignment=ay;this.repaint()}};this.colVisibility=function(col,x,d,b){var cols=this.getGridCols();if(cols===0)return null;var left=this.getLeft(),dx=this.scrollManager.getSX(),xx1=Math.min(this.visibleArea.x+this.visibleArea.width,this.width-this.getRight()),xx2=Math.max(left,this.visibleArea.x+this.getLeftCaptionWidth());for(;col<cols&&col>=0;col+=d){if(x+dx<xx1&&x+this.colWidths[col]+dx>xx2){if(b)return[col,x]}else{if(b===false)return this.colVisibility(col,x,d>0?-1:1,true)}if(d<0){if(col>0)x-=this.colWidths[col-1]+this.lineSize}else{if(col<cols-1)x+=this.colWidths[col]+this.lineSize}}return b?null:d>0?[col-1,x]:[0,this.$leftX()]};this.rowVisibility=function(row,y,d,b){var rows=this.getGridRows();if(rows===0)return null;var top=this.getTop(),dy=this.scrollManager.getSY(),yy1=Math.min(this.visibleArea.y+this.visibleArea.height,this.height-this.getBottom()),yy2=Math.max(this.visibleArea.y,top+this.getTopCaptionHeight());for(;row<rows&&row>=0;row+=d){if(y+dy<yy1&&y+this.rowHeights[row]+dy>yy2){if(b)return[row,y]}else{if(b===false)return this.rowVisibility(row,y,d>0?-1:1,true)}if(d<0){if(row>0)y-=this.rowHeights[row-1]+this.lineSize}else{if(row<rows-1)y+=this.rowHeights[row]+this.lineSize}}return b?null:d>0?[row-1,y]:[0,this.$topY()]};this.vVisibility=function(){var va=ui.$cvp(this,{});if(va===null){this.visibleArea=null;this.visibility.fr=null;return}if(this.visibleArea===null||va.x!==this.visibleArea.x||va.y!==this.visibleArea.y||va.width!==this.visibleArea.width||va.height!==this.visibleArea.height){this.iColVisibility(0);this.iRowVisibility(0);this.visibleArea=va}var v=this.visibility,b=v.hasVisibleCells();if(this.colOffset!==100){if(this.colOffset>0&&b){v.lc=this.colVisibility(v.lc[0],v.lc[1],-1,true);v.fc=this.colVisibility(v.lc[0],v.lc[1],-1,false)}else{if(this.colOffset<0&&b){v.fc=this.colVisibility(v.fc[0],v.fc[1],1,true);v.lc=this.colVisibility(v.fc[0],v.fc[1],1,false)}else{v.fc=this.colVisibility(0,this.$leftX(),1,true);v.lc=v.fc!==null?this.colVisibility(v.fc[0],v.fc[1],1,false):null}}this.colOffset=100}if(this.rowOffset!==100){if(this.rowOffset>0&&b){v.lr=this.rowVisibility(v.lr[0],v.lr[1],-1,true);v.fr=this.rowVisibility(v.lr[0],v.lr[1],-1,false)}else{if(this.rowOffset<0&&b){v.fr=this.rowVisibility(v.fr[0],v.fr[1],1,true);v.lr=v.fr!==null?this.rowVisibility(v.fr[0],v.fr[1],1,false):null}else{v.fr=this.rowVisibility(0,this.$topY(),1,true);v.lr=v.fr!==null?this.rowVisibility(v.fr[0],v.fr[1],1,false):null}}this.rowOffset=100}};this.makeVisible=function(row,col){var top=this.getTop()+this.getTopCaptionHeight(),left=this.getLeft()+this.getLeftCaptionWidth(),o=ui.calcOrigin(this.getColX(col),this.getRowY(row),this.getLineSize(row)>1?this.colWidths[col]+this.lineSize:this.psWidth_,this.rowHeights[row]+this.lineSize,this.scrollManager.getSX(),this.scrollManager.getSY(),this,top,left,this.getBottom(),this.getRight());this.scrollManager.scrollTo(o[0],o[1])};this.$se=function(row,col,e){if(row>=0){this.stopEditing(true);if(this.editors!==null&&this.editors.shouldStart(this,row,col,e)){return this.startEditing(row,col)}}return false};this.getXOrigin=function(){return this.scrollManager.getSX()};this.getYOrigin=function(){return this.scrollManager.getSY()};this.getColPSWidth=function(col){return this.getPSSize(col,false)};this.getRowPSHeight=function(row){return this.getPSSize(row,true)};this.recalc=function(){if(this.isUsePsMetric){this.rPsMetric()}else{this.rCustomMetric()}var cols=this.getGridCols(),rows=this.getGridRows();this.psWidth_=this.lineSize*(cols+(this.leftCaption===null||this.leftCaption.isVisible===false?1:0));this.psHeight_=this.lineSize*(rows+(this.topCaption===null||this.topCaption.isVisible===false?1:0));var i=0;for(;i<cols;i++)this.psWidth_+=this.colWidths[i];for(i=0;i<rows;i++)this.psHeight_+=this.rowHeights[i]};this.getGridRows=function(){return this.model!==null?this.model.rows:0};this.getGridCols=function(){return this.model!==null?this.model.cols:0};this.getRowHeight=function(row){this.validateMetric();return this.rowHeights[row]};this.getColWidth=function(col){this.validateMetric();return this.colWidths[col]};this.getCellsVisibility=function(){this.validateMetric();return this.visibility};this.getColX=function(col){if(this.isValid===false)this.validateMetric();var start=0,d=1,x=this.getLeft()+(this.leftCaption===null||this.leftCaption.isVisible===false?this.lineSize:0)+this.getLeftCaptionWidth();if(this.visibility.hasVisibleCells()){start=this.visibility.fc[0];x=this.visibility.fc[1];d=col>this.visibility.fc[0]?1:-1}for(var i=start;i!==col;x+=(this.colWidths[i]+this.lineSize)*d,i+=d);return x};this.getRowY=function(row){if(this.isValid===false){this.validateMetric()}var start=0,d=1,y=this.getTop()+(this.topCaption===null||this.topCaption.isVisible===false?this.lineSize:0)+this.getTopCaptionHeight();if(this.visibility.hasVisibleCells()){start=this.visibility.fr[0];y=this.visibility.fr[1];d=row>this.visibility.fr[0]?1:-1}for(var i=start;i!==row;y+=(this.rowHeights[i]+this.lineSize)*d,i+=d);return y};this.childPointerEntered=this.childPointerExited=this.childPointerReleased=this.childPointerReleased=this.childPointerPressed=this.childKeyReleased=this.childKeyTyped=this.childKeyPressed=function(e){if(this.editingRow>=0){if(this.editors.shouldCancel(this,this.editingRow,this.editingCol,e)){this.stopEditing(false)}else{if(this.editors.shouldFinish(this,this.editingRow,this.editingCol,e)){this.stopEditing(true)}}}};this.iColVisibility=function(off){this.colOffset=this.colOffset===100?this.colOffset=off:off!==this.colOffset?0:this.colOffset};this.iRowVisibility=function(off){this.rowOffset=this.rowOffset===100?off:off+this.rowOffset===0?0:this.rowOffset};this.getTopCaptionHeight=function(){return this.topCaption!==null&&this.topCaption.isVisible===true?this.topCaption.height:0};this.getLeftCaptionWidth=function(){return this.leftCaption!==null&&this.leftCaption.isVisible===true?this.leftCaption.width:0};this.paint=function(g){this.vVisibility();if(this.visibility.hasVisibleCells()){var dx=this.scrollManager.getSX(),dy=this.scrollManager.getSY(),th=this.getTopCaptionHeight(),tw=this.getLeftCaptionWidth();try{g.save();g.translate(dx,dy);if(th>0||tw>0){g.clipRect(tw-dx,th-dy,this.width-tw,this.height-th)}if(this.paintPosMarkerOver!==true){this.paintPosMarker(g)}this.paintData(g);if(this.paintNetOnCaption!==true&&(this.drawHorLines===true||this.drawVerLines===true)){this.paintNet(g)}if(this.paintPosMarkerOver===true){this.paintPosMarker(g)}g.restore()}catch(e){g.restore();throw e}}};this.paintOnTop=function(g){if(this.paintNetOnCaption===true&&(this.drawHorLines===true||this.drawVerLines===true)){this.paintNet(g)}};this.catchScrolled=function(psx,psy){var offx=this.scrollManager.getSX()-psx,offy=this.scrollManager.getSY()-psy;if(offx!==0){this.iColVisibility(offx>0?1:-1)}if(offy!==0){this.iRowVisibility(offy>0?1:-1)}this.stopEditing(false);this.repaint()};this.isInvalidatedByChild=function(c){return c!==this.editor||this.isUsePsMetric};this.stopEditing=function(applyData){if(this.editors!==null&&this.editingRow>=0&&this.editingCol>=0){try{if(zebkit.instanceOf(this.editor,pkg.Grid)){this.editor.stopEditing(applyData)}var data=this.getDataToEdit(this.editingRow,this.editingCol);if(applyData){this.setEditedData(this.editingRow,this.editingCol,this.editors.fetchEditedValue(this,this.editingRow,this.editingCol,data,this.editor))}this.repaintRows(this.editingRow,this.editingRow)}finally{this.editingCol=this.editingRow=-1;if(this.indexOf(this.editor)>=0){this.remove(this.editor)}this.editor=null;this.requestFocus()}}};this.setDrawLines=function(hor,ver){if(this.drawVerLines!==hor||this.drawHorLines!==ver){this.drawHorLines=hor;this.drawVerLines=ver;this.repaint()}return this};this.setNavigationMode=function(mode){if(mode.toLowerCase()==="row"){this.navigationMode="row";this.getLineSize=function(row){return 1};this.getMaxOffset=function(){return this.getGridRows()-1}}else{this.navigationMode="cell";if(mode.toLowerCase()==="cell"){this.getLineSize=function(row){return this.getGridCols()};this.getMaxOffset=function(){return this.getGridRows()*this.getGridCols()-1}}else{throw new Error("Unsupported position marker mode")}}return this};this.getLines=function(){return this.getGridRows()};this.getLineSize=function(line){return 1};this.getMaxOffset=function(){return this.getGridRows()-1};this.posChanged=function(target,prevOffset,prevLine,prevCol){var row=this.position.currentLine;if(row>=0){this.makeVisible(row,this.position.currentCol);this.select(row,true);this.repaintRows(prevLine,row)}else{this.repaintRows(prevLine,prevLine)}};this.keyReleased=function(e){if(this.position!==null){this.$se(this.position.currentLine,this.position.currentCol,e)}};this.keyTyped=function(e){if(this.position!==null){this.$se(this.position.currentLine,this.position.currentCol,e)}};this.keyPressed=function(e){if(this.position!==null){switch(e.code){case"ArrowLeft":this.position.seek(-1);break;case"ArrowUp":this.position.seekLineTo("up");break;case"ArrowRight":this.position.seek(1);break;case"ArrowDown":this.position.seekLineTo("down");break;case"PageUp":this.position.seekLineTo("up",this.pageSize(-1));break;case"PageDown":this.position.seekLineTo("down",this.pageSize(1));break;case"End":if(e.ctrlKey)this.position.setOffset(this.getLines()-1);break;case"Home":if(e.ctrlKey)this.position.setOffset(0);break}this.$se(this.position.currentLine,this.position.currentCol,e)}};this.isSelected=function(row,col){return row===this.selectedIndex};this.repaintRows=function(r1,r2){if(r1<0)r1=r2;if(r2<0)r2=r1;if(r1>r2){var i=r2;r2=r1;r1=i}var rows=this.getGridRows();if(r1<rows){if(r2>=rows)r2=rows-1;var y1=this.getRowY(r1),y2=(r1===r2?y1+1:this.getRowY(r2))+this.rowHeights[r2];this.repaint(0,y1+this.scrollManager.getSY(),this.width,y2-y1)}return this};this.cellByLocation=function(x,y){this.validate();var dx=this.scrollManager.getSX(),dy=this.scrollManager.getSY(),v=this.visibility,ry1=v.fr[1]+dy,rx1=v.fc[1]+dx,row=-1,col=-1,i=0,ry2=v.lr[1]+this.rowHeights[v.lr[0]]+dy,rx2=v.lc[1]+this.colWidths[v.lc[0]]+dx;if(y>ry1&&y<ry2){for(i=v.fr[0];i<=v.lr[0];ry1+=this.rowHeights[i]+this.lineSize,i++){if(y>ry1&&y<ry1+this.rowHeights[i]){row=i;break}}}if(x>rx1&&x<rx2){for(i=v.fc[0];i<=v.lc[0];rx1+=this.colWidths[i]+this.lineSize,i++){if(x>rx1&&x<rx1+this.colWidths[i]){col=i;break}}}return col>=0&&row>=0?{row:row,col:col}:null};this.doLayout=function(target){var topHeight=this.topCaption!==null&&this.topCaption.isVisible===true?this.topCaption.getPreferredSize().height:0,leftWidth=this.leftCaption!==null&&this.leftCaption.isVisible===true?this.leftCaption.getPreferredSize().width:0;if(this.topCaption!==null){this.topCaption.setBounds(this.getLeft()+leftWidth,this.getTop(),Math.min(target.width-this.getLeft()-this.getRight()-leftWidth,this.psWidth_),topHeight)}if(this.leftCaption!==null){this.leftCaption.setBounds(this.getLeft(),this.getTop()+topHeight,leftWidth,Math.min(target.height-this.getTop()-this.getBottom()-topHeight,this.psHeight_))}if(this.stub!==null&&this.stub.isVisible===true){if(this.topCaption!==null&&this.topCaption.isVisible===true&&this.leftCaption!==null&&this.leftCaption.isVisible===true){this.stub.setBounds(this.getLeft(),this.getTop(),this.topCaption.x-this.stub.x,this.leftCaption.y-this.stub.y)}else{this.stub.setSize(0,0)}}if(this.editors!==null&&this.editor!==null&&this.editor.parent===this&&this.editor.isVisible===true){var w=this.colWidths[this.editingCol],h=this.rowHeights[this.editingRow],x=this.getColX(this.editingCol),y=this.getRowY(this.editingRow);if(this.isUsePsMetric){x+=this.cellInsetsLeft;y+=this.cellInsetsTop;w-=this.cellInsetsLeft+this.cellInsetsRight;h-=this.cellInsetsTop+this.cellInsetsBottom}this.editor.setBounds(x+this.scrollManager.getSX(),y+this.scrollManager.getSY(),w,h)}};this.canHaveFocus=function(){return this.editor===null};this.clearSelect=function(){if(this.selectedIndex>=0){var prev=this.selectedIndex;this.selectedIndex=-1;this._.rowSelected(this,-1,0,false);this.repaintRows(-1,prev)}return this};this.select=function(row,b){if(arguments.length<2)b=true;if(this.isSelected(row)!==b){if(this.selectedIndex>=0)this.clearSelect();if(b){this.selectedIndex=row;this._.rowSelected(this,row,1,b)}}return this};this.laidout=function(){this.vVisibility()};this.pointerClicked=function(e){if(e.isAction()&&this.visibility.hasVisibleCells()){this.stopEditing(true);if(e.isAction()){var p=this.cellByLocation(e.x,e.y);if(p!==null){if(this.position!==null){var row=this.position.currentLine,col=this.position.currentCol,ls=this.getLineSize(p.row);if(row===p.row&&col===p.col%ls){this.makeVisible(row,col)}else{this.clearSelect();this.position.setRowCol(p.row,p.col%ls)}}if(this.$se(p.row,p.col,e)){}}}}};this.calcPreferredSize=function(target){return{width:this.psWidth_+(this.leftCaption!==null&&this.leftCaption.isVisible===true?this.leftCaption.getPreferredSize().width:0),height:this.psHeight_+(this.topCaption!==null&&this.topCaption.isVisible===true?this.topCaption.getPreferredSize().height:0)}};this.paintNet=function(g){var v=this.visibility,i=0,topX=v.fc[1]-this.lineSize,topY=v.fr[1]-this.lineSize,botX=v.lc[1]+this.colWidths[v.lc[0]],botY=v.lr[1]+this.rowHeights[v.lr[0]],prevWidth=g.lineWidth;g.setColor(this.lineColor);g.lineWidth=this.lineSize;g.beginPath();if(this.drawHorLines===true){i=v.fr[0];var y=topY+this.lineSize/2,tx=this.paintNetOnCaption===true?this.getLeft():topX;for(;i<=v.lr[0];i++){g.moveTo(tx,y);g.lineTo(botX,y);y+=this.rowHeights[i]+this.lineSize}g.moveTo(tx,y);g.lineTo(botX,y)}if(this.drawVerLines===true){i=v.fc[0];if(this.drawSideLines!==true&&v.fc[0]===0){i++;topX=v.fc[1]+this.colWidths[0]}var x=topX+this.lineSize/2,cols=this.getGridCols()-1,ty=this.paintNetOnCaption===true?this.getTop():topY;for(;i<=v.lc[0]&&(this.drawSideLines===true||i<cols);i++){g.moveTo(x,ty);g.lineTo(x,botY);x+=this.colWidths[i]+this.lineSize}g.moveTo(x,ty);g.lineTo(x,botY)}g.stroke();g.lineWidth=prevWidth};this.paintData=function(g){var y=this.visibility.fr[1]+this.cellInsetsTop,addW=this.cellInsetsLeft+this.cellInsetsRight,addH=this.cellInsetsTop+this.cellInsetsBottom,ts=g.$states[g.$curState],cx=ts.x,cy=ts.y,cw=ts.width,ch=ts.height,res={};for(var i=this.visibility.fr[0];i<=this.visibility.lr[0]&&y<cy+ch;i++){if(y+this.rowHeights[i]>cy){var x=this.visibility.fc[1]+this.cellInsetsLeft;for(var j=this.visibility.fc[0];j<=this.visibility.lc[0];j++){if(this.isSelected(i,j)===true){this.paintCellSelection(g,i,j,x-this.cellInsetsLeft,y-this.cellInsetsTop)}else{var bg=typeof this.provider.getCellColor!=="undefined"?this.provider.getCellColor(this,i,j):this.defCellColor;if(bg!==null){g.setColor(bg);g.fillRect(x-this.cellInsetsLeft,y-this.cellInsetsTop,this.colWidths[j],this.rowHeights[i])}}var v=i===this.editingRow&&j===this.editingCol?null:this.provider.getView(this,i,j,this.model.get(i,j));if(v!==null){var w=this.colWidths[j]-addW,h=this.rowHeights[i]-addH;res.x=x>cx?x:cx;res.width=Math.min(x+w,cx+cw)-res.x;res.y=y>cy?y:cy;res.height=Math.min(y+h,cy+ch)-res.y;if(res.width>0&&res.height>0){var ax=typeof this.provider.getXAlignment!=="undefined"?this.provider.getXAlignment(this,i,j):this.defXAlignment,ay=typeof this.provider.getYAlignment!=="undefined"?this.provider.getYAlignment(this,i,j):this.defYAlignment,vw=w,vh=h,xx=x,yy=y,id=-1,ps=ax!==null||ay!==null?v.getPreferredSize(vw,vh):null;if(ax!==null){xx=x+(ax==="center"?~~((w-ps.width)/2):ax==="right"?w-ps.width:0);vw=ps.width}if(ay!==null){yy=y+(ay==="center"?~~((h-ps.height)/2):ay==="bottom"?h-ps.height:0);vh=ps.height}if(xx<res.x||yy<res.y||xx+vw>x+w||yy+vh>y+h){id=g.save();g.clipRect(res.x,res.y,res.width,res.height)}v.paint(g,xx,yy,vw,vh,this);if(id>=0){g.restore()}}}x+=this.colWidths[j]+this.lineSize}}y+=this.rowHeights[i]+this.lineSize}};this.$getPosMarker=function(){return this.hasFocus()?typeof this.views.marker==="undefined"?null:this.views.marker:typeof this.views.offmarker==="undefined"?null:this.views.offmarker};this.paintPosMarker=function(g){if(this.position!==null&&this.position.offset>=0){var view=this.$getPosMarker(),row=this.position.currentLine,col=this.position.currentCol,rowPosMode=this.navigationMode==="row",v=this.visibility;if(view!==null&&row>=v.fr[0]&&row<=v.lr[0]&&(rowPosMode===true||col>=v.fc[0]&&col<=v.lc[0])){if(rowPosMode===true){view.paint(g,v.fc[1],this.getRowY(row),v.lc[1]-v.fc[1]+this.colWidths[v.lc[0]],this.rowHeights[row],this)}else{view.paint(g,this.getColX(col),this.getRowY(row),this.colWidths[col],this.rowHeights[row],this)}}}};this.paintCellSelection=function(g,row,col,x,y){if(this.editingRow<0){var v=ui.focusManager.focusOwner===this?this.views.onselection:this.views.offselection;if(v!==null&&typeof v!=="undefined"){v.paint(g,x,y,this.colWidths[col],this.rowHeights[row],this)}}};this.rPsMetric=function(){var cols=this.getGridCols(),rows=this.getGridRows(),addW=this.cellInsetsLeft+this.cellInsetsRight,addH=this.cellInsetsTop+this.cellInsetsBottom,capPS=null,i=0;if(this.colWidths===null||this.colWidths.length!==cols){this.colWidths=Array(cols);for(;i<cols;i++)this.colWidths[i]=0}else{for(;i<cols;i++)this.colWidths[i]=0}if(this.rowHeights===null||this.rowHeights.length!==rows){this.rowHeights=Array(rows);for(i=0;i<rows;i++)this.rowHeights[i]=0}else{for(i=0;i<rows;i++)this.rowHeights[i]=0}for(i=0;i<cols;i++){for(var j=0;j<rows;j++){var v=this.provider.getView(this,j,i,this.model.get(j,i));if(v!==null){var ps=v.getPreferredSize();ps.width+=addW;ps.height+=addH;if(ps.width>this.colWidths[i])this.colWidths[i]=ps.width;if(ps.height>this.rowHeights[j])this.rowHeights[j]=ps.height}else{if(pkg.Grid.DEF_COLWIDTH>this.colWidths[i]){this.colWidths[i]=pkg.Grid.DEF_COLWIDTH}if(pkg.Grid.DEF_ROWHEIGHT>this.rowHeights[j]){this.rowHeights[j]=pkg.Grid.DEF_ROWHEIGHT}}}}if(this.topCaption!==null&&this.topCaption.isVisible===true){for(i=0;i<cols;i++){capPS=this.topCaption.getCaptionPS(i);if(capPS>this.colWidths[i])this.colWidths[i]=capPS}}if(this.leftCaption!==null&&this.leftCaption.isVisible===true){for(i=0;i<rows;i++){capPS=this.leftCaption.getCaptionPS(i);if(capPS>this.rowHeights[i])this.rowHeights[i]=capPS}}};this.getPSSize=function(rowcol,b){if(this.isUsePsMetric===true){return b?this.getRowHeight(rowcol):this.getColWidth(rowcol)}else{var max=0,count=b?this.getGridCols():this.getGridRows();for(var j=0;j<count;j++){var r=b?rowcol:j,c=b?j:rowcol,v=this.provider.getView(this,r,c,this.model.get(r,c));if(v!==null){var ps=v.getPreferredSize();if(b){if(ps.height>max)max=ps.height}else{if(ps.width>max)max=ps.width}}}return max+this.lineSize*2+(b?this.cellInsetsTop+this.cellInsetsBottom:this.cellInsetsLeft+this.cellInsetsRight)}};this.rCustomMetric=function(){var start=0;if(this.colWidths!==null){start=this.colWidths.length;if(this.colWidths.length!==this.getGridCols()){this.colWidths.length=this.getGridCols()}}else{this.colWidths=Array(this.getGridCols())}for(;start<this.colWidths.length;start++){this.colWidths[start]=pkg.Grid.DEF_COLWIDTH}start=0;if(this.rowHeights!==null){start=this.rowHeights.length;if(this.rowHeights.length!==this.getGridRows()){this.rowHeights.length=this.getGridRows()}}else{this.rowHeights=Array(this.getGridRows())}for(;start<this.rowHeights.length;start++){this.rowHeights[start]=pkg.Grid.DEF_ROWHEIGHT}};this.pageSize=function(d){this.validate();if(this.visibility.hasVisibleCells()&&this.position!==null){var off=this.position.offset;if(off>=0){var hh=this.visibleArea.height-this.getTopCaptionHeight(),sum=0,poff=off;for(;off>=0&&off<this.getGridRows()&&sum<hh;sum+=this.rowHeights[off]+this.lineSize,off+=d);return Math.abs(poff-off)}}return 0};this.setRowHeight=function(row,h){this.setRowsHeight(row,1,h);return this};this.setRowsHeight=function(row,len,h){if(this.isUsePsMetric===false){if(arguments.length===1){h=arguments[0];row=0;len=this.getGridRows()}if(len!==0){this.validateMetric();var b=false;for(var i=row;i<row+len;i++){if(this.rowHeights[i]!==h){this.psHeight_+=h-this.rowHeights[i];this.rowHeights[i]=h;b=true}}if(b===true){this.stopEditing(false);this.cachedHeight=this.getTop()+this.getBottom()+this.psHeight_+(this.topCaption!==null&&this.topCaption.isVisible===true?this.topCaption.getPreferredSize().height:0);if(this.parent!==null){this.parent.invalidate()}this.iRowVisibility(0);this.invalidateLayout();this.repaint()}}return this}};this.setColWidth=function(col,w){this.setColsWidth(col,1,w);return this};this.setColsWidth=function(col,len,w){if(this.isUsePsMetric===false){if(arguments.length===1){w=arguments[0];col=0;len=this.getGridCols()}if(len!==0){this.validateMetric();var b=false;for(var i=col;i<col+len;i++){if(this.colWidths[i]!==w){this.psWidth_+=w-this.colWidths[i];this.colWidths[i]=w;b=true}}if(b===true){this.stopEditing(false);this.cachedWidth=this.getRight()+this.getLeft()+this.psWidth_+(this.leftCaption!==null&&this.leftCaption.isVisible===true?this.leftCaption.getPreferredSize().width:0);if(this.parent!==null){this.parent.invalidate()}this.iColVisibility(0);this.invalidateLayout();this.repaint()}}return this}};this.matrixResized=function(target,prevRows,prevCols){this.clearSelect();this.vrp();if(this.position!==null){this.position.setOffset(null)}for(var i=0;i<this.kids.length;i++){if(typeof this.kids[i].matrixResized!=="undefined"){this.kids[i].matrixResized(target,prevRows,prevCols)}}};this.cellModified=function(target,row,col,prevValue){if(this.isUsePsMetric){this.invalidate()}for(var i=0;i<this.kids.length;i++){if(typeof this.kids[i].cellModified!=="undefined"){this.kids[i].cellModified(target,row,col,prevValue)}}};this.matrixSorted=function(target,info){this.clearSelect();this.vrp();for(var i=0;i<this.kids.length;i++){if(typeof this.kids[i].matrixSorted!=="undefined"){this.kids[i].matrixSorted(target,info)}}};this.setEditorProvider=function(p){if(p!==this.editors){this.stopEditing(true);this.editors=p}return this};this.setUsePsMetric=function(b){if(this.isUsePsMetric!==b){this.isUsePsMetric=b;this.vrp()}return this};this.setPosition=function(p){if(this.position!==p){if(this.position!==null){this.position.off(this)}this.position=p;if(this.position!==null){this.position.on(this);this.position.setMetric(this)}this.repaint()}return this};this.setViewProvider=function(p){if(this.provider!==p){this.provider=p;this.vrp()}return this};this.setModel=function(d){if(d!==this.model){this.clearSelect();if(Array.isArray(d))d=new this.clazz.Matrix(d);if(this.model!==null&&typeof this.model._!=="undefined"){this.model.off(this)}this.model=d;if(this.model!==null&&typeof this.model._!=="undefined"){this.model.on(this)}if(this.position!==null){this.position.setOffset(null)}this.vrp()}return this};this.setCellPadding=function(p){this.setCellPaddings(p,p,p,p);return this};this.setCellPaddings=function(t,l,b,r){if(t!==this.cellInsetsTop||l!==this.cellInsetsLeft||b!==this.cellInsetsBottom||r!==this.cellInsetsRight){this.cellInsetsTop=t;this.cellInsetsLeft=l;this.cellInsetsBottom=b;this.cellInsetsRight=r;this.vrp()}return this};this.setLineColor=function(c){if(c!==this.lineColor){this.lineColor=c;if(this.drawVerLines||this.drawHorLines){this.repaint()}}return this};this.setLineSize=function(s){if(s!==this.lineSize){this.lineSize=s;this.vrp()}return this};this.startEditing=function(row,col){this.stopEditing(true);if(this.editors!==null){var editor=this.editors.getEditor(this,row,col,this.getDataToEdit(row,col));if(editor!==null){this.editingRow=row;this.editingCol=col;if(editor.isPopupEditor===true){var p=zebkit.layout.toParentOrigin(this.getColX(col)+this.scrollManager.getSX(),this.getRowY(row)+this.scrollManager.getSY(),this);editor.setLocation(p.x,p.y);ui.makeFullyVisible(this.getCanvas(),editor);this.editor=editor;var $this=this;this.editor.winOpened=function(e){if(e.isShown===false){$this.stopEditing(typeof e.source.isAccepted!=="undefined"?e.source.isAccepted():false)}};ui.showModalWindow(this,editor,this)}else{this.add("editor",editor);this.repaintRows(this.editingRow,this.editingRow)}ui.focusManager.requestFocus(editor);return true}}return false};this.getDataToEdit=function(row,col){return this.model.get(row,col)};this.setEditedData=function(row,col,value){this.model.put(row,col,value)};this.setLeftCaption=function(){if(this.leftCaption!==null){this.leftCaption.removeMe()}this.add("left",new pkg.GridCaption(Array.prototype.slice.call(arguments)));return this};this.setTopCaption=function(){if(this.topCaption!==null){this.topCaption.removeMe()}this.add("top",new pkg.GridCaption(Array.prototype.slice.call(arguments)));return this}},function focused(){this.$super();this.repaint()},function invalidate(){this.$super();this.iColVisibility(0);this.iRowVisibility(0)},function kidAdded(index,ctr,c){this.$super(index,ctr,c);if(ctr===null&&this.topCaption===null||"top"===ctr){this.topCaption=c}else{if("editor"===ctr)this.editor=c;else{if(ctr===null&&this.leftCaption===null||"left"===ctr){this.leftCaption=c}else{if(ctr===null&&this.stub===null||"corner"===ctr){this.stub=c}}}}},function kidRemoved(index,c){this.$super(index,c);if(c===this.editor)this.editor=null;else{if(c===this.topCaption){this.topCaption=null}else{if(c===this.leftCaption){this.leftCaption=null}else{if(c===this.stub)this.stub=null}}}}]);var ui=pkg.cd("..");pkg.GridStretchPan=Class(ui.Panel,[function(grid){this.$super(this);this.grid=grid;this.$widths=[];this.$prevWidth=0;this.$propW=-1;this.add(grid)},function $prototype(){this.$props=this.$strPs=null;this.grid=null;this.calcPreferredSize=function(target){this.recalcPS();return target.kids.length===0||target.grid.isVisible===false?{width:0,height:0}:{width:this.$strPs.width,height:this.$strPs.height}};this.doLayout=function(target){this.recalcPS();if(target.kids.length>0){var grid=this.grid,left=target.getLeft(),top=target.getTop();if(grid.isVisible===true){grid.setBounds(left,top,target.width-left-target.getRight(),target.height-top-target.getBottom());for(var i=0;i<this.$widths.length;i++){grid.setColWidth(i,this.$widths[i])}}}};this.captionResized=function(src,col,pw){if(col<this.$widths.length-1){var grid=this.grid,w=grid.getColWidth(col),dt=w-pw;if(dt<0){grid.setColWidth(col+1,grid.getColWidth(col+1)-dt)}else{var ww=grid.getColWidth(col+1)-dt,mw=this.getMinWidth();if(ww<mw){grid.setColWidth(col,w-(mw-ww));grid.setColWidth(col+1,mw)}else{grid.setColWidth(col+1,ww)}}this.$propW=-1}};this.getMinWidth=function(){return zebkit.instanceOf(this.grid.topCaption,pkg.BaseCaption)?this.grid.topCaption.minSize:10};this.calcColWidths=function(targetAreaW){var grid=this.grid,cols=grid.getGridCols(),ew=targetAreaW-(this.$props.length+1)*grid.lineSize,sw=0;if(this.$widths.length!==cols){this.$widths=Array(cols)}for(var i=0;i<cols;i++){if(this.$props.length-1===i){this.$widths[i]=ew-sw}else{this.$widths[i]=Math.round(ew*this.$props[i]);sw+=this.$widths[i]}}};this.recalcPS=function(){var grid=this.grid;if(grid!==null&&grid.isVisible===true){var p=this.parent,isScr=zebkit.instanceOf(p,ui.ScrollPan),taWidth=isScr?p.width-p.getLeft()-p.getRight()-this.getRight()-this.getLeft():this.width-this.getRight()-this.getLeft(),taHeight=isScr?p.height-p.getTop()-p.getBottom()-this.getBottom()-this.getTop():this.height-this.getBottom()-this.getTop();if(this.grid.leftCaption!==null&&this.grid.leftCaption.isVisible===true){taWidth-=this.grid.leftCaption.getPreferredSize().width}if(this.$strPs===null||this.$prevWidth!==taWidth){var cols=grid.getGridCols();if(this.$propW<0||this.$props===null||this.$props.length!==cols){if(this.$props===null||this.$props.length!==cols){this.$props=Array(cols)}this.$propW=0;var i=0,w=0;for(i=0;i<cols;i++){w=grid.getColWidth(i);if(w===0)w=grid.getColPSWidth(i);this.$propW+=w}for(i=0;i<cols;i++){w=grid.getColWidth(i);if(w===0)w=grid.getColPSWidth(i);this.$props[i]=w/this.$propW}}this.$prevWidth=taWidth;this.calcColWidths(taWidth);this.$strPs={width:taWidth,height:grid.getPreferredSize().height};if(isScr===true&&p.height>0&&(typeof p.vBar!=="undefined"||p.vBar===null)&&p.autoHide===false&&taHeight<this.$strPs.height){taWidth-=p.vBar.getPreferredSize().width;this.calcColWidths(taWidth);this.$strPs.width=taWidth}}}}},function kidAdded(index,constr,l){this.$propsW=-1;if(l.topCaption!==null){l.topCaption.on(this)}this.scrollManager=l.scrollManager;this.$super(index,constr,l)},function kidRemoved(i,l){this.$propsW=-1;if(l.topCaption!==null){l.topCaption.off(this)}this.scrollManager=null;this.$super(i,l)},function invalidate(){this.$strPs=null;this.$super()}]);zebkit.ui.$configWith(pkg)});zebkit.package("ui.design",function(pkg,Class){var ui=pkg.cd("..");var CURSORS={left:ui.Cursor.W_RESIZE,right:ui.Cursor.E_RESIZE,top:ui.Cursor.N_RESIZE,bottom:ui.Cursor.S_RESIZE,topLeft:ui.Cursor.NW_RESIZE,topRight:ui.Cursor.NE_RESIZE,bottomLeft:ui.Cursor.SW_RESIZE,bottomRight:ui.Cursor.SE_RESIZE,center:ui.Cursor.MOVE,none:ui.Cursor.DEFAULT};pkg.ShaperBorder=Class(ui.View,[function $prototype(){this.color="blue";this.gap=7;function contains(x,y,gx,gy,ww,hh){return gx<=x&&gx+ww>x&&gy<=y&&gy+hh>y}this.paint=function(g,x,y,w,h,d){var cx=Math.floor((w-this.gap)/2),cy=Math.floor((h-this.gap)/2);g.setColor(this.color);g.beginPath();g.rect(x,y,this.gap,this.gap);g.rect(x+cx,y,this.gap,this.gap);g.rect(x,y+cy,this.gap,this.gap);g.rect(x+w-this.gap,y,this.gap,this.gap);g.rect(x,y+h-this.gap,this.gap,this.gap);g.rect(x+cx,y+h-this.gap,this.gap,this.gap);g.rect(x+w-this.gap,y+cy,this.gap,this.gap);g.rect(x+w-this.gap,y+h-this.gap,this.gap,this.gap);g.fill();g.beginPath();g.rect(x+Math.floor(this.gap/2)+.5,y+Math.floor(this.gap/2)+.5,w-this.gap,h-this.gap);g.stroke()};this.detectAt=function(target,x,y){if(contains(x,y,this.gap,this.gap,target.width-2*this.gap,target.height-2*this.gap)){return"center"}if(contains(x,y,0,0,this.gap,this.gap)){return"topLeft"}if(contains(x,y,0,target.height-this.gap,this.gap,this.gap)){return"bottomLeft"}if(contains(x,y,target.width-this.gap,0,this.gap,this.gap)){return"topRight"}if(contains(x,y,target.width-this.gap,target.height-this.gap,this.gap,this.gap)){return"bottomRight"}var mx=Math.floor((target.width-this.gap)/2);if(contains(x,y,mx,0,this.gap,this.gap)){return"top"}if(contains(x,y,mx,target.height-this.gap,this.gap,this.gap)){return"bottom"}var my=Math.floor((target.height-this.gap)/2);if(contains(x,y,0,my,this.gap,this.gap)){return"left"}return contains(x,y,target.width-this.gap,my,this.gap,this.gap)?"right":"none"}}]);pkg.ShaperPan=Class(ui.Panel,[function $clazz(){this.colors=["lightGray","blue"]},function $prototype(){this.colors=null;this.minHeight=this.minWidth=12;this.canHaveFocus=this.isResizeEnabled=this.isMoveEnabled=true;this.state=null;this.catchInput=true;this.getCursorType=function(t,x,y){return this.kids.length>0?CURSORS[this.shaperBr.detectAt(t,x,y)]:null};this.keyPressed=function(e){if(this.kids.length>0){var dx=e.code==="ArrowLeft"?-1:e.code==="ArrowRight"?1:0,dy=e.code==="ArrowUp"?-1:e.code==="ArrowDown"?1:0,w=this.width+dx,h=this.height+dy,x=this.x+dx,y=this.y+dy;if(e.shiftKey){if(this.isResizeEnabled===true&&w>this.shaperBr.gap*2&&h>this.shaperBr.gap*2){this.setSize(w,h)}}else{if(this.isMoveEnabled){if(x+this.width/2>0&&y+this.height/2>0&&x<this.parent.width-this.width/2&&y<this.parent.height-this.height/2){this.setLocation(x,y)}}}}};this.pointerDragStarted=function(e){this.state=null;if(this.isResizeEnabled||this.isMoveEnabled){var t=this.shaperBr.detectAt(this,e.x,e.y);if(this.isMoveEnabled===true||t!=="center"||(this.isResizeEnabled===true||t==="center")){this.state={top:t==="top"||t==="topLeft"||t==="topRight"?1:0,left:t==="left"||t==="topLeft"||t==="bottomLeft"?1:0,right:t==="right"||t==="topRight"||t==="bottomRight"?1:0,bottom:t==="bottom"||t==="bottomRight"||t==="bottomLeft"?1:0};this.px=e.absX;this.py=e.absY}}};this.pointerDragged=function(e){if(this.state!==null){var dy=e.absY-this.py,dx=e.absX-this.px,s=this.state,nw=this.width-dx*s.left+dx*s.right,nh=this.height-dy*s.top+dy*s.bottom;if(nw>=this.minWidth&&nh>=this.minHeight){this.px=e.absX;this.py=e.absY;if(s.top+s.right+s.bottom+s.left===0){this.setLocation(this.x+dx,this.y+dy)}else{this.setBounds(this.x+dx*s.left,this.y+dy*s.top,nw,nh)}}}};this.setColor=function(b,color){var rp=false;if(this.colors===null){this.colors=["lightGray","blue"];rp=true}var oldCol=this.colors[b?1:0];if(oldCol!==color){this.colors[b?1:0]=color;rp=true}var hasFocus=this.hasFocus();if(this.shaperBr.color!==this.colors[hasFocus?1:0]){this.shaperBr.color=this.colors[hasFocus?1:0];rp=true}if(rp){this.repaint()}return this};this.setColors=function(col1,col2){this.setColor(false,col1);if(arguments.length>1){this.setColor(true,col2)}return this}},function insert(i,constr,d){if(this.kids.length>0){this.removeAll()}var top=this.getTop(),left=this.getLeft();if(d.width===0||d.height===0){d.toPreferredSize()}this.setBounds(d.x-left,d.y-top,d.width+left+this.getRight(),d.height+top+this.getBottom());this.$super(i,"center",d)},function focused(){this.$super();this.shaperBr.color=this.colors[this.hasFocus()?1:0];this.repaint()},function(t){this.shaperBr=new pkg.ShaperBorder;this.$super(new zebkit.layout.BorderLayout);this.px=this.py=0;this.setBorder(this.shaperBr);if(arguments.length>0){this.add(t)}}]);pkg.FormTreeModel=Class(zebkit.data.TreeModel,[function $prototype(){this.buildModel=function(comp,root){var b=typeof this.exclude!=="undefined"&&this.exclude(comp),item=b?root:this.createItem(comp);for(var i=0;i<comp.kids.length;i++){var r=this.buildModel(comp.kids[i],item);if(r!==null){r.parent=item;item.kids.push(r)}}return b?null:item};this.itemByComponent=function(c,r){if(arguments.length<2)r=this.root;if(r.comp===c)return c;for(var i=0;i<r.kids.length;i++){var item=this.itemByComponent(c,r.kids[i]);if(item!==null)return item}return null};this.createItem=function(comp){var name=comp.clazz.$name;if(typeof name==="undefined")name=comp.toString();var index=name.lastIndexOf("."),item=new zebkit.data.Item(index>0?name.substring(index+1):name);item.comp=comp;return item}},function(target){this.$super(this.buildModel(target,null))}])});zebkit.package("web",function(pkg,Class){"use strict";pkg.$deviceRatio=typeof window.devicePixelRatio!=="undefined"?window.devicePixelRatio:typeof window.screen.deviceXDPI!=="undefined"?window.screen.deviceXDPI/window.screen.logicalXDPI:1;pkg.$windowSize=function(){return{width:window.innerWidth,height:window.innerHeight}};pkg.$viewPortSize=function(){var ws=pkg.$windowSize(),body=document.body,css=["margin-left","margin-right","margin-top","margin-bottom","padding-left","padding-right","padding-top","padding-bottom","border-left-width","border-right-width","border-top-width","border-bottom-width"];for(var i=0;i<css.length;){ws.width-=pkg.$measure(body,css[i++])+pkg.$measure(body,css[i++]);ws.height-=pkg.$measure(body,css[i++])+pkg.$measure(body,css[i++])}return ws};pkg.$measure=function(e,cssprop){var value=window.getComputedStyle(e,null).getPropertyValue(cssprop);return value===null||value===""?0:parseInt(/(^[0-9\.]+)([a-z]+)?/.exec(value)[1],10)};pkg.$contains=function(element){return typeof document.contains!=="undefined"&&document.contains(element)||typeof document.body.contains!=="undefined"&&document.body.contains(element)};pkg.$isInsideElement=function(element,pageX,pageY){var r=element.getBoundingClientRect();return r!==null&&pageX>=r.left&&pageY>=r.top&&pageX<=r.right-1&&pageY<=r.bottom-1};var $focusInOutSupported=function(){var support=false,parent=document.lastChild,a=document.createElement("a");a.href="#";a.setAttribute("style","position:fixed;left:-99em;top:-99em;");a.addEventListener("focusin",function(){support=true});parent.appendChild(a).focus();parent.removeChild(a);return support}();pkg.$focusin=function(element,f,b){return element.addEventListener($focusInOutSupported?"focusin":"focus",f,b)};pkg.$focusout=function(element,f,b){return element.addEventListener($focusInOutSupported?"focusout":"blur",f,b)};pkg.$eventsBlackHole=function(e){e.preventDefault();e.stopPropagation()};pkg.$createBlockedElement=function(){var be=document.createElement("div");be.style.height=be.style.width="100%";be.style.left=be.style.top="0px";be.style.position="absolute";be.style["z-index"]="100000";be.setAttribute("zebkit","blockedElement");be.onmouseup=be.onmousedown=be.onmouseout=be.onmouseover=be.onmousemove=be.onkeydown=be.onkeypress=be.onkeyup=pkg.$eventsBlackHole;var events=["touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","pointerenter","pointerleave"];for(var i=0;i<events.length;i++){be.addEventListener(events[i],pkg.$eventsBlackHole,false)}return be};pkg.$2DContextMethods={setFont:function(f){f=typeof f.s!=="undefined"?f.s:f.toString();if(f!==this.font){this.font=f}},setColor:function(c){c=typeof c.s!=="undefined"?c.s:c.toString();if(c!==this.fillStyle)this.fillStyle=c;if(c!==this.strokeStyle)this.strokeStyle=c},drawLine:function(x1,y1,x2,y2,w){if(arguments.length<5)w=1;var pw=this.lineWidth;this.beginPath();if(this.lineWidth!==w)this.lineWidth=w;if(x1===x2){x1+=w/2;x2=x1}else if(y1===y2){y1+=w/2;y2=y1}this.moveTo(x1,y1);this.lineTo(x2,y2);this.stroke();if(pw!==this.lineWidth)this.lineWidth=pw},ovalPath:function(x,y,w,h){this.beginPath();x+=this.lineWidth;y+=this.lineWidth;w-=2*this.lineWidth;h-=2*this.lineWidth;var kappa=.5522848,ox=Math.floor(w/2*kappa),oy=Math.floor(h/2*kappa),xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;this.moveTo(x,ym);this.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);this.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);this.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);this.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);this.closePath()},polylinePath:function(xPoints,yPoints,nPoints){this.beginPath();this.moveTo(xPoints[0],yPoints[0]);for(var i=1;i<nPoints;i++)this.lineTo(xPoints[i],yPoints[i])},drawDottedRect:function(x,y,w,h){var ctx=this,m=["moveTo","lineTo","moveTo"];function dv(x,y,s){for(var i=0;i<s;i++)ctx[m[i%3]](x+.5,y+i)}function dh(x,y,s){for(var i=0;i<s;i++)ctx[m[i%3]](x+i,y+.5)}ctx.beginPath();dh(x,y,w);dh(x,y+h-1,w);ctx.stroke();ctx.beginPath();dv(x,y,h);dv(w+x-1,y,h);ctx.stroke()},drawDashLine:function(x,y,x2,y2){var pattern=[1,2],compute=null,dx=x2-x,dy=y2-y,b=Math.abs(dx)>Math.abs(dy),slope=b?dy/dx:dx/dy,sign=b?dx<0?-1:1:dy<0?-1:1,dist=Math.sqrt(dx*dx+dy*dy);if(b){compute=function(step){x+=step;y+=slope*step}}else{compute=function(step){x+=slope*step;y+=step}}this.beginPath();this.moveTo(x,y);for(var i=0;dist>=.1;i++){var idx=i%pattern.length,dl=dist<pattern[idx]?dist:pattern[idx],step=Math.sqrt(dl*dl/(1+slope*slope))*sign;compute(step);this[i%2===0?"lineTo":"moveTo"](x+.5,y+.5);dist-=dl}this.stroke()}};pkg.$extendContext=function(ctx,methods){for(var k in methods){if(k==="$init"){methods[k].call(ctx)}else{var old=ctx[k];if(typeof old!=="undefined"){var kk="$"+k;if(typeof ctx[kk]==="undefined"){ctx[kk]=old}}ctx[k]=methods[k]}}};pkg.$canvas=function(c,w,h,forceResize){var cs=window.getComputedStyle(c,null),cw=parseInt(cs.getPropertyValue("width"),10),ch=parseInt(cs.getPropertyValue("height"),10),ctx=c.getContext("2d"),updateRatio=false;if(isNaN(parseInt(c.style.width))||isNaN(parseInt(c.style.height))){c.style.width=""+cw+"px";c.style.height=""+ch+"px";updateRatio=true}if(arguments.length>1){if(cw!==w||ch!==h){c.style.width=""+w+"px";c.style.height=""+h+"px";updateRatio=true}cw=w;ch=h}if(typeof ctx.$ratio==="undefined"){ctx.$ratio=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.backingStorePixelRatio||ctx.backingStorePixelRatio||1;ctx.$getImageData=ctx.getImageData;ctx.$scale=ctx.scale;if(pkg.$deviceRatio!=ctx.$ratio){var r=pkg.$deviceRatio/ctx.$ratio;ctx.getImageData=function(x,y,w,h){return this.$getImageData(x*r,y*r,w,h)}}pkg.$extendContext(ctx,pkg.$2DContextMethods)}if(ctx.$ratio!=pkg.$deviceRatio){var ratio=pkg.$deviceRatio/ctx.$ratio;cw=~~(cw*ratio);ch=~~(ch*ratio);if(c.width!=cw||c.height!=ch||updateRatio===true||forceResize===true){c.width=cw;c.height=ch;ctx.$scale(ratio,ratio)}}else{if(c.width!=cw||c.height!=ch||forceResize===true){c.width=cw;c.height=ch}}if(ctx.textBaseline!=="top"){ctx.textBaseline="top"}return ctx};function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;function $dupKeyEvent(e,id,target){var k=new CustomEvent(id);k.keyCode=e.keyCode;k.key=e.key;k.code=e.code;k.ctrlKey=e.ctrlKey;k.altKey=e.altKey;k.shiftKey=e.shiftKey;k.metaKey=e.metaKey;k.which=e.which;return k}pkg.Clipboard=Class(zebkit.ui.Clipboard,[function(triggerKeyCode){if(document.getElementById(this.clazz.id)!==null){throw new Error("Duplicated clipboard element")}if(arguments.length>0&&triggerKeyCode!==null){this.triggerKeyCode=triggerKeyCode}else{this.triggerKeyCode=zebkit.isMacOS?"MetaLeft":"Control"}if(this.triggerKeyCode!==null){this.$clipboard=document.createElement("textarea");this.$clipboard.setAttribute("style","display:none;position:fixed;left:-99em;top:-99em;");this.$clipboard.setAttribute("id",this.clazz.id);this.$element=null;var $this=this;window.addEventListener("keydown",function(e){var dest=$this.getDestination();if(dest!==null){if(typeof dest.clipCopy!=="undefined"||typeof dest.clipPaste!=="undefined"){if(zebkit.web.$fetchKeyCode(e)===$this.triggerKeyCode){$this.$on("1")}}}},true);this.$clipboard.onkeydown=function(ee){$this.$element.dispatchEvent($dupKeyEvent(ee,"keydown",this.$element));$this.$clipboard.value="1";$this.$clipboard.select()};this.$clipboard.onkeyup=function(ee){if(zebkit.web.$fetchKeyCode(ee)===$this.triggerKeyCode){$this.$clipboard.style.display="none";$this.$element.focus()}$this.$element.dispatchEvent($dupKeyEvent(ee,"keyup",$this.$element))};this.$clipboard.onfocus=function(e){if($this.$element==null&&e.relatedTarget!=null){$this.$element=e.relatedTarget}};this.$clipboard.onblur=function(){this.value="";this.style.display="none";$this.$element.focus()};this.$clipboard.oncopy=function(ee){var dest=$this.getDestination();if(dest!==null&&typeof dest.clipCopy!=="undefined"){var v=dest.clipCopy();$this.$clipboard.value=v===null||typeof v==="undefined"?"":v;$this.$clipboard.select();if(typeof $this.clipCopy!=="undefined"){$this.clipCopy(v,$this.$clipboard.value)}}};this.$clipboard.oncut=function(ee){var dest=$this.getDestination();if(dest!==null&&typeof dest.cut!=="undefined"){$this.$clipboard.value=dest.cut();$this.$clipboard.select();if(typeof $this.clipCut!=="undefined"){$this.clipCut(dest,$this.$clipboard.value)}}};if(zebkit.isFF===true){this.$clipboard.addEventListener("input",function(ee){var dest=$this.getDestination();if(dest!==null&&typeof dest.clipPaste!=="undefined"){dest.clipPaste($this.$clipboard.value);if(typeof $this.clipPaste!=="undefined"){$this.clipPaste(dest,$clipboard.value)}}},false)}else{this.$clipboard.onpaste=function(ee){var dest=$this.getDestination();if(dest!==null&&typeof dest.clipPaste!=="undefined"){var txt=typeof ee.clipboardData==="undefined"?window.clipboardData.getData("Text"):ee.clipboardData.getData("text/plain");dest.clipPaste(txt);if(typeof $this.clipPaste!=="undefined"){$this.clipPaste(dest,txt)}}$this.$clipboard.value=""}}document.body.appendChild(this.$clipboard)}},function $clazz(){this.id="zebkitClipboardBuffer"},function $prototype(){this.triggerKeyCode=null;this.write=function(txt){try{this.$on(txt);if(typeof document.execCommand!=="undefined"&&document.execCommand("copy")!==true){throw new Error("Unsupported 'copy' clipboard command")}}finally{this.$off()}};this.read=function(){try{var clip=this.$on("");if(typeof document.execCommand!=="undefined"&&document.execCommand("paste",null,null)){return clip.value}else{throw new Error("Unsupported 'paste' clipboard command")}}finally{this.$off()}};this.$off=function(){if(this.$clipboard.style.display!=="none"){this.$clipboard.value="";this.$clipboard.style.display="none";this.$element.focus()}};this.$on=function(txt){this.$off();this.$element=document.activeElement;this.$clipboard.style.display="block";this.$clipboard.value=arguments.length>0?txt:"1";this.$clipboard.select();this.$clipboard.focus();return this.$clipboard}}]);new pkg.Clipboard;if(typeof pkg.doubleClickDelta==="undefined"){pkg.doubleClickDelta=280}var PI4=Math.PI/4,PI4_3=PI4*3,$enteredElement=null,$tmpWinMouseMoveListener=null,$lastPointerReleased=null,$pointerPressedEvents={},LMOUSE="lmouse",RMOUSE="rmouse";pkg.PointerEvent=Class(zebkit.ui.PointerEvent,[function $prototype(){this.isAction=function(){return this.identifier!==RMOUSE&&this.touchCounter===1};this.$fillWith=function(identifier,e){this.pageX=Math.floor(e.pageX);this.pageY=Math.floor(e.pageY);this.target=e.target;this.identifier=identifier;this.altKey=typeof e.altKey!=="undefined"?e.altKey:false;this.shiftKey=typeof e.shiftKey!=="undefined"?e.shiftKey:false;this.ctrlKey=typeof e.ctrlKey!=="undefined"?e.ctrlKey:false;this.metaKey=typeof e.metaKey!=="undefined"?e.metaKey:false;this.pressure=typeof e.pressure!=="undefined"?e.pressure:.5};this.getTouches=function(){var touches=[],i=0;for(var k in pkg.$pointerPressedEvents){var pe=pkg.$pointerPressedEvents[k];touches[i++]={pageX:pe.pageX,pageY:pe.pageY,identifier:pe.identifier,target:pe.target,pressure:pe.pressure,pointerType:pe.stub.pointerType}}return touches}}]);var ME_STUB=new pkg.PointerEvent,TOUCH_STUB=new pkg.PointerEvent,POINTER_STUB=new pkg.PointerEvent;ME_STUB.pointerType="mouse";TOUCH_STUB.pointerType="touch";POINTER_STUB.pointerType="unknown";function $cleanDragFix(){if($tmpWinMouseMoveListener!==null&&$pointerPressedEvents.hasOwnProperty(LMOUSE)===false&&$pointerPressedEvents.hasOwnProperty(RMOUSE)===false){window.removeEventListener("mousemove",$tmpWinMouseMoveListener,true);$tmpWinMouseMoveListener=null;return true}return false}function isIn(t,id){for(var i=0;i<t.length;i++){if(t[i].identifier===id)return true}return false}pkg.PointerEventUnifier=Class([function $clazz(){document.addEventListener("mouseup",function(e){if(e.button===0||e.button===2){var id=e.button===0?LMOUSE:RMOUSE;if($pointerPressedEvents.hasOwnProperty(id)){var mp=$pointerPressedEvents[id];if(mp.$adapter.element!==e.target&&mp.$adapter.element.contains(e.target)===false){try{if($enteredElement!==null){$enteredElement=null;mp.$adapter.destination.$pointerExited(ME_STUB)}}finally{mp.$adapter.$UP(id,e,ME_STUB)}}}}},false)},function $prototype(){this.$timer=null;this.$queue=[];this.$touchedAt=function(pageX,pageY,d){var lx=pageX-d,ty=pageY-d,rx=pageX+d,by=pageY+d;for(var k in $pointerPressedEvents){if(k!==LMOUSE&&k!==RMOUSE){var e=$pointerPressedEvents[k];if(e.pageX>=lx&&e.pageY>=ty&&e.pageX<=rx&&e.pageY<=by){return true}}}return false};this.$DRAG=function(id,e,stub){if($pointerPressedEvents.hasOwnProperty(id)){var mp=$pointerPressedEvents[id];if(mp.$adapter.element===this.element){if(this.$timer===null){stub.$fillWith(id,e);var dx=stub.pageX-mp.pageX,dy=stub.pageY-mp.pageY,d=mp.direction;mp.$adx+=dx;mp.$ady+=dy;mp.pageX=stub.pageX;mp.pageY=stub.pageY;if(Math.abs(mp.$adx)>4||Math.abs(mp.$ady)>4){var gamma=Math.atan2(mp.$ady,mp.$adx);if(gamma>-PI4){d=gamma<PI4?"right":gamma<PI4_3?"bottom":"left"}else{d=gamma>-PI4_3?"top":"left"}mp.direction=d;mp.$ady=mp.$adx=0;mp.gamma=gamma}stub.direction=mp.direction;stub.dx=dx;stub.dy=dy;try{if(mp.isDragged===false){this.destination.$pointerDragStarted(stub)}if(mp.isDragged===false||dx!==0||dy!==0){this.destination.$pointerDragged(stub)}}finally{mp.isDragged=true}}}else{mp.$adapter.$DRAG(id,e,stub)}}};this.$fireUP=function(id,e,mp,stub,destination){try{stub.$fillWith(id,e);stub.pressPageX=mp.pressPageX;stub.pressPageY=mp.pressPageY;if(mp.isDragged===true){destination.$pointerDragEnded(stub)}else{if(mp.pressPageY===stub.pageY&&mp.pressPageX===stub.pageX){if($lastPointerReleased!==null&&$lastPointerReleased.identifier===id&&(new Date).getTime()-$lastPointerReleased.time<=pkg.doubleClickDelta){destination.$pointerDoubleClicked(stub)}else{if(mp.group===stub.touchCounter){destination.$pointerClicked(stub)}}}}destination.$pointerReleased(stub)}finally{if(stub.touchCounter>0)stub.touchCounter--;$lastPointerReleased=$pointerPressedEvents.hasOwnProperty(id)?$pointerPressedEvents[id]:null;delete $pointerPressedEvents[id];$cleanDragFix()}};this.$UP=function(id,e,stub){if(this.$timer!==null){clearTimeout(this.$timer);this.$timer=null}var isPressedInQ=false;for(var i=0;i<this.$queue.length;i++){if(this.$queue[i].identifier===id){isPressedInQ=true;break}}this.$firePressedFromQ();if($pointerPressedEvents.hasOwnProperty(id)){var mp=$pointerPressedEvents[id];if(this.element!==mp.$adapter.element){$enteredElement=null;try{stub.$fillWith(id,e);mp.$adapter.destination.$pointerExited(stub);$enteredElement=this.element;this.destination.$pointerEntered(stub)}catch(ee){$enteredElement=this.element;throw ee}finally{mp.$adapter.$UP(id,e,stub)}}else{if(isPressedInQ){var $this=this;setTimeout(function(){$this.$fireUP(id,e,mp,stub,$this.destination)},50)}else{this.$fireUP(id,e,mp,stub,this.destination)}}}};this.$indexOfQ=function(id){for(var i=0;i<this.$queue.length;i++){if(id===this.$queue[i].identifier)return i}return-1};this.$firePressedFromQ=function(){if(this.$queue.length>0){var l=this.$queue.length;for(var i=0;i<l;i++){var t=this.$queue[i];try{$pointerPressedEvents[t.identifier]=t;t.stub.$fillWith(t.identifier,t);t.group=l;if(this.destination.$pointerPressed(t.stub)===true){if(t.stub.touchCounter>0){t.stub.touchCounter--}delete $pointerPressedEvents[t.identifier]}}catch(ex){if(t.stub.touchCounter>0){t.stub.touchCounter--}delete $pointerPressedEvents[t.identifier];zebkit.dumpError(ex)}}this.$queue.length=0}};this.$DOWN=function(id,e,stub){$cleanDragFix();var i=this.$indexOfQ(id);if(i>=0){this.$queue.splice(i,1)}if($pointerPressedEvents.hasOwnProperty(id)){var mp=$pointerPressedEvents[id];mp.$adapter.$UP(id,e,mp.stub)}stub.touchCounter++;try{var q={target:e.target,direction:null,identifier:id,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,ctrlKey:e.ctrlKey,time:(new Date).getTime(),$adapter:this,$adx:0,$ady:0,isDragged:false,stub:stub};q.pageX=q.pressPageX=Math.floor(e.pageX);q.pageY=q.pressPageY=Math.floor(e.pageY);this.$queue.push(q);if(this.$queue.length>0&&this.$timer===null){var $this=this;this.$timer=setTimeout(function(){$this.$timer=null;$this.$firePressedFromQ()},25)}}catch(ee){if(stub.touchCounter>0)stub.touchCounter--;throw ee}};this.$MMOVE=function(e){var pageX=Math.floor(e.pageX),pageY=Math.floor(e.pageY);if(this.$mousePageY!==pageY||this.$mousePageX!==pageX){this.$mousePageX=pageX;this.$mousePageY=pageY;if($pointerPressedEvents.hasOwnProperty(LMOUSE)||$pointerPressedEvents.hasOwnProperty(RMOUSE)){if($pointerPressedEvents.hasOwnProperty(LMOUSE)){this.$DRAG(LMOUSE,e,ME_STUB)}if($pointerPressedEvents.hasOwnProperty(RMOUSE)){this.$DRAG(RMOUSE,e,ME_STUB)}}else{ME_STUB.$fillWith("mouse",e);this.destination.$pointerMoved(ME_STUB)}}}},function(element,destination){if(element===null||typeof element==="undefined"){throw new Error("Invalid DOM element")}if(destination===null||typeof destination==="undefined"){throw new Error("Invalid destination")}this.destination=destination;this.element=element;var $this=this;element.onmousedown=function(e){if(e.button!==0&&e.button!==2||$this.$touchedAt(e.pageX,e.pageY,0)){e.preventDefault()}else{$this.$DOWN(e.button===0?LMOUSE:RMOUSE,e,ME_STUB);e.stopPropagation()}};element.onmouseup=function(e){if(e.button!==0&&e.button!==2){e.preventDefault()}else{var id=e.button===0?LMOUSE:RMOUSE;$this.$UP(id,e,ME_STUB);if(typeof e.stopPropagation!=="undefined"){e.stopPropagation()}}};element.onmouseover=function(e){if($this.$touchedAt(e.pageX,e.pageY,0)){e.preventDefault()}else{var id=e.button===0?LMOUSE:RMOUSE;if($pointerPressedEvents.hasOwnProperty(id)===false){$cleanDragFix();if($enteredElement===null||$enteredElement.contains(e.target)===false&&$enteredElement!==e.target){ME_STUB.$fillWith("mouse",e);$enteredElement=element;destination.$pointerEntered(ME_STUB)}}else{if(element===e.target||element.contains(e.target)){$cleanDragFix()}}e.stopPropagation()}};element.onmouseout=function(e){var id=e.button===0?LMOUSE:RMOUSE;if($pointerPressedEvents.hasOwnProperty(id)===false){if($enteredElement!==null&&(e.relatedTarget!=null&&e.relatedTarget!==element&&element.contains(e.relatedTarget)===false)){$enteredElement=null;ME_STUB.$fillWith("mouse",e);if(zebkit.web.$isInsideElement(element,e.pageX,e.pageY)===false){destination.$pointerExited(ME_STUB)}}}else{var mp=$pointerPressedEvents[id];if($tmpWinMouseMoveListener===null&&e.relatedTarget!=null&&element.contains(e.relatedTarget)===false){if(id===LMOUSE||id===RMOUSE){$tmpWinMouseMoveListener=function(ee){ee.stopPropagation();if($pointerPressedEvents.hasOwnProperty(LMOUSE)){$this.$DRAG(LMOUSE,{pageX:ee.pageX,pageY:ee.pageY,target:mp.target},ME_STUB)}if($pointerPressedEvents.hasOwnProperty(RMOUSE)){$this.$DRAG(RMOUSE,{pageX:ee.pageX,pageY:ee.pageY,target:mp.target},ME_STUB)}ee.preventDefault()};window.addEventListener("mousemove",$tmpWinMouseMoveListener,true)}}}$this.$mousePageX=$this.$mousePageY=-1;e.stopPropagation()};if("onpointerdown"in window||"onmspointerdown"in window){var names="onpointerdown"in window?["pointerdown","pointerup","pointermove","pointerenter","pointerleave"]:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerEnter","MSPointerLeave"];element.addEventListener(names[0],function(e){var pt=e.pointerType;if(pt===4){pt="mouse"}else if(pt===2){pt="touch"}else if(pt===3){pt="pen"}if(pt!=="mouse"){POINTER_STUB.touch=e;POINTER_STUB.pointerType=pt;$this.$DOWN(e.pointerId,e,POINTER_STUB)}},false);element.addEventListener(names[1],function(e){var pt=e.pointerType;if(pt===4){pt="mouse"}else if(pt===2){pt="touch"}else if(pt===3){pt="pen"}if(pt!=="mouse"){POINTER_STUB.touch=e;POINTER_STUB.pointerType=pt;$this.$UP(e.pointerId,e,POINTER_STUB)}},false);element.addEventListener(names[2],function(e){var pt=e.pointerType;if(pt===4){pt="mouse"}else if(pt===2){pt="touch"}else if(pt===3){pt="pen"}if(pt!=="mouse"){POINTER_STUB.touch=e;POINTER_STUB.pointerType=pt;$this.$DRAG(e.pointerId,e,POINTER_STUB)}else{$this.$MMOVE(e)}},false)}else{element.addEventListener("touchstart",function(e){var allTouches=e.touches,newTouches=e.changedTouches;$this.$mousePageX=Math.floor(e.pageX);$this.$mousePageY=Math.floor(e.pageY);for(var i=0;i<newTouches.length;i++){var newTouch=newTouches[i];$this.$DOWN(newTouch.identifier,newTouch,TOUCH_STUB)}for(var k in $pointerPressedEvents){if(isIn(allTouches,k)===false){var tt=$pointerPressedEvents[k];if(tt.group!=null)tt.group.active=false;$this.$UP(tt.identifier,tt,TOUCH_STUB)}}e.preventDefault()},false);element.addEventListener("touchend",function(e){var t=e.changedTouches;for(var i=0;i<t.length;i++){var tt=t[i];$this.$UP(tt.identifier,tt,TOUCH_STUB)}e.preventDefault()},false);element.addEventListener("touchmove",function(e){var mt=e.changedTouches;for(var k in $this.touches){$pointerPressedEvents[k].dx=$pointerPressedEvents[k].dy=0}for(var i=0;i<mt.length;i++){var nmt=mt[i];if($pointerPressedEvents.hasOwnProperty(nmt.identifier)){var t=$pointerPressedEvents[nmt.identifier];if(t.pageX!==Math.floor(nmt.pageX)||t.pageY!==Math.floor(nmt.pageY)){if(t.isDragged||Math.abs(nmt.pageX-t.pageX)+Math.abs(nmt.pageY-t.pageY)>4){$this.$DRAG(nmt.identifier,nmt,TOUCH_STUB)}}}}e.preventDefault()},false);element.onmousemove=function(e){$this.$MMOVE(e);e.stopPropagation()}}element.oncontextmenu=function(e){e.preventDefault()}}]);pkg.MouseWheelSupport=Class([function(element,destination){var META=this.clazz.$META;for(var k in META){if(META[k].test()){var $wheelMeta=META[k],$clazz=this.clazz;element.addEventListener(k,function(e){var dy=typeof e[$wheelMeta.dy]!=="undefined"?e[$wheelMeta.dy]*$wheelMeta.dir:0,dx=typeof e[$wheelMeta.dx]!=="undefined"?e[$wheelMeta.dx]*$wheelMeta.dir:0;if(Math.abs(dy)<1){dy*=$clazz.dyZoom}if(Math.abs(dx)<1){dx*=$clazz.dxZoom}dy=Math.abs(dy)>$clazz.dyNorma?dy%$clazz.dyNorma:dy;dx=Math.abs(dx)>$clazz.dxNorma?dx%$clazz.dxNorma:dx;if(destination.$doScroll(Math.floor(dx),Math.floor(dy),"wheel")){e.preventDefault()}},false);break}}},function $clazz(){this.dxZoom=this.dyZoom=20;this.dxNorma=this.dyNorma=80;this.$META={wheel:{dy:"deltaY",dx:"deltaX",dir:1,test:function(){return"WheelEvent"in window}},mousewheel:{dy:"wheelDelta",dx:"wheelDeltaX",dir:-1,test:function(){return document.onmousewheel!==undefined}},DOMMouseScroll:{dy:"detail",dir:1,test:function(){return true}}}},function $prototype(){this.naturalDirection=true}]);var CODES={KeyA:{keyCode:65},KeyB:{keyCode:66},KeyC:{keyCode:67},KeyD:{keyCode:68},KeyE:{keyCode:69},KeyF:{keyCode:70},KeyG:{keyCode:71},KeyH:{keyCode:72},KeyI:{keyCode:73},KeyJ:{keyCode:74},KeyK:{keyCode:75},KeyL:{keyCode:76},KeyM:{keyCode:77},KeyN:{keyCode:78},KeyO:{keyCode:79},KeyP:{keyCode:80},KeyQ:{keyCode:81},KeyR:{keyCode:82},KeyS:{keyCode:83},KeyT:{keyCode:84},KeyU:{keyCode:85},KeyV:{keyCode:86},KeyW:{keyCode:87},KeyX:{keyCode:88},KeyY:{keyCode:89},KeyZ:{keyCode:90},Digit0:{keyCode:48},Digit1:{keyCode:49},Digit2:{keyCode:50},Digit3:{keyCode:51},Digit4:{keyCode:52},Digit5:{keyCode:53},Digit6:{keyCode:54},Digit7:{keyCode:55},Digit8:{keyCode:56},Digit9:{keyCode:57},F1:{keyCode:112,key:"F1",rp:false},F2:{keyCode:113,key:"F2",rp:false},F3:{keyCode:114,key:"F3",rp:false},F4:{keyCode:115,key:"F4",rp:false},F5:{keyCode:116,key:"F5",rp:false},F6:{keyCode:117,key:"F6",rp:false},F7:{keyCode:118,key:"F7",rp:false},F8:{keyCode:119,key:"F8",rp:false},F9:{keyCode:120,key:"F9",rp:false},F10:{keyCode:121,key:"F10",rp:false},F11:{keyCode:122,key:"F11",rp:false},F12:{keyCode:123,key:"F12",rp:false},F13:{keyCode:124,key:"F13",rp:false},F14:{keyCode:125,key:"F14",rp:false},F15:{keyCode:126,key:"F15",rp:false},Numpad0:{keyCode:96},Numpad1:{keyCode:97},Numpad2:{keyCode:98},Numpad3:{keyCode:99},Numpad4:{keyCode:100},Numpad5:{keyCode:101},Numpad6:{keyCode:102},Numpad7:{keyCode:103},Numpad8:{keyCode:104},Numpad9:{keyCode:105},NumpadDecimal:{keyCode:110,key:"Decimal"},NumpadSubtract:{keyCode:109,key:"Subtract"},NumpadDivide:{keyCode:111,key:"Divide"},NumpadMultiply:{keyCode:106,key:"Multiply"},NumpadAdd:{keyCode:107,key:"Add"},NumLock:{keyCode:zebkit.isFF?144:12,key:"NumLock",rp:false,ignore:true},Comma:{keyCode:188},Period:{keyCode:190},Semicolon:{keyCode:zebkit.isFF?59:186},Quote:{keyCode:222},BracketLeft:{keyCode:219},BracketRight:{keyCode:221},Backquote:{keyCode:192},Backslash:{keyCode:220},Minus:{keyCode:zebkit.isFF?173:189},Equal:{keyCode:zebkit.isFF?61:187},NumpadEnter:{map:"Enter"},Enter:{keyCode:13,key:"\n"},Slash:{keyCode:191},Space:{keyCode:32,pr:true,key:" "},Delete:{keyCode:46,key:"Delete"},IntlRo:{keyCode:zebkit.isFF?167:193,key:"IntlRo"},Backspace:{keyCode:8,pr:true,key:"Backspace"},Tab:{keyCode:9,pr:true,key:"\t"},ContextMenu:{keyCode:zebkit.isFF?93:0,pr:true,key:"ContextMenu"},ArrowLeft:{keyCode:37,pr:true,key:"ArrowLeft"},ArrowRight:{keyCode:39,pr:true,key:"ArrowRight"},ArrowUp:{keyCode:38,pr:true,key:"ArrowUp"},ArrowDown:{keyCode:40,pr:true,key:"ArrowDown"},PageUp:{keyCode:33,pr:true,key:"PaheUp"},PageDown:{keyCode:34,pr:true,key:"PageDown"},Home:{keyCode:36,pr:true,key:"Home"},End:{keyCode:35,pr:true,key:"End"},Escape:{keyCode:27,pr:true,key:"Escape",rp:false},CapsLock:{keyCode:20,key:"CapsLock",rp:false,ignore:true},Shift:{keyCode:16,pr:true,key:"Shift",rp:false},ShiftLeft:{map:"Shift"},ShiftRight:{map:"Shift"},Alt:{keyCode:18,pr:true,key:"Alt",rp:false},AltLeft:{map:"Alt"},AltRight:{map:"Alt"},Control:{keyCode:17,pr:true,key:"Control",rp:false},ControlRight:{map:"Control"},ControlLeft:{map:"Control"},MetaLeft:{keyCode:91,pr:true,key:"Meta",rp:false},MetaRight:{keyCode:93,pr:true,key:"Meta",rp:false},OSLeft:{keyCode:224,map:"MetaLeft"},OSRight:{keyCode:224,map:"MetaRight"}},CODES_MAP={};function $initializeCodesMap(){var k=null,code=null;for(k in CODES){code=CODES[k];if(typeof code.map!=="undefined"){if(typeof CODES[code.map]==="undefined"){throw new Error("Invalid mapping for code = '"+k+"'")}}else if(typeof code.keyCode==="undefined"){throw new Error("unknown keyCode  for code = '"+k+"'")}}CODES_MAP={};for(k in CODES){code=CODES[k];if(typeof code.map!=="undefined"){if(typeof code.keyCode!=="undefined"){CODES_MAP[code.keyCode]=code.map}}else{CODES_MAP[code.keyCode]=k}}}pkg.$fetchKeyCode=function(e){var code=e.code;if(typeof code!=="undefined"){if(CODES.hasOwnProperty(code)&&CODES[code].hasOwnProperty("map")){code=CODES[code].map}}else{code=CODES_MAP[e.which||e.keyCode||0];if(typeof code==="undefined"){code=null}}return code};$initializeCodesMap();pkg.KeyEvent=Class(zebkit.ui.KeyEvent,[function $prototype(){this.$fillWith=function(e){var keyCode=e.which||e.keyCode||0;this.code=pkg.$fetchKeyCode(e);if(this.code==="Enter"||this.code==="Space"||this.code==="Tab"){this.key=CODES[this.code].key}else if(e.key!=null){this.key=e.key}else if(e.type==="keypress"){this.key=e.charCode>0&&keyCode>=32?String.fromCharCode(e.charCode):null}else{if(e.keyIdentifier!=null){if(e.keyIdentifier[0]==="U"&&e.keyIdentifier[1]==="+"){this.key=String.fromCharCode(parseInt(e.keyIdentifier.substring(2),16))}else{this.key=e.keyIdentifier}}else{if(this.code!=null&&CODES.hasOwnProperty(this.code)===true&&CODES[this.code].key!=null){this.key=CODES[this.code].key}else{this.key=e.charCode>0&&keyCode>=32?String.fromCharCode(e.charCode):null}}}this.altKey=e.altKey;this.shiftKey=e.shiftKey;this.ctrlKey=e.ctrlKey;this.metaKey=e.metaKey;return this}}]);var KEY_DOWN_EVENT=new pkg.KeyEvent,KEY_UP_EVENT=new pkg.KeyEvent,KEY_PRESS_EVENT=new pkg.KeyEvent,wasMetaLeftPressed=false,wasMetaRightPressed=false;pkg.KeyEventUnifier=Class([function(element,destination){element.onkeydown=function(e){var code=KEY_DOWN_EVENT.code,pts=KEY_DOWN_EVENT.timeStamp,ts=(new Date).getTime();var fc=pkg.$fetchKeyCode(e);if(CODES[fc]!=null&&CODES[fc].ignore===true){return}if(wasMetaLeftPressed===true&&(e.metaKey!==true||fc==="MetaLeft")){wasMetaLeftPressed=false;try{KEY_DOWN_EVENT.code="MetaLeft";KEY_DOWN_EVENT.repeat=0;KEY_DOWN_EVENT.metaKey=true;KEY_DOWN_EVENT.timeStamp=ts;destination.$keyReleased(KEY_DOWN_EVENT)}catch(ex){zebkit.dumpError(ex)}finally{KEY_DOWN_EVENT.code=null;code=null}}if(wasMetaRightPressed===true&&(e.metaKey!==true||fc==="MetaRight")){wasMetaRightPressed=false;try{KEY_DOWN_EVENT.code="MetaRight";KEY_DOWN_EVENT.repeat=0;KEY_DOWN_EVENT.metaKey=true;KEY_DOWN_EVENT.timeStamp=ts;destination.$keyReleased(KEY_DOWN_EVENT)}catch(ex){zebkit.dumpError(ex)}finally{KEY_DOWN_EVENT.code=null;code=null}}KEY_DOWN_EVENT.$fillWith(e);KEY_DOWN_EVENT.timeStamp=ts;if(KEY_DOWN_EVENT.code===code&&e.metaKey!==true&&ts-pts<1e3){KEY_DOWN_EVENT.repeat++}else{KEY_DOWN_EVENT.repeat=1}var key=CODES[KEY_DOWN_EVENT.code];if(key!=null&&key.pr===true&&e.target===element){e.preventDefault()}e.stopPropagation();try{destination.$keyPressed(KEY_DOWN_EVENT)}catch(ex){zebkit.dumpError(ex)}if(KEY_DOWN_EVENT.code==="MetaLeft"){wasMetaLeftPressed=true}else if(KEY_DOWN_EVENT.code==="MetaRight"){wasMetaRightPressed=true}else{if(e.metaKey===true){if(key==null||key.rp!==false){try{KEY_UP_EVENT.$fillWith(e);KEY_UP_EVENT.repeat=0;KEY_UP_EVENT.timeStamp=ts;destination.$keyReleased(KEY_UP_EVENT)}catch(ex){zebkit.dumpError(ex)}}}else if(KEY_DOWN_EVENT.code==="Space"||KEY_DOWN_EVENT.code==="Enter"||KEY_DOWN_EVENT.code==="Tab"){KEY_PRESS_EVENT.$fillWith(e);KEY_PRESS_EVENT.repeat=KEY_DOWN_EVENT.repeat;KEY_PRESS_EVENT.timeStamp=ts;destination.$keyTyped(KEY_PRESS_EVENT)}}};element.onkeyup=function(e){e.stopPropagation();KEY_UP_EVENT.$fillWith(e);if(CODES[KEY_UP_EVENT.code]!=null&&CODES[KEY_UP_EVENT.code].ignore===true){return}if(wasMetaLeftPressed===true&&KEY_UP_EVENT.code==="MetaLeft"){wasMetaLeftPressed=false}if(wasMetaRightPressed===true&&KEY_UP_EVENT.code==="MetaRight"){wasMetaRightPressed=false}var key=CODES[KEY_UP_EVENT.code];if(e.metaKey!==true||key!=null&&key.rp===false){KEY_UP_EVENT.repeat=0;KEY_UP_EVENT.timeStamp=(new Date).getTime();try{destination.$keyReleased(KEY_UP_EVENT)}finally{if(KEY_DOWN_EVENT.code===KEY_UP_EVENT.code){KEY_DOWN_EVENT.repeat=0}}}};element.onkeypress=function(e){e.stopPropagation();if(e.metaKey!==true){KEY_PRESS_EVENT.$fillWith(e);KEY_PRESS_EVENT.code=KEY_DOWN_EVENT.code;KEY_PRESS_EVENT.repeat=KEY_DOWN_EVENT.repeat;if(KEY_PRESS_EVENT.code!=="Space"&&KEY_PRESS_EVENT.code!=="Enter"&&KEY_PRESS_EVENT.code!=="Tab"&&KEY_PRESS_EVENT.code!=="ContextMenu"){KEY_PRESS_EVENT.timeStamp=(new Date).getTime();destination.$keyTyped(KEY_PRESS_EVENT)}}}}])});zebkit.package("ui.web",function(pkg,Class){"use strict";pkg.CursorManager=Class(zebkit.ui.CursorManager,[function $prototype(){this.$isFunc=false;this.source=this.target=null;this.pointerMoved=function(e){if(this.$isFunc===true){this.cursorType=this.source.getCursorType(this.source,e.x,e.y);this.target.style.cursor=this.cursorType===null?"default":this.cursorType}};this.pointerEntered=function(e){if(typeof e.source.cursorType!=="undefined"&&e.source.cursorType!==null||typeof e.source.getCursorType!=="undefined"){this.$isFunc=typeof e.source.getCursorType==="function";this.target=e.target;this.source=e.source;this.cursorType=this.$isFunc===true?this.source.getCursorType(this.source,e.x,e.y):this.source.cursorType;this.target.style.cursor=this.cursorType===null?"default":this.cursorType}};this.pointerExited=function(e){if(this.source!==null){this.cursorType="default";if(this.target.style.cursor!=this.cursorType){this.target.style.cursor=this.cursorType}this.source=this.target=null;this.$isFunc=false}};this.pointerDragged=function(e){if(this.$isFunc===true){this.cursorType=this.source.getCursorType(this.source,e.x,e.y);this.target.style.cursor=this.cursorType===null?"default":this.cursorType}}}]);pkg.cd("..").cursorManager=new pkg.CursorManager;var ui=pkg.cd("..");pkg.HtmlElement=Class(ui.Panel,[function(e){if(arguments.length===0){e="div"}if(zebkit.isString(e)){e=document.createElement(e);e.style.border="0px solid transparent";e.style.fontSize=this.clazz.$bodyFontSize}e.style.margin=e.style.padding="0px";this.element=e;this.element.style.position="relative";if(e.parentNode!==null&&e.parentNode.getAttribute("data-zebcont")!==null){throw new Error("DOM element '"+e+"' already has container")}this.$container=document.createElement("div");this.$container.style.display="inline-block";this.$container.style.overflow="hidden";this.$container.style["z-index"]="0";this.$container.style.left=this.$container.style.top="0px";this.$container.visibility="hidden";this.$container.style.fontSize=this.$container.style.padding=this.$container.style.padding="0px";this.$container.setAttribute("id","container-"+this.toString());this.$container.setAttribute("data-zebcont","true");this.$container.style["pointer-events"]="auto";if(e.parentNode!==null){e.parentNode.replaceChild(this.$container,e);this.$container.appendChild(e)}else{this.$container.style.position="absolute";this.$container.appendChild(e)}if(e.getAttribute("id")===null){e.setAttribute("id",this.toString())}this.$super();if(typeof this.$initListeners!=="undefined"){this.$initListeners()}var fe=this.$getElementRootFocus();if(fe!==null){var $this=this;zebkit.web.$focusin(fe,function(e){if($this.hasFocus()===false){$this.requestFocus()}},false);zebkit.web.$focusout(fe,function(e){if($this.hasFocus()){ui.focusManager.requestFocus(null)}},false)}},function $clazz(){this.CLASS_NAME=null;this.$bodyFontSize=window.getComputedStyle(document.body,null).getPropertyValue("font-size")},function $prototype(){this.$blockElement=this.$container=this.$canvas=null;this.ePsW=this.ePsH=0;this.isDOMElement=true;this.$sizeAdjusted=false;this.wrap=function(c){this.setLayout(new zebkit.layout.StackLayout);this.add(c);return this};this.setFont=function(f){this.setStyle("font",f.toString());this.vrp();return this};this.setColor=function(c){this.setStyle("color",c.toString());return this};this.setStyles=function(styles){for(var k in styles){this.$setStyle(this.element,k,styles[k])}this.vrp();return this};this.setStyle=function(name,value){this.$setStyle(this.element,name,value);this.vrp();return this};this.$setStyle=function(element,name,value){name=name.trim();var i=name.indexOf(":");if(i>0){if(zebkit[name.substring(0,i)]!==true){return}name=name.substring(i+1)}element.style[name]=value;return this};this.setAttribute=function(name,value){this.element.setAttribute(name,value);return this};this.setAttributes=function(attrs){for(var name in attrs){this.element.setAttribute(name,attrs[name])}return this};this.paint=function(g){if(this.$container.style.visibility==="hidden"){this.$container.style.visibility="visible"}if(this.$sizeAdjusted!==true){this.setSize(this.width,this.height)}};this.calcPreferredSize=function(target){return{width:this.ePsW,height:this.ePsH}};var $store=["paddingTop","paddingLeft","paddingBottom","paddingRight","border","borderStyle","borderWidth","borderTopStyle","borderTopWidth","borderBottomStyle","borderBottomWidth","borderLeftStyle","borderLeftWidth","borderRightStyle","visibility","borderRightWidth","width","height","position"];this.recalc=function(){if(this.layout===this){var e=this.element,vars={},domParent=null,k=null,b=!zebkit.web.$contains(this.$container);if(b){domParent=this.$container.parentNode;document.body.appendChild(this.$container)}for(var i=0;i<$store.length;i++){k=$store[i];vars[k]=e.style[k]}this.$container.style.visibility="hidden";e.style.padding="0px";e.style.border="none";e.style.position=e.style.height=e.style.width="auto";this.ePsW=e.offsetWidth;this.ePsH=e.offsetHeight;for(k in vars){var v=vars[k];if(v!==null)e.style[k]=v}if(b){document.body.removeChild(this.$container);if(domParent!==null)domParent.appendChild(this.$container)}}};this.setContent=function(content){this.element.innerHTML=content;this.vrp();return this};this.$getElementRootFocus=function(){return null};this.canHaveFocus=function(){return this.$getElementRootFocus()!==null};this.$focus=function(){if(this.canHaveFocus()&&document.activeElement!==this.$getElementRootFocus()){this.$getElementRootFocus().focus()}};this.$blur=function(){if(this.canHaveFocus()&&document.activeElement===this.$getElementRootFocus()){this.$getElementRootFocus().blur()}}},function toFront(){this.$super();var pnode=this.$container.parentNode;if(pnode!==null&&pnode.lastChild!==this.$container){pnode.removeChild(this.$container);pnode.appendChild(this.$container)}},function toBack(){this.$super();var pnode=this.$container.parentNode;if(pnode!==null&&pnode.firstChild!==this.$container){pnode.removeChild(this.$container);pnode.insertBefore(this.$container,pnode.firstChild)}},function setEnabled(b){if(this.isEnabled!==b){if(b){this.$container.removeChild(this.$blockElement)}else{if(this.$blockElement===null){this.$blockElement=zebkit.web.$createBlockedElement()}this.$container.appendChild(this.$blockElement)}}return this.$super(b)},function setSize(w,h){if(zebkit.web.$contains(this.$container)){var prevVisibility=this.$container.style.visibility;this.$container.style.visibility="hidden";this.element.style.width=""+w+"px";this.element.style.height=""+h+"px";var ww=2*w-this.element.offsetWidth,hh=2*h-this.element.offsetHeight;if(ww!==w||hh!==h){this.element.style.width=""+ww+"px";this.element.style.height=""+hh+"px"}this.$sizeAdjusted=true;this.$container.style.visibility=prevVisibility}else{this.$sizeAdjusted=false}return this.$super(w,h)},function setPadding(t,l,b,r){if(arguments.length===1){l=b=r=t}this.setStyles({paddingTop:""+t+"px",paddingLeft:""+l+"px",paddingRight:""+r+"px",paddingBottom:""+b+"px"});if(this.top!==t||this.left!==l||this.right!==r||this.bottom!==b){this.$sizeAdjusted=false}this.$super.apply(this,arguments);return this},function setBorder(b){b=ui.$view(b);if(b===null){this.setStyle("border","none")}else{this.setStyles({border:"0px solid transparent",borderTopStyle:"solid",borderTopColor:"transparent",borderTopWidth:""+b.getTop()+"px",borderLeftStyle:"solid",borderLeftColor:"transparent",borderLeftWidth:""+b.getLeft()+"px",borderBottomStyle:"solid",borderBottomColor:"transparent",borderBottomWidth:""+b.getBottom()+"px",borderRightStyle:"solid",borderRightColor:"transparent",borderRightWidth:""+b.getRight()+"px"})}if(this.border!=b){this.$sizeAdjusted=false}return this.$super(b)},function validate(){if(this.$canvas===null&&this.parent!==null){this.$canvas=this.getCanvas()}this.$super()},function focused(){this.$super();if(this.hasFocus()){this.$focus()}else{this.$blur()}}]).hashable();pkg.HtmlElementMan=Class(ui.Manager,[function $prototype(){function $isInInvisibleState(c){if(c.isVisible===false||c.$container.parentNode===null||c.width<=0||c.height<=0||c.parent===null||zebkit.web.$contains(c.$container)===false){return true}var p=c.parent;while(p!==null&&p.isVisible===true&&p.width>0&&p.height>0){p=p.parent}return p!==null||ui.$cvp(c)===null}function $resolveDOMParent(c){var parentElement=null;for(var p=c.parent;p!==null;p=p.parent){if(p.isDOMElement===true){parentElement=p.$container;break}}if(parentElement!==null&&c.$container.parentNode===null){parentElement.appendChild(c.$container);$adjustLocation(c)}else{if(parentElement!==null&&c.$container.parentNode!==null&&c.$container.parentNode!==parentElement){throw new Error("DOM parent inconsistent state ")}}}function $adjustLocation(c){if(c.$container.parentNode!==null){var prevVisibility=null;if(c.$container.style.visibility!=="hidden"){prevVisibility=c.$container.style.visibility;c.$container.style.visibility="hidden"}var p=c,xx=c.x,yy=c.y;while((p=p.parent)!==null&&p.isDOMElement!==true){xx+=p.x;yy+=p.y}c.$container.style.left=""+xx+"px";c.$container.style.top=""+yy+"px";if(prevVisibility!==null){c.$container.style.visibility=prevVisibility}}}function $domElements(c,callback){for(var k in c.$domKids){var e=c.$domKids[k];if(e.isDOMElement===true){callback.call(this,e)}else if(typeof e.$domKids!=="undefined"){$domElements(e,callback)}}}this.compShown=function(e){var c=e.source;if(c.isDOMElement===true){c.$container.style.visibility=c.isVisible===false||$isInInvisibleState(c)?"hidden":"visible"}else if(typeof c.$domKids!=="undefined"){$domElements(c,function(e){e.$container.style.visibility=e.isVisible===false||$isInInvisibleState(e)?"hidden":"visible"})}};this.compMoved=function(e){var c=e.source;if(c.isDOMElement===true){if(c.$isRootCanvas!==true){var dx=e.prevX-c.x,dy=e.prevY-c.y,cont=c.$container;cont.style.left=(parseInt(cont.style.left,10)||0)-dx+"px";cont.style.top=(parseInt(cont.style.top,10)||0)-dy+"px"}}else if(typeof c.$domKids!=="undefined"){$domElements(c,function(e){$adjustLocation(e)})}};function detachFromParent(p,c){if(p.isDOMElement!==true&&typeof p.$domKids!=="undefined"){delete p.$domKids[c.$hash$];if(isLeaf(p)){if(p.parent!==null&&p.parent.isDOMElement!==true){detachFromParent(p.parent,p)}delete p.$domKids}}}function isLeaf(c){if(typeof c.$domKids!=="undefined"){for(var k in c.$domKids){if(c.$domKids.hasOwnProperty(k))return false}}return true}function removeDOMChildren(c){if(c.isDOMElement!==true&&typeof c.$domKids!=="undefined"){for(var k in c.$domKids){if(c.$domKids.hasOwnProperty(k)){var kid=c.$domKids[k];if(kid.isDOMElement===true){kid.$container.parentNode.removeChild(kid.$container);kid.$container.parentNode=null}else{removeDOMChildren(kid)}}}delete c.$domKids}}this.compRemoved=function(e){var c=e.kid;if(c.isDOMElement===true){c.$container.parentNode.removeChild(c.$container);c.$container.parentNode=null}else{removeDOMChildren(c)}detachFromParent(e.source,c)};this.compAdded=function(e){var p=e.source,c=e.kid;if(c.isDOMElement===true){$resolveDOMParent(c)}else{if(typeof c.$domKids!=="undefined"){$domElements(c,function(e){$resolveDOMParent(e)})}else{return}}if(p.isDOMElement!==true){while(p!==null&&p.isDOMElement!==true){if(typeof p.$domKids==="undefined"){p.$domKids={};p.$domKids[c.$genHash()]=c;c=p;p=p.parent}else{var id=c.$genHash();if(p.$domKids.hasOwnProperty(id)){throw new Error("Inconsistent state for "+c+", "+c.clazz.$name)}p.$domKids[id]=c;break}}}}}]);pkg.$htmlElementMan=new pkg.HtmlElementMan;if(typeof zebkit.ui.FocusManager!=="undefined"){zebkit.ui.FocusManager.extend([function requestFocus(c){this.$super(c);var canvas=null;if(c!==null&&c!==this.focusOwner&&(c.isDOMElement!==true||c.$getElementRootFocus()===null)){canvas=c.getCanvas();if(canvas!==null&&document.activeElement!==canvas.element){canvas.element.focus()}if(this.focusOwner!==null&&this.focusOwner.getCanvas()!==canvas){this.requestFocus(null)}}else if(this.focusOwner!==null&&this.focusOwner.isDOMElement!==true){canvas=this.focusOwner.getCanvas();if(canvas!==null&&document.activeElement!==canvas.element){canvas.element.focus()}}},function pointerPressed(e){if(e.isAction()){if(document.activeElement!==e.source.getCanvas().element){var $this=this;setTimeout(function(){$this.requestFocus(e.source)})}else{this.$$super(e)}}}])}var ui=pkg.cd("..");pkg.HtmlCanvas=Class(pkg.HtmlElement,[function(e){if(arguments.length>0&&e!==null&&e.tagName!=="CANVAS"){throw new Error("Invalid element '"+e+"'")}this.$da={x:0,y:0,width:-1,height:0};this.$super(arguments.length===0||e===null?"canvas":e);this.$container.style["pointer-events"]="none";if(arguments.length===0||e===null){this.element.onselectstart=function(){return false}}},function $clazz(){this.$ContextMethods={reset:function(w,h){this.$curState=0;var s=this.$states[0];s.srot=s.rotateVal=s.x=s.y=s.width=s.height=s.dx=s.dy=0;s.crot=s.sx=s.sy=1;s.width=w;s.height=h;this.setFont(ui.font);this.setColor("white")},$init:function(){this.$states=Array(70);for(var i=0;i<this.$states.length;i++){var s={};s.srot=s.rotateVal=s.x=s.y=s.width=s.height=s.dx=s.dy=0;s.crot=s.sx=s.sy=1;this.$states[i]=s}},translate:function(dx,dy){if(dx!==0||dy!==0){var c=this.$states[this.$curState];c.x-=dx;c.y-=dy;c.dx+=dx;c.dy+=dy;this.$translate(dx,dy)}},rotate:function(v){var c=this.$states[this.$curState];c.rotateVal+=v;c.srot=Math.sin(c.rotateVal);c.crot=Math.cos(c.rotateVal);this.$rotate(v)},scale:function(sx,sy){var c=this.$states[this.$curState];c.sx=c.sx*sx;c.sy=c.sy*sy;this.$scale(sx,sy)},save:function(){this.$curState++;var c=this.$states[this.$curState],cc=this.$states[this.$curState-1];c.x=cc.x;c.y=cc.y;c.width=cc.width;c.height=cc.height;c.dx=cc.dx;c.dy=cc.dy;c.sx=cc.sx;c.sy=cc.sy;c.srot=cc.srot;c.crot=cc.crot;c.rotateVal=cc.rotateVal;this.$save();return this.$curState-1},restoreAll:function(){while(this.$curState>0){this.restore()}},restore:function(){if(this.$curState===0){throw new Error("Context restore history is empty")}this.$curState--;this.$restore();return this.$curState},clipRect:function(x,y,w,h){var c=this.$states[this.$curState];if(c.x!==x||y!==c.y||w!==c.width||h!==c.height){var xx=c.x,yy=c.y,ww=c.width,hh=c.height,xw=x+w,xxww=xx+ww,yh=y+h,yyhh=yy+hh;c.x=x>xx?x:xx;c.width=(xw<xxww?xw:xxww)-c.x;c.y=y>yy?y:yy;c.height=(yh<yyhh?yh:yyhh)-c.y;if(c.x!==xx||yy!==c.y||ww!==c.width||hh!==c.height){this.beginPath();this.rect(x,y,w,h);this.closePath();this.clip()}}}}},function $prototype(clazz){this.$rotateValue=0;this.$scaleX=1;this.$scaleY=1;this.$context=null;this.setBorder=function(b){return ui.Panel.prototype.setBorder.call(this,b)};this.rotate=function(r){this.$rotateValue+=r;if(this.$context!==null){this.$context.rotate(r)}this.vrp();return this};this.scale=function(sx,sy){if(this.$context!==null)this.$context.scale(sx,sy);this.$scaleX=this.$scaleX*sx;this.$scaleY=this.$scaleY*sy;this.vrp();return this};this.clearTransformations=function(){this.$scaleX=1;this.$scaleY=1;this.$rotateValue=0;if(this.$context!==null){this.$context=zebkit.web.$canvas(this.element,this.width,this.height,true);this.$context.reset(this.width,this.height)}this.vrp();return this};this.setPadding=function(){return ui.Panel.prototype.setPadding.apply(this,arguments)};this.setSize=function(w,h){if(this.width!==w||h!==this.height){var pw=this.width,ph=this.height;this.$context=zebkit.web.$canvas(this.element,w,h);if(typeof this.$context.$states==="undefined"){zebkit.web.$extendContext(this.$context,clazz.$ContextMethods)}this.$context.reset(w,h);if(this.$rotateValue!==0){this.$context.rotate(this.$rotateValue)}if(this.$scaleX!==1||this.$scaleY!==1){this.$context.scale(this.$scaleX,this.$scaleY)}this.width=w;this.height=h;if(this.$container.style.visibility==="hidden"){if(this.isVisible){this.$container.style.visibility="visible"}}this.invalidate();this.validate();this.repaint();if(w!==pw||h!==ph){this.resized(pw,ph)}}return this}}]);pkg.HtmlWinCanvas=Class(pkg.HtmlCanvas,[function $prototype(){this.winOpened=function(e){this.target.winOpened(e)};this.winActivated=function(e){this.target.winActivated(e)}},function(target){this.$super();this.target=arguments.length===0?new ui.Window:target;var $this=this;target.getWinContainer=function(){return $this};this.setLayout(new zebkit.layout.BorderLayout);this.add("center",target)}]);pkg.HtmlFocusableElement=Class(pkg.HtmlElement,[function $prototype(){this.$getElementRootFocus=function(){return this.element}}]);pkg.HtmlTextInput=Class(pkg.HtmlFocusableElement,[function(text,e){if(text===null)text="";this.$super(e);this.setAttribute("tabindex",0);this.setValue(text)},function $prototype(){this.cursorType=ui.Cursor.TEXT;this.getValue=function(){return this.element.value.toString()};this.setValue=function(t){if(this.element.value!==t){this.element.value=t;this.vrp()}return this}}]);pkg.HtmlTextField=Class(pkg.HtmlTextInput,[function(text){this.$super(text,"input");this.element.setAttribute("type","text")}]);pkg.HtmlTextArea=Class(pkg.HtmlTextInput,[function(text){this.$super(text,"textarea");this.element.setAttribute("rows",10)},function setResizeable(b){this.setStyle("resize",b===false?"none":"both");return this}]);pkg.HtmlLink=Class(pkg.HtmlElement,[function(text,href){this.$super("a");this.setContent(text);this.setAttribute("href",arguments.length<2?"#":href);this._=new zebkit.util.Listeners;var $this=this;this.element.onclick=function(e){$this._.fired($this)}}]);var ui=pkg.cd("..");pkg.HtmlLayer=Class(pkg.HtmlCanvas,[]);pkg.RootLayer=Class(pkg.HtmlLayer,ui.RootLayerMix,[function $clazz(){this.layout=new zebkit.layout.RasterLayout}]);pkg.WinLayer=Class(pkg.HtmlLayer,ui.WinLayerMix,[function(){this.$super();this.element.style["z-index"]=1e4},function $clazz(){this.layout=new zebkit.layout.RasterLayout}]);pkg.PopupLayer=Class(pkg.HtmlLayer,ui.PopupLayerMix,[function $clazz(){this.layout=new ui.PopupLayerLayout([function doLayout(target){if(target.kids.length>0){if(target.$container.style["pointer-events"]!=="auto"){target.$container.style["pointer-events"]="auto"}}else if(target.$container.style["pointer-events"]!=="none"){target.$container.style["pointer-events"]="none"}this.$super(target)}])}]);pkg.CanvasEvent=Class(zebkit.util.Event,[]);var ui=pkg.cd(".."),COMP_EVENT=new ui.CompEvent;pkg.$pointerOwner={};pkg.$pointerPressedOwner={};ui.zCanvas=pkg.zCanvas=Class(pkg.HtmlCanvas,[function(element,w,h){if(arguments.length===0){w=400;h=400;element=null}else if(arguments.length===1){w=-1;h=-1}else if(arguments.length===2){h=w;w=element;element=null}if(element!==null&&zebkit.isString(element)){var id=element;element=document.getElementById(id);if(element===null){throw new Error("Canvas id='"+id+"' element cannot be found")}}this.$layers={};this.$super(element);this.$container.style.position="relative";this.$container.style["pointer-events"]="auto";if(this.$container.parentNode===null){document.body.appendChild(this.$container)}if(this.element.getAttribute("tabindex")===null){this.element.setAttribute("tabindex","1")}if(w<0)w=this.element.offsetWidth;if(h<0)h=this.element.offsetHeight;this.clazz.$canvases.push(this);this.setSize(w,h);var cvis=this.element.style.visibility==="hidden"?false:true;if(this.isVisible!==cvis){this.setVisible(cvis)}if(typeof this.canvasInitialized!=="undefined"){this.canvasInitialized()}var $this=this;zebkit.web.$focusin(this.$container,function(e){},true)},function $clazz(){this.CLASS_NAME="zebcanvas";this.$canvases=[];this.$getCanvasByElement=function(e){for(var i=0;i<this.$canvases.length;i++){if(this.$canvases[i]===e){return this.$canvases[i]}}return null}},function $prototype(){this.$isRootCanvas=true;this.isSizeFull=false;this.offx=this.offy=0;this.$toElementX=function(pageX,pageY){pageX-=this.offx;pageY-=this.offy;var c=this.$context.$states[this.$context.$curState];return(c.sx!==1||c.sy!==1||c.rotateVal!==0?Math.round((c.crot*pageX+pageY*c.srot)/c.sx):pageX)-c.dx};this.$toElementY=function(pageX,pageY){pageX-=this.offx;pageY-=this.offy;var c=this.$context.$states[this.$context.$curState];return(c.sx!==1||c.sy!==1||c.rotateVal!==0?Math.round((pageY*c.crot-c.srot*pageX)/c.sy):pageY)-c.dy};this.load=function(jsonPath){return this.root.load(jsonPath)};this.$doScroll=function(dx,dy,src){if(src==="wheel"&&pkg.$pointerOwner.mouse!=null){var owner=pkg.$pointerOwner.mouse;while(owner!==null&&typeof owner.doScroll==="undefined"){owner=owner.parent}if(owner!==null){return owner.doScroll(dx,dy,src)}}return false};this.$keyTyped=function(e){if(ui.focusManager.focusOwner!==null){e.source=ui.focusManager.focusOwner;return ui.events.fire("keyTyped",e)}else{return false}};this.$keyPressed=function(e){for(var i=this.kids.length-1;i>=0;i--){var l=this.kids[i];if(typeof l.layerKeyPressed!=="undefined"&&l.layerKeyPressed(e)===true){return true}}if(ui.focusManager.focusOwner!==null){e.source=ui.focusManager.focusOwner;return ui.events.fire("keyPressed",e)}else{e.source=this;return ui.events.fire("keyPressed",e)}};this.$keyReleased=function(e){if(ui.focusManager.focusOwner!==null){e.source=ui.focusManager.focusOwner;return ui.events.fire("keyReleased",e)}else{return false}};this.$pointerEntered=function(e){this.recalcOffset();var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),d=this.getComponentAt(x,y),o=pkg.$pointerOwner[e.identifier];if(d!==o){if(o!=null){pkg.$pointerOwner[e.identifier]=null;ui.events.fire("pointerExited",e.update(o,x,y))}if(d!==null&&d.isEnabled===true){pkg.$pointerOwner[e.identifier]=d;ui.events.fire("pointerEntered",e.update(d,x,y))}}};this.$pointerExited=function(e){var o=pkg.$pointerOwner[e.identifier];if(o!=null){pkg.$pointerOwner[e.identifier]=null;return ui.events.fire("pointerExited",e.update(o,this.$toElementX(e.pageX,e.pageY),this.$toElementY(e.pageX,e.pageY)))}};this.$pointerMoved=function(e){var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),d=this.getComponentAt(x,y),o=pkg.$pointerOwner[e.identifier],b=false;if(o!=null){if(d!==o){pkg.$pointerOwner[e.identifier]=null;b=ui.events.fire("pointerExited",e.update(o,x,y));if(d!=null&&d.isEnabled===true){pkg.$pointerOwner[e.identifier]=d;b=ui.events.fire("pointerEntered",e.update(d,x,y))||b}}else{if(d!==null&&d.isEnabled===true){b=ui.events.fire("pointerMoved",e.update(d,x,y))}}}else{if(d!==null&&d.isEnabled===true){pkg.$pointerOwner[e.identifier]=d;b=ui.events.fire("pointerEntered",e.update(d,x,y))}}return b};this.$pointerDragStarted=function(e){var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),d=this.getComponentAt(x,y);if(d!==null&&d.isEnabled===true){return ui.events.fire("pointerDragStarted",e.update(d,x,y))}return false};this.$pointerDragged=function(e){if(pkg.$pointerOwner[e.identifier]!=null){return ui.events.fire("pointerDragged",e.update(pkg.$pointerOwner[e.identifier],this.$toElementX(e.pageX,e.pageY),this.$toElementY(e.pageX,e.pageY)))}return false};this.$pointerDragEnded=function(e){if(pkg.$pointerOwner[e.identifier]!=null){return ui.events.fire("pointerDragEnded",e.update(pkg.$pointerOwner[e.identifier],this.$toElementX(e.pageX,e.pageY),this.$toElementY(e.pageX,e.pageY)))}return false};this.$isBlockedByLayer=function(id,method,e){for(var i=this.kids.length-1;i>=0;i--){var layer=this.kids[i];if(typeof layer[method]!=="undefined"){e.id=id;if(layer[method](e)===true){return true}}}return false};this.$pointerClicked=function(e){var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),d=this.getComponentAt(x,y);if(d===null){this.recalcOffset();x=this.$toElementX(e.pageX,e.pageY);y=this.$toElementY(e.pageX,e.pageY);d=this.getComponentAt(x,y)}if(d!==null){e=e.update(d,x,y);if(this.$isBlockedByLayer("pointerClicked","layerPointerClicked",e)){return true}else{return ui.events.fire("pointerClicked",e)}}else{return false}};this.$pointerDoubleClicked=function(e){var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),d=this.getComponentAt(x,y);return d!==null?ui.events.fire("pointerDoubleClicked",e.update(d,x,y)):false};this.$pointerReleased=function(e){var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),pp=pkg.$pointerPressedOwner[e.identifier];if(pp!=null){try{e=e.update(pp,x,y);if(this.$isBlockedByLayer("pointerReleased","layerPointerReleased",e)!==true){ui.events.fire("pointerReleased",e)}}finally{delete pkg.$pointerPressedOwner[e.identifier]}}if(e.pointerType==="mouse"&&(e.pressPageX!==e.pageX||e.pressPageY!==e.pageY)){var nd=this.getComponentAt(x,y),po=this.getComponentAt(this.$toElementX(e.pressPageX,e.pressPageY),this.$toElementY(e.pressPageX,e.pressPageY));if(nd!==po){if(po!==null){pkg.$pointerOwner[e.identifier]=null;ui.events.fire("pointerExited",e.update(po,x,y))}if(nd!==null&&nd.isEnabled===true){pkg.$pointerOwner[e.identifier]=nd;ui.events.fire("pointerEntered",e.update(nd,x,y))}}}};this.$pointerPressed=function(e){var x=this.$toElementX(e.pageX,e.pageY),y=this.$toElementY(e.pageX,e.pageY),pp=pkg.$pointerPressedOwner[e.identifier];if(pp!=null){try{ui.events.fire("pointerReleased",e.update(pp,x,y))}finally{delete pkg.$pointerPressedOwner[e.identifier]}}e.source=null;e.x=x;e.y=y;if(this.$isBlockedByLayer("pointerPressed","layerPointerPressed",e)){return true}var d=this.getComponentAt(x,y);if(d!==null&&d.isEnabled===true){if(pkg.$pointerOwner[e.identifier]!==d){pkg.$pointerOwner[e.identifier]=d;ui.events.fire("pointerEntered",e.update(d,x,y))}pkg.$pointerPressedOwner[e.identifier]=d;if(ui.events.fire("pointerPressed",e.update(d,x,y))===true){delete pkg.$pointerPressedOwner[e.identifier];return true}}return false};this.getComponentAt=function(x,y){for(var i=this.kids.length;--i>=0;){var c=this.kids[i].getComponentAt(x,y);if(c!==null){var p=c;while((p=p.parent)!==null){if(typeof p.catchInput!=="undefined"&&(p.catchInput===true||p.catchInput!==false&&p.catchInput(c))){c=p}}return c}}return null};this.recalcOffset=function(){var poffx=this.offx,poffy=this.offy,ba=this.$container.getBoundingClientRect();this.offx=Math.round(ba.left)+zebkit.web.$measure(this.$container,"border-left-width")+zebkit.web.$measure(this.$container,"padding-left")+window.pageXOffset;this.offy=Math.round(ba.top)+zebkit.web.$measure(this.$container,"padding-top")+zebkit.web.$measure(this.$container,"border-top-width")+window.pageYOffset;if(this.offx!==poffx||this.offy!==poffy){this.relocated(this,poffx,poffy)}};this.getLayer=function(id){return this.$layers[id]};this.relocated=function(px,py){COMP_EVENT.source=this;COMP_EVENT.px=px;COMP_EVENT.py=py;ui.events.fire("compMoved",COMP_EVENT)};this.resized=function(pw,ph){COMP_EVENT.source=this;COMP_EVENT.prevWidth=pw;COMP_EVENT.prevHeight=ph;ui.events.fire("compSized",COMP_EVENT);this.repaint()};this.$initListeners=function(){new zebkit.web.PointerEventUnifier(this.$container,this);new zebkit.web.KeyEventUnifier(this.element,this);new zebkit.web.MouseWheelSupport(this.$container,this)};this.setSizeFull=function(b){if(this.isSizeFull!==true){if(zebkit.web.$contains(this.$container)!==true){throw new Error("zCanvas is not a part of DOM tree")}this.isSizeFull=true;this.setLocation(0,0);document.body.style["font-size"]="0px";var ws=zebkit.web.$viewPortSize();this.setSize(ws.width,ws.height)}}},function setSize(w,h){if(this.width!==w||h!==this.height){this.$super(w,h);pkg.$elBoundsUpdated()}return this},function setVisible(b){var prev=this.isVisible;this.$super(b);if(b!==prev){this.repaint()}return this},function vrp(){this.$super();if(zebkit.web.$contains(this.element)&&this.element.style.visibility==="visible"){this.repaint()}},function kidAdded(i,constr,c){if(this.$layers.hasOwnProperty(c.id)){throw new Error("Layer '"+c.id+"' already exist")}this.$layers[c.id]=c;if(c.id==="root")this.root=c;this.$super(i,constr,c)},function kidRemoved(i,c){delete this.$layers[c.id];if(c.id==="root")this.root=null;this.$super(i,c)}]);pkg.$elBoundsUpdated=function(){for(var i=pkg.zCanvas.$canvases.length-1;i>=0;i--){var c=pkg.zCanvas.$canvases[i];if(c.isFullSize===true){var ws=zebkit.web.$viewPortSize();c.setSize(ws.width+window.pageXOffset,ws.height+window.pageYOffset)}c.recalcOffset()}};var $wrt=null,$winSizeUpdated=false,$wpw=-1,$wph=-1;window.addEventListener("resize",function(e){var ws=zebkit.web.$viewPortSize();if($wpw!==window.innerWidth||$wph!==window.innerHeight){$wpw=window.innerWidth;$wph=window.innerHeight;if($wrt!==null){$winSizeUpdated=true}else{$wrt=zebkit.util.tasksSet.run(function(){if($winSizeUpdated===false){pkg.$elBoundsUpdated();this.shutdown();$wrt=null}$winSizeUpdated=false},200,150)}}},false);window.onbeforeunload=function(e){var msgs=[];for(var i=pkg.zCanvas.$canvases.length-1;i>=0;i--){if(typeof pkg.zCanvas.$canvases[i].saveBeforeLeave!=="undefined"){var m=pkg.zCanvas.$canvases[i].saveBeforeLeave();if(m!=null){msgs.push(m)}}}if(msgs.length>0){var message=msgs.join("  ");if(typeof e==="undefined"){e=window.event}if(e){e.returnValue=message}return message}};document.addEventListener("DOMNodeInserted",function(e){pkg.$elBoundsUpdated()},false);document.addEventListener("DOMNodeRemoved",function(e){for(var i=pkg.zCanvas.$canvases.length-1;i>=0;i--){var canvas=pkg.zCanvas.$canvases[i];if(zebkit.web.$contains(canvas.element)!==true){pkg.zCanvas.$canvases.splice(i,1);if(typeof canvas.saveBeforeLeave!=="undefined"){canvas.saveBeforeLeave()}}}pkg.$elBoundsUpdated()},false);var ui=pkg.cd("..");pkg.VideoPan=Class(ui.Panel,[function(src){var $this=this;this.video=document.createElement("video");this.source=document.createElement("source");this.source.setAttribute("src",src);this.video.appendChild(this.source);this.$super();this.video.addEventListener("canplaythrough",function(){$this._.playbackStateUpdated($this,"ready");$this.repaint();$this.$continuePlayback()},false);this.video.addEventListener("ended",function(){$this._.playbackStateUpdated($this,"end");$this.$interruptCancelTask()},false);this.video.addEventListener("pause",function(){$this._.playbackStateUpdated($this,"pause");$this.$interruptCancelTask()},false);this.video.addEventListener("play",function(){$this.$continuePlayback();$this._.playbackStateUpdated($this,"play")},false);this.video.addEventListener("progress",function(){if($this.$cancelTask!==null){$this.$interruptCancelTask();if($this.video.paused===false){$this.$continuePlayback();$this._.playbackStateUpdated($this,"continue")}}},false);this.source.addEventListener("error",function(e){$this.$interruptCancelTask();$this.$lastError=e.toString();$this._.playbackStateUpdated($this,"error");$this.repaint();$this.pause()},false);this.video.addEventListener("stalled",function(){$this.$cancelPlayback()},false);this.video.addEventListener("loadedmetadata",function(e){$this.videoWidth=this.videoWidth;$this.videoHeight=this.videoHeight;$this.$aspectRatio=$this.videoHeight>0?$this.videoWidth/$this.videoHeight:0;$this.vrp()},false)},function $clazz(){this.Listeners=zebkit.util.ListenersClass("playbackStateUpdated");this.SignLabel=Class(ui.Panel,[function $clazz(){this.font=new ui.Font("bold",18)},function setColor(c){this.kids[0].setColor(c);return this},function(title){this.$super(new zebkit.layout.FlowLayout("center","center"));this.add(new ui.Label(title).setFont(this.clazz.font));this.setBorder(new ui.Border("gray",1,8));this.setPadding(6);this.setBackground("white");this.setColor("black")}])},function $prototype(clazz){this.videoWidth=this.videoHeight=0;this.cancelationTimeout=2e4;this.showSign=true;this.$animStallCounter=this.$aspectRatio=0;this.$adjustProportions=true;this.$lastError=this.$videoBound=this.$cancelTask=null;this.$animCurrentTime=-1;this._=new this.clazz.Listeners;this.views={pause:new clazz.SignLabel("Pause, press to continue").toView(),replay:new clazz.SignLabel("Press to re-play").toView(),play:new clazz.SignLabel("Press to play").toView(),error:new clazz.SignLabel("Failed, press to re-try").setColor("red").toView(),waiting:new clazz.SignLabel("Waiting ...").setColor("orange").toView()};this.paint=function(g){if(this.video.paused===false&&this.video.ended===false&&this.$cancelTask===null){if(this.video.currentTime!==this.$animCurrentTime){this.$animStallCounter=0;this.repaint()}else{if(this.$animStallCounter>180){this.$cancelPlayback()}else{this.$animStallCounter++;this.repaint()}}}this.$animCurrentTime=this.video.currentTime;if(this.$videoBound===null){this.calcVideoBound()}g.drawImage(this.video,this.$videoBound.x,this.$videoBound.y,this.$videoBound.width,this.$videoBound.height);if(this.showSign){var sign=null;if(this.$lastError!==null){sign=this.views.error}else{if(this.$cancelTask!==null){sign=this.views.waiting}else if(this.video.ended){sign=this.views.replay}else if(this.video.paused){if(this.video.currentTime===0){sign=this.views.play}else{sign=this.views.pause}}}if(sign!==null){this.paintViewAt(g,"center","center",sign)}}};this.autoplay=function(b){this.video.autoplay=b;return this};this.pause=function(){if(this.video.paused===false){this.video.pause();this.repaint()}return this};this.mute=function(b){this.video.muted=b;return this};this.play=function(){if(this.video.paused===true){if(this.$lastError!==null){this.$lastError=null;this.video.load()}this.video.play();this.repaint()}return this};this.adjustProportions=function(b){if(this.$adjustProportions!==b){this.$adjustProportions=b;this.vrp()}return this};this.calcPreferredSize=function(target){return{width:this.videoWidth,height:this.videoHeight}};this.pointerClicked=function(e){if(this.isPaused()){this.play()}else{this.pause()}};this.isPaused=function(){return this.video.paused};this.isEnded=function(){return this.video.ended};this.getDuration=function(){return this.video.duration};this.compSized=function(e){this.$calcVideoBound()};this.recalc=function(){this.$calcVideoBound()};this.$calcVideoBound=function(){this.$videoBound={x:this.getLeft(),y:this.getTop(),width:this.width-this.getLeft()-this.getBottom(),height:this.height-this.getTop()-this.getBottom()};if(this.$adjustProportions===true&&this.$aspectRatio!==0){var ar=this.$videoBound.width/this.$videoBound.height;if(ar<this.$aspectRatio){this.$videoBound.height=Math.floor(this.$videoBound.height*ar/this.$aspectRatio)}else{this.$videoBound.width=Math.floor(this.$videoBound.width*this.$aspectRatio/ar)}this.$videoBound.x=Math.floor((this.width-this.$videoBound.width)/2);this.$videoBound.y=Math.floor((this.height-this.$videoBound.height)/2)}};this.$continuePlayback=function(){this.$interruptCancelTask();if(this.video.paused===false&&this.video.ended===false){this.$animCurrentTime=this.video.currentTime;this.$animStallCounter=0;this.repaint()}};this.$cancelPlayback=function(){if(this.video.paused===true||this.video.ended===true){this.$interruptCancelTask()}else{if(this.$cancelTask===null){var $this=this;this.$postponedTime=(new Date).getTime();this.$cancelTask=zebkit.environment.setInterval(function(){var dt=(new Date).getTime()-$this.$postponedTime;if(dt>$this.cancelationTimeout){try{if($this.video.paused===false){$this.$lastError="Playback failed";$this.pause();$this.repaint();$this._.playbackStateUpdated($this,"error")}}finally{$this.$interruptCancelTask()}}else{$this._.playbackStateUpdated($this,"wait")}},200)}}};this.$interruptCancelTask=function(){if(this.$cancelTask!==null){zebkit.environment.clearInterval(this.$cancelTask);this.$postponedTime=this.$cancelTask=null}}}]);zebkit.ui.$configWith(pkg);if(zebkit.isIE){window.focus()}});