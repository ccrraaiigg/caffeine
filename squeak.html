<html>
  <head>
    <meta charset="utf-8">
    <title>Caffeine</title>
    <link rel="icon" type="image/png" href="pictures/squeakjs.png">
    <link rel="stylesheet" href="css/squeakjs.css">
  </head>
  <body>
    <canvas id="squeak"
	    width="1000"
	    height="400"
	    onselectstart="return false;"
	    ondragstart="return false;"
	    style="visibility: 'invisible';
		   overflow: hidden;
		   webkit-user-select: none;
		   position: absolute;
		   top: 0px;
		   left: 0px"></canvas>
    <div id="sqSpinner"><div></div></div>

    <script src="js/squeakjs/squeak.js"></script>
    <script src="js/html/utilities.js"></script>
    <script>
        // We shouldn't be using setTimeout() anywhere...
        setTimeout(
          function () {
            // Attempt to keep this page embeddable in external non-secure origins.
            var magicWindow
            try {magicWindow = window.top.magicWindow}
            catch (exception) {magicWindow = null}

	    window.top.document.ontouchend = (event) => {
	      if (!window.top.muteButtonOverridden) {
		// Unlock HTML5 Audio - load a data url of short silence and play it
		// This will allow us to play web audio when the Apple iPhone/iPad hardware
		// mute toggle is on.
	      
		var silenceDataURL = "data:audio/mp3;base64,//MkxAAHiAICWABElBeKPL/RANb2w+yiT1g/gTok//lP/W/l3h8QO/OCdCqCW2Cw//MkxAQHkAIWUAhEmAQXWUOFW2dxPu//9mr60ElY5sseQ+xxesmHKtZr7bsqqX2L//MkxAgFwAYiQAhEAC2hq22d3///9FTV6tA36JdgBJoOGgc+7qvqej5Zu7/7uI9l//MkxBQHAAYi8AhEAO193vt9KGOq+6qcT7hhfN5FTInmwk8RkqKImTM55pRQHQSq//MkxBsGkgoIAABHhTACIJLf99nVI///yuW1uBqWfEu7CgNPWGpUadBmZ////4sL//MkxCMHMAH9iABEmAsKioqKigsLCwtVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVV//MkxCkECAUYCAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
		    tag = document.createElement("audio")
		
		tag.controls = false
		tag.preload = "auto"
		tag.loop = false
		tag.src = silenceDataURL

		tag.onended = () => {
		  window.top.muteButtonOverridden = true
		  console.log("iOS hardware mute switch overridden")}

		var p = tag.play()

		if (p) p.then(
		  () => {},
		  (reason) => {console.log("iOS hardware mute switch not overridden, HTML5 audio play failed", reason)})}

	      var caffeineElement = window.top.document.getElementById("Caffeine"),
                  embeddedSqueakElement = window.top.document.getElementById("embeddedSqueak")

              if (caffeineElement) {
                caffeineElement.contentWindow.focus()
                caffeineElement.ontouchend = window.top.document.ontouchend}

              embeddedSqueakElement.ontouchend = window.top.document.ontouchend
              embeddedSqueakElement.style.zIndex = 1000
              embeddedSqueakElement.style.boxShadow = "1px 1px 7px #999, 2px 2px 8px #999, 3px 3px 9px #999"}


            if (magicWindow) {
              magicWindow.squeakDisplay = window.startCaffeine(
                squeak,
                "caffeine",
                "SqueakV46",
                {
                  appID: "4599d316-a13e-46ef-92be-c7337899038c",
                  appName: "Caffeine",
                  appServer: "demo.blackpagedigital.com:8091"})}
            else {
              window.startCaffeine(
                squeak,
                "caffeine",
                "SqueakV46",
                {
                  appID: "4599d316-a13e-46ef-92be-c7337899038c",
                  appName: "Caffeine",
                  appServer: "demo.blackpagedigital.com:8091"})}},
          2000)
    </script>
  </body>
</html>
